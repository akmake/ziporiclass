ğŸš« .git/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)
ğŸ“„ .gitattributes
ğŸ“„ .gitignore
ğŸ“„ README.md
  # Zipori Class - ××¢×¨×›×ª × ×™×”×•×œ ×”×–×× ×•×ª ×•×ª×¤×¢×•×œ ××œ×•× ×•×ª
  
  ××¢×¨×›×ª CRM ×•-PMS (Property Management System) ××ª×§×“××ª ×œ× ×™×”×•×œ ×¨×©×ª ××œ×•× ×•×ª "×¦×™×¤×•×¨×™ ×§×œ××¡".
  ×”××¢×¨×›×ª ××¡×¤×§×ª ×¤×ª×¨×•×Ÿ ××§×¦×” ×œ×§×¦×”: ×”×—×œ ××©×œ×‘ ×§×œ×™×˜×ª ×”×œ×™×“ ×•×”×¦×¢×ª ×”××—×™×¨, ×•×¢×“ ×œ× ×™×”×•×œ ×”×ª×¤×¢×•×œ ×”×©×•×˜×£, × ×™×§×™×•×Ÿ ×”×—×“×¨×™× ×•×”×ª×—×–×•×§×”.
  
  ×”×¤×¨×•×™×§×˜ ×‘× ×•×™ ×‘××¨×›×™×˜×§×˜×•×¨×ª Monorepo ×•××›×™×œ:
  - **Client**: ××¤×œ×™×§×¦×™×™×ª React ××•×“×¨× ×™×ª ×¢× Vite, TailwindCSS (shadcn/ui), Zustand ×œ× ×™×”×•×œ ××¦×‘, React Query ×œ×¡× ×›×¨×•×Ÿ × ×ª×•× ×™× ×•-Framer Motion ×œ×× ×™××¦×™×•×ª.
  - **Server**: ×©×¨×ª Express ×—×–×§ ×¢× Node.js, ××¡×“ × ×ª×•× ×™× MongoDB, ××™××•×ª ×××•×‘×˜×— (JWT + CSRF), ×•××¢×¨×›×ª ×”×ª×¨××•×ª (Web Push).
  
  ---
  
  ## âœ¨ ×¤×™×¦'×¨×™× ××¨×›×–×™×™×
  
  ### ğŸ¨ × ×™×”×•×œ ×”×–×× ×•×ª ×•××›×™×¨×•×ª (CRM)
  - **× ×™×”×•×œ ×œ×™×“×™×:** ×§×œ×™×˜×” ××•×˜×•××˜×™×ª ×©×œ ×¤× ×™×•×ª (Webhooks), ×¡×™× ×•×Ÿ, ×¡×˜×˜×•×¡×™× ×•××¢×§×‘.
  - **×”×–×× ×•×ª:** ×™×¦×™×¨×ª ×”×–×× ×•×ª ××•×¨×›×‘×•×ª, × ×™×”×•×œ ××—×™×¨×•× ×™× ×“×™× ××™×™×, ×—×™×©×•×‘ ××—×™×¨×™× ××•×˜×•××˜×™ ×œ×¤×™ ×”×¨×›×‘ ××•×¨×—×™×.
  - **×”×¦×¢×•×ª ××—×™×¨:** ×”×¤×§×ª ×“×¤×™ × ×—×™×ª×” ×œ×”×¦×¢×ª ××—×™×¨ ×•×™×™×¦×•× ×œ-PDF ×œ×©×œ×™×—×” ×œ×œ×§×•×—.
  - **××—×©×‘×•× ×™×:** ×œ×•×’×™×§×” ×¢×¡×§×™×ª ×—×›××” ×œ×—×™×©×•×‘ ×¢×œ×•×™×•×ª, ×ª×•×¡×¤×•×ª ×•×”× ×—×•×ª.
  
  ### ğŸ§¹ ×ª×¤×¢×•×œ ×•××—×–×§×” (Operations)
  - **×ª××•× ×ª ××¦×‘ ×—×“×¨×™× (Live):** ×“×©×‘×•×¨×“ ×‘×–××Ÿ ×××ª ×”××¦×™×’ ×—×“×¨×™× × ×§×™×™×, ××œ×•×›×œ×›×™× ××• ×‘×ª×§×œ×”.
  - **×¡×™×“×•×¨ ×¢×‘×•×“×” ×™×•××™:** ×”×§×¦××ª ××©×™××•×ª ×œ××—×¨ (Checkout / Stayover).
  - **× ×™×”×•×œ ××©×™××•×ª:** ×¦'×§ ×œ×™×¡×˜×™× ×œ× ×™×§×™×•×Ÿ, ×“×™×•×•×— ×ª×§×œ×•×ª ×•×ª×™×§×•× ×™×.
  - **×××©×§ ×¢×•×‘×“:** ××¡×š ××•×ª×× ×œ×¢×•×‘×“×™ ×©×˜×— ×œ×“×™×•×•×— ×‘×™×¦×•×¢ ×‘×–××Ÿ ×××ª.
  
  ### ğŸ›¡ï¸ × ×™×”×•×œ ×•×‘×§×¨×” (Admin)
  - **×“×©×‘×•×¨×“ ×× ×”×œ×™×:** ×¡×˜×˜×™×¡×˜×™×§×•×ª, ×’×¨×¤×™×, ×”×›× ×¡×•×ª ×•×‘×™×¦×•×¢×™ ×× ×©×™ ××›×™×¨×•×ª.
  - **××©×ª××©×™× ×•×”×¨×©××•×ª:** × ×™×”×•×œ ×ª×¤×§×™×“×™× (Admin, Sales, Maintenance) ×•×‘×§×¨×ª ×’×™×©×”.
  - **×”×’×“×¨×•×ª ××¢×¨×›×ª:** × ×™×”×•×œ ××œ×•× ×•×ª, ×¡×•×’×™ ×—×“×¨×™×, ××—×™×¨×•× ×™× ×•×”×•×“×¢×•×ª ××¢×¨×›×ª.
  - **×”×ª×¨××•×ª:** ××¢×¨×›×ª Push Notifications ×œ×¢×“×›×•×Ÿ ×¢×œ ×œ×™×“×™× ×—×“×©×™× ×’× ×›×©×”×“×¤×“×¤×Ÿ ×¡×’×•×¨.
  
  ---
  
  ## ğŸš€ ×”×¨×¦×” ××§×•××™×ª (×¤×™×ª×•×—)
  
  ### 1. ×“×¨×™×©×•×ª ×§×“×
  - Node.js (×’×¨×¡×” 18+)
  - MongoDB (××§×•××™ ××• Atlas URI)
  
  ### 2. ×”×ª×§× ×ª ×ª×œ×•×™×•×ª
  ×”×¨×¥ ××ª ×”×¤×§×•×“×” ×”×‘××” ×‘×ª×™×§×™×™×” ×”×¨××©×™×ª ×›×“×™ ×œ×”×ª×§×™×Ÿ ×ª×œ×•×™×•×ª ×œ×©×¨×ª ×•×œ×œ×§×•×—:
  ```bash
  npm install
  cd client && npm install
  cd ../server && npm install
ğŸ“ client/
  ğŸ“„ .env.development.local
  ğŸ“„ components.json
  ğŸ“„ index.html
    <!doctype html>
    <html lang="he" dir="rtl">
      <head>
        <meta charset="UTF-8" />
        <!-- ×¢×“×›×Ÿ ××ª ×”× ×ª×™×‘ ×œ-favicon ×× ×™×© ×œ×š ××—×“ -->
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <!-- ×™×™×‘×•× ×¤×•× ×˜ Assistant -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    
        <!-- ×©× ×” ××ª ×”×›×•×ª×¨×ª ×œ×›×•×ª×¨×ª ×”×¤×¨×•×™×§×˜ ×©×œ×š -->
        <title>× ×™×”×•×œ ×”×–×× ×•×ª</title>
      </head>
      <body class="bg-gray-50 text-gray-800">
        <div id="root"></div>
        <!-- ×–×” ×”×—×œ×§ ×”×›×™ ×—×©×•×‘ - ×”×•× ×˜×•×¢×Ÿ ××ª ××¤×œ×™×§×¦×™×™×ª ×”×¨×™××§×˜ ×©×œ×š -->
        <script type="module" src="/src/main.jsx"></script>
      </body>
    </html>
  ğŸ“„ jsconfig.json
  ğŸ“„ localhost-key.pem
  ğŸ“„ localhost.pem
  ğŸ“„ mkcert.exe
  ğŸš« node_modules/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)
  ğŸ“„ package.json
  ğŸ“„ postcss.config.cjs
    module.exports = {
      plugins: {
        tailwindcss: {},
        autoprefixer: {},
      },
    };
  ğŸ“ public/
    ğŸ“„ favicon.svg
    ğŸ“„ notification.mp3
    ğŸ“„ sw.js
      // client/public/sw.js
      
      self.addEventListener('push', function(event) {
        // ×§×‘×œ×ª ×”× ×ª×•× ×™× ××”×©×¨×ª
        const data = event.data ? JSON.parse(event.data.text()) : {};
      
        const options = {
          body: data.body || '×™×© ×œ×š ×”×•×“×¢×” ×—×“×©×” ×‘××¢×¨×›×ª',
          icon: data.icon || '/favicon.svg',
          badge: '/favicon.svg', // ××™×™×§×•×Ÿ ×§×˜×Ÿ ×‘×©×•×¨×ª ×”×”×ª×¨××•×ª (×× ×“×¨×•××™×“)
          data: {
              url: data.url || '/' // ×”-URL ×©× ×¤×ª×— ×‘×œ×—×™×¦×”
          }
        };
      
        event.waitUntil(
          self.registration.showNotification(data.title || '×”×ª×¨××” ×—×“×©×”', options)
        );
      });
      
      self.addEventListener('notificationclick', function(event) {
        event.notification.close();
      
        // ×œ×—×™×¦×” ×¢×œ ×”×”×ª×¨××” ×¤×•×ª×—×ª ××ª ×”××ª×¨
        event.waitUntil(
          clients.matchAll({ type: 'window', includeUncontrolled: true }).then(function(clientList) {
            // ×× ×™×© ×˜××‘ ×¤×ª×•×—, ×ª×¢×‘×•×¨ ××œ×™×•
            for (let i = 0; i < clientList.length; i++) {
              let client = clientList[i];
              if (client.url && 'focus' in client) {
                return client.focus();
              }
            }
            // ×× ××™×Ÿ ×˜××‘, ×¤×ª×— ×—×“×© ×¢× ×”×›×ª×•×‘×ª ×©×”×’×™×¢×” ××”×©×¨×ª
            if (clients.openWindow) {
              return clients.openWindow(event.notification.data.url);
            }
          })
        );
      });
  ğŸ“ src/
    ğŸ“„ App.jsx
      import { Routes, Route } from "react-router-dom";
      
      /* Layout & Route Protection */
      import Layout from "@/components/Layout.jsx";
      import AdminRoute from "@/components/routes/AdminRoute.jsx";
      import SalesRoute from "@/components/routes/SalesRoute.jsx";
      import MaintenanceRoute from "@/components/routes/MaintenanceRoute.jsx";
      import PriceListManagerRoute from "@/components/routes/PriceListManagerRoute.jsx";
      
      /* Public Pages */
      import HomePage from "@/pages/HomePage.jsx";
      import LoginPage from "@/pages/LoginPage.jsx";
      import QuotePage from '@/pages/QuotePage.jsx';
      import NotFoundPage from "@/pages/NotFoundPage.jsx";
      
      /* Sales Pages */
      import OrdersPage from '@/pages/OrdersPage.jsx';
      import OrderPage from '@/pages/OrderPage.jsx';
      import EditOrderPage from '@/pages/EditOrderPage.jsx';
      import LeadsPage from '@/pages/LeadsPage.jsx';
      import PricingLogicPage from '@/pages/PricingLogicPage.jsx';
      
      /* Maintenance Pages */
      import MaintenanceDashboardPage from '@/pages/maintenance/MaintenanceDashboardPage.jsx';
      
      /* Admin Pages */
      import AdminDashboardPage from "@/pages/admin/AdminDashboardPage.jsx";
      import AdminMaintenanceDashboard from "@/pages/admin/AdminMaintenanceDashboard.jsx";
      import ManagePhysicalRoomsPage from '@/pages/admin/ManagePhysicalRoomsPage.jsx';
      import RoomStatusPage from '@/pages/admin/RoomStatusPage.jsx';
      import DailyPlanPage from '@/pages/admin/DailyPlanPage.jsx';
      import ManagePriceListsPage from '@/pages/admin/ManagePriceListsPage.jsx';
      import ManageOrdersPage from '@/pages/admin/ManageOrdersPage.jsx';
      import ManageUsersPage from "@/pages/admin/ManageUsersPage.jsx";
      import ManageHotelsPage from './pages/admin/ManageHotelsPage.jsx';
      import AffiliateReportsPage from '@/pages/admin/AffiliateReportsPage.jsx';
      import ManageAnnouncementsPage from '@/pages/admin/ManageAnnouncementsPage.jsx';
      import ManageReferrersPage from '@/pages/admin/ManageReferrersPage.jsx';
      import ManageExtrasPage from '@/pages/admin/ManageExtrasPage.jsx';
      
      // âœ¨ ×™×™×‘×•× ×”×× ×”×œ ×”×—×“×©
      import PushNotificationManager from "@/components/PushNotificationManager.jsx";
      
      export default function App() {
        return (
          <>
            {/* âœ¨ ×”×¤×¢×œ×ª ×× ×”×œ ×”×”×ª×¨××•×ª ×‘×¨×§×¢ */}
            <PushNotificationManager />
      
            <Routes>
              <Route path="/quote/:orderId" element={<QuotePage />} />
      
              <Route path="/" element={<Layout />}>
                <Route path="login" element={<LoginPage />} />
      
                {/* --- Sales & General Admin --- */}
                <Route element={<SalesRoute />}>
                  <Route index element={<HomePage />} />
                  <Route path="new-order" element={<OrderPage />} />
                  <Route path="orders-history" element={<OrdersPage />} />
                  <Route path="edit-order/:orderId" element={<EditOrderPage />} />
                  <Route path="leads" element={<LeadsPage />} />
                  <Route path="sales-guide" element={<PricingLogicPage />} />
                </Route>
      
                {/* --- Maintenance Workers --- */}
                <Route element={<MaintenanceRoute />}>
                   <Route path="maintenance" element={<MaintenanceDashboardPage />} />
                </Route>
      
                <Route element={<PriceListManagerRoute />}>
                    <Route path="manage-pricelists" element={<ManagePriceListsPage />} />
                </Route>
      
                {/* --- Admin Panel --- */}
                <Route path="admin" element={<AdminRoute />}>
                  <Route index element={<AdminDashboardPage />} />
      
                  <Route path="maintenance" element={<AdminMaintenanceDashboard />} />
                  <Route path="rooms/create" element={<ManagePhysicalRoomsPage />} />
      
                  {/* ×“×¤×™ ×ª×¤×¢×•×œ ×•× ×™×”×•×œ ×—×“×¨×™× */}
                  <Route path="rooms-status" element={<RoomStatusPage />} />
                  <Route path="daily-plan" element={<DailyPlanPage />} />
      
                  {/* ×©××¨ ×“×¤×™ ×”× ×™×”×•×œ */}
                  <Route path="orders" element={<ManageOrdersPage />} />
                  <Route path="users" element={<ManageUsersPage />} />
                  <Route path="hotels" element={<ManageHotelsPage />} />
                  <Route path="affiliates" element={<AffiliateReportsPage />} />
                  <Route path="extras" element={<ManageExtrasPage />} />
                  <Route path="referrers" element={<ManageReferrersPage />} />
                  <Route path="announcements" element={<ManageAnnouncementsPage />} />
                </Route>
      
                <Route path="*" element={<NotFoundPage />} />
              </Route>
            </Routes>
          </>
        );
      }
    ğŸ“ components/
      ğŸ“„ Layout.jsx
        // client/src/components/Layout.jsx
        import { Outlet } from 'react-router-dom';
        import Navbar from './Navbar.jsx'; // Navbar ×©×œ×š ×›×‘×¨ ××˜×¤×œ ×‘××•×‘×™×™×œ/×“×¡×§×˜×•×¤
        import { Toaster } from "@/components/ui/Toaster.jsx";
        
        export default function Layout() {
          return (
            <>
              {/* ×¨×›×™×‘ ×”-Navbar ×©×œ×š ×›×‘×¨ ×‘× ×•×™ ×¢× ×”×”×™×’×™×•×Ÿ
                ×œ×”×¦×’×ª ×¡×¨×’×œ ×¦×“ ×‘×“×¡×§×˜×•×¤ (hidden md:flex) [cite: 245]
                ×•×¡×¨×’×œ ×¢×œ×™×•×Ÿ ×‘××•×‘×™×™×œ (md:hidden)[cite: 247].
                ×× ×—× ×• ×¤×©×•×˜ × ×•×ª× ×™× ×œ×• ×œ×¢×©×•×ª ××ª ×”×¢×‘×•×“×”.
              */}
              <Navbar />
        
              {/* ×–×” ×”×—×œ×§ ×”×¢×™×§×¨×™ ×©×œ ×”×ª×•×›×Ÿ.
                × ×•×¡×™×£ ×œ×• 'padding' ××™××™×Ÿ (pr) ×‘××—×©×‘×™× ×’×“×•×œ×™× (md)
                ×›×“×™ ×©×œ× ×™×¡×ª×ª×¨ ×××—×•×¨×™ ×¡×¨×’×œ ×”×¦×“ ×”×§×‘×•×¢.
                ×‘××•×‘×™×™×œ, ×”×•× ×™×ª×¤×•×¡ ×¨×•×—×‘ ××œ×.
              */}
              <div className="flex-1 md:pr-64">
                {/* ××–×•×¨ ×”×ª×•×›×Ÿ ×”×“×™× ××™ */}
                <main className="flex-1">
                  <Outlet />
                </main>
              </div>
        
              {/* Toaster ×œ×”×•×“×¢×•×ª ×§×•×¤×¦×•×ª */}
              <Toaster />
            </>
          );
        }
      ğŸ“„ LeadsBell.jsx
        // client/src/components/LeadsBell.jsx
        
        import React, { useRef, useMemo } from 'react';
        import { useQuery } from '@tanstack/react-query';
        import { Link } from 'react-router-dom';
        import api from '@/utils/api.js';
        // 1. ×™×™×‘×•× ×”-hook ×”× ×›×•×Ÿ ×¢×‘×•×¨ ×”×”×ª×¨××•×ª (shadcn)
        import { useToast } from "@/hooks/use-toast.js";
        import { Bell } from 'lucide-react';
        
        // --- ×”×’×“×¨×ª ×¦×œ×™×œ ---
        // 1. ×”× ×— ×§×•×‘×¥ ×¦×œ×™×œ (×œ××©×œ, 'notification.mp3') ×‘×ª×™×§×™×™×” 'client/public'.
        const notificationSound = new Audio('/notification.mp3');
        // ---------------------------------
        
        const fetchLeads = async () => {
          const { data } = await api.get('/leads');
          return data;
        };
        
        export function LeadsBell() {
          // 2. ×”×¤×¢×œ ××ª ×”-hook ×©×œ shadcn ×›×“×™ ×œ×§×‘×œ ××ª ×¤×•× ×§×¦×™×™×ª toast
          const { toast } = useToast();
          // 3. Ref ×©×™×–×›×•×¨ ××ª ××–×”×™ ×”×¤× ×™×•×ª ×©×¨××™× ×•
          const previousProcessedLeadIds = useRef(null);
          // ××ª×—×™×œ ×‘-null ×›×“×™ ×œ×–×”×•×ª ×˜×¢×™× ×” ×¨××©×•× ×”
        
          // 4. ×©××™×œ×ª×” ××•×˜×•××˜×™×ª ×›×œ 10 ×©× ×™×•×ª
          const { data: leads } = useQuery({
            queryKey: ['leads'],
            queryFn: fetchLeads,
            refetchInterval: 10000, // ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×›×œ 10 ×©× ×™×•×ª
        
            onSuccess: (data) => {
              // 5. ××¦× ××ª ×›×œ ×”×œ×™×“×™× ×”× ×•×›×—×™×™× ×©×‘××¦×‘ "×œ× × ×¢× ×”"
              const currentNewLeads = data.filter(lead => lead.status === 'new');
              const currentNewIds = new Set(currentNewLeads.map(lead => lead._id));
        
              // 6. ×‘×“×™×§×” ×× ×–×• ×”×˜×¢×™× ×” ×”×¨××©×•× ×” ×©×œ ×”×¨×›×™×‘
              if (previousProcessedLeadIds.current === null) {
                // ×‘×˜×¢×™× ×” ×¨××©×•× ×”, ×× ×—× ×• ×¨×§ ×©×•××¨×™× ××ª ×”××¦×‘ ×”×§×™×™× ×•×œ× ××§×¤×™×¦×™× ×”×ª×¨××•×ª
                previousProcessedLeadIds.current = currentNewIds;
                return;
              }
        
              // 7. × ××¦× ××ª ×”×¤× ×™×•×ª ×”"×—×“×©×•×ª" (××œ×• ×©×§×™×™××•×ª ×‘×¨×©×™××” ×”×—×“×©×” ××š ×œ× ×”×™×• ×‘×¨×©×™××” ×”×§×•×“××ª)
              const newLeads = currentNewLeads.filter(
                lead => !previousProcessedLeadIds.current.has(lead._id)
              );
        
              // 8. ×× ×™×© ×¤× ×™×•×ª ×—×“×©×•×ª - × ×§×¤×™×¥ ×”×ª×¨××” ×•× ×’×Ÿ ×¦×œ×™×œ
              if (newLeads.length > 0) {
                try {
                  // × ×’×Ÿ ××ª ×”×¦×œ×™×œ (×¤×¢× ××—×ª, ×’× ×× × ×›× ×¡×• ×›××” ×¤× ×™×•×ª ×‘×™×—×“)
                  notificationSound.play().catch(e => console.warn("×œ× × ×™×ª×Ÿ ×”×™×” ×œ× ×’×Ÿ ×¦×œ×™×œ ×”×ª×¨××” (×™×™×ª×›×Ÿ ×©× ×“×¨×©×ª ××™× ×˜×¨××§×¦×™×” ×¨××©×•× ×™×ª ×¢× ×”×“×£):", e));
                } catch (e) {
                  console.warn("×©×’×™××” ×‘× ×™×’×•×Ÿ ×¦×œ×™×œ:", e);
                }
        
                // × ×§×¤×™×¥ ×”×ª×¨××” × ×¤×¨×“×ª ×œ×›×œ ×¤× ×™×™×” ×—×“×©×”
                newLeads.forEach(lead => {
                  const leadName = lead.parsedName || '×¤× ×™×™×” ×—×“×©×”';
        
                  // 9. ×©×™××•×© ×‘×¤×•× ×§×¦×™×™×ª ×”-toast ×©×œ shadcn
                  toast({
                    title: "ğŸ”¥ ×¤× ×™×™×” ×—×“×©×” ×”×ª×§×‘×œ×”!",
                    description: `×”×’×™×¢×” ×”×•×“×¢×” ×—×“×©×” ×${leadName}.`,
                  });
                });
              }
        
              // 10. ×¢×“×›×•×Ÿ ×”×–×™×›×¨×•×Ÿ ×œ××¦×‘ ×”× ×•×›×—×™
              previousProcessedLeadIds.current = currentNewIds;
            }
          });
        
          // 11. ×—×™×©×•×‘ ×¡×¤×™×¨×ª ×”×¤× ×™×•×ª ×”×¤×ª×•×—×•×ª (×¡×˜×˜×•×¡ 'new')
          const openLeadsCount = useMemo(() => {
            if (!leads) return 0;
            // ×¡×¤×•×¨ ×œ×™×“×™× ×©×”× "×œ× × ×¢× ×”" (new)
            return leads.filter(lead => lead.status === 'new').length;
          }, [leads]);
        
          // 12. ×”×¨×›×™×‘ ×”×•×™×–×•××œ×™
          return (
            <Link to="/leads" className="relative text-2xl text-gray-600 hover:text-amber-600" aria-label="×¤×ª×— ×ª×™×‘×ª ×¤× ×™×•×ª">
              <Bell size={24} />
              {openLeadsCount > 0 && (
                <span className="absolute -top-2 -right-3 bg-red-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                  {openLeadsCount}
                </span>
              )}
            </Link>
          );
        }
      ğŸ“„ Navbar.jsx
        import { useState } from "react";
        import { Link, NavLink } from "react-router-dom";
        import {
            Menu, X, LogOut, Home, PlusCircle, User, ChevronDown, FileText, ListOrdered, Shield,
            Mail, Calculator, Wrench, CalendarDays, Activity, Paintbrush
        } from "lucide-react";
        import { motion, AnimatePresence } from "framer-motion";
        import { useAuthStore } from "@/stores/authStore.js";
        import { Button } from "@/components/ui/Button.jsx";
        import {
          DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator,
        } from "@/components/ui/Dropdown-menu";
        import { LeadsBell } from './LeadsBell';
        
        // ×œ×•×’×™×§×” ×œ×‘× ×™×™×ª ×”×ª×¤×¨×™×˜×™× ×œ×¤×™ ×”×¨×©××•×ª
        const getNavGroups = (isAuthenticated, user) => {
          if (!isAuthenticated) return null;
        
          const role = user?.role;
          const groups = {
              sales: [],
              maintenance: [],
              admin: []
          };
        
          // 1. ×§×‘×•×¦×ª ××›×™×¨×•×ª (Sales)
          if (role === 'admin' || role === 'sales') {
              groups.sales = [
                { to: '/', label: '×¨××©×™ (××›×™×¨×•×ª)', icon: Home },
                { to: '/new-order', label: '×”×–×× ×” ×—×“×©×”', icon: PlusCircle },
                { to: '/orders-history', label: '×”×–×× ×•×ª ×•×”×¦×¢×•×ª', icon: FileText },
                { to: '/leads', label: '×ª×™×‘×ª ×¤× ×™×•×ª', icon: Mail },
                { to: '/sales-guide', label: '××—×©×‘×•×Ÿ ×•××“×¨×™×š', icon: Calculator },
              ];
              if (user?.canManagePriceLists || role === 'admin') {
                groups.sales.push({ to: '/manage-pricelists', label: '× ×™×”×•×œ ××—×™×¨×•× ×™×', icon: ListOrdered });
              }
          }
        
          // 2. ×§×‘×•×¦×ª ×ª×¤×¢×•×œ (Maintenance)
          if (role === 'admin' || role === 'maintenance') {
              groups.maintenance = [
                  { to: '/admin/maintenance', label: '××¨×›×– ×ª×¤×¢×•×œ', icon: Wrench },
                  { to: '/admin/daily-plan', label: '×¡×™×“×•×¨ ×¢×‘×•×“×”', icon: CalendarDays },
                  { to: '/admin/rooms-status', label: '×ª××•× ×ª ××¦×‘', icon: Activity },
                  { to: '/maintenance', label: '××¡×š ×¢×•×‘×“ ×©×˜×—', icon: Paintbrush },
              ];
          }
        
          // 3. ×§×‘×•×¦×ª ××“××™×Ÿ ×›×œ×œ×™ (Admin)
          if (role === 'admin') {
              groups.admin = [
                  { to: '/admin', label: '×“×©×‘×•×¨×“ ×× ×”×œ', icon: Shield },
              ];
          }
        
          return groups;
        };
        
        export default function Navbar() {
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const { isAuthenticated, user, logout } = useAuthStore();
        
            const navGroups = getNavGroups(isAuthenticated, user);
        
            return (
                <>
                    {/* Sidebar for Desktop */}
                    <div className="hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0">
                        <SidebarContent
                            groups={navGroups}
                            user={user}
                            isAuthenticated={isAuthenticated}
                            logout={logout}
                        />
                    </div>
        
                    {/* Mobile Top Bar */}
                    <div className="md:hidden flex items-center justify-between bg-white dark:bg-slate-900 border-b h-16 px-4">
                        <Link to="/" className="text-xl font-extrabold tracking-tight bg-gradient-to-r from-primary to-amber-600 bg-clip-text text-transparent">
                             ZIPORI CLASS
                        </Link>
        
                        <div className="flex items-center gap-4">
                          {/* ×¤×¢××•×Ÿ ×‘× ×™×™×“ */}
                          {isAuthenticated && user?.role !== 'maintenance' && <LeadsBell />}
        
                          <Button variant="ghost" size="icon" onClick={() => setSidebarOpen(true)}>
                             <Menu className="h-6 w-6" />
                          </Button>
                        </div>
                    </div>
        
                    {/* Mobile Drawer */}
                    <AnimatePresence>
                        {sidebarOpen && (
                            <motion.div
                                initial={{ x: '100%' }}
                                animate={{ x: 0 }}
                                exit={{ x: '100%' }}
                                transition={{ type: 'spring', stiffness: 300, damping: 30 }}
                                className="fixed inset-y-0 right-0 z-50 w-64 md:hidden"
                            >
                                <SidebarContent
                                    groups={navGroups}
                                    user={user}
                                    isAuthenticated={isAuthenticated}
                                    logout={logout}
                                    onClose={() => setSidebarOpen(false)}
                                />
                            </motion.div>
                        )}
                    </AnimatePresence>
                </>
              );
        }
        
        function SidebarContent({ groups, user, isAuthenticated, logout, onClose }) {
            const handleLogout = () => {
                logout();
                if (onClose) onClose();
            };
        
            return (
                <div className="flex flex-col flex-grow border-l border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-900 overflow-y-auto h-full shadow-xl">
                    {/* Header / Logo */}
                    <div className="flex items-center justify-between h-16 flex-shrink-0 px-4 bg-slate-50 border-b">
                        <Link to="/" onClick={onClose} className="text-xl font-extrabold tracking-tight bg-gradient-to-r from-primary to-amber-600 bg-clip-text text-transparent">
                            ZIPORI CLASS
                        </Link>
        
                        {/* âœ¨ ×”×ª×™×§×•×Ÿ ×›××Ÿ: ×”×¡×¨×ª×™ ××ª md:hidden ×›×“×™ ×©×”×¤×¢××•×Ÿ ×™×•×¤×™×¢ ×’× ×‘××—×©×‘ âœ¨ */}
                        <div className="flex items-center gap-3">
                            {isAuthenticated && user?.role !== 'maintenance' && <LeadsBell />}
        
                            {/* ×›×¤×ª×•×¨ ×¡×’×™×¨×” - ×™×•×¤×™×¢ ×¨×§ ×× ×™×© ×¤×•× ×§×¦×™×™×ª ×¡×’×™×¨×” (×›×œ×•××¨ ×‘× ×™×™×“) */}
                            {onClose && (
                                <Button variant="ghost" size="icon" onClick={onClose}>
                                    <X className="h-6 w-6" />
                                </Button>
                            )}
                        </div>
                    </div>
        
                    {/* Nav Items Section */}
                    <div className="flex-1 flex flex-col py-4 px-3 gap-6">
        
                        {/* 1. ×§×‘×•×¦×ª ××›×™×¨×•×ª */}
                        {groups?.sales?.length > 0 && (
                            <div>
                                <h3 className="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">××¢×¨×›×ª ×”×–×× ×•×ª</h3>
                                <nav className="space-y-1">
                                    {groups.sales.map((item) => (
                                        <NavItem key={item.to} item={item} onClick={onClose} />
                                    ))}
                                </nav>
                            </div>
                        )}
        
                        {/* 2. ×§×‘×•×¦×ª ×ª×¤×¢×•×œ */}
                        {groups?.maintenance?.length > 0 && (
                            <div>
                                {(groups.sales?.length > 0) && <div className="my-2 border-t border-gray-100"></div>}
                                <h3 className="px-3 text-xs font-semibold text-amber-600 uppercase tracking-wider mb-2 mt-2">×ª×¤×¢×•×œ ×•× ×™×§×™×•×Ÿ</h3>
                                <nav className="space-y-1">
                                    {groups.maintenance.map((item) => (
                                        <NavItem key={item.to} item={item} onClick={onClose} />
                                    ))}
                                </nav>
                            </div>
                        )}
        
                        {/* 3. ×§×‘×•×¦×ª ××“××™×Ÿ */}
                        {groups?.admin?.length > 0 && (
                            <div>
                                {(groups.sales?.length > 0 || groups.maintenance?.length > 0) && <div className="my-2 border-t border-gray-100"></div>}
                                <h3 className="px-3 text-xs font-semibold text-purple-600 uppercase tracking-wider mb-2 mt-2">× ×™×”×•×œ ×¨××©×™</h3>
                                <nav className="space-y-1">
                                    {groups.admin.map((item) => (
                                        <NavItem key={item.to} item={item} onClick={onClose} />
                                    ))}
                                </nav>
                            </div>
                        )}
                    </div>
        
                    {/* Footer User Area */}
                    <div className="px-2 py-4 border-t dark:border-slate-800 bg-gray-50">
                        {isAuthenticated ? (
                            <UserNav user={user} logout={handleLogout} />
                        ) : (
                            <div className="space-y-2">
                                <Button variant="ghost" asChild className="w-full justify-start">
                                    <Link to="/login" onClick={onClose}><User className="ml-2 h-4 w-4" />×”×ª×—×‘×¨×•×ª</Link>
                                 </Button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // ×¨×›×™×‘ ×¤×¨×™×˜ × ×™×•×•×˜
        function NavItem({ item, onClick }) {
            const navLinkClass = "group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors";
            const activeClass = "bg-slate-100 dark:bg-slate-800 text-primary dark:text-white";
            const inactiveClass = "text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary dark:hover:text-white";
            return (
                <NavLink
                    to={item.to}
                    onClick={onClick}
                    className={({ isActive }) => `${navLinkClass} ${isActive ? activeClass : inactiveClass}`}
                  >
                    <item.icon className="ml-3 flex-shrink-0 h-5 w-5" />
                    {item.label}
                </NavLink>
            );
        }
        
        // ×¨×›×™×‘ ××©×ª××©
        function UserNav({ user, logout }) {
            const getInitials = (name) => {
                if (!name) return 'U';
                const names = name.split(' ');
                return names.length > 1 ? `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase() : name[0].toUpperCase();
            };
            return (
                <DropdownMenu>
                    <DropdownMenuTrigger className="w-full">
                        <div className="flex items-center gap-3 text-sm font-medium p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                            <div className="h-9 w-9 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center">
                                {getInitials(user?.name)}
                            </div>
                            <div className="text-start flex-1 truncate">
                                <p className="font-semibold text-slate-800 dark:text-slate-100">{user?.name || '××©×ª××©'}</p>
                                <p className="text-xs text-slate-500 dark:text-slate-400 truncate">{user?.email}</p>
                            </div>
                            <ChevronDown size={16} className="text-slate-500" />
                        </div>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent className="w-56" align="end" forceMount>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem onClick={logout} className="text-red-500 focus:text-red-600 focus:bg-red-50 cursor-pointer">
                            <LogOut className="mr-2 h-4 w-4" />
                            <span>×”×ª× ×ª×§</span>
                        </DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
            );
        }
      ğŸ“„ ProtectedRoute.jsx
        import React from 'react';
        import { Navigate, Outlet } from 'react-router-dom';
        import { useAuthStore } from '@/stores/authStore';
        
        /**
         * This component protects routes that require authentication.
         * It uses the modern "wrapper route" pattern from react-router-dom v6.
         * * - If the user is authenticated, it renders an <Outlet />, which displays
         * whatever child route is currently active.
         * - If the user is not authenticated, it redirects them to the /login page.
         */
        const ProtectedRoute = () => {
          const { isAuthenticated } = useAuthStore();
        
          if (!isAuthenticated) {
            // Redirect them to the /login page, but save the current location they were
            // trying to go to so we can send them there after login.
            return <Navigate to="/login" replace />;
          }
        
          // If authenticated, render the child route component via the Outlet.
          return <Outlet />;
        };
        
        export default ProtectedRoute;
      ğŸ“„ PushNotificationManager.jsx
        import { useEffect } from 'react';
        import { useAuthStore } from '@/stores/authStore.js';
        import api from '@/utils/api.js';
        
        // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×”××¨×ª ××¤×ª×— VAPID
        function urlBase64ToUint8Array(base64String) {
          const padding = '='.repeat((4 - base64String.length % 4) % 4);
          const base64 = (base64String + padding)
            .replace(/-/g, '+')
            .replace(/_/g, '/');
        
          const rawData = window.atob(base64);
          const outputArray = new Uint8Array(rawData.length);
        
          for (let i = 0; i < rawData.length; ++i) {
            outputArray[i] = rawData.charCodeAt(i);
          }
          return outputArray;
        }
        
        export default function PushNotificationManager() {
          const { isAuthenticated } = useAuthStore();
        
          useEffect(() => {
            // 1. ×”×× ×”×“×¤×“×¤×Ÿ ×ª×•××š?
            if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
                return;
            }
        
            // 2. ×”×× ×”××©×ª××© ××—×•×‘×¨?
            if (!isAuthenticated) return;
        
            const registerPush = async () => {
              try {
                // ×¨×™×©×•× ×”-Service Worker
                const register = await navigator.serviceWorker.register('/sw.js', {
                  scope: '/'
                });
        
                // ×‘×“×™×§×” ×”×× ×›×‘×¨ ×¨×©×•×
                let subscription = await register.pushManager.getSubscription();
        
                if (!subscription) {
                    // ×× ×œ× ×¨×©×•×, ×¦×¨×™×š ×œ×§×‘×œ ××ª ×”××¤×ª×— ×”×¦×™×‘×•×¨×™ ××”×©×¨×ª
                    const { data } = await api.get('/push/key');
                    const publicVapidKey = data.publicKey;
        
                    // ×”×¨×©××” ×œ-Push Service ×©×œ ×”×“×¤×“×¤×Ÿ
                    subscription = await register.pushManager.subscribe({
                        userVisibleOnly: true,
                        applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
                    });
                }
        
                // ×©×œ×™×—×ª ×”××™× ×•×™ ×œ×©×¨×ª ×©×œ× ×• ×œ×©××™×¨×”
                await api.post('/push/subscribe', subscription);
                console.log('âœ… Push notification registered successfully');
        
              } catch (error) {
                console.error('âŒ Failed to register push notification:', error);
              }
            };
        
            // ×‘×§×©×ª ×”×¨×©××” (×× ×˜×¨× × ×™×ª× ×”)
            if (Notification.permission === 'default') {
                // ××—×›×” ×œ××™× ×˜×¨××§×¦×™×” ×¨××©×•× ×™×ª ×›×“×™ ×œ× "×œ×”×¤×¦×™×¥" ××ª ×”××©×ª××© ××™×“
                const timer = setTimeout(() => {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            registerPush();
                        }
                    });
                }, 3000);
                return () => clearTimeout(timer);
            } else if (Notification.permission === 'granted') {
                registerPush();
            }
        
          }, [isAuthenticated]);
        
          return null; // ×¨×›×™×‘ ×œ×•×’×™ ×‘×œ×‘×“, ×œ×œ× ×ª×¦×•×’×”
        }
      ğŸ“„ StatsCard.jsx
        export default function StatsCard({ label, value, icon }) {
          return (
            <div className="flex items-center gap-4 p-4 rounded-2xl bg-white shadow hover:shadow-md transition">
              <div className="text-3xl">{icon}</div>
              <div>
                <p className="text-sm text-gray-500">{label}</p>
                <p className="text-xl font-bold">{value}</p>
              </div>
            </div>
          );
        }
      ğŸ“ admin/
        ğŸ“„ LogoUploader.jsx
          import React, { useState } from 'react';
          import api from '@/utils/api.js';
          import { Button } from '@/components/ui/Button.jsx';
          import { Upload } from 'lucide-react';
          import toast from 'react-hot-toast';
          
          export default function LogoUploader() {
            const [uploading, setUploading] = useState(false);
          
            const handleFileChange = async (e) => {
              const file = e.target.files[0];
              if (!file) return;
          
              const formData = new FormData();
              formData.append('logo', file);
          
              setUploading(true);
              try {
                await api.post('/upload/logo', formData, {
                  headers: { 'Content-Type': 'multipart/form-data' },
                });
                toast.success('×”×œ×•×’×• ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”! (×¨×¢× ×Ÿ ××ª ×”×“×£ ×›×“×™ ×œ×¨××•×ª)');
              } catch (error) {
                console.error(error);
                toast.error('×©×’×™××” ×‘×”×¢×œ××ª ×”×œ×•×’×•');
              } finally {
                setUploading(false);
              }
            };
          
            return (
              <div className="p-4 border rounded-lg bg-white shadow-sm">
                <h3 className="font-bold mb-2">×¢×“×›×•×Ÿ ×œ×•×’×• ×—×‘×¨×”</h3>
                <div className="flex items-center gap-4">
                  <Button variant="outline" asChild disabled={uploading}>
                    <label className="cursor-pointer flex items-center gap-2">
                      <Upload size={16} />
                      {uploading ? '××¢×œ×”...' : '×‘×—×¨ ×§×•×‘×¥ ×œ×•×’×•'}
                      <input type="file" className="hidden" accept="image/png, image/jpeg" onChange={handleFileChange} />
                    </label>
                  </Button>
                </div>
              </div>
            );
          }
      ğŸ“ dashboard/
      ğŸ“ orders/
        ğŸ“„ AddRoomForm.jsx
          // client/src/components/orders/AddRoomForm.jsx
          import React, { useState, useMemo, useEffect } from 'react';
          import { calculateRoomTotalPrice } from '@/lib/priceCalculator';
          import { Button } from '@/components/ui/Button.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Label } from '@/components/ui/Label.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Moon, Lock, StickyNote } from 'lucide-react';
          
          export function AddRoomForm({ priceLists, roomTypes, numberOfNights, onNightsChange, onAddRoom, disabled, isLoading }) {
            const [room, setRoom] = useState({ adults: 2, teens: 0, children: 0, babies: 0 });
            const [roomNotes, setRoomNotes] = useState(''); // âœ¨ × ×©××¨: ×¡×˜×™×™×˜ ×œ×”×¢×¨×•×ª ×—×“×¨
            const [selectedPL, setSelectedPL] = useState([]);
            const [selectedRoomTypeId, setSelectedRoomTypeId] = useState(null);
          
            useEffect(() => {
                if (roomTypes && roomTypes.length > 0) {
                    const defaultType = roomTypes.find(rt => rt.isDefault) || roomTypes[0];
                    setSelectedRoomTypeId(defaultType?._id);
                } else {
                    setSelectedRoomTypeId(null);
                }
            }, [roomTypes]);
          
            // ×—×™×©×•×‘ ××’×‘×œ×ª ×”×œ×™×œ×•×ª
            const nightConstraints = useMemo(() => {
              let maxAllowed = 0;
              let isFixed = false;
          
              if (selectedPL.length === 0) return { max: 0, isFixed: false };
          
              selectedPL.forEach(name => {
                  const pl = priceLists[name];
                  if (pl && pl.maxNights > 0) {
                      if (maxAllowed === 0 || pl.maxNights < maxAllowed) {
                          maxAllowed = pl.maxNights;
                      }
                  }
              });
          
              if (maxAllowed === 1) isFixed = true;
              return { max: maxAllowed, isFixed };
            }, [selectedPL, priceLists]);
          
            // ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×©×œ ×œ×™×œ×•×ª
            useEffect(() => {
              if (nightConstraints.max > 0) {
                  if (numberOfNights > nightConstraints.max) {
                       onNightsChange({ target: { value: nightConstraints.max } });
                  }
                  if (nightConstraints.isFixed && numberOfNights !== 1) {
                       onNightsChange({ target: { value: 1 } });
                  }
              }
            }, [nightConstraints, numberOfNights, onNightsChange]);
          
            const currentPrice = useMemo(() => {
              if (selectedPL.length === 0 || disabled) return 0;
              const selectedType = roomTypes.find(rt => rt._id === selectedRoomTypeId);
              const supplement = selectedType ? selectedType.supplementPerNight : 0;
              return calculateRoomTotalPrice(room, priceLists, selectedPL, numberOfNights, supplement);
            }, [room, priceLists, selectedPL, disabled, numberOfNights, selectedRoomTypeId, roomTypes]);
          
            const handleInputChange = (e) => {
              const { name, value } = e.target;
              // âœ¨ ×ª×™×§×•×Ÿ ×•×™×–×•××œ×™: ×× ×”×¢×¨×š ×¨×™×§, × ×©××•×¨ 0
              setRoom(prev => ({ ...prev, [name]: parseInt(value, 10) || 0 }));
            };
          
            const handlePriceListToggle = (name) => {
              setSelectedPL(prev =>
                prev.includes(name) ? prev.filter(item => item !== name) : [...prev, name]
              );
            };
          
            const handleSubmit = (e) => {
              e.preventDefault();
              if (disabled) return;
              if (selectedPL.length === 0) {
                alert("×—×•×‘×” ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ××—×™×¨×•×Ÿ ××—×“.");
                return;
              }
          
              const selectedTypeObj = roomTypes.find(rt => rt._id === selectedRoomTypeId);
              const typeName = selectedTypeObj ? selectedTypeObj.name : '×¨×’×™×œ';
              const supplement = selectedTypeObj ? selectedTypeObj.supplementPerNight : 0;
          
              onAddRoom({
                  ...room,
                  price_list_names: selectedPL,
                  price: currentPrice,
                  roomTypeId: selectedRoomTypeId,
                  roomType: typeName,
                  roomSupplement: supplement,
                  notes: roomNotes // âœ¨ ×©×™××•×¨ ×©×œ×™×—×ª ×”×”×¢×¨×•×ª
              });
          
              setRoom({ adults: 2, teens: 0, children: 0, babies: 0 });
              setRoomNotes('');
              setSelectedPL([]);
            };
          
            return (
              <form onSubmit={handleSubmit} className="space-y-4">
                {disabled && isLoading && (
                    <div className="text-center p-4 bg-amber-50 text-amber-800 rounded-md">
                        ×˜×•×¢×Ÿ × ×ª×•× ×™×...
                     </div>
                )}
          
                <fieldset disabled={disabled} className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                      {/* ×¡×•×’ ×—×“×¨ */}
                      <div>
                          <Label className="mb-1.5 block">×¡×•×’ ×—×“×¨</Label>
                          <Select value={selectedRoomTypeId || ''} onValueChange={setSelectedRoomTypeId}>
                              <SelectTrigger>
                                  <SelectValue placeholder="×‘×—×¨ ×¡×•×’" />
                              </SelectTrigger>
                              <SelectContent>
                                  {roomTypes.length > 0 ? (
                                      roomTypes.map(rt => (
                                          <SelectItem key={rt._id} value={rt._id}>
                                              {rt.name} {rt.supplementPerNight > 0 ? `(+${rt.supplementPerNight}â‚ª)` : ''}
                                          </SelectItem>
                                      ))
                                  ) : (
                                      <SelectItem value="default" disabled>××™×Ÿ ×¡×•×’×™×</SelectItem>
                                  )}
                               </SelectContent>
                          </Select>
                      </div>
          
                      {/* ×œ×™×œ×•×ª */}
                      <div>
                           <Label className="mb-1.5 block">
                               ×œ×™×œ×•×ª
                               {nightConstraints.max > 0 && (
                                   <span className="text-xs text-red-500 mr-2">
                                       (××•×’×‘×œ ×¢×“ {nightConstraints.max})
                                   </span>
                               )}
                           </Label>
                           <div className="relative">
                               {nightConstraints.isFixed ? (
                                   <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                               ) : (
                                   <Moon className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                               )}
                               <Input
                                  type="number"
                                  min="1"
                                  max={nightConstraints.max > 0 ? nightConstraints.max : undefined}
                                  value={numberOfNights}
                                  onChange={onNightsChange}
                                  disabled={disabled || nightConstraints.isFixed}
                                  className={`pl-9 font-bold ${nightConstraints.isFixed ? 'bg-gray-100 text-gray-500 cursor-not-allowed' : ''}`}
                               />
                           </div>
                      </div>
                  </div>
          
                  {/* âœ¨ ×”×ª×™×§×•×Ÿ ×”×•×™×–×•××œ×™: ×”×¦×’×ª ×©×“×” ×¨×™×§ ×‘××§×•× 0 */}
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="block text-sm font-medium text-gray-600">××‘×•×’×¨×™×</label>
                        <input
                          type="number"
                          name="adults"
                          value={room.adults || ''}
                          placeholder="0"
                          onChange={handleInputChange}
                          className="w-full mt-1 p-2 border border-gray-300 rounded-md"
                          min="0"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-600">× ×¢×¨×™×</label>
                        <input
                          type="number"
                          name="teens"
                          value={room.teens || ''}
                          placeholder="0"
                          onChange={handleInputChange}
                          className="w-full mt-1 p-2 border border-gray-300 rounded-md"
                          min="0"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-600">×™×œ×“×™×</label>
                        <input
                          type="number"
                          name="children"
                          value={room.children || ''}
                          placeholder="0"
                          onChange={handleInputChange}
                          className="w-full mt-1 p-2 border border-gray-300 rounded-md"
                          min="0"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-600">×ª×™× ×•×§×•×ª</label>
                        <input
                          type="number"
                          name="babies"
                          value={room.babies || ''}
                          placeholder="0"
                          onChange={handleInputChange}
                          className="w-full mt-1 p-2 border border-gray-300 rounded-md"
                          min="0"
                        />
                      </div>
                  </div>
          
                  {/* âœ¨ ×©×“×” ×”×¢×¨×•×ª ×œ×—×“×¨ (× ×©××¨ ××”×§×•×‘×¥ ×”××¢×•×“×›×Ÿ ×©×œ×š) */}
                  <div>
                      <Label className="mb-1.5 block">×”×¢×¨×•×ª ×œ×—×“×¨ (××•×¤×¦×™×•× ×œ×™)</Label>
                      <div className="relative">
                          <StickyNote className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                          <Input
                              type="text"
                              value={roomNotes}
                              onChange={(e) => setRoomNotes(e.target.value)}
                              placeholder="×œ×“×•×’××”: ××™×˜×” ×–×•×’×™×ª ××•×¤×¨×“×ª, ×¢×¨×™×¡×”..."
                              className="pl-10"
                          />
                      </div>
                  </div>
          
                  <div>
                    <label className="font-medium block mb-2">×‘×—×¨ ××—×™×¨×•× ×™×:</label>
                    <div className="space-y-2 bg-slate-50 p-3 rounded-md max-h-40 overflow-y-auto">
                        {Object.keys(priceLists).length > 0 ? (
                        Object.keys(priceLists).map(name => {
                          const pl = priceLists[name];
                          return (
                            <div key={name} className="flex items-center justify-between gap-2">
                                <div className="flex items-center gap-2">
                                  <input type="checkbox" id={`pl-${name}`} checked={selectedPL.includes(name)} onChange={() => handlePriceListToggle(name)} className="h-4 w-4 rounded border-gray-300" />
                                  <label htmlFor={`pl-${name}`} className="text-sm cursor-pointer select-none">{name}</label>
                                </div>
                                {pl.maxNights > 0 && (
                                    <span className="text-[10px] bg-gray-200 px-1.5 py-0.5 rounded text-gray-600">
                                        {pl.maxNights === 1 ? '×œ×™×œ×” 1' : `×¢×“ ${pl.maxNights} ×œ×™×œ×•×ª`}
                                    </span>
                                )}
                            </div>
                          )
                        })
                        ) : (
                           <p className="text-sm text-gray-500">{!disabled ? '×œ× × ××¦××• ××—×™×¨×•× ×™× ×¢×‘×•×¨ ××œ×•×Ÿ ×–×”.' : ''}</p>
                      )}
                    </div>
                  </div>
          
                  <div className="bg-blue-50 p-3 rounded-md border border-blue-100 mt-2">
                      <div className="flex justify-between items-center">
                          <span className="text-sm text-blue-800">××—×™×¨ ×œ-{numberOfNights} ×œ×™×œ×•×ª:</span>
                          <span className="text-xl font-bold text-blue-700">{currentPrice.toLocaleString()} â‚ª</span>
                       </div>
                  </div>
          
                  <Button type="submit" className="w-full" disabled={disabled}>×”×•×¡×£ ×—×“×¨ ×œ×”×–×× ×”</Button>
                </fieldset>
              </form>
            );
          }
        ğŸ“„ OrderExtrasForm.jsx
          import React, { useState } from 'react';
          import { useQuery } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Plus, Trash2, LoaderCircle } from 'lucide-react';
          
          const fetchExtraTypes = async () => (await api.get('/admin/extras')).data;
          
          export function OrderExtrasForm({ extras, onChange }) {
              const { data: types = [], isLoading } = useQuery({
                  queryKey: ['extraTypes'],
                  queryFn: fetchExtraTypes,
                  staleTime: 1000 * 60 * 5
              });
          
              const [newExtra, setNewExtra] = useState({ type: '', price: '' });
          
              const handleAdd = () => {
                  if (!newExtra.type || !newExtra.price) return;
                  const updatedExtras = [...extras, {
                      extraType: newExtra.type,
                      price: parseFloat(newExtra.price),
                      quantity: 1
                  }];
                  onChange(updatedExtras);
                  setNewExtra({ type: '', price: '' });
              };
          
              const handleRemove = (index) => {
                  const updated = extras.filter((_, i) => i !== index);
                  onChange(updated);
              };
          
              return (
                  <div className="space-y-6">
                      {/* ×©×•×¨×ª ×”×•×¡×¤×” - ××¢×•×¦×‘×ª ×‘×’×•×“×œ ××œ× ×•×¡×˜× ×“×¨×˜×™ */}
                      <div className="flex items-end gap-3">
                          <div className="flex-1">
                              <label className="block text-sm font-medium text-gray-600 mb-1.5">×¡×•×’ ×”×ª×•×¡×¤×ª</label>
                              <Select value={newExtra.type} onValueChange={(v) => setNewExtra(p => ({...p, type: v}))}>
                                  <SelectTrigger className="h-10 bg-white w-full"> {/* ×’×•×‘×” ×¡×˜× ×“×¨×˜×™ */}
                                      <SelectValue placeholder="×‘×—×¨ ×ª×•×¡×¤×ª..." />
                                  </SelectTrigger>
                                  <SelectContent>
                                      {isLoading ?
                                          <div className="p-2 flex justify-center"><LoaderCircle className="animate-spin h-4 w-4"/></div> :
                                          types.length > 0 ?
                                          types.map(t => <SelectItem key={t._id} value={t.name}>{t.name}</SelectItem>) :
                                          <div className="p-2 text-sm text-center">××™×Ÿ ×¡×•×’×™× ××•×’×“×¨×™×</div>
                                      }
                                  </SelectContent>
                              </Select>
                          </div>
          
                          <div className="w-32">
                              <label className="block text-sm font-medium text-gray-600 mb-1.5">××—×™×¨</label>
                              <Input
                                  type="number"
                                  placeholder="0"
                                  className="h-10 bg-white" // ×’×•×‘×” ×¡×˜× ×“×¨×˜×™
                                  value={newExtra.price}
                                  onChange={e => setNewExtra(p => ({...p, price: e.target.value}))}
                              />
                          </div>
          
                          <Button
                              onClick={handleAdd}
                              disabled={!newExtra.type || !newExtra.price}
                              className="h-10 px-4" // ×›×¤×ª×•×¨ ×‘×’×•×“×œ ××œ×
                          >
                              <Plus className="mr-2 h-4 w-4"/> ×”×•×¡×£
                          </Button>
                      </div>
          
                      {/* ×¨×©×™××ª ×”×ª×•×¡×¤×•×ª ×”×§×™×™××•×ª */}
                      <div className="space-y-2">
                          {extras.map((ex, idx) => (
                              <div key={idx} className="flex justify-between items-center p-3 bg-white border border-slate-200 rounded-md shadow-sm hover:border-blue-300 transition-colors">
                                  <span className="font-medium text-base text-slate-800">{ex.extraType}</span>
                                  <div className="flex items-center gap-4">
                                      <span className="font-bold text-slate-900 bg-slate-100 px-3 py-1 rounded-full text-sm">
                                          {ex.price.toLocaleString()} â‚ª
                                      </span>
                                      <Button
                                          variant="ghost"
                                          size="icon"
                                          onClick={() => handleRemove(idx)}
                                          className="text-slate-400 hover:text-red-600 hover:bg-red-50"
                                      >
                                          <Trash2 className="h-5 w-5"/>
                                      </Button>
                                  </div>
                              </div>
                          ))}
          
                          {extras.length === 0 && (
                              <div className="text-center py-8 border-2 border-dashed border-slate-200 rounded-lg">
                                  <p className="text-slate-500">×œ× × ×‘×—×¨×• ×ª×•×¡×¤×•×ª ×œ×”×–×× ×” ×–×•.</p>
                              </div>
                          )}
                      </div>
                  </div>
              );
          }
        ğŸ“„ OrderSummaryTable.jsx
          // client/src/components/orders/OrderSummaryTable.jsx
          
          import React from 'react';
          import { calculateRoomTotalPrice } from '@/lib/priceCalculator';
          import { Button } from '@/components/ui/Button.jsx';
          import {
            DropdownMenu,
            DropdownMenuContent,
            DropdownMenuCheckboxItem,
            DropdownMenuLabel,
            DropdownMenuSeparator,
            DropdownMenuTrigger,
          } from "@/components/ui/Dropdown-menu";
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Input } from '@/components/ui/Input.jsx';
          import { SlidersHorizontal, Moon, Trash2 } from 'lucide-react'; // âœ¨ ×”×•×¡×¤×ª×™ ××™×™×§×•×Ÿ Trash2
          
          export function OrderSummaryTable({ rooms, priceLists, roomTypes, numberOfNights, onRemoveRoom, onUpdateRoom }) {
          
            const totalPrice = rooms.reduce((sum, room) => sum + room.price, 0);
          
            // ×¢×“×›×•×Ÿ ×©×“×•×ª (××¡×¤×¨×™×™× ×•×˜×§×¡×˜×•××œ×™×™×)
            const handleCellChange = (index, field, value) => {
              // ×‘×“×™×§×”: ×× ×”×©×“×” ×”×•× 'notes', ×œ× ×œ×”××™×¨ ×œ××¡×¤×¨. ×× ×–×” ××¡×¤×¨ ×•×”×•× ×¨×™×§, × ×©××•×¨ 0.
              const finalValue = field === 'notes' ? value : (value === '' ? 0 : parseInt(value, 10));
          
              const updatedRoom = { ...rooms[index], [field]: finalValue || (field === 'notes' ? '' : 0) };
              recalculateAndSave(index, updatedRoom);
            };
          
            // ×¢×“×›×•×Ÿ ××—×™×¨×•× ×™×
            const handlePriceListChange = (roomIndex, priceListName) => {
              const roomToUpdate = { ...rooms[roomIndex] };
              const currentSelection = roomToUpdate.price_list_names || [];
          
              const newSelection = currentSelection.includes(priceListName)
                ? currentSelection.filter(name => name !== priceListName)
                : [...currentSelection, priceListName];
          
              roomToUpdate.price_list_names = newSelection;
              recalculateAndSave(roomIndex, roomToUpdate);
            };
          
            // ×¢×“×›×•×Ÿ ×¡×•×’ ×—×“×¨
            const handleRoomTypeChange = (index, newTypeId) => {
                const roomToUpdate = { ...rooms[index] };
                const selectedType = roomTypes.find(rt => rt._id === newTypeId);
          
                if (selectedType) {
                    roomToUpdate.roomTypeId = selectedType._id;
                    roomToUpdate.roomType = selectedType.name;
                    roomToUpdate.roomSupplement = selectedType.supplementPerNight;
                }
                recalculateAndSave(index, roomToUpdate);
            };
          
            const recalculateAndSave = (index, updatedRoom) => {
                let supplement = updatedRoom.roomSupplement;
                if (supplement === undefined) {
                     const typeObj = roomTypes.find(rt => rt._id === updatedRoom.roomTypeId || rt.name === updatedRoom.roomType);
                     supplement = typeObj ? typeObj.supplementPerNight : 0;
                }
          
                const newPrice = calculateRoomTotalPrice(
                    updatedRoom,
                    priceLists,
                    updatedRoom.price_list_names,
                    numberOfNights,
                    supplement
                );
                onUpdateRoom(index, { ...updatedRoom, price: newPrice, roomSupplement: supplement });
            };
          
            if (rooms.length === 0) {
              return <p className="text-center text-gray-500 py-10">×¢×“×™×™×Ÿ ×œ× × ×•×¡×¤×• ×—×“×¨×™× ×œ×”×–×× ×”.</p>;
            }
          
            // âœ¨ ×¢×™×¦×•×‘ ××—×™×“ ×œ×©×“×•×ª ×”×§×˜× ×™×
            const numberInputClass = "w-10 h-8 border border-gray-200 rounded text-center text-sm focus:outline-none focus:border-blue-400 transition-colors bg-white";
          
            return (
              <div>
                <h2 className="text-xl font-bold mb-4 flex justify-between items-center">
                    <span>×¡×™×›×•× ×”×–×× ×”</span>
                    <span className="text-sm font-normal bg-blue-50 text-blue-700 px-2 py-1 rounded-md flex items-center gap-1">
                        <Moon size={14}/> ×œ×¤×™ {numberOfNights} ×œ×™×œ×•×ª
                    </span>
                </h2>
                <div className="overflow-x-auto pb-24 md:pb-0">
                  <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-2 py-2 text-right text-xs font-medium uppercase w-[140px]">×¡×•×’ ×—×“×¨</th>
                        <th className="px-1 py-2 text-center text-xs font-medium uppercase text-gray-500">××‘'</th>
                        <th className="px-1 py-2 text-center text-xs font-medium uppercase text-gray-500">× ×¢'</th>
                        <th className="px-1 py-2 text-center text-xs font-medium uppercase text-gray-500">×™×œ'</th>
                        <th className="px-1 py-2 text-center text-xs font-medium uppercase text-gray-500">×ª×™'</th>
                        <th className="px-2 py-2 text-right text-xs font-medium uppercase w-[100px]">××—×™×¨×•× ×™×</th>
                        <th className="px-2 py-2 text-right text-xs font-medium uppercase min-w-[150px]">×”×¢×¨×•×ª</th> {/* âœ¨ ×¢××•×“×” × ×©××¨×” */}
                        <th className="px-2 py-2 text-right text-xs font-medium uppercase">×¡×”"×›</th>
                        <th className="px-1 py-2"></th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      {rooms.map((room, index) => (
                        <tr key={index}>
                          {/* ×¢××•×“×ª ×¡×•×’ ×—×“×¨ */}
                          <td className="px-2 py-2">
                               <Select
                                  value={room.roomTypeId || ''}
                                  onValueChange={(val) => handleRoomTypeChange(index, val)}
                              >
                                  <SelectTrigger className="h-8 text-xs w-full bg-white border-gray-200">
                                      <SelectValue placeholder={room.roomType || '×¨×’×™×œ'} />
                                  </SelectTrigger>
                                  <SelectContent>
                                       {roomTypes.map(rt => (
                                          <SelectItem key={rt._id} value={rt._id} className="text-xs">
                                              {rt.name}
                                          </SelectItem>
                                      ))}
                                  </SelectContent>
                              </Select>
                          </td>
          
                          {/* âœ¨ ×ª×™×§×•×Ÿ ×•×™×–×•××œ×™: ×©×“×•×ª ×¨×™×§×™× ×‘××§×•× 0, ×•×§×˜× ×™× ×™×•×ª×¨ */}
                          <td className="px-1 py-2 text-center">
                              <input type="number" min="0" className={numberInputClass}
                                  value={room.adults > 0 ? room.adults : ''}
                                  onChange={(e) => handleCellChange(index, 'adults', e.target.value)} />
                          </td>
                          <td className="px-1 py-2 text-center">
                              <input type="number" min="0" className={numberInputClass}
                                  value={room.teens > 0 ? room.teens : ''}
                                  onChange={(e) => handleCellChange(index, 'teens', e.target.value)} />
                          </td>
                          <td className="px-1 py-2 text-center">
                              <input type="number" min="0" className={numberInputClass}
                                  value={room.children > 0 ? room.children : ''}
                                  onChange={(e) => handleCellChange(index, 'children', e.target.value)} />
                          </td>
                          <td className="px-1 py-2 text-center">
                              <input type="number" min="0" className={numberInputClass}
                                  value={room.babies > 0 ? room.babies : ''}
                                  onChange={(e) => handleCellChange(index, 'babies', e.target.value)} />
                          </td>
          
                          <td className="px-2 py-2 text-xs">
                            <DropdownMenu>
                              <DropdownMenuTrigger asChild>
                                <Button variant="outline" size="sm" className="w-full justify-between h-8 text-xs px-2 bg-white border-gray-200 hover:bg-gray-50">
                                   <span className="truncate max-w-[80px]">{room.price_list_names.length > 0 ? room.price_list_names.join(', ') : '×‘×—×¨'}</span>
                                  <SlidersHorizontal className="mr-1 h-3 w-3 opacity-50" />
                                </Button>
                              </DropdownMenuTrigger>
                              <DropdownMenuContent className="w-56">
                                <DropdownMenuLabel>×‘×—×¨ ××—×™×¨×•× ×™×</DropdownMenuLabel>
                                <DropdownMenuSeparator />
                                {Object.keys(priceLists).map(name => (
                                  <DropdownMenuCheckboxItem
                                    key={name}
                                    checked={room.price_list_names.includes(name)}
                                    onCheckedChange={() => handlePriceListChange(index, name)}
                                  >
                                    {name}
                                  </DropdownMenuCheckboxItem>
                                ))}
                              </DropdownMenuContent>
                            </DropdownMenu>
                          </td>
          
                          {/* âœ¨ ×ª× ×”×¢×¨×•×ª (× ×©××¨) */}
                          <td className="px-2 py-2">
                              <Input
                                  type="text"
                                  value={room.notes || ''}
                                  onChange={(e) => handleCellChange(index, 'notes', e.target.value)}
                                  className="h-8 text-xs min-w-[120px]"
                                  placeholder="×”×¢×¨×”..."
                              />
                          </td>
          
                          <td className="px-2 py-2 font-semibold text-sm min-w-[80px] text-gray-700">{room.price.toLocaleString()} â‚ª</td>
                          <td className="px-1 py-2 text-center">
                              <Button variant="ghost" size="icon" className="h-8 w-8 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-full" onClick={() => onRemoveRoom(index)}>
                                  <Trash2 size={14}/>
                              </Button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
                <div className="text-2xl font-bold text-right mt-6 border-t pt-4">
                  ×¡×”"×› ×œ×ª×©×œ×•×: <span className="text-blue-600">{totalPrice.toLocaleString()} â‚ª</span>
                </div>
              </div>
            );
          }
        ğŸ“„ PriceListManagerDialog.jsx
          // client/src/components/orders/PriceListManagerDialog.jsx
          
          import React, { useState, useEffect } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import toast from 'react-hot-toast';
          import api from '@/utils/api.js';
          // UI Components
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "@/components/ui/Dialog";
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Edit, Trash2, PlusCircle, Lock } from 'lucide-react';
          
          // API Functions
          const fetchPriceListsForHotel = async (hotelId) => (await api.get(`/pricelists?hotelId=${hotelId}`)).data;
          const createPriceList = (data) => api.post('/pricelists', data);
          const updatePriceList = ({ id, ...data }) => api.put(`/pricelists/${id}`, data);
          const deletePriceList = (id) => api.delete(`/pricelists/${id}`);
          
          // Helper component for the form
          const PriceListForm = ({ hotelId, priceList, onSave, onCancel, isSaving }) => {
              // âœ¨ ×”×•×¡×¤× ×• ××ª maxNights ×œ×¡×˜×™×™×˜ ×”×”×ª×—×œ×ª×™
              const [formData, setFormData] = useState({
                  name: '', couple: 0, teen: 0, child: 0, baby: 0, single_room: 0, maxNights: 0
              });
          
              useEffect(() => {
                  if (priceList) {
                      setFormData({ ...priceList });
                  } else {
                      // âœ¨ ××™×¤×•×¡ ×›×•×œ×œ maxNights
                      setFormData({ name: '', hotel: hotelId, couple: 0, teen: 0, child: 0, baby: 0, single_room: 0, maxNights: 0 });
                  }
              }, [priceList, hotelId]);
          
              const handleChange = (e) => {
                  const { name, value } = e.target;
                  setFormData(prev => ({ ...prev, [name]: value }));
              };
          
              const handleSubmit = (e) => {
                  e.preventDefault();
                  const dataToSave = Object.fromEntries(
                      Object.entries(formData).map(([key, value]) => [key, value === '' ? 0 : value])
                  );
                  onSave({ ...dataToSave, hotel: hotelId });
              };
          
              return (
                  <form onSubmit={handleSubmit} className="space-y-4 pt-4 border-t">
                      <h3 className="font-semibold">{priceList ? '×¢×¨×™×›×ª ××—×™×¨×•×Ÿ' : '×”×•×¡×¤×ª ××—×™×¨×•×Ÿ ×—×“×©'}</h3>
                      <div className="grid grid-cols-2 gap-4">
                          <div className="col-span-2">
                              <Input name="name" placeholder="×©× (×œ××©×œ: ×¡×•×¤×©)" value={formData.name || ''} onChange={handleChange} required />
                          </div>
          
                          <Input name="couple" type="number" placeholder="××—×™×¨ ×œ×–×•×’" value={formData.couple || ''} onChange={handleChange} />
                          <Input name="single_room" type="number" placeholder="××—×™×¨ ×œ×™×—×™×“" value={formData.single_room || ''} onChange={handleChange} />
          
                          <Input name="teen" type="number" placeholder="××—×™×¨ ×œ× ×¢×¨" value={formData.teen || ''} onChange={handleChange} />
                          <Input name="child" type="number" placeholder="××—×™×¨ ×œ×™×œ×“" value={formData.child || ''} onChange={handleChange} />
                          <Input name="baby" type="number" placeholder="××—×™×¨ ×œ×ª×™× ×•×§" value={formData.baby || ''} onChange={handleChange} />
          
                          {/* âœ¨ ×©×“×” ×—×“×© ×œ×”×’×‘×œ×ª ×œ×™×œ×•×ª */}
                          <div className="relative">
                              <Lock className="absolute left-2 top-2.5 h-4 w-4 text-gray-400" />
                              <Input
                                  name="maxNights"
                                  type="number"
                                  placeholder="×”×’×‘×œ×ª ×œ×™×œ×•×ª (0 = ×œ×œ×)"
                                  value={formData.maxNights || ''}
                                  onChange={handleChange}
                                  className="pl-8 bg-amber-50/50 border-amber-200 focus:border-amber-500"
                                  title="×”×©××¨ 0 ×œ×œ× ×”×’×‘×œ×”. ×¨×©×•× 1 ×›×“×™ ×œ×§×‘×¢ ×œ×œ×™×œ×” ××—×“."
                              />
                          </div>
                      </div>
                      <div className="flex justify-end gap-2">
                          <Button type="button" variant="ghost" onClick={onCancel}>×‘×™×˜×•×œ</Button>
                          <Button type="submit" disabled={isSaving}>{isSaving ? '×©×•××¨...' : '×©××•×¨'}</Button>
                      </div>
                  </form>
              );
          };
          
          
          export default function PriceListManagerDialog({ isOpen, onClose, hotelId }) {
              const queryClient = useQueryClient();
              const [editingPriceList, setEditingPriceList] = useState(null); // null for new, object for editing
          
              const { data: priceLists = [], refetch } = useQuery({
                  queryKey: ['priceListsMap', hotelId],
                  queryFn: () => fetchPriceListsForHotel(hotelId),
                  enabled: !!hotelId,
              });
          
              const commonMutationOptions = {
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['priceListsMap', hotelId] });
                      setEditingPriceList(null); // Close form on success
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”'),
              };
          
              const createMutation = useMutation({ ...commonMutationOptions, mutationFn: createPriceList, onSuccess: () => { toast.success('××—×™×¨×•×Ÿ × ×•×¦×¨!'); commonMutationOptions.onSuccess(); } });
              const updateMutation = useMutation({ ...commonMutationOptions, mutationFn: updatePriceList, onSuccess: () => { toast.success('××—×™×¨×•×Ÿ ×¢×•×“×›×Ÿ!'); commonMutationOptions.onSuccess(); } });
              const deleteMutation = useMutation({ ...commonMutationOptions, mutationFn: deletePriceList, onSuccess: () => { toast.success('××—×™×¨×•×Ÿ × ××—×§!'); commonMutationOptions.onSuccess(); } });
          
              const handleSave = (data) => {
                  if (editingPriceList && editingPriceList._id) {
                      updateMutation.mutate({ id: editingPriceList._id, ...data });
                  } else {
                      createMutation.mutate(data);
                  }
              };
          
              const handleDelete = (id) => {
                  if (window.confirm('×”×× ×œ××—×•×§ ××ª ×”××—×™×¨×•×Ÿ?')) {
                      deleteMutation.mutate(id);
                  }
              };
          
              return (
                  <Dialog open={isOpen} onOpenChange={onClose}>
                      <DialogContent className="max-w-2xl">
                          <DialogHeader>
                              <DialogTitle>× ×™×”×•×œ ××—×™×¨×•× ×™×</DialogTitle>
                              <DialogDescription>× ×™×”×•×œ ××”×™×¨ ×©×œ ×”××—×™×¨×•× ×™× ×¢×‘×•×¨ ×”××œ×•×Ÿ ×”× ×‘×—×¨.</DialogDescription>
                          </DialogHeader>
          
                          <div className="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                              {priceLists.length > 0 ? (
                                  priceLists.map(pl => (
                                      <div key={pl._id} className="flex justify-between items-center p-2 rounded-md hover:bg-slate-50">
                                          <div>
                                              <span className="font-medium">{pl.name}</span>
                                              {/* âœ¨ ×ª×¦×•×’×” ×•×™×–×•××œ×™×ª ×× ×™×© ××’×‘×œ×” */}
                                              {pl.maxNights > 0 && (
                                                  <span className="mr-2 text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full flex-inline items-center gap-1">
                                                      <Lock size={10} className="inline" />
                                                      {pl.maxNights === 1 ? '×œ×™×œ×” 1 ×‘×œ×‘×“' : `×¢×“ ${pl.maxNights} ×œ×™×œ×•×ª`}
                                                  </span>
                                              )}
                                          </div>
                                          <div className="flex gap-2">
                                              <Button variant="ghost" size="icon" onClick={() => setEditingPriceList(pl)}><Edit className="h-4 w-4" /></Button>
                                              <Button variant="ghost" size="icon" onClick={() => handleDelete(pl._id)}><Trash2 className="h-4 w-4 text-red-500" /></Button>
                                          </div>
                                      </div>
                                  ))
                              ) : (
                                  <p className="text-center text-slate-500 py-4">×œ× ×§×™×™××™× ××—×™×¨×•× ×™× ×œ××œ×•×Ÿ ×–×”.</p>
                              )}
                          </div>
          
                          <PriceListForm
                              hotelId={hotelId}
                              priceList={editingPriceList}
                              onSave={handleSave}
                              onCancel={() => setEditingPriceList(null)}
                              isSaving={createMutation.isPending || updateMutation.isPending}
                          />
                      </DialogContent>
                  </Dialog>
              );
          }
      ğŸ“ routes/
        ğŸ“„ AdminRoute.jsx
          import { Navigate, Outlet } from 'react-router-dom';
          import { useAuthStore } from '@/stores/authStore';
          
          const AdminRoute = () => {
            const { user, isAuthenticated } = useAuthStore();
          
            // If the user is not authenticated, redirect to the login page
            if (!isAuthenticated) {
              return <Navigate to="/login" replace />;
            }
          
            // If the user is authenticated but is not an admin, redirect to the home page
            if (user?.role !== 'admin') {
              return <Navigate to="/" replace />;
            }
          
            // If the user is an authenticated admin, show the requested page
            return <Outlet />;
          };
          
          export default AdminRoute;
        ğŸ“„ MaintenanceRoute.jsx
          import { Navigate, Outlet } from 'react-router-dom';
          import { useAuthStore } from '@/stores/authStore';
          
          const MaintenanceRoute = () => {
            const { user, isAuthenticated } = useAuthStore();
          
            if (!isAuthenticated) {
              return <Navigate to="/login" replace />;
            }
          
            // ×¨×§ ×× ×”×œ ××• ××™×© ×ª×—×–×•×§×” ××•×¨×©×™×
            if (user?.role === 'admin' || user?.role === 'maintenance') {
              return <Outlet />;
            }
          
            // ×× ×–×” ××™×© ××›×™×¨×•×ª ×©×× ×¡×” ×œ×”×™×›× ×¡ ×œ×ª×—×–×•×§×” - × ×–×¨×•×§ ××•×ª×• ×œ×“×£ ×”×‘×™×ª ×”×¨×’×™×œ
            return <Navigate to="/" replace />;
          };
          
          export default MaintenanceRoute;
        ğŸ“„ PriceListManagerRoute.jsx
          import { Navigate, Outlet } from 'react-router-dom';
          import { useAuthStore } from '@/stores/authStore';
          
          const PriceListManagerRoute = () => {
            const { user, isAuthenticated } = useAuthStore();
          
            if (!isAuthenticated) {
              return <Navigate to="/login" replace />;
            }
          
            // ×× ×”××©×ª××© ×”×•× ×× ×”×œ ××• ×©×™×© ×œ×• ×”×¨×©××” ××¤×•×¨×©×ª, ××¤×©×¨ ×œ×• ×œ×¢×‘×•×¨
            if (user?.role === 'admin' || user?.canManagePriceLists) {
              return <Outlet />;
            }
          
            // ××—×¨×ª, ×”×¢×‘×¨ ××•×ª×• ×œ×“×£ ×”×‘×™×ª ×›×™ ××™×Ÿ ×œ×• ×”×¨×©××”
            return <Navigate to="/" replace />;
          };
          
          export default PriceListManagerRoute;
        ğŸ“„ SalesRoute.jsx
          import { Navigate, Outlet } from 'react-router-dom';
          import { useAuthStore } from '@/stores/authStore';
          
          const SalesRoute = () => {
            const { user, isAuthenticated } = useAuthStore();
          
            if (!isAuthenticated) {
              return <Navigate to="/login" replace />;
            }
          
            // ×¨×§ ×× ×”×œ ××• ××™×© ××›×™×¨×•×ª ××•×¨×©×™×
            if (user?.role === 'admin' || user?.role === 'sales') {
              return <Outlet />;
            }
          
            // ×× ×–×” ××™×© ×ª×—×–×•×§×” ×©×× ×¡×” ×œ×”×™×›× ×¡ ×œ××›×™×¨×•×ª - × ×–×¨×•×§ ××•×ª×• ×œ×“×£ ×”×‘×™×ª ×©×œ×•
            return <Navigate to="/maintenance" replace />;
          };
          
          export default SalesRoute;
        ğŸ“„ UserRoute.jsx
          import { Navigate } from 'react-router-dom';
          import { useAuthStore } from '@/stores/authStore';
          
          // âœ¨ 1. ×”×§×•××¤×•× × ×˜×” ×¦×¨×™×›×” ×œ×§×‘×œ ××ª ×”-children ×©×œ×”
          export default function UserRoute({ children }) {
            const { isAuthenticated, isLoading } = useAuthStore((state) => ({
              isAuthenticated: state.isAuthenticated,
              // ×”×•×¡×¤× ×• ×‘×“×™×§×” ×× ×”×—× ×•×ª ×¡×™×™××” ×œ×”×™×˜×¢×Ÿ, ×œ×× ×™×¢×ª ×§×¤×™×¦×•×ª
              isLoading: state.isInitialized === false,
            }));
          
            // ×‘×–××Ÿ ×©×”×—× ×•×ª × ×˜×¢× ×ª, × ×—×›×”
            if (isLoading) {
              return <div>×˜×•×¢×Ÿ...</div>;
            }
          
            // âœ¨ 2. ×”×‘×“×™×§×” ×¦×¨×™×›×” ×œ×”×™×•×ª ×¢×œ isAuthenticated
            return isAuthenticated
              ? children // âœ¨ 3. ×× ××—×•×‘×¨, ×”×¦×’ ××ª ×”-children (××ª ×”×“×£ ×¢×¦××•)
              : <Navigate to="/login" replace />;
          }
      ğŸ“ ui/
        ğŸ“„ AnimatedNavLink.jsx
          import { NavLink } from "react-router-dom";
          import { motion } from "framer-motion";
          
          export const AnimatedNavLink = ({ to, label, className, children }) => {
            return (
              <NavLink to={to} className={({ isActive }) => `${className} ${isActive ? "active" : ""}`}>
                {({ isActive }) => (
                  <div className="relative flex items-center justify-center">
                    <span className="relative z-10">{label}</span>
                    {isActive && (
                      <motion.div
                        layoutId="active-pill"
                        className="absolute inset-0 z-0 rounded-full bg-primary/10"
                        transition={{ type: "spring", stiffness: 300, damping: 30 }}
                      />
                    )}
                    {children}
                  </div>
                )}
              </NavLink>
            );
          };
        ğŸ“„ Badge.jsx
          import * as React from "react"
          import { cva } from "class-variance-authority";
          
          import { cn } from "@/lib/utils.js"
          
          const badgeVariants = cva(
            "inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
            {
              variants: {
                variant: {
                  default:
                    "border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",
                  secondary:
                    "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
                  destructive:
                    "border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",
                  outline: "text-foreground",
                },
              },
              defaultVariants: {
                variant: "default",
              },
            }
          )
          
          function Badge({
            className,
            variant,
            ...props
          }) {
            return (<div className={cn(badgeVariants({ variant }), className)} {...props} />);
          }
          
          export { Badge, badgeVariants }
        ğŸ“„ Button.jsx
          import * as React from "react"
          import { Slot } from "@radix-ui/react-slot"
          import { cva } from "class-variance-authority";
          
          import { cn } from "@/lib/utils.js"
          
          const buttonVariants = cva(
            "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
            {
              variants: {
                variant: {
                  default:
                    "bg-primary text-primary-foreground shadow hover:bg-primary/90",
                  destructive:
                    "bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",
                  outline:
                    "border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",
                  secondary:
                    "bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",
                  ghost: "hover:bg-accent hover:text-accent-foreground",
                  link: "text-primary underline-offset-4 hover:underline",
                },
                size: {
                  default: "h-9 px-4 py-2",
                  sm: "h-8 rounded-md px-3 text-xs",
                  lg: "h-10 rounded-md px-8",
                  icon: "h-9 w-9",
                },
              },
              defaultVariants: {
                variant: "default",
                size: "default",
              },
            }
          )
          
          const Button = React.forwardRef(({ className, variant, size, asChild = false, ...props }, ref) => {
            const Comp = asChild ? Slot : "button"
            return (
              <Comp
                className={cn(buttonVariants({ variant, size, className }))}
                ref={ref}
                {...props} />
            );
          })
          Button.displayName = "Button"
          
          export { Button, buttonVariants }
        ğŸ“„ Card.jsx
          import * as React from "react"
          
          import { cn } from "@/lib/utils.js"
          
          const Card = React.forwardRef(({ className, ...props }, ref) => (
            <div
              ref={ref}
              className={cn("rounded-xl border bg-card text-card-foreground shadow", className)}
              {...props} />
          ))
          Card.displayName = "Card"
          
          const CardHeader = React.forwardRef(({ className, ...props }, ref) => (
            <div
              ref={ref}
              className={cn("flex flex-col space-y-1.5 p-6", className)}
              {...props} />
          ))
          CardHeader.displayName = "CardHeader"
          
          const CardTitle = React.forwardRef(({ className, ...props }, ref) => (
            <div
              ref={ref}
              className={cn("font-semibold leading-none tracking-tight", className)}
              {...props} />
          ))
          CardTitle.displayName = "CardTitle"
          
          const CardDescription = React.forwardRef(({ className, ...props }, ref) => (
            <div
              ref={ref}
              className={cn("text-sm text-muted-foreground", className)}
              {...props} />
          ))
          CardDescription.displayName = "CardDescription"
          
          const CardContent = React.forwardRef(({ className, ...props }, ref) => (
            <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
          ))
          CardContent.displayName = "CardContent"
          
          const CardFooter = React.forwardRef(({ className, ...props }, ref) => (
            <div
              ref={ref}
              className={cn("flex items-center p-6 pt-0", className)}
              {...props} />
          ))
          CardFooter.displayName = "CardFooter"
          
          export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
        ğŸ“„ Checkbox.jsx
          import * as React from "react"
          import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
          import { Check } from "lucide-react"
          
          import { cn } from "@/lib/utils.js"
          
          const Checkbox = React.forwardRef(({ className, ...props }, ref) => (
            <CheckboxPrimitive.Root
              ref={ref}
              className={cn(
                "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
                className
              )}
              {...props}>
              <CheckboxPrimitive.Indicator className={cn("flex items-center justify-center text-current")}>
                <Check className="h-4 w-4" />
              </CheckboxPrimitive.Indicator>
            </CheckboxPrimitive.Root>
          ))
          Checkbox.displayName = CheckboxPrimitive.Root.displayName
          
          export { Checkbox }
        ğŸ“„ Datepicker.jsx
          import { useState } from 'react';
          
          /* â”€â”€ DatePicker â”€â”€ */
          function DatePicker({ label, value = '', onChange }) {
            const [val, setVal] = useState(value);
          
            const handle = (e) => {
              setVal(e.target.value);
              onChange?.(e.target.value);
            };
          
            return (
              <label className="flex flex-col gap-1 text-sm font-medium text-gray-700 rtl">
                {label}
                <input
                  type="date"
                  value={val}
                  onChange={handle}
                  className="rounded border px-2 py-1"
                />
              </label>
            );
          }
          
          export default DatePicker;            // import DatePicker from ...
          export { DatePicker };                // import { DatePicker } ...
        ğŸ“„ Dialog.jsx
          import * as React from "react"
          import * as DialogPrimitive from "@radix-ui/react-dialog"
          import { X } from "lucide-react"
          
          import { cn } from "@/lib/utils.js"
          
          const Dialog = DialogPrimitive.Root
          
          const DialogTrigger = DialogPrimitive.Trigger
          
          const DialogPortal = DialogPrimitive.Portal
          
          const DialogClose = DialogPrimitive.Close
          
          const DialogOverlay = React.forwardRef(({ className, ...props }, ref) => (
            <DialogPrimitive.Overlay
              ref={ref}
              className={cn(
                "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
                className
              )}
              {...props} />
          ))
          DialogOverlay.displayName = DialogPrimitive.Overlay.displayName
          
          const DialogContent = React.forwardRef(({ className, children, ...props }, ref) => (
            <DialogPortal>
              <DialogOverlay />
              <DialogPrimitive.Content
                ref={ref}
                className={cn(
                  "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
                  className
                )}
                {...props}>
                {children}
                <DialogPrimitive.Close
                  className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
                  <X className="h-4 w-4" />
                  <span className="sr-only">Close</span>
                </DialogPrimitive.Close>
              </DialogPrimitive.Content>
            </DialogPortal>
          ))
          DialogContent.displayName = DialogPrimitive.Content.displayName
          
          const DialogHeader = ({
            className,
            ...props
          }) => (
            <div
              className={cn("flex flex-col space-y-1.5 text-center sm:text-left", className)}
              {...props} />
          )
          DialogHeader.displayName = "DialogHeader"
          
          const DialogFooter = ({
            className,
            ...props
          }) => (
            <div
              className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2", className)}
              {...props} />
          )
          DialogFooter.displayName = "DialogFooter"
          
          const DialogTitle = React.forwardRef(({ className, ...props }, ref) => (
            <DialogPrimitive.Title
              ref={ref}
              className={cn("text-lg font-semibold leading-none tracking-tight", className)}
              {...props} />
          ))
          DialogTitle.displayName = DialogPrimitive.Title.displayName
          
          const DialogDescription = React.forwardRef(({ className, ...props }, ref) => (
            <DialogPrimitive.Description
              ref={ref}
              className={cn("text-sm text-muted-foreground", className)}
              {...props} />
          ))
          DialogDescription.displayName = DialogPrimitive.Description.displayName
          
          export {
            Dialog,
            DialogPortal,
            DialogOverlay,
            DialogTrigger,
            DialogClose,
            DialogContent,
            DialogHeader,
            DialogFooter,
            DialogTitle,
            DialogDescription,
          }
        ğŸ“„ Dropdown-menu.jsx
          "use client"
          
          import * as React from "react"
          import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
          import { Check, ChevronRight, Circle } from "lucide-react"
          
          import { cn } from "@/lib/utils.js"
          
          const DropdownMenu = DropdownMenuPrimitive.Root
          
          const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger
          
          const DropdownMenuGroup = DropdownMenuPrimitive.Group
          
          const DropdownMenuPortal = DropdownMenuPrimitive.Portal
          
          const DropdownMenuSub = DropdownMenuPrimitive.Sub
          
          const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup
          
          const DropdownMenuSubTrigger = React.forwardRef(({ className, inset, children, ...props }, ref) => (
            <DropdownMenuPrimitive.SubTrigger
              ref={ref}
              className={cn(
                "flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
                inset && "pl-8",
                className
              )}
              {...props}>
              {children}
              <ChevronRight className="ml-auto" />
            </DropdownMenuPrimitive.SubTrigger>
          ))
          DropdownMenuSubTrigger.displayName =
            DropdownMenuPrimitive.SubTrigger.displayName
          
          const DropdownMenuSubContent = React.forwardRef(({ className, ...props }, ref) => (
            <DropdownMenuPrimitive.SubContent
              ref={ref}
              className={cn(
                "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
                className
              )}
              {...props} />
          ))
          DropdownMenuSubContent.displayName =
            DropdownMenuPrimitive.SubContent.displayName
          
          const DropdownMenuContent = React.forwardRef(({ className, sideOffset = 4, ...props }, ref) => (
            <DropdownMenuPrimitive.Portal>
              <DropdownMenuPrimitive.Content
                ref={ref}
                sideOffset={sideOffset}
                className={cn(
                  "z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md",
                  "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
                  className
                )}
                {...props} />
            </DropdownMenuPrimitive.Portal>
          ))
          DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName
          
          const DropdownMenuItem = React.forwardRef(({ className, inset, ...props }, ref) => (
            <DropdownMenuPrimitive.Item
              ref={ref}
              className={cn(
                "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",
                inset && "pl-8",
                className
              )}
              {...props} />
          ))
          DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName
          
          const DropdownMenuCheckboxItem = React.forwardRef(({ className, children, checked, ...props }, ref) => (
            <DropdownMenuPrimitive.CheckboxItem
              ref={ref}
              className={cn(
                "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
                className
              )}
              checked={checked}
              {...props}>
              <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
                <DropdownMenuPrimitive.ItemIndicator>
                  <Check className="h-4 w-4" />
                </DropdownMenuPrimitive.ItemIndicator>
              </span>
              {children}
            </DropdownMenuPrimitive.CheckboxItem>
          ))
          DropdownMenuCheckboxItem.displayName =
            DropdownMenuPrimitive.CheckboxItem.displayName
          
          const DropdownMenuRadioItem = React.forwardRef(({ className, children, ...props }, ref) => (
            <DropdownMenuPrimitive.RadioItem
              ref={ref}
              className={cn(
                "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
                className
              )}
              {...props}>
              <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
                <DropdownMenuPrimitive.ItemIndicator>
                  <Circle className="h-2 w-2 fill-current" />
                </DropdownMenuPrimitive.ItemIndicator>
              </span>
              {children}
            </DropdownMenuPrimitive.RadioItem>
          ))
          DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName
          
          const DropdownMenuLabel = React.forwardRef(({ className, inset, ...props }, ref) => (
            <DropdownMenuPrimitive.Label
              ref={ref}
              className={cn("px-2 py-1.5 text-sm font-semibold", inset && "pl-8", className)}
              {...props} />
          ))
          DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName
          
          const DropdownMenuSeparator = React.forwardRef(({ className, ...props }, ref) => (
            <DropdownMenuPrimitive.Separator
              ref={ref}
              className={cn("-mx-1 my-1 h-px bg-muted", className)}
              {...props} />
          ))
          DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName
          
          const DropdownMenuShortcut = ({
            className,
            ...props
          }) => {
            return (
              <span
                className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
                {...props} />
            );
          }
          DropdownMenuShortcut.displayName = "DropdownMenuShortcut"
          
          export {
            DropdownMenu,
            DropdownMenuTrigger,
            DropdownMenuContent,
            DropdownMenuItem,
            DropdownMenuCheckboxItem,
            DropdownMenuRadioItem,
            DropdownMenuLabel,
            DropdownMenuSeparator,
            DropdownMenuShortcut,
            DropdownMenuGroup,
            DropdownMenuPortal,
            DropdownMenuSub,
            DropdownMenuSubContent,
            DropdownMenuSubTrigger,
            DropdownMenuRadioGroup,
          }
        ğŸ“„ Input.jsx
          import * as React from "react"
          
          import { cn } from "@/lib/utils.js"
          
          const Input = React.forwardRef(({ className, type, ...props }, ref) => {
            return (
              <input
                type={type}
                className={cn(
                  "flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
                  className
                )}
                ref={ref}
                {...props} />
            );
          })
          Input.displayName = "Input"
          
          export { Input }
        ğŸ“„ Label.jsx
          import * as React from "react"
          import * as LabelPrimitive from "@radix-ui/react-label"
          import { cva } from "class-variance-authority";
          
          import { cn } from "@/lib/utils.js"
          
          const labelVariants = cva(
            "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
          )
          
          const Label = React.forwardRef(({ className, ...props }, ref) => (
            <LabelPrimitive.Root ref={ref} className={cn(labelVariants(), className)} {...props} />
          ))
          Label.displayName = LabelPrimitive.Root.displayName
          
          export { Label }
        ğŸ“„ Progress.jsx
          import * as React from "react"
          import * as ProgressPrimitive from "@radix-ui/react-progress"
          
          import { cn } from "@/lib/utils.js"
          
          const Progress = React.forwardRef(({ className, value, ...props }, ref) => (
            <ProgressPrimitive.Root
              ref={ref}
              className={cn("relative h-4 w-full overflow-hidden rounded-full bg-secondary", className)}
              {...props}
            >
              <ProgressPrimitive.Indicator
                className="h-full w-full flex-1 bg-primary transition-all"
                style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
              />
            </ProgressPrimitive.Root>
          ))
          Progress.displayName = ProgressPrimitive.Root.displayName
          
          export { Progress }
        ğŸ“„ Select.jsx
          "use client"
          
          import * as React from "react"
          import * as SelectPrimitive from "@radix-ui/react-select"
          import { Check, ChevronDown, ChevronUp } from "lucide-react"
          
          import { cn } from "@/lib/utils.js"
          
          const Select = SelectPrimitive.Root
          
          const SelectGroup = SelectPrimitive.Group
          
          const SelectValue = SelectPrimitive.Value
          
          const SelectTrigger = React.forwardRef(({ className, children, ...props }, ref) => (
            <SelectPrimitive.Trigger
              ref={ref}
              className={cn(
                "flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
                className
              )}
              {...props}>
              {children}
              <SelectPrimitive.Icon asChild>
                <ChevronDown className="h-4 w-4 opacity-50" />
              </SelectPrimitive.Icon>
            </SelectPrimitive.Trigger>
          ))
          SelectTrigger.displayName = SelectPrimitive.Trigger.displayName
          
          const SelectScrollUpButton = React.forwardRef(({ className, ...props }, ref) => (
            <SelectPrimitive.ScrollUpButton
              ref={ref}
              className={cn("flex cursor-default items-center justify-center py-1", className)}
              {...props}>
              <ChevronUp className="h-4 w-4" />
            </SelectPrimitive.ScrollUpButton>
          ))
          SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName
          
          const SelectScrollDownButton = React.forwardRef(({ className, ...props }, ref) => (
            <SelectPrimitive.ScrollDownButton
              ref={ref}
              className={cn("flex cursor-default items-center justify-center py-1", className)}
              {...props}>
              <ChevronDown className="h-4 w-4" />
            </SelectPrimitive.ScrollDownButton>
          ))
          SelectScrollDownButton.displayName =
            SelectPrimitive.ScrollDownButton.displayName
          
          const SelectContent = React.forwardRef(({ className, children, position = "popper", ...props }, ref) => (
            <SelectPrimitive.Portal>
              <SelectPrimitive.Content
                ref={ref}
                className={cn(
                  "relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",
                  position === "popper" &&
                    "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
                  className
                )}
                position={position}
                {...props}>
                <SelectScrollUpButton />
                <SelectPrimitive.Viewport
                  className={cn("p-1", position === "popper" &&
                    "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]")}>
                  {children}
                </SelectPrimitive.Viewport>
                <SelectScrollDownButton />
              </SelectPrimitive.Content>
            </SelectPrimitive.Portal>
          ))
          SelectContent.displayName = SelectPrimitive.Content.displayName
          
          const SelectLabel = React.forwardRef(({ className, ...props }, ref) => (
            <SelectPrimitive.Label
              ref={ref}
              className={cn("px-2 py-1.5 text-sm font-semibold", className)}
              {...props} />
          ))
          SelectLabel.displayName = SelectPrimitive.Label.displayName
          
          const SelectItem = React.forwardRef(({ className, children, ...props }, ref) => (
            <SelectPrimitive.Item
              ref={ref}
              className={cn(
                "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
                className
              )}
              {...props}>
              <span className="absolute right-2 flex h-3.5 w-3.5 items-center justify-center">
                <SelectPrimitive.ItemIndicator>
                  <Check className="h-4 w-4" />
                </SelectPrimitive.ItemIndicator>
              </span>
              <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
            </SelectPrimitive.Item>
          ))
          SelectItem.displayName = SelectPrimitive.Item.displayName
          
          const SelectSeparator = React.forwardRef(({ className, ...props }, ref) => (
            <SelectPrimitive.Separator
              ref={ref}
              className={cn("-mx-1 my-1 h-px bg-muted", className)}
              {...props} />
          ))
          SelectSeparator.displayName = SelectPrimitive.Separator.displayName
          
          export {
            Select,
            SelectGroup,
            SelectValue,
            SelectTrigger,
            SelectContent,
            SelectLabel,
            SelectItem,
            SelectSeparator,
            SelectScrollUpButton,
            SelectScrollDownButton,
          }
        ğŸ“„ Separator.jsx
          "use client"
          
          import * as React from "react"
          import * as SeparatorPrimitive from "@radix-ui/react-separator"
          
          import { cn } from "@/lib/utils.js"
          
          const Separator = React.forwardRef((
            { className, orientation = "horizontal", decorative = true, ...props },
            ref
          ) => (
            <SeparatorPrimitive.Root
              ref={ref}
              decorative={decorative}
              orientation={orientation}
              className={cn(
                "shrink-0 bg-border",
                orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
                className
              )}
              {...props} />
          ))
          Separator.displayName = SeparatorPrimitive.Root.displayName
          
          export { Separator }
        ğŸ“„ Skeleton.jsx
          import { cn } from "@/lib/utils.js"
          
          function Skeleton({
            className,
            ...props
          }) {
            return (
              <div
                className={cn("animate-pulse rounded-md bg-primary/10", className)}
                {...props} />
            );
          }
          
          export { Skeleton }
        ğŸ“„ Switch.jsx
          import * as React from "react"
          import * as SwitchPrimitives from "@radix-ui/react-switch"
          
          import { cn } from "@/lib/utils.js"
          
          const Switch = React.forwardRef(({ className, ...props }, ref) => (
            <SwitchPrimitives.Root
              className={cn(
                "peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
                className
              )}
              {...props}
              ref={ref}>
              <SwitchPrimitives.Thumb
                className={cn(
                  "pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0"
                )} />
            </SwitchPrimitives.Root>
          ))
          Switch.displayName = SwitchPrimitives.Root.displayName
          
          export { Switch }
        ğŸ“„ Table.jsx
          import * as React from "react"
          
          import { cn } from "@/lib/utils.js"
          
          const Table = React.forwardRef(({ className, ...props }, ref) => (
            <div className="relative w-full overflow-auto">
              <table
                ref={ref}
                className={cn("w-full caption-bottom text-sm", className)}
                {...props} />
            </div>
          ))
          Table.displayName = "Table"
          
          const TableHeader = React.forwardRef(({ className, ...props }, ref) => (
            <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
          ))
          TableHeader.displayName = "TableHeader"
          
          const TableBody = React.forwardRef(({ className, ...props }, ref) => (
            <tbody
              ref={ref}
              className={cn("[&_tr:last-child]:border-0", className)}
              {...props} />
          ))
          TableBody.displayName = "TableBody"
          
          const TableFooter = React.forwardRef(({ className, ...props }, ref) => (
            <tfoot
              ref={ref}
              className={cn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0", className)}
              {...props} />
          ))
          TableFooter.displayName = "TableFooter"
          
          const TableRow = React.forwardRef(({ className, ...props }, ref) => (
            <tr
              ref={ref}
              className={cn(
                "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
                className
              )}
              {...props} />
          ))
          TableRow.displayName = "TableRow"
          
          const TableHead = React.forwardRef(({ className, ...props }, ref) => (
            <th
              ref={ref}
              className={cn(
                "h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
                className
              )}
              {...props} />
          ))
          TableHead.displayName = "TableHead"
          
          const TableCell = React.forwardRef(({ className, ...props }, ref) => (
            <td
              ref={ref}
              className={cn(
                "p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
                className
              )}
              {...props} />
          ))
          TableCell.displayName = "TableCell"
          
          const TableCaption = React.forwardRef(({ className, ...props }, ref) => (
            <caption
              ref={ref}
              className={cn("mt-4 text-sm text-muted-foreground", className)}
              {...props} />
          ))
          TableCaption.displayName = "TableCaption"
          
          export {
            Table,
            TableHeader,
            TableBody,
            TableFooter,
            TableHead,
            TableRow,
            TableCell,
            TableCaption,
          }
        ğŸ“„ Tabs.jsx
          import * as React from "react"
          import * as TabsPrimitive from "@radix-ui/react-tabs"
          
          import { cn } from "@/lib/utils.js"
          
          const Tabs = TabsPrimitive.Root
          
          const TabsList = React.forwardRef(({ className, ...props }, ref) => (
            <TabsPrimitive.List
              ref={ref}
              className={cn(
                "inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",
                className
              )}
              {...props} />
          ))
          TabsList.displayName = TabsPrimitive.List.displayName
          
          const TabsTrigger = React.forwardRef(({ className, ...props }, ref) => (
            <TabsPrimitive.Trigger
              ref={ref}
              className={cn(
                "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",
                className
              )}
              {...props} />
          ))
          TabsTrigger.displayName = TabsPrimitive.Trigger.displayName
          
          const TabsContent = React.forwardRef(({ className, ...props }, ref) => (
            <TabsPrimitive.Content
              ref={ref}
              className={cn(
                "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
                className
              )}
              {...props} />
          ))
          TabsContent.displayName = TabsPrimitive.Content.displayName
          
          export { Tabs, TabsList, TabsTrigger, TabsContent }
        ğŸ“„ Textarea.jsx
          import * as React from "react"
          
          import { cn } from "@/lib/utils.js"
          
          const Textarea = React.forwardRef(({ className, ...props }, ref) => {
            return (
              (<textarea
                className={cn(
                  "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                  className
                )}
                ref={ref}
                {...props} />)
            );
          })
          Textarea.displayName = "Textarea"
          
          export { Textarea }
        ğŸ“„ Toast.jsx
          import * as React from "react"
          import * as ToastPrimitives from "@radix-ui/react-toast"
          import { cva } from "class-variance-authority";
          import { X } from "lucide-react"
          
          import { cn } from "@/lib/utils.js"
          
          const ToastProvider = ToastPrimitives.Provider
          
          const ToastViewport = React.forwardRef(({ className, ...props }, ref) => (
            <ToastPrimitives.Viewport
              ref={ref}
              className={cn(
                "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
                className
              )}
              {...props} />
          ))
          ToastViewport.displayName = ToastPrimitives.Viewport.displayName
          
          const toastVariants = cva(
            "group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
            {
              variants: {
                variant: {
                  default: "border bg-background text-foreground",
                  destructive:
                    "destructive group border-destructive bg-destructive text-destructive-foreground",
                },
              },
              defaultVariants: {
                variant: "default",
              },
            }
          )
          
          const Toast = React.forwardRef(({ className, variant, ...props }, ref) => {
            return (
              <ToastPrimitives.Root
                ref={ref}
                className={cn(toastVariants({ variant }), className)}
                {...props} />
            );
          })
          Toast.displayName = ToastPrimitives.Root.displayName
          
          const ToastAction = React.forwardRef(({ className, ...props }, ref) => (
            <ToastPrimitives.Action
              ref={ref}
              className={cn(
                "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
                className
              )}
              {...props} />
          ))
          ToastAction.displayName = ToastPrimitives.Action.displayName
          
          const ToastClose = React.forwardRef(({ className, ...props }, ref) => (
            <ToastPrimitives.Close
              ref={ref}
              className={cn(
                "absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
                className
              )}
              toast-close=""
              {...props}>
              <X className="h-4 w-4" />
            </ToastPrimitives.Close>
          ))
          ToastClose.displayName = ToastPrimitives.Close.displayName
          
          const ToastTitle = React.forwardRef(({ className, ...props }, ref) => (
            <ToastPrimitives.Title
              ref={ref}
              className={cn("text-sm font-semibold [&+div]:text-xs", className)}
              {...props} />
          ))
          ToastTitle.displayName = ToastPrimitives.Title.displayName
          
          const ToastDescription = React.forwardRef(({ className, ...props }, ref) => (
            <ToastPrimitives.Description ref={ref} className={cn("text-sm opacity-90", className)} {...props} />
          ))
          ToastDescription.displayName = ToastPrimitives.Description.displayName
          
          export { ToastProvider, ToastViewport, Toast, ToastTitle, ToastDescription, ToastClose, ToastAction };
        ğŸ“„ Toaster.jsx
          import { useToast } from "@/hooks/use-toast"
          import {
            Toast,
            ToastClose,
            ToastDescription,
            ToastProvider,
            ToastTitle,
            ToastViewport,
          } from "@/components/ui/Toast"
          
          export function Toaster() {
            const { toasts } = useToast()
          
            return (
              <ToastProvider>
                {toasts.map(function ({ id, title, description, action, ...props }) {
                  return (
                    <Toast key={id} {...props}>
                      <div className="grid gap-1">
                        {title && <ToastTitle>{title}</ToastTitle>}
                        {description && (
                          <ToastDescription>{description}</ToastDescription>
                        )}
                      </div>
                      {action}
                      <ToastClose />
                    </Toast>
                  );
                })}
                <ToastViewport />
              </ToastProvider>
            );
          }
        ğŸ“„ Tooltip.jsx
          import * as React from "react"
          import * as TooltipPrimitive from "@radix-ui/react-tooltip"
          
          import { cn } from "@/lib/utils.js"
          
          const TooltipProvider = TooltipPrimitive.Provider
          
          const Tooltip = TooltipPrimitive.Root
          
          const TooltipTrigger = TooltipPrimitive.Trigger
          
          const TooltipContent = React.forwardRef(({ className, sideOffset = 4, ...props }, ref) => (
            <TooltipPrimitive.Portal>
              <TooltipPrimitive.Content
                ref={ref}
                sideOffset={sideOffset}
                className={cn(
                  "z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",
                  className
                )}
                {...props} />
            </TooltipPrimitive.Portal>
          ))
          TooltipContent.displayName = TooltipPrimitive.Content.displayName
          
          export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
    ğŸ“ hooks/
      ğŸ“„ use-toast.js
        "use client";
        // Inspired by react-hot-toast library
        import * as React from "react"
        
        const TOAST_LIMIT = 1
        const TOAST_REMOVE_DELAY = 1000000
        
        const actionTypes = {
          ADD_TOAST: "ADD_TOAST",
          UPDATE_TOAST: "UPDATE_TOAST",
          DISMISS_TOAST: "DISMISS_TOAST",
          REMOVE_TOAST: "REMOVE_TOAST"
        }
        
        let count = 0
        
        function genId() {
          count = (count + 1) % Number.MAX_SAFE_INTEGER
          return count.toString();
        }
        
        const toastTimeouts = new Map()
        
        const addToRemoveQueue = (toastId) => {
          if (toastTimeouts.has(toastId)) {
            return
          }
        
          const timeout = setTimeout(() => {
            toastTimeouts.delete(toastId)
            dispatch({
              type: "REMOVE_TOAST",
              toastId: toastId,
            })
          }, TOAST_REMOVE_DELAY)
        
          toastTimeouts.set(toastId, timeout)
        }
        
        export const reducer = (state, action) => {
          switch (action.type) {
            case "ADD_TOAST":
              return {
                ...state,
                toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
              };
        
            case "UPDATE_TOAST":
              return {
                ...state,
                toasts: state.toasts.map((t) =>
                  t.id === action.toast.id ? { ...t, ...action.toast } : t),
              };
        
            case "DISMISS_TOAST": {
              const { toastId } = action
        
              // ! Side effects ! - This could be extracted into a dismissToast() action,
              // but I'll keep it here for simplicity
              if (toastId) {
                addToRemoveQueue(toastId)
              } else {
                state.toasts.forEach((toast) => {
                  addToRemoveQueue(toast.id)
                })
              }
        
              return {
                ...state,
                toasts: state.toasts.map((t) =>
                  t.id === toastId || toastId === undefined
                    ? {
                        ...t,
                        open: false,
                      }
                    : t),
              };
            }
            case "REMOVE_TOAST":
              if (action.toastId === undefined) {
                return {
                  ...state,
                  toasts: [],
                }
              }
              return {
                ...state,
                toasts: state.toasts.filter((t) => t.id !== action.toastId),
              };
          }
        }
        
        const listeners = []
        
        let memoryState = { toasts: [] }
        
        function dispatch(action) {
          memoryState = reducer(memoryState, action)
          listeners.forEach((listener) => {
            listener(memoryState)
          })
        }
        
        function toast({
          ...props
        }) {
          const id = genId()
        
          const update = (props) =>
            dispatch({
              type: "UPDATE_TOAST",
              toast: { ...props, id },
            })
          const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })
        
          dispatch({
            type: "ADD_TOAST",
            toast: {
              ...props,
              id,
              open: true,
              onOpenChange: (open) => {
                if (!open) dismiss()
              },
            },
          })
        
          return {
            id: id,
            dismiss,
            update,
          }
        }
        
        function useToast() {
          const [state, setState] = React.useState(memoryState)
        
          React.useEffect(() => {
            listeners.push(setState)
            return () => {
              const index = listeners.indexOf(setState)
              if (index > -1) {
                listeners.splice(index, 1)
              }
            };
          }, [state])
        
          return {
            ...state,
            toast,
            dismiss: (toastId) => dispatch({ type: "DISMISS_TOAST", toastId }),
          };
        }
        
        export { useToast, toast }
      ğŸ“„ useLogin.js
        import { useMutation } from '@tanstack/react-query';
        import api from '@/utils/api.js';
        import { useAuthStore } from '@/stores/authStore';
        
        const loginRequest = async (credentials) => {
          const { data } = await api.post('/auth/login', credentials);
          return data.user;
        };
        
        const useLogin = () => {
          const login = useAuthStore((state) => state.login);
        
          return useMutation({
            mutationFn: loginRequest,
            onSuccess: (user) => {
              login(user);
            },
          });
        };
        
        export default useLogin;
      ğŸ“„ useLogout.js
        import { useMutation } from '@tanstack/react-query';
        import { useNavigate } from 'react-router-dom';
        import toast from 'react-hot-toast';
        import api from '@/utils/api.js';
        import { useAuthStore } from '@/stores/authStore';
        
        const logoutRequest = async () => {
          await api.post('/auth/logout');
        };
        
        const useLogout = () => {
          const logout = useAuthStore((state) => state.logout);
          const navigate = useNavigate();
        
          return useMutation({
            mutationFn: logoutRequest,
            onSuccess: () => {
              logout();
              toast.success('×”×ª× ×ª×§×ª ×‘×”×¦×œ×—×”.');
              navigate('/');
            },
            onError: () => {
              // Even if server fails, log out on client
              logout();
              toast.error('××™×¨×¢×” ×©×’×™××” ×‘×”×ª× ×ª×§×•×ª, ××š × ×•×§×ª×” ××”××¢×¨×›×ª.');
              navigate('/');
            },
          });
        };
        
        export default useLogout;
      ğŸ“„ useRegister.js
        import { useMutation } from '@tanstack/react-query';
        import api from '@/utils/api.js';
        
        const registerRequest = async (credentials) => {
          // credentials will be an object like { email, password }
          const { data } = await api.post('/auth/register', credentials);
          return data;
        };
        
        const useRegister = () => {
          return useMutation({
            mutationFn: registerRequest,
          });
        };
        
        export default useRegister;
      ğŸ“„ useToast.js
        // client/src/hooks/useToast.js
        
        // This is a minimal implementation of the shadcn/ui useToast hook.
        // It is designed to work with the Toaster component we will create.
        import * as React from "react"
        
        const TOAST_LIMIT = 1
        const TOAST_REMOVE_DELAY = 1000000
        
        const actionTypes = {
          ADD_TOAST: "ADD_TOAST",
          UPDATE_TOAST: "UPDATE_TOAST",
          DISMISS_TOAST: "DISMISS_TOAST",
          REMOVE_TOAST: "REMOVE_TOAST",
        }
        
        let count = 0
        
        function genId() {
          count = (count + 1) % Number.MAX_VALUE
          return count.toString()
        }
        
        const toastTimeouts = new Map()
        
        const addToRemoveQueue = (toastId) => {
          if (toastTimeouts.has(toastId)) {
            return
          }
        
          const timeout = setTimeout(() => {
            toastTimeouts.delete(toastId)
            dispatch({
              type: actionTypes.REMOVE_TOAST,
              toastId: toastId,
            })
          }, TOAST_REMOVE_DELAY)
        
          toastTimeouts.set(toastId, timeout)
        }
        
        export const reducer = (state, action) => {
          switch (action.type) {
            case actionTypes.ADD_TOAST:
              return {
                ...state,
                toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
              }
        
            case actionTypes.UPDATE_TOAST:
              return {
                ...state,
                toasts: state.toasts.map((t) =>
                  t.id === action.toast.id ? { ...t, ...action.toast } : t
                ),
              }
        
            case actionTypes.DISMISS_TOAST: {
              const { toastId } = action
              if (toastId) {
                addToRemoveQueue(toastId)
              } else {
                state.toasts.forEach((toast) => {
                  addToRemoveQueue(toast.id)
                })
              }
        
              return {
                ...state,
                toasts: state.toasts.map((t) =>
                  t.id === toastId || toastId === undefined
                    ? {
                        ...t,
                        open: false,
                      }
                    : t
                ),
              }
            }
            case actionTypes.REMOVE_TOAST:
              if (action.toastId === undefined) {
                return {
                  ...state,
                  toasts: [],
                }
              }
              return {
                ...state,
                toasts: state.toasts.filter((t) => t.id !== action.toastId),
              }
          }
        }
        
        const listeners = []
        let memoryState = { toasts: [] }
        
        function dispatch(action) {
          memoryState = reducer(memoryState, action)
          listeners.forEach((listener) => {
            listener(memoryState)
          })
        }
        
        function toast(props) {
          const id = genId()
        
          const update = (props) =>
            dispatch({
              type: actionTypes.UPDATE_TOAST,
              toast: { ...props, id },
            })
          const dismiss = () => dispatch({ type: actionTypes.DISMISS_TOAST, toastId: id })
        
          dispatch({
            type: actionTypes.ADD_TOAST,
            toast: {
              ...props,
              id,
              open: true,
              onOpenChange: (open) => {
                if (!open) dismiss()
              },
            },
          })
        
          return {
            id: id,
            dismiss,
            update,
          }
        }
        
        function useToast() {
          const [state, setState] = React.useState(memoryState)
        
          React.useEffect(() => {
            listeners.push(setState)
            return () => {
              const index = listeners.indexOf(setState)
              if (index > -1) {
                listeners.splice(index, 1)
              }
            }
          }, [state])
        
          return {
            ...state,
            toast,
            dismiss: (toastId) => dispatch({ type: actionTypes.DISMISS_TOAST, toastId }),
          }
        }
        
        export { useToast, toast }
    ğŸ“„ index.css
      @tailwind base;
      @tailwind components;
      @tailwind utilities;
      
      body {
        font-family: 'Assistant', sans-serif;
      }
      
      
      
      @layer base {
        :root {
          --background: 0 0% 100%;
          --foreground: 0 0% 3.9%;
          --card: 0 0% 100%;
          --card-foreground: 0 0% 3.9%;
          --popover: 0 0% 100%;
          --popover-foreground: 0 0% 3.9%;
          --primary: 0 0% 9%;
          --primary-foreground: 0 0% 98%;
          --secondary: 0 0% 96.1%;
          --secondary-foreground: 0 0% 9%;
          --muted: 0 0% 96.1%;
          --muted-foreground: 0 0% 45.1%;
          --accent: 0 0% 96.1%;
          --accent-foreground: 0 0% 9%;
          --destructive: 0 84.2% 60.2%;
          --destructive-foreground: 0 0% 98%;
          --border: 0 0% 89.8%;
          --input: 0 0% 89.8%;
          --ring: 0 0% 3.9%;
          --chart-1: 12 76% 61%;
          --chart-2: 173 58% 39%;
          --chart-3: 197 37% 24%;
          --chart-4: 43 74% 66%;
          --chart-5: 27 87% 67%;
          --radius: 0.5rem;
        }
        .dark {
          --background: 0 0% 3.9%;
          --foreground: 0 0% 98%;
          --card: 0 0% 3.9%;
          --card-foreground: 0 0% 98%;
          --popover: 0 0% 3.9%;
          --popover-foreground: 0 0% 98%;
          --primary: 0 0% 98%;
          --primary-foreground: 0 0% 9%;
          --secondary: 0 0% 14.9%;
          --secondary-foreground: 0 0% 98%;
          --muted: 0 0% 14.9%;
          --muted-foreground: 0 0% 63.9%;
          --accent: 0 0% 14.9%;
          --accent-foreground: 0 0% 98%;
          --destructive: 0 62.8% 30.6%;
          --destructive-foreground: 0 0% 98%;
          --border: 0 0% 14.9%;
          --input: 0 0% 14.9%;
          --ring: 0 0% 83.1%;
          --chart-1: 220 70% 50%;
          --chart-2: 160 60% 45%;
          --chart-3: 30 80% 55%;
          --chart-4: 280 65% 60%;
          --chart-5: 340 75% 55%;
        }
      }
      
      
      
      @layer base {
        * {
          @apply border-border;
        }
        body {
          @apply bg-background text-foreground;
        }
      }
    ğŸ“ lib/
      ğŸ“„ loanCalculator.js
        // server/utils/loanCalculator.js
        
        /**
         * ××—×©×‘ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ ×œ×”×œ×•×•××” ×‘×©×™×˜×ª "×©×¤×™×¦×¨".
         * @returns {Array<object>} ××¢×¨×š ××•×‘×™×™×§×˜×™× ×”××™×™×¦×’ ××ª ×œ×•×— ×”×¡×™×œ×•×§×™×Ÿ.
         */
        export function calculateSpitzerSchedule({ principal, annualRate, termInMonths, startDate }) {
          const schedule = [];
          let remainingBalance = principal;
          const monthlyInterestRate = annualRate / 100 / 12;
        
          // × ×•×¡×—×ª ×©×¤×™×¦×¨ ×œ×—×™×©×•×‘ ×”×”×—×–×¨ ×”×—×•×“×©×™ ×”×§×‘×•×¢
          const monthlyPayment = principal * (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, termInMonths)) / (Math.pow(1 + monthlyInterestRate, termInMonths) - 1);
        
          for (let i = 1; i <= termInMonths; i++) {
            const interestPayment = remainingBalance * monthlyInterestRate;
            const principalPayment = monthlyPayment - interestPayment;
            remainingBalance -= principalPayment;
        
            const paymentDate = new Date(startDate);
            paymentDate.setMonth(paymentDate.getMonth() + i);
        
            schedule.push({
              paymentNumber: i,
              date: paymentDate,
              principal: parseFloat(principalPayment.toFixed(2)),
              interest: parseFloat(interestPayment.toFixed(2)),
              totalPayment: parseFloat(monthlyPayment.toFixed(2)),
              remainingBalance: parseFloat(Math.max(0, remainingBalance).toFixed(2)),
            });
          }
          return schedule;
        }
        
        /**
         * ××—×©×‘ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ ×œ×”×œ×•×•××” ×‘×©×™×˜×ª "×§×¨×Ÿ ×©×•×•×”".
         * @returns {Array<object>} ××¢×¨×š ××•×‘×™×™×§×˜×™× ×”××™×™×¦×’ ××ª ×œ×•×— ×”×¡×™×œ×•×§×™×Ÿ.
         */
        export function calculateKerenShavaSchedule({ principal, annualRate, termInMonths, startDate }) {
          const schedule = [];
          let remainingBalance = principal;
          const monthlyInterestRate = annualRate / 100 / 12;
          const principalPerMonth = principal / termInMonths;
        
          for (let i = 1; i <= termInMonths; i++) {
            const interestPayment = remainingBalance * monthlyInterestRate;
            const totalPayment = principalPerMonth + interestPayment;
            remainingBalance -= principalPerMonth;
        
            const paymentDate = new Date(startDate);
            paymentDate.setMonth(paymentDate.getMonth() + i);
        
            schedule.push({
              paymentNumber: i,
              date: paymentDate,
              principal: parseFloat(principalPerMonth.toFixed(2)),
              interest: parseFloat(interestPayment.toFixed(2)),
              totalPayment: parseFloat(totalPayment.toFixed(2)),
              remainingBalance: parseFloat(Math.max(0, remainingBalance).toFixed(2)),
            });
          }
          return schedule;
        }
      ğŸ“„ priceCalculator.js
        // client/src/lib/priceCalculator.js
        
        // ×”×™×¨×¨×›×™×™×ª ××—×™×¨×™×: ××™ × ×—×©×‘ "×™×§×¨" ×™×•×ª×¨ ×‘×—×“×¨
        const guestHierarchy = {
          adult: { priceKey: 'teen', order: 1 }, // ××‘×•×’×¨ ×”×•× ×”×™×§×¨ ×‘×™×•×ª×¨
          teen: { priceKey: 'teen', order: 2 },
          child: { priceKey: 'child', order: 3 },
        };
        
        /**
         * ××—×©×‘ ××—×™×¨ ×‘×¡×™×¡ *×œ×œ×™×œ×” ××—×“* ×¢×‘×•×¨ ×”×¨×›×‘ ××•×¨×—×™× ×•××—×™×¨×•×Ÿ ×¡×¤×¦×™×¤×™.
         * (×¤×•× ×§×¦×™×” ×¤× ×™××™×ª)
         */
        export function calculateSingleNightBasePrice(room, priceList) {
          const { adults = 0, teens = 0, children = 0, babies = 0 } = room;
        
          // 1. ×ª×™× ×•×§×•×ª: ×ª×•×¡×¤×ª ×§×‘×•×¢×” (×œ×œ×™×œ×”)
          const babyCost = babies * (priceList.baby || 0);
        
          // 2. ×§×‘×•×¦×” ×¢×™×§×¨×™×ª (×œ×œ× ×ª×™× ×•×§×•×ª)
          const mainGroupSize = adults + teens + children;
          let mainGroupPrice = 0;
        
          if (mainGroupSize === 0) {
            mainGroupPrice = 0;
          } else if (mainGroupSize === 1) {
            // ××—×™×¨ ×™×—×™×“ ×‘×—×“×¨
            mainGroupPrice = priceList.single_room || 0;
          } else {
            // ×–×•×’ ×•××¢×œ×”
            // ×××™×™× ×™× ×›×“×™ ×©×©× ×™ ×”"×™×§×¨×™×" ×‘×™×•×ª×¨ ×™×ª×¤×¡×• ××ª ××—×™×¨ ×”"×–×•×’"
            const guests = [
              ...Array(adults).fill('adult'),
              ...Array(teens).fill('teen'),
              ...Array(children).fill('child'),
            ];
        
            guests.sort((a, b) => guestHierarchy[a].order - guestHierarchy[b].order);
        
            // ××—×™×¨ ×”×‘×¡×™×¡ ×œ×–×•×’
            mainGroupPrice = priceList.couple || 0;
        
            // ×ª×•×¡×¤×•×ª ×¢×‘×•×¨ ×›×œ ××“× ××¢×‘×¨ ×œ×–×•×’ (×”×—×œ ××”××“× ×”×©×œ×™×©×™)
            for (let i = 2; i < guests.length; i++) {
              const guestType = guests[i];
              const priceKey = guestHierarchy[guestType].priceKey;
              mainGroupPrice += (priceList[priceKey] || 0);
            }
          }
        
          return mainGroupPrice + babyCost;
        }
        
        /**
         * ×”×¤×•× ×§×¦×™×” ×”×¨××©×™×ª ×œ×—×™×©×•×‘ ××—×™×¨ ×—×“×¨.
         * ××©×§×œ×œ×ª: ××—×™×¨×•× ×™× × ×‘×—×¨×™× + ×ª×•×¡×¤×ª ×¡×•×’ ×—×“×¨ + ××¡×¤×¨ ×œ×™×œ×•×ª.
         * * @param {Object} room - ××•×‘×™×™×§×˜ ×”×—×“×¨ (×›××•×™×•×ª ××•×¨×—×™×)
         * @param {Object} allPriceLists - ××¤×” ×©×œ ×›×œ ×”××—×™×¨×•× ×™× ×”×–××™× ×™×
         * @param {Array} selectedNames - ××¢×¨×š ×©××•×ª ×”××—×™×¨×•× ×™× ×©× ×‘×—×¨×• ×œ×—×“×¨ ×–×”
         * @param {Number} nights - ××¡×¤×¨ ×”×œ×™×œ×•×ª (×‘×¨×™×¨×ª ××—×“×œ 1)
         * @param {Number} roomSupplementPerNight - ×ª×•×¡×¤×ª ×©×§×œ×™×ª ×œ×œ×™×œ×” ×¢×‘×•×¨ ×¡×•×’ ×”×—×“×¨ (×‘×¨×™×¨×ª ××—×“×œ 0)
         */
        export function calculateRoomTotalPrice(room, allPriceLists, selectedNames, nights = 1, roomSupplementPerNight = 0) {
            if (!allPriceLists || !selectedNames || selectedNames.length === 0) {
                return 0;
            }
        
            let totalBasePricePerNight = 0;
        
            // ×¡×™×›×•× ×”××—×™×¨×™× ××›×œ ×”××—×™×¨×•× ×™× ×©× ×‘×—×¨×• (×œ×œ×™×œ×” ××—×“)
            for (const name of selectedNames) {
                const priceList = allPriceLists[name];
                if (priceList) {
                    totalBasePricePerNight += calculateSingleNightBasePrice(room, priceList);
                }
            }
        
            // ×”××—×™×¨ ×”×¡×•×¤×™ ×œ×œ×™×œ×” = (××—×™×¨ ××—×™×¨×•× ×™×) + (×ª×•×¡×¤×ª ×¡×•×’ ×—×“×¨)
            const finalPricePerNight = totalBasePricePerNight + roomSupplementPerNight;
        
            // ×”×›×¤×œ×” ×‘××¡×¤×¨ ×”×œ×™×œ×•×ª
            return finalPricePerNight * nights;
        }
      ğŸ“„ utils.js
        import { clsx } from "clsx";
        import { twMerge } from "tailwind-merge"
        
        export function cn(...inputs) {
          return twMerge(clsx(inputs));
        }
    ğŸ“„ main.jsx
      import React from 'react';
      import ReactDOM from 'react-dom/client';
      import { BrowserRouter } from 'react-router-dom';
      import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
      import App from './App.jsx';
      import './index.css';
      
      // Create a client for React Query
      const queryClient = new QueryClient();
      
      ReactDOM.createRoot(document.getElementById('root')).render(
        <React.StrictMode>
          <BrowserRouter>
            <QueryClientProvider client={queryClient}>
              <App />
            </QueryClientProvider>
          </BrowserRouter>
        </React.StrictMode>
      );
    ğŸ“ pages/
      ğŸ“„ EditOrderPage.jsx
        import React, { useState, useEffect, useMemo } from 'react';
        import { useParams, useNavigate, Link } from 'react-router-dom';
        import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
        import api from '@/utils/api.js';
        import toast from 'react-hot-toast';
        import { format } from 'date-fns';
        import ReactQuill from 'react-quill';
        import 'react-quill/dist/quill.snow.css';
        import { useAuthStore } from '@/stores/authStore.js'; // âœ¨ ×™×™×‘×•× ×”-store
        
        // Components
        import { AddRoomForm } from '@/components/orders/AddRoomForm';
        import { OrderSummaryTable } from '@/components/orders/OrderSummaryTable';
        import { OrderExtrasForm } from '@/components/orders/OrderExtrasForm';
        import { Button } from '@/components/ui/Button.jsx';
        import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/Card.jsx';
        import { Input } from '@/components/ui/Input.jsx';
        import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
        import { Label } from '@/components/ui/Label.jsx';
        import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from "@/components/ui/Dialog";
        
        // Icons
        import {
            ArrowRight, User, Phone, Activity, BadgePercent, Save,
            FileDown, Hotel, Eye, StickyNote, FilePlus2, Tag, Mail, Calendar, Maximize2
        } from 'lucide-react';
        
        import { calculateRoomTotalPrice } from '@/lib/priceCalculator';
        
        const fetchOrder = async (orderId) => (await api.get(`/orders/${orderId}`)).data;
        
        const fetchAllPriceListsAsMap = async (hotelId) => {
          const { data } = await api.get(`/pricelists?hotelId=${hotelId}`);
          return data.reduce((acc, pl) => {
            acc[pl.name] = pl;
            return acc;
          }, {});
        };
        
        const fetchRoomTypes = async (hotelId) => {
            const { data } = await api.get(`/admin/room-types/by-hotel/${hotelId}`);
            return data;
        };
        
        const updateOrder = (orderData) => api.put(`/orders/${orderData._id}`, orderData);
        
        const modules = {
            toolbar: [
              [{ 'header': [1, 2, 3, false] }],
              ['bold', 'italic', 'underline', 'strike'],
              [{ 'color': [] }, { 'background': [] }],
              [{ 'align': [] }],
              [{ 'direction': 'rtl' }],
              [{ 'list': 'ordered'}, { 'list': 'bullet' }],
              ['clean']
            ],
        };
        const formats = [
            'header', 'bold', 'italic', 'underline', 'strike',
            'color', 'background', 'align', 'direction',
            'list', 'bullet'
        ];
        
        export default function EditOrderPage() {
            const { orderId } = useParams();
            const navigate = useNavigate();
            const queryClient = useQueryClient();
            const { user } = useAuthStore(); // âœ¨ ×©×œ×™×¤×ª ×”××©×ª××©
        
            const [rooms, setRooms] = useState([]);
            const [extras, setExtras] = useState([]);
            const [discountPercent, setDiscountPercent] = useState(0);
            const [numberOfNights, setNumberOfNights] = useState(1);
        
            const [orderDetails, setOrderDetails] = useState({
                customerName: '',
                customerPhone: '',
                customerEmail: '',
                eventDate: '',
                status: '×‘×”××ª× ×”',
                notes: ''
            });
        
            const [isNotesDialogOpen, setIsNotesDialogOpen] = useState(false);
            const [tempNotes, setTempNotes] = useState('');
        
            const { data: order, isLoading: isLoadingOrder, isError: isOrderError } = useQuery({
                queryKey: ['order', orderId],
                queryFn: () => fetchOrder(orderId),
                enabled: !!orderId,
            });
        
            const hotelId = order?.hotel?._id;
        
            const { data: priceLists, isLoading: isLoadingPriceLists } = useQuery({
                queryKey: ['priceListsMap', hotelId],
                queryFn: () => fetchAllPriceListsAsMap(hotelId),
                enabled: !!hotelId,
            });
        
            const { data: roomTypes = [], isLoading: isLoadingRoomTypes } = useQuery({
                queryKey: ['roomTypes', hotelId],
                queryFn: () => fetchRoomTypes(hotelId),
                enabled: !!hotelId,
            });
        
            const activePriceLists = useMemo(() => {
                if (!priceLists) return {};
                const active = {};
                Object.values(priceLists).forEach(pl => {
                    if (pl.isVisible !== false) {
                        active[pl.name] = pl;
                    }
                });
                return active;
            }, [priceLists]);
        
            useEffect(() => {
                if (order) {
                    setRooms(order.rooms || []);
                    setExtras(order.extras || []);
                    setDiscountPercent(order.discountPercent || 0);
                    setNumberOfNights(order.numberOfNights || 1);
        
                    setOrderDetails({
                        customerName: order.customerName || '',
                        customerPhone: order.customerPhone || '',
                        customerEmail: order.customerEmail || '',
                        eventDate: order.eventDate ? format(new Date(order.eventDate), 'yyyy-MM-dd') : '',
                        status: order.status || '×‘×”××ª× ×”',
                        notes: order.notes || '',
                    });
                }
            }, [order]);
        
            useEffect(() => {
                if (
                    rooms.length > 0 &&
                    priceLists &&
                    Object.keys(priceLists).length > 0 &&
                    order &&
                    numberOfNights !== order.numberOfNights
                ) {
                    const updatedRooms = rooms.map(room => {
                         const newPrice = calculateRoomTotalPrice(
                             room,
                             priceLists,
                             room.price_list_names,
                             numberOfNights,
                             room.roomSupplement
                         );
                         return { ...room, price: newPrice };
                    });
                     setRooms(updatedRooms);
                }
                // eslint-disable-next-line react-hooks/exhaustive-deps
            }, [numberOfNights, priceLists, order]);
        
            const { mutate: saveOrder, isPending: isSaving } = useMutation({
                mutationFn: updateOrder,
                onSuccess: () => {
                    toast.success('×”×”×–×× ×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!');
                    queryClient.invalidateQueries({ queryKey: ['myOrders'] });
                    queryClient.invalidateQueries({ queryKey: ['adminAllOrders'] });
                    queryClient.invalidateQueries({ queryKey: ['order', orderId] });
                    navigate(-1);
                },
                onError: (err) => toast.error(err.response?.data?.message || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×”×–×× ×”.'),
            });
        
            const totals = useMemo(() => {
                const roomsTotal = rooms.reduce((sum, room) => {
                    let price = room.price;
                    if (price === 0 && priceLists && room.price_list_names?.length > 0) {
                         price = calculateRoomTotalPrice(room, priceLists, room.price_list_names, numberOfNights, room.roomSupplement);
                    }
                    return sum + price;
                }, 0);
        
                const extrasTotal = extras.reduce((sum, ex) => sum + (ex.price * ex.quantity), 0);
                const subTotal = roomsTotal + extrasTotal;
                const discountAmount = subTotal * (discountPercent / 100);
                const afterDiscount = subTotal - discountAmount;
                const salesCommission = afterDiscount * 0.03;
        
                return { roomsTotal, extrasTotal, subTotal, discountAmount, finalTotal: afterDiscount, salesCommission };
            }, [rooms, extras, discountPercent, priceLists, numberOfNights]);
        
            const addRoom = (newRoom) => setRooms(prev => [...prev, newRoom]);
            const removeRoom = (index) => setRooms(prev => prev.filter((_, i) => i !== index));
            const updateRoom = (index, updatedRoom) => setRooms(prev => prev.map((room, i) => i === index ? updatedRoom : room));
        
            const handleDetailsChange = (e) => setOrderDetails(prev => ({ ...prev, [e.target.name]: e.target.value }));
            const handleStatusChange = (value) => setOrderDetails(prev => ({ ...prev, status: value }));
        
            const handleNightsChange = (e) => {
                const val = parseInt(e.target.value, 10);
                setNumberOfNights(val < 1 ? 1 : val);
            };
        
            const handleOpenNotesDialog = () => {
                setTempNotes(orderDetails.notes || '');
                setIsNotesDialogOpen(true);
            };
            const handleSaveNotesFromDialog = () => {
                setOrderDetails(prev => ({ ...prev, notes: tempNotes }));
                setIsNotesDialogOpen(false);
            };
        
            const handleFinishEditing = () => {
                if (!orderDetails.customerName) return toast.error('×—×•×‘×” ×œ×”×–×™×Ÿ ×©× ×œ×§×•×—.');
        
                const dataToSave = {
                  ...order,
                  ...orderDetails,
                  rooms,
                  extras,
                  discountPercent,
                  total_price: totals.finalTotal,
                  numberOfNights
                };
                saveOrder(dataToSave);
            };
        
            const handleExportToExcel = () => { /* ... */ };
        
            if (isLoadingOrder) return <div className="text-center p-10">×˜×•×¢×Ÿ ×¤×¨×˜×™ ×”×–×× ×”...</div>;
            if (isOrderError) return <div className="text-center p-10 text-red-600">×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×–×× ×”.</div>;
        
            const isLoadingSomething = isLoadingOrder || (hotelId && (isLoadingPriceLists || isLoadingRoomTypes));
        
            return (
                <div className="container mx-auto p-4 space-y-8">
                    <header className="flex flex-wrap justify-between items-center gap-4">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900">×¢×¨×™×›×ª ×”×–×× ×” #{order?.orderNumber}</h1>
                            <p className="mt-1 text-gray-600">×¢×“×›×•×Ÿ ×¤×¨×˜×™ ×œ×§×•×—, ×¡×˜×˜×•×¡, ×•×”×¨×›×‘ ×”×—×“×¨×™×.</p>
                        </div>
                        <div className="flex gap-2">
                            <Button asChild variant="outline">
                                <Link to={`/quote/${order?._id}`} target="_blank">
                                  <Eye className="ml-2 h-4 w-4" /> ×”×¦×’ ×”×¦×¢×ª ××—×™×¨
                                </Link>
                            </Button>
                            <Button variant="outline" onClick={() => navigate(-1)}>
                                <ArrowRight className="ml-2 h-4 w-4"/> ×—×–×•×¨
                            </Button>
                        </div>
                    </header>
        
                    <Card className="shadow-lg">
                        <CardHeader>
                            <CardTitle className="flex items-center gap-2">×¤×¨×˜×™ ×”×¤× ×™×™×”</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 items-end">
        
                                {/* ×©×•×¨×” 1 */}
                                <div>
                                    <Label htmlFor="customerName" className="mb-1">×©× ×”×œ×§×•×—</Label>
                                    <div className="relative">
                                        <User className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                                        <Input id="customerName" name="customerName" value={orderDetails.customerName} onChange={handleDetailsChange} required className="pl-10" />
                                    </div>
                                </div>
        
                                <div>
                                    <Label htmlFor="customerPhone" className="mb-1">×˜×œ×¤×•×Ÿ</Label>
                                    <div className="relative">
                                        <Phone className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                                        <Input id="customerPhone" name="customerPhone" value={orderDetails.customerPhone} onChange={handleDetailsChange} className="pl-10" />
                                    </div>
                                </div>
        
                                <div>
                                    <Label htmlFor="customerEmail" className="mb-1">××™××™×™×œ</Label>
                                    <div className="relative">
                                        <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                                        <Input id="customerEmail" name="customerEmail" type="email" value={orderDetails.customerEmail} onChange={handleDetailsChange} className="pl-10" />
                                    </div>
                                </div>
        
                                <div>
                                    <Label htmlFor="eventDate" className="mb-1">×ª××¨×™×š ××™×¨×•×¢/×”×’×¢×”</Label>
                                    <div className="relative">
                                        <Calendar className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none" />
                                        <Input id="eventDate" name="eventDate" type="date" value={orderDetails.eventDate} onChange={handleDetailsChange} className="pl-10" />
                                    </div>
                                </div>
        
                                {/* ×©×•×¨×” 2 */}
                                <div>
                                    <Label htmlFor="status" className="mb-1">×¡×˜×˜×•×¡</Label>
                                    <Select value={orderDetails.status} onValueChange={handleStatusChange}>
                                        <SelectTrigger id="status">
                                            <div className="flex items-center gap-2">
                                                <Activity className="h-4 w-4 text-gray-400" />
                                                <SelectValue />
                                            </div>
                                        </SelectTrigger>
                                        <SelectContent>
                                            <SelectItem value="×‘×”××ª× ×”">×‘×”××ª× ×”</SelectItem>
                                            <SelectItem value="×‘×•×¦×¢">×‘×•×¦×¢</SelectItem>
                                            <SelectItem value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</SelectItem>
                                        </SelectContent>
                                    </Select>
                                </div>
        
                                <div className="lg:col-span-3">
                                    <Label htmlFor="notes" className="mb-1 block">×”×¢×¨×•×ª ×œ×”×–×× ×”</Label>
                                    <div
                                        className="relative min-h-[42px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background cursor-pointer hover:bg-slate-50 transition-colors flex items-center"
                                        onClick={handleOpenNotesDialog}
                                        title="×œ×—×¥ ×œ×¤×ª×™×—×ª ×¢×•×¨×š ×”×¢×¨×•×ª ××œ×"
                                    >
                                        <StickyNote className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                                        <div className="pl-8 w-full overflow-hidden text-ellipsis whitespace-nowrap text-slate-600" dir="auto">
                                            {orderDetails.notes ? (
                                                <span dangerouslySetInnerHTML={{ __html: orderDetails.notes.replace(/<[^>]+>/g, ' ').substring(0, 100) + (orderDetails.notes.length > 100 ? '...' : '') }}></span>
                                            ) : (
                                                <span className="text-muted-foreground">×”×¢×¨×•×ª ×›×œ×œ×™×•×ª... (×œ×—×¥ ×œ×¢×¨×™×›×”)</span>
                                            )}
                                        </div>
                                        <Maximize2 className="absolute bottom-2 left-2 h-3 w-3 text-blue-400 opacity-70" />
                                    </div>
                                </div>
        
                            </div>
                        </CardContent>
                    </Card>
        
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
        
                        <div className="lg:col-span-1 space-y-8">
                            <Card>
                                <CardHeader><CardTitle className="flex items-center gap-2"><Hotel size={22}/> ××œ×•×Ÿ</CardTitle></CardHeader>
                                <CardContent>
                                    <p className="text-lg font-semibold p-2 bg-slate-100 rounded-md text-center">{order?.hotel?.name || '×œ× ×–××™×Ÿ'}</p>
                                </CardContent>
                            </Card>
        
                            {/* ×”×•×¡×¤×ª ×—×“×¨ */}
                            <Card className="shadow-lg">
                                <CardHeader><CardTitle className="flex items-center gap-2"><FilePlus2 size={22} /> ×”×•×¡×¤×ª ×—×“×¨</CardTitle></CardHeader>
                                <CardContent>
                                    <AddRoomForm
                                        priceLists={activePriceLists || {}}
                                        roomTypes={roomTypes || []}
                                        numberOfNights={numberOfNights}
                                        onNightsChange={handleNightsChange}
                                        onAddRoom={addRoom}
                                        disabled={!hotelId || isLoadingSomething}
                                        isLoading={isLoadingSomething}
                                    />
                                </CardContent>
                            </Card>
        
                            {/* × ×™×”×•×œ ×ª×•×¡×¤×•×ª */}
                            <Card className="shadow-lg">
                                <CardHeader><CardTitle className="flex items-center gap-2"><Tag size={22}/> ×ª×•×¡×¤×•×ª ×œ×”×–×× ×”</CardTitle></CardHeader>
                                <CardContent>
                                    <OrderExtrasForm extras={extras} onChange={setExtras} />
                                </CardContent>
                            </Card>
                        </div>
        
                        {/* ×˜×‘×œ×” ×•×¡×™×›×•× */}
                        <Card className="lg:col-span-2 shadow-lg">
                            <CardHeader>
                                <CardTitle>×¡×™×›×•× ×”×–×× ×”</CardTitle>
                                <CardDescription>{rooms.length > 0 ? `×¡×”"×› ${rooms.length} ×—×“×¨×™× ×•-${extras.length} ×ª×•×¡×¤×•×ª.` : '×”×˜×‘×œ×” ×ª×ª×¢×“×›×Ÿ ×œ××—×¨ ×”×•×¡×¤×ª ×¤×¨×™×˜×™×.'}</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <OrderSummaryTable
                                    rooms={rooms}
                                    priceLists={priceLists || {}}
                                    onRemoveRoom={removeRoom}
                                    onUpdateRoom={updateRoom}
                                    roomTypes={roomTypes || []}
                                    numberOfNights={numberOfNights}
                                />
        
                                <div className="mt-8 bg-slate-50 p-6 rounded-lg border border-slate-100 space-y-3">
                                    <div className="flex justify-between text-sm text-gray-600">
                                        <span>×¡×”"×› ×—×“×¨×™×:</span>
                                        <span>{totals.roomsTotal.toLocaleString()} â‚ª</span>
                                    </div>
        
                                    {totals.extrasTotal > 0 && (
                                        <div className="flex justify-between text-sm text-blue-700 font-medium">
                                            <span>×ª×•×¡×¤×•×ª (××•×œ×/×¦×™×•×“):</span>
                                            <span>+ {totals.extrasTotal.toLocaleString()} â‚ª</span>
                                        </div>
                                    )}
        
                                    <div className="flex justify-between items-center py-2 border-t border-dashed border-gray-300">
                                        <span className="font-medium text-gray-700">×”× ×—×” (%):</span>
                                        <div className="flex items-center gap-2">
                                            <Input
                                                type="number"
                                                min="0"
                                                max="100"
                                                className="w-16 h-8 text-center bg-white border-slate-300"
                                                value={discountPercent}
                                                onChange={(e) => setDiscountPercent(Number(e.target.value))}
                                            />
                                            <span className="text-red-600 text-sm w-24 text-left font-medium">
                                                - {totals.discountAmount.toLocaleString()} â‚ª
                                            </span>
                                        </div>
                                    </div>
        
                                    <div className="flex justify-between text-2xl font-bold text-slate-900 pt-2 border-t border-gray-300">
                                        <span>×¡×”"×› ×œ×ª×©×œ×•×:</span>
                                        <span>{totals.finalTotal.toLocaleString()} â‚ª</span>
                                    </div>
                                </div>
        
                            </CardContent>
        
                            <CardFooter className="flex flex-col items-end gap-4 bg-slate-50 p-6 rounded-b-xl">
                                {/* âœ¨ ×‘×“×™×§×ª ×”×¨×©××•×ª ×œ×”×¦×’×ª ×¢××œ×•×ª */}
                                {(user?.role === 'admin' || user?.canViewCommissions) && (
                                    <div className="w-full max-w-sm text-right">
                                        <div className="flex justify-between text-sm text-green-600 font-medium">
                                            <span className="flex items-center gap-1.5"><BadgePercent size={16}/> ×¢××œ×ª×š (3%):</span>
                                            <span>+ {totals.salesCommission.toLocaleString('he-IL', { style: 'currency', currency: 'ILS' })}</span>
                                        </div>
                                    </div>
                                )}
        
                                <div className="flex justify-start gap-4 w-full mt-4">
                                    <Button variant="outline" onClick={handleExportToExcel}><FileDown className="ml-2" /> ×©××•×¨ ×œ××§×¡×œ</Button>
                                    <Button onClick={handleFinishEditing} disabled={isSaving}><Save className="ml-2" />{isSaving ? '×©×•××¨ ×©×™× ×•×™×™×...' : '×©××•×¨ ×©×™× ×•×™×™×'}</Button>
                                </div>
                            </CardFooter>
                        </Card>
                    </div>
        
                    <Dialog open={isNotesDialogOpen} onOpenChange={setIsNotesDialogOpen}>
                        <DialogContent className="max-w-3xl max-h-[90vh] flex flex-col overflow-hidden">
                            <DialogHeader>
                                <DialogTitle>×¢×¨×™×›×ª ×”×¢×¨×•×ª ×œ×”×–×× ×”</DialogTitle>
                                <DialogDescription>×”×•×¡×£ ×”×¢×¨×•×ª ××¤×•×¨×˜×•×ª, ×”×“×’×©×•×ª ×•×¦×‘×¢×™×.</DialogDescription>
                            </DialogHeader>
        
                            <div className="flex-1 overflow-y-auto py-2" dir="rtl">
                                <ReactQuill
                                    theme="snow"
                                    value={tempNotes}
                                    onChange={setTempNotes}
                                    modules={modules}
                                    formats={formats}
                                    className="h-64 mb-12"
                                    placeholder="×”×§×œ×“ ×›××Ÿ ××ª ×”×”×¢×¨×•×ª..."
                                />
                            </div>
        
                            <DialogFooter className="mt-4">
                                <Button variant="outline" onClick={() => setIsNotesDialogOpen(false)}>×‘×™×˜×•×œ</Button>
                                <Button onClick={handleSaveNotesFromDialog}>×©××•×¨ ×”×¢×¨×•×ª</Button>
                            </DialogFooter>
                        </DialogContent>
                    </Dialog>
        
                </div>
            );
        }
      ğŸ“„ ExcelImportPage.jsx
        import React, { useState, useEffect, useRef } from 'react';
        import api from '@/utils/api.js';
        import * as XLSX from 'xlsx';
        
        // --- ×™×™×‘×•× ×¨×›×™×‘×™ UI ××”×¡×¤×¨×™×™×” ×©×œ×š ---
        import { Button } from "@/components/ui/Button.jsx";import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/Card";
        import { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/Dialog";
        import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
        import { Input } from "@/components/ui/Input";
        import { UploadCloud, FileText, Settings, CheckCircle, AlertTriangle } from 'lucide-react';
        
        // --- ×”×’×“×¨×•×ª ×§×‘×•×¢×•×ª ---
        const CREATE_NEW_CATEGORY_VALUE = "CREATE_NEW";
        
        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×¢×™×‘×•×“ ××§×¡×œ ---
        function cleanFile(data, type) {
          if (type === 'cal') {
            if (data.length < 5) throw new Error("×”×§×•×‘×¥ × ×¨××” ×§×¦×¨ ××“×™ ×¢×‘×•×¨ ×¤×•×¨××˜ '×›××œ'.");
            const trimmed = data.slice(1, -3);
            return trimmed.map(row => ({
              "×ª××¨×™×š ×¢×¡×§×”": row[0],
              "×©× ×‘×™×ª ×”×¢×¡×§": String(row[1] || '').trim(),
              "×¡×›×•×": row[2],
            }));
          }
          if (type === 'max') {
            if (data.length < 7) throw new Error("×”×§×•×‘×¥ × ×¨××” ×§×¦×¨ ××“×™ ×¢×‘×•×¨ ×¤×•×¨××˜ '××§×¡'.");
            const trimmed = data.slice(3, -3);
            if (trimmed.length < 1) throw new Error("×œ× × ××¦××• × ×ª×•× ×™× ×‘×§×•×‘×¥ ×œ××—×¨ ×”× ×™×§×•×™.");
            const headers = trimmed[0].map(h => String(h || '').trim().replace(/\s+/g, ' '));
            const rows = trimmed.slice(1);
        
            if (!headers.includes('×©× ×‘×™×ª ×”×¢×¡×§') || !headers.includes('×ª××¨×™×š ×¢×¡×§×”') || !headers.includes('×¡×›×•× ×¢×¡×§×” ××§×•×¨×™')) {
                throw new Error('×”×¢××•×“×•×ª ×”× ×“×¨×©×•×ª ×œ× × ××¦××• ×‘×§×•×‘×¥ "××§×¡".');
            }
        
            return rows.map(rowArray => {
              let rowObject = {};
              headers.forEach((header, index) => { rowObject[header] = rowArray[index]; });
              return rowObject;
            });
          }
          throw new Error('×¡×•×’ ×™×™×‘×•× ×œ× ×™×“×•×¢.');
        }
        
        // --- ×¨×›×™×‘ ×”×“×£ ×”×¨××©×™ ---
        export default function ExcelImportPage() {
          const [stage, setStage] = useState('select');
          const [importerType, setImporterType] = useState('');
          const [parsedData, setParsedData] = useState([]);
          const [unseenMerchants, setUnseenMerchants] = useState([]);
          const [mappings, setMappings] = useState({});
          const [categories, setCategories] = useState([]);
          const [message, setMessage] = useState('');
          const [isCategoryDialogOpen, setIsCategoryDialogOpen] = useState(false);
          const [newCategoryName, setNewCategoryName] = useState('');
          const [currentMerchantForNewCategory, setCurrentMerchantForNewCategory] = useState(null);
          const fileInputRef = useRef(null);
        
          const fetchCategories = () => {
            return api.get('/categories')
              .then(res => setCategories(res.data))
              .catch(err => console.error("Could not fetch categories", err));
          };
        
          useEffect(() => {
            fetchCategories();
          }, []);
        
          const handleImportButtonClick = (type) => {
            setImporterType(type);
            fileInputRef.current.click();
          };
        
          const handleFileSelected = (event) => {
            const file = event.target.files[0];
            if (file) {
              analyzeFile(file, importerType);
            }
            event.target.value = null;
          };
        
          const analyzeFile = (file, type) => {
            setStage('processing');
            setMessage('×§×•×¨× ×•×× ×ª×— ××ª ×§×•×‘×¥ ×”××§×¡×œ...');
            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rawData = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });
                const cleanedData = cleanFile(rawData, type);
                setParsedData(cleanedData);
                const merchantNames = [...new Set(cleanedData.map(row => row['×©× ×‘×™×ª ×”×¢×¡×§']).filter(Boolean))];
                const { data: response } = await api.post('/import/check-merchants', { merchantNames });
                if (response.unseenMerchants && response.unseenMerchants.length > 0) {
                  setUnseenMerchants(response.unseenMerchants);
                  const initialMappings = {};
                  response.unseenMerchants.forEach(name => {
                    initialMappings[name] = { newName: name, category: '' };
                  });
                  setMappings(initialMappings);
                  setStage('map');
                } else {
                  processData([], cleanedData);
                }
              } catch (error) {
                setMessage(error.message || '×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥.');
                setStage('result');
              }
            };
            reader.readAsArrayBuffer(file);
          };
        
          const handleMappingChange = (originalName, field, value) => {
            if (field === 'category' && value === CREATE_NEW_CATEGORY_VALUE) {
                setCurrentMerchantForNewCategory(originalName);
                setIsCategoryDialogOpen(true);
            } else {
                setMappings(prev => ({ ...prev, [originalName]: { ...prev[originalName], [field]: value } }));
            }
          };
        
          const handleSaveNewCategory = async () => {
            if (!newCategoryName.trim()) return;
            try {
              const { data: newCategory } = await api.post('/categories', { name: newCategoryName.trim(), type: '×”×•×¦××”' });
              // Real-time update
              setCategories(prev => [...prev, newCategory].sort((a, b) => a.name.localeCompare(b.name)));
              if (currentMerchantForNewCategory) {
                  handleMappingChange(currentMerchantForNewCategory, 'category', newCategory._id);
              }
              setIsCategoryDialogOpen(false);
              setNewCategoryName('');
              setCurrentMerchantForNewCategory(null);
            } catch (err) {
              alert(`×©×’×™××” ×‘×™×¦×™×¨×ª ×§×˜×’×•×¨×™×”: ${err.response?.data?.message || err.message}`);
            }
          };
        
          const processData = async (mappingsToSave, dataToProcess) => {
            setStage('processing');
            setMessage('××¢×‘×“ ×¢×¡×§××•×ª ×•×©×•×œ×— ×œ×©×¨×ª...');
            try {
              const allMapsRes = await api.get('/management');
              const allMaps = allMapsRes.data.merchantMaps || [];
        
              const finalMap = [...allMaps, ...mappingsToSave];
              const mappingDict = Object.fromEntries(finalMap.map(m => [m.originalName, { newName: m.newName, category: m.category?.name }]));
        
              const transactions = dataToProcess.map(row => {
                const originalName = row['×©× ×‘×™×ª ×”×¢×¡×§'];
                const amount = row['×¡×›×•×'] || row['×¡×›×•× ×¢×¡×§×” ××§×•×¨×™'];
                const date = row['×ª××¨×™×š ×¢×¡×§×”'];
                const mapping = mappingDict[originalName] || {};
        
                return {
                    date: date,
                    description: mapping.newName || originalName,
                    amount: Math.abs(Number(amount)) || 0,
                    type: '×”×•×¦××”',
                    category: mapping.category || '×œ×œ× ×§×˜×’×•×¨×™×”',
                    account: 'checking',
                };
              });
        
              const { data: response } = await api.post('/import/process-transactions', { transactions, newMappings: mappingsToSave });
              setMessage(response.message);
              setStage('result');
            } catch (error) {
              setMessage(error.response?.data?.message || '×©×’×™××” ×‘×¢×™×‘×•×“ ×”×§×•×‘×¥.');
              setStage('result');
            }
          };
        
          const handleProcessClick = async (forceProcessAll = false) => {
            let finalMappings = [];
        
            for (const originalName of unseenMerchants) {
              const mapping = mappings[originalName];
              let categoryId = mapping.category;
        
              if (categoryId === CREATE_NEW_CATEGORY_VALUE) {
                // This case is handled by the Dialog now, so this part of logic might not be directly triggered
                // but is kept for safety.
                alert('×™×© ×œ×™×¦×•×¨ ×§×˜×’×•×¨×™×” ×—×“×©×” ×“×¨×š ×”×—×œ×•×Ÿ ×©× ×¤×ª×—.');
                return;
              }
        
              if (categoryId) {
                finalMappings.push({ originalName, newName: mapping.newName.trim() || originalName, category: categoryId });
              } else if (!forceProcessAll) {
                alert(`× × ×œ×‘×—×•×¨ ×§×˜×’×•×¨×™×” ×¢×‘×•×¨ "${originalName}"`);
                return;
              } else {
                // Add a mapping without a category if forcing all
                finalMappings.push({ originalName, newName: mapping.newName.trim() || originalName, category: null });
              }
            }
        
            processData(finalMappings, parsedData);
          };
        
          const resetProcess = () => {
            setStage('select');
            setMessage('');
            setParsedData([]);
            setUnseenMerchants([]);
          };
        
          return (
            <div className="container mx-auto p-4 md:p-8">
              <Card className="max-w-4xl mx-auto shadow-lg">
                <CardHeader className="text-center">
                  <CardTitle className="text-3xl font-bold">××©×£ ×™×™×‘×•× ×¢×¡×§××•×ª</CardTitle>
                  <CardDescription className="text-lg text-slate-600 mt-2">×™×™×‘× ×“×¤×™ ×—×©×‘×•×Ÿ ×‘×§×œ×•×ª ×•×‘××”×™×¨×•×ª</CardDescription>
                </CardHeader>
                <CardContent className="min-h-[400px] flex items-center justify-center">
                  {stage === 'select' && (
                    <div className="text-center p-8 space-y-6">
                      <UploadCloud className="mx-auto h-16 w-16 text-slate-300" />
                      <h3 className="text-xl font-semibold">×”×ª×—×œ ×™×™×‘×•× ×—×“×©</h3>
                      <p className="text-slate-500">×‘×—×¨ ××ª ×¡×•×’ ×”×“×•×— ×©×‘×¨×¦×•× ×š ×œ×™×™×‘× ×›×“×™ ×œ×”×ª×—×™×œ.</p>
                      <div className="flex justify-center gap-4 pt-4">
                        <Button size="lg" onClick={() => handleImportButtonClick('max')}>×™×™×‘×•× ××“×•×— "××§×¡"</Button>
                        <Button size="lg" onClick={() => handleImportButtonClick('cal')}>×™×™×‘×•× ××“×•×— "×›××œ"</Button>
                      </div>
                      <input type="file" ref={fileInputRef} onChange={handleFileSelected} accept=".xlsx, .xls" className="hidden" />
                    </div>
                  )}
        
                  {stage === 'map' && (
                    <div className="w-full">
                      <div className="text-center mb-6">
                        <Settings className="mx-auto h-12 w-12 text-slate-300" />
                        <h3 className="text-xl font-semibold mt-4">××™×¤×•×™ ×¡×¤×§×™× ×—×“×©×™×</h3>
                        <p className="text-slate-500">× ××¦××• {unseenMerchants.length} ×¡×¤×§×™× ×—×“×©×™×. ×”×’×“×¨ ×¢×‘×•×¨× ×©× × ×§×™ ×•×§×˜×’×•×¨×™×”.</p>
                      </div>
                      <div className="space-y-3 max-h-[40vh] overflow-y-auto pr-2 border-t border-b py-4">
                        {unseenMerchants.map(name => (
                          <div key={name} className="grid grid-cols-1 md:grid-cols-3 gap-4 items-center p-2 rounded-md hover:bg-slate-50">
                            <span className="truncate font-medium" title={name}>{name}</span>
                            <Input placeholder="×©× × ×§×™ (××•×¤×¦×™×•× ×œ×™)" value={mappings[name]?.newName || ''} onChange={(e) => handleMappingChange(name, 'newName', e.target.value)} />
                            <div className="flex gap-2">
                              <Select value={mappings[name]?.category || ''} onValueChange={(v) => handleMappingChange(name, 'category', v)}>
                                <SelectTrigger><SelectValue placeholder="×‘×—×¨ ×§×˜×’×•×¨×™×”" /></SelectTrigger>
                                <SelectContent>
                                  {categories.map(cat => <SelectItem key={cat._id} value={cat._id}>{cat.name}</SelectItem>)}
                                  <SelectItem value={CREATE_NEW_CATEGORY_VALUE}>--- ×¦×•×¨ ×§×˜×’×•×¨×™×” ×—×“×©×” ---</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>
                        ))}
                      </div>
                      <div className="flex justify-end gap-4 pt-6">
                         <Button type="button" variant="ghost" onClick={() => handleProcessClick(true)}>×™×™×‘× ×”×›×œ (×•×©×™×™×š ×××•×—×¨ ×™×•×ª×¨)</Button>
                         <Button type="button" onClick={() => handleProcessClick(false)}>×¡×™×™× ×•×™×™×‘×</Button>
                      </div>
                    </div>
                  )}
        
                  {(stage === 'processing' || stage === 'result') && (
                    <div className="text-center p-8 space-y-4">
                       {stage === 'processing' ? <FileText className="mx-auto h-16 w-16 text-slate-300 animate-pulse" /> : message.includes('×©×’×™××”') ? <AlertTriangle className="mx-auto h-16 w-16 text-red-400" /> : <CheckCircle className="mx-auto h-16 w-16 text-green-400" />}
                       <h2 className="text-2xl font-bold">{stage === 'processing' ? '×‘×ª×”×œ×™×š...' : '×ª×”×œ×™×š ×”×™×™×‘×•× ×”×¡×ª×™×™×'}</h2>
                       <p className={message.includes('×©×’×™××”') ? 'text-red-600' : 'text-green-600'}>{message}</p>
                       {stage === 'result' && <Button onClick={resetProcess} className="mt-6">×”×ª×—×œ ×™×™×‘×•× ×—×“×©</Button>}
                    </div>
                  )}
                </CardContent>
              </Card>
        
              <Dialog open={isCategoryDialogOpen} onOpenChange={setIsCategoryDialogOpen}>
                <DialogContent>
                  <DialogHeader><DialogTitle>×”×•×¡×¤×ª ×§×˜×’×•×¨×™×” ×—×“×©×”</DialogTitle></DialogHeader>
                  <div className="py-4"><Input placeholder="×©× ×”×§×˜×’×•×¨×™×”..." value={newCategoryName} onChange={(e) => setNewCategoryName(e.target.value)} /></div>
                  <DialogFooter>
                    <Button type="button" variant="ghost" onClick={() => setIsCategoryDialogOpen(false)}>×‘×™×˜×•×œ</Button>
                    <Button type="button" onClick={handleSaveNewCategory}>×©××•×¨ ×§×˜×’×•×¨×™×”</Button>
                  </DialogFooter>
                </DialogContent>
              </Dialog>
            </div>
          );
        }
      ğŸ“„ HomePage.jsx
        // client/src/pages/HomePage.jsx
        
        import { Link } from 'react-router-dom';
        import { useQuery } from '@tanstack/react-query';
        import { motion, AnimatePresence } from 'framer-motion';
        import { Button } from '@/components/ui/Button.jsx';
        import { Card, CardHeader, CardTitle, CardContent, CardDescription } from '@/components/ui/Card.jsx';
        import api from '@/utils/api.js';
        import { Megaphone, CalendarClock } from 'lucide-react';
        import { format } from 'date-fns';
        import { useAuthStore } from '@/stores/authStore.js'; // âœ¨ 1. ×™×™×‘×•× ×”-Store
        
        // ×—×™×©×•×‘ ×›×ª×•×‘×ª ×”×©×¨×ª ×œ×˜×•×‘×ª ×”×œ×•×’×•
        const API_BASE = import.meta.env.VITE_API_BASE_URL || 'http://localhost:4000';
        const SERVER_ROOT = API_BASE.replace(/\/api$/, '');
        const LOGO_URL = `${SERVER_ROOT}/uploads/company-logo.png?t=${Date.now()}`;
        
        // ×”×’×“×¨×ª ×¦×‘×¢×™ ×”××™×ª×•×’ ×”×—×“×©×™×
        const BRAND_COLOR = '#bfa15f';
        const BRAND_COLOR_HOVER = '#a28e4d'; // ×’×•×•×Ÿ ××¢×˜ ×›×”×” ×™×•×ª×¨ ×œ-Hover
        
        const fetchMyAnnouncements = async () => {
          try {
            const { data } = await api.get('/announcements');
            return data;
          } catch (error) {
            console.error("Failed to fetch announcements", error);
            return [];
          }
        };
        
        export default function HomePage() {
          // âœ¨ 2. ×‘×“×™×§×” ×”×× ×”××©×ª××© ××—×•×‘×¨
          const { isAuthenticated } = useAuthStore();
        
          const { data: announcements = [], isLoading } = useQuery({
            queryKey: ['myAnnouncements'],
            queryFn: fetchMyAnnouncements,
            staleTime: 1000 * 60 * 5, // ×œ×¨×¢× ×Ÿ ×›×œ 5 ×“×§×•×ª
            enabled: isAuthenticated // âœ¨ 3. ×©×•×œ×£ × ×ª×•× ×™× ×¨×§ ×× ×”××©×ª××© ××—×•×‘×¨
          });
        
          return (
            <main className="min-h-[calc(100vh-4rem)] flex flex-col justify-center items-center px-6 text-center py-10 bg-slate-50/50">
        
              {/* --- ×œ×•×’×• ×”×—×‘×¨×” --- */}
              <motion.div
                initial={{ opacity: 0, scale: 0.8 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ duration: 0.6 }}
                className="mb-6"
              >
                <img
                    src={LOGO_URL}
                    alt="Company Logo"
                    className="h-32 md:h-40 object-contain mx-auto drop-shadow-md"
                    onError={(e) => e.target.style.display = 'none'}
                    crossOrigin="anonymous"
                />
              </motion.div>
        
              {/* --- ×›×•×ª×¨×ª --- */}
              <motion.h1
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.2, duration: 0.7 }}
                className="text-4xl sm:text-5xl font-extrabold mb-6 leading-tight text-gray-900"
              >
                ×¨×©×ª ××œ×•× ×•×ª ×¦×¤×•×¨×™ ×§×œ××¡
                <br />
                <span style={{ color: BRAND_COLOR }}>× ×™×”×•×œ ×•××¢×§×‘ ××—×¨×™ ×œ×™×“×™× ×•×¤× ×™×•×ª</span>
              </motion.h1>
        
              {/* --- ××–×•×¨ ×”×”×•×“×¢×•×ª (××•×¦×’ ×¨×§ ×œ××—×•×‘×¨×™×) --- */}
              {isAuthenticated && (
                  <div className="w-full max-w-2xl mb-10">
                    <AnimatePresence>
                      {!isLoading && announcements.length > 0 && (
                        <motion.div
                          initial={{ opacity: 0, height: 0 }}
                          animate={{ opacity: 1, height: 'auto' }}
                          className="space-y-4 text-left"
                        >
                          {announcements.map((msg, idx) => (
                              <motion.div
                                  key={msg._id}
                                  initial={{ opacity: 0, x: -20 }}
                                  animate={{ opacity: 1, x: 0 }}
                                  transition={{ delay: 0.3 + (idx * 0.1) }}
                              >
                                  <Card
                                    className="bg-white shadow-sm hover:shadow-md transition-all border-l-4"
                                    style={{ borderLeftColor: BRAND_COLOR }}
                                  >
                                      <CardHeader className="pb-2">
                                          <div className="flex justify-between items-start">
                                              <CardTitle className="text-lg flex items-center gap-2 text-slate-800">
                                                  <Megaphone className="h-5 w-5" style={{ color: BRAND_COLOR }} />
                                                  {msg.title}
                                              </CardTitle>
                                              <span className="text-xs text-gray-400 flex items-center gap-1 bg-slate-100 px-2 py-1 rounded-full">
                                                  <CalendarClock size={12} />
                                                  {format(new Date(msg.createdAt), 'dd/MM/yyyy')}
                                              </span>
                                          </div>
                                          <CardDescription className="text-xs mt-1">×××ª: {msg.authorName}</CardDescription>
                                      </CardHeader>
                                      <CardContent>
                                          <div
                                             className="text-slate-600 text-sm leading-relaxed prose prose-sm max-w-none"
                                             dangerouslySetInnerHTML={{ __html: msg.content }}
                                         />
                                      </CardContent>
                                  </Card>
                              </motion.div>
                          ))}
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>
              )}
        
              {/* --- ×˜×§×¡×˜ ×•×›×¤×ª×•×¨ --- */}
              <motion.p
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.4, duration: 0.6 }}
                className="text-lg sm:text-xl text-gray-600 max-w-2xl mb-10"
              >
                ×›×œ ×”×›×œ×™× ×œ× ×™×”×•×œ ×”×¦×¢×•×ª ××—×™×¨, ××¢×§×‘ ××—×¨ ×”×–×× ×•×ª ×•×—×™×©×•×‘ ×¢××œ×•×ª ×‘××§×•× ××—×“.
                <br />
                ×¤×©×•×˜, ××”×™×¨ ×•×™×¢×™×œ.
              </motion.p>
        
              <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ delay: 0.5, duration: 0.5 }}
              >
                <Button
                    asChild
                    size="lg"
                    className="text-white shadow-lg transition-colors"
                    style={{
                        backgroundColor: BRAND_COLOR,
                        boxShadow: `0 10px 15px -3px ${BRAND_COLOR}66`
                    }}
                    onMouseEnter={(e) => e.target.style.backgroundColor = BRAND_COLOR_HOVER}
                    onMouseLeave={(e) => e.target.style.backgroundColor = BRAND_COLOR}
                >
                  <Link to="/new-order">×¦×•×¨ ×”×–×× ×” ×—×“×©×”</Link>
                </Button>
              </motion.div>
            </main>
          );
        }
      ğŸ“„ LeadsPage.jsx
        // client/src/pages/LeadsPage.jsx
        
        import React, { useState } from 'react';
        import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
        import api from '@/utils/api.js';
        import toast from 'react-hot-toast';
        import { format } from 'date-fns';
        import { useAuthStore } from '@/stores/authStore.js';
        
        // UI Components
        import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "@/components/ui/Dialog.jsx";
        import { Button } from '@/components/ui/Button.jsx';
        import { Input } from "@/components/ui/Input.jsx";
        import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
        import { LoaderCircle, Trash2, Phone, User, Calendar, MapPin, StickyNote } from 'lucide-react';
        
        // ×¦×‘×¢×™×
        const GOLD_COLOR = '#bfa15f';
        const BLUE_COLOR = '#3b82f6'; // ×›×—×•×œ ×‘×•×œ×˜ ×œ×œ×™×“×™× ×—×“×©×™×
        
        // --- API Functions ---
        const fetchLeads = async () => {
          const { data } = await api.get('/leads');
          return data;
        };
        
        const updateLeadStatusApi = async ({ leadId, status, rejectionReason }) => {
          const { data } = await api.patch(`/leads/${leadId}/status`, { status, rejectionReason });
          return data;
        };
        
        const deleteLeadApi = async (leadId) => {
            await api.delete(`/leads/${leadId}`);
        };
        
        export default function LeadsPage() {
          const queryClient = useQueryClient();
          const { user } = useAuthStore();
        
          const [selectedLead, setSelectedLead] = useState(null);
          const [noteToView, setNoteToView] = useState(null);
          const [rejectionDialogLeadId, setRejectionDialogLeadId] = useState(null);
          const [rejectionReason, setRejectionReason] = useState('');
        
          const { data: leads, isLoading, isError, error } = useQuery({
            queryKey: ['leads'],
            queryFn: fetchLeads,
            refetchInterval: 15000
          });
        
          const updateStatusMutation = useMutation({
            mutationFn: updateLeadStatusApi,
            onSuccess: () => {
              queryClient.invalidateQueries({ queryKey: ['leads'] });
              toast.success('×¡×˜×˜×•×¡ ×¢×•×“×›×Ÿ');
              setRejectionDialogLeadId(null);
              setRejectionReason('');
            },
            onError: () => toast.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ'),
          });
        
          const deleteMutation = useMutation({
            mutationFn: deleteLeadApi,
            onSuccess: () => {
                toast.success('× ××—×§ ×‘×”×¦×œ×—×”');
                queryClient.invalidateQueries({ queryKey: ['leads'] });
            },
            onError: () => toast.error('×©×’×™××” ×‘××—×™×§×”'),
          });
        
          const handleStatusChange = (leadId, newStatus) => {
              if (newStatus === 'not_relevant') {
                  setRejectionDialogLeadId(leadId);
              } else {
                  updateStatusMutation.mutate({ leadId, status: newStatus });
              }
          };
        
          const submitRejection = () => {
              if (!rejectionReason.trim()) return toast.error('×—×•×‘×” ×œ×›×ª×•×‘ ×¡×™×‘×”');
              updateStatusMutation.mutate({
                  leadId: rejectionDialogLeadId,
                  status: 'not_relevant',
                  rejectionReason
              });
          };
        
          const handleDelete = (leadId) => {
            if (window.confirm("×œ××—×•×§ ××ª ×”×¤× ×™×™×”?")) {
                deleteMutation.mutate(leadId);
            }
          };
        
          return (
            <div className="container mx-auto p-4 space-y-6">
              <header>
                <h1 className="text-3xl font-bold text-gray-900">× ×™×”×•×œ ×¤× ×™×•×ª</h1>
              </header>
        
              <div>
                {isLoading && <div className="text-center py-20"><LoaderCircle className="animate-spin h-10 w-10 mx-auto text-gray-400"/></div>}
                {isError && <div className="text-center text-red-500 py-10">{error.message}</div>}
        
                {!isLoading && leads && (
                    <div className="space-y-2" dir="rtl">
                        {leads.map(lead => (
                          <LeadStrip
                            key={lead._id}
                            lead={lead}
                            onStatusChange={handleStatusChange}
                            onViewRaw={() => setSelectedLead(lead)}
                            onViewNote={() => setNoteToView(lead)}
                            onDelete={user?.role === 'admin' ? handleDelete : undefined}
                          />
                        ))}
                        {leads.length === 0 && (
                            <p className="text-center text-gray-500 py-10 border-dashed border rounded bg-gray-50">××™×Ÿ ×¤× ×™×•×ª ×—×“×©×•×ª.</p>
                        )}
                    </div>
                )}
              </div>
        
              {/* ×“×™××œ×•×’ ×“×—×™×™×” */}
              <Dialog open={!!rejectionDialogLeadId} onOpenChange={(o) => !o && setRejectionDialogLeadId(null)}>
                  <DialogContent>
                      <DialogHeader>
                          <DialogTitle>×¡×™×‘×ª ×‘×™×˜×•×œ</DialogTitle>
                          <DialogDescription>××“×•×¢ ×”×¤× ×™×™×” ×œ× ×¨×œ×•×•× ×˜×™×ª?</DialogDescription>
                      </DialogHeader>
                      <div className="py-4 space-y-3">
                          <Input
                            placeholder="×”×§×œ×“ ×¡×™×‘×”..."
                            value={rejectionReason}
                            onChange={(e) => setRejectionReason(e.target.value)}
                            autoFocus
                          />
                          <div className="flex flex-wrap gap-2">
                              {['×™×§×¨ ××“×™', '×ª××¨×™×š ×ª×¤×•×¡', '×œ× ×¢×•× ×”', '×¨×¦×” ××©×”×• ××—×¨'].map(r => (
                                  <span
                                    key={r}
                                    className="cursor-pointer bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-xs border"
                                    onClick={() => setRejectionReason(r)}
                                  >
                                      {r}
                                  </span>
                              ))}
                          </div>
                      </div>
                      <DialogFooter>
                          <Button variant="outline" onClick={() => setRejectionDialogLeadId(null)}>×‘×™×˜×•×œ</Button>
                          <Button onClick={submitRejection} className="bg-red-600 hover:bg-red-700 text-white">××™×©×•×¨</Button>
                      </DialogFooter>
                  </DialogContent>
              </Dialog>
        
              <Dialog open={!!selectedLead} onOpenChange={(o) => !o && setSelectedLead(null)}>
                <DialogContent className="max-w-xl max-h-[80vh] overflow-auto"><pre className="text-xs whitespace-pre-wrap" dir="ltr">{selectedLead?.body}</pre></DialogContent>
              </Dialog>
        
              <Dialog open={!!noteToView} onOpenChange={(o) => !o && setNoteToView(null)}>
                <DialogContent>
                    <DialogHeader><DialogTitle>×¤×¨×˜×™× ××œ××™×</DialogTitle></DialogHeader>
                    <div className="py-4 text-right whitespace-pre-wrap">
                        <p className="font-bold mb-2 text-lg">{noteToView?.hotel}</p>
                        <p className="text-gray-700">{noteToView?.parsedNote}</p>
                    </div>
                </DialogContent>
              </Dialog>
            </div>
          );
        }
        
        // --- ×”×¨×›×™×‘ ×”××¢×•×¦×‘ ---
        const LeadStrip = ({ lead, onStatusChange, onViewRaw, onViewNote, onDelete }) => {
        
          const isNew = lead.status === 'new';
        
          // ×”×’×“×¨×ª ×¦×‘×¢×™× ×œ×¤×™ ×¡×˜×˜×•×¡
          const statusStyles = {
              // âœ¨ ×›×—×•×œ ×œ"×œ× × ×¢× ×”"
              'new': 'bg-blue-100 text-blue-800 border-blue-200 hover:bg-blue-200 font-bold',
              'in_progress': 'bg-amber-50 border-amber-200 text-amber-700',
              'closed': 'bg-green-50 border-green-200 text-green-700 font-bold',
              'not_relevant': 'bg-gray-100 border-gray-200 text-gray-400 decoration-slice'
          };
        
          // âœ¨ ×§×‘×™×¢×ª ×¦×‘×¢ ×”×¤×¡ ×”×¦×™×“×™: ×›×—×•×œ ×œ×—×“×©×™×, ×–×”×‘ ×œ×›×œ ×”×©××¨
          const sideBorderColor = isNew ? BLUE_COLOR : GOLD_COLOR;
        
          // âœ¨ ×¨×§×¢ ×©×•×¨×”: ×›×—×œ×—×œ ×¢×“×™×Ÿ ×××•×“ ×œ×—×“×©×™×, ×œ×‘×Ÿ ×œ××—×¨×™×
          const rowBackground = isNew ? 'bg-blue-50/30' : 'bg-white';
        
          const handlePhoneClick = () => {
              if (lead.status === 'new') {
                  onStatusChange(lead._id, 'in_progress');
              }
          };
        
          return (
            <div
                className={`
                    flex flex-col md:flex-row items-center gap-4 p-3 border-b border-gray-100 hover:bg-gray-50/80 transition-all group
                    ${rowBackground}
                `}
                style={{ borderRight: `4px solid ${sideBorderColor}` }} // ×”×¤×¡ ×”×¦×‘×¢×•× ×™ ×”××©×ª× ×”
            >
                {/* 1. ××–×•×¨ ×©× ×•×ª××¨×™×š */}
                <div className="w-full md:w-[180px] flex flex-col justify-center min-w-[180px]">
                    <div
                        className={`font-bold text-sm md:text-base truncate cursor-pointer hover:text-blue-600 flex items-center gap-2 ${isNew ? 'text-black' : 'text-gray-700'}`}
                        onClick={onViewRaw}
                        title={lead.parsedName}
                    >
                        <User size={14} className="text-gray-400 shrink-0" />
                        {lead.parsedName || '×œ×œ× ×©×'}
                    </div>
                    <div className="text-[11px] text-gray-400 flex items-center gap-1 mt-1 pr-6">
                        {format(new Date(lead.receivedAt), 'dd/MM HH:mm')}
                    </div>
                </div>
        
                {/* 2. ×˜×œ×¤×•×Ÿ */}
                <div className="w-full md:w-[130px] flex items-center min-w-[130px]">
                    {lead.parsedPhone ? (
                        <a
                            href={`https://wa.me/${lead.parsedPhone}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            className={`text-sm font-medium hover:text-blue-600 transition-colors flex items-center gap-2 ${isNew ? 'text-blue-700' : 'text-gray-600'}`}
                            onClick={handlePhoneClick}
                            dir="ltr"
                        >
                            <Phone size={14} className={isNew ? "text-blue-400" : "text-gray-300"} />
                            {lead.parsedPhone}
                        </a>
                    ) : (
                        <span className="text-gray-300 text-xs">-</span>
                    )}
                </div>
        
                {/* 3. ××œ×•×Ÿ ×•×”×¢×¨×” */}
                <div
                    className="w-full md:flex-1 flex flex-col justify-center min-w-0 cursor-pointer pr-4 border-r md:border-r-0 border-gray-100"
                    onClick={onViewNote}
                >
                    <div className="flex items-center gap-2 mb-1">
                        {lead.hotel && (
                            <span className="text-[10px] font-bold text-gray-500 bg-white border border-gray-200 px-1.5 rounded shadow-sm">
                                {lead.hotel}
                            </span>
                        )}
                    </div>
                    <span className="text-sm text-gray-600 truncate" title={lead.parsedNote}>
                        {lead.parsedNote || <span className="text-gray-300 text-xs">××™×Ÿ ×”×¢×¨×•×ª</span>}
                    </span>
                </div>
        
                {/* 4. ×¡×˜×˜×•×¡ ×•××—×™×§×” */}
                <div className="w-full md:w-[200px] flex items-center gap-3 justify-between md:justify-end min-w-[200px]">
        
                    <div className="flex-grow md:flex-grow-0 w-full md:w-[160px]">
                        <Select
                            value={lead.status}
                            onValueChange={(val) => onStatusChange(lead._id, val)}
                        >
                            <SelectTrigger className={`h-8 text-xs shadow-sm ${statusStyles[lead.status] || 'bg-white border-gray-200'}`}>
                                <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                                <SelectItem value="new">×œ× × ×¢× ×”</SelectItem>
                                <SelectItem value="in_progress">×‘×˜×™×¤×•×œ</SelectItem>
                                <SelectItem value="closed">× ×¡×’×¨ ×‘×”×¦×œ×—×”</SelectItem>
                                <SelectItem value="not_relevant">×œ× ×¨×œ×•×•× ×˜×™</SelectItem>
                            </SelectContent>
                        </Select>
        
                        {/* ×¡×™×‘×ª ×“×—×™×™×” ×§×˜× ×” ××ª×—×ª */}
                        {lead.rejectionReason && lead.status === 'not_relevant' && (
                            <p className="text-[10px] text-gray-400 truncate mt-1 text-center md:text-right w-full">
                                {lead.rejectionReason}
                            </p>
                        )}
                    </div>
        
                    {onDelete && (
                        <button
                            className="text-gray-300 hover:text-red-500 transition-colors p-1"
                            onClick={(e) => { e.stopPropagation(); onDelete(lead._id); }}
                            title="××—×§ ×¤× ×™×™×”"
                        >
                            <Trash2 size={16} />
                        </button>
                    )}
                </div>
            </div>
          );
        };
      ğŸ“„ LoginPage.jsx
        import { useState, useEffect } from 'react';
        import { Link, useNavigate } from 'react-router-dom';
        import api from "@/utils/api";
        import { useAuthStore } from "@/stores/authStore.js";
        import { Button } from '@/components/ui/Button.jsx';
        import { motion, AnimatePresence } from 'framer-motion';
        import { Mail, Lock, Eye, EyeOff, LoaderCircle, AlertCircle } from 'lucide-react';
        
        export default function LoginPage() {
          const [email, setEmail] = useState('');
          const [password, setPassword] = useState('');
          const [error, setError] = useState('');
          const [loading, setLoading] = useState(false);
          const [showPassword, setShowPassword] = useState(false);
          const loginAction = useAuthStore((s) => s.login);
          const navigate = useNavigate();
        
          useEffect(() => {
            api.get('/csrf-token').catch((err) => {
              console.error("Failed to fetch CSRF token", err);
              setError("×©×’×™××ª ××‘×˜×—×”. ×¨×¢× ×Ÿ ××ª ×”×“×£ ×•× ×¡×” ×©×•×‘.");
            });
          }, []);
        
          const handleSubmit = async (e) => {
            e.preventDefault();
            if (loading) return;
        
            setLoading(true);
            setError('');
        
            try {
              const { data } = await api.post('/auth/login', { email, password });
        
              if (data && data.user) {
                loginAction(data.user);
                navigate('/');
              } else {
                throw new Error("×ª×’×•×‘×ª ×”×©×¨×ª ××™× ×” ××›×™×œ×” ×¤×¨×˜×™ ××©×ª××©.");
              }
        
            } catch (err) {
              setError(err.response?.data?.message || '×©×’×™××” ×œ× ×¦×¤×•×™×”. × ×¡×” ×©×•×‘.');
            } finally {
              setLoading(false);
            }
          };
        
          const cardVariants = {
            hidden: { opacity: 0, y: 20 },
            visible: {
              opacity: 1,
              y: 0,
              transition: {
                duration: 0.6,
                ease: "easeOut",
                when: "beforeChildren",
                staggerChildren: 0.1
              }
            },
          };
        
          const itemVariants = {
            hidden: { opacity: 0, y: 20 },
            visible: { opacity: 1, y: 0, transition: { duration: 0.5 } }
          };
        
          return (
            <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-4">
              <motion.div
                variants={cardVariants}
                initial="hidden"
                animate="visible"
                className="w-full max-w-md bg-white/80 backdrop-blur-xl rounded-2xl shadow-2xl p-8 space-y-6"
              >
                <motion.div variants={itemVariants} className="text-center">
                  <Link to="/" className="text-3xl font-bold text-amber-700 inline-block mb-2">× ×™×”×•×œ ×”×–×× ×•×ª</Link>
                  <h1 className="text-2xl font-bold text-gray-900">×‘×¨×•×›×™× ×”×‘××™×</h1>
                  <p className="text-gray-600">×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ ×©×œ×š ×›×“×™ ×œ×”××©×™×š</p>
                </motion.div>
        
                <form onSubmit={handleSubmit} className="space-y-4">
                  <motion.div variants={itemVariants}>
                    <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">×›×ª×•×‘×ª ××™××™×™×œ</label>
                    <div className="relative">
                      <span className="absolute inset-y-0 left-0 flex items-center pl-3"><Mail className="h-5 w-5 text-gray-400" /></span>
                      <input id="email" type="email" placeholder="you@example.com" required value={email} onChange={(e) => setEmail(e.target.value)} className="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition"/>
                    </div>
                  </motion.div>
        
                  <motion.div variants={itemVariants}>
                    <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">×¡×™×¡××”</label>
                    <div className="relative">
                      <span className="absolute inset-y-0 left-0 flex items-center pl-3"><Lock className="h-5 w-5 text-gray-400" /></span>
                      <input id="password" type={showPassword ? 'text' : 'password'} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required value={password} onChange={(e) => setPassword(e.target.value)} className="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition"/>
                      <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute inset-y-0 right-0 flex items-center pr-3" aria-label={showPassword ? "×”×¡×ª×¨ ×¡×™×¡××”" : "×”×¦×’ ×¡×™×¡××”"}>
                        {showPassword ? <EyeOff className="h-5 w-5 text-gray-500 hover:text-gray-800" /> : <Eye className="h-5 w-5 text-gray-500 hover:text-gray-800" />}
                      </button>
                    </div>
                  </motion.div>
        
                  <AnimatePresence>
                    {error && (
                      <motion.div
                        initial={{ opacity: 0, y: -10, height: 0 }}
                        animate={{ opacity: 1, y: 0, height: 'auto' }}
                        exit={{ opacity: 0, y: -10, height: 0 }}
                        className="bg-red-50 border border-red-200 text-red-700 p-3 rounded-lg text-sm flex items-center gap-2 overflow-hidden"
                      >
                        <AlertCircle className="h-5 w-5 flex-shrink-0"/>
                        <span>{error}</span>
                      </motion.div>
                    )}
                  </AnimatePresence>
        
                  <motion.div variants={itemVariants}>
                    <Button type="submit" className="w-full flex justify-center items-center gap-2" disabled={loading}>
                      {loading && <LoaderCircle className="animate-spin h-5 w-5" />}
                      {loading ? '××ª×—×‘×¨...' : '×”×ª×—×‘×¨×•×ª'}
                    </Button>
                  </motion.div>
                </form>
        
                {/* âœ¨ ×”×§×™×©×•×¨ ×œ×”×¨×©××” ×”×•×¡×¨ ××›××Ÿ */}
                <motion.div variants={itemVariants} className="text-sm text-center text-gray-600">
                    <p>××¢×¨×›×ª ×–×• ××™×•×¢×“×ª ×œ××©×ª××©×™× ××•×¨×©×™× ×‘×œ×‘×“.</p>
                </motion.div>
              </motion.div>
            </div>
          );
        }
      ğŸ“„ NotFoundPage.jsx
        import { Link } from 'react-router-dom';
        import { Button } from '@/components/ui/Button.jsx';
        const NotFoundPage = () => {
          return (
            <div className="text-center flex flex-col items-center justify-center h-full">
              <h1 className="text-6xl font-bold text-amber-600">404</h1>
              <p className="text-2xl mt-4 mb-8">××•×¤×¡! ×”×¢××•×“ ×©×—×™×¤×©×ª ×œ× × ××¦×.</p>
              <Button asChild>
                <Link to="/">×—×–×•×¨ ×œ×“×£ ×”×‘×™×ª</Link>
              </Button>
            </div>
          );
        };
        
        export default NotFoundPage;
      ğŸ“„ OrderPage.jsx
        // client/src/pages/OrderPage.jsx
        import React, { useState, useMemo, useEffect } from 'react';
        import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
        import toast from 'react-hot-toast';
        import api from '@/utils/api.js';
        import ReactQuill from 'react-quill';
        import 'react-quill/dist/quill.snow.css';
        import { useAuthStore } from '@/stores/authStore.js'; // âœ¨ ×™×™×‘×•× ×”-store
        
        import { AddRoomForm } from '@/components/orders/AddRoomForm';
        import { OrderSummaryTable } from '@/components/orders/OrderSummaryTable';
        import { OrderExtrasForm } from '@/components/orders/OrderExtrasForm';
        import { Button } from '@/components/ui/Button.jsx';
        import { Card, CardContent, CardHeader, CardTitle, CardFooter, CardDescription } from '@/components/ui/Card.jsx';
        import { Input } from '@/components/ui/Input.jsx';
        import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
        import { Label } from '@/components/ui/Label.jsx';
        import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from "@/components/ui/Dialog";
        import { Hotel, FilePlus2, BadgePercent, User, Phone, Activity, StickyNote, Eye, Maximize2, Tag, Calendar, Mail, Save } from 'lucide-react';
        import { calculateRoomTotalPrice } from '@/lib/priceCalculator';
        
        const fetchHotels = async () => (await api.get('/admin/hotels')).data;
        
        const fetchPriceListsAsMap = async (hotelId) => {
          const { data } = await api.get(`/pricelists?hotelId=${hotelId}&active=true`);
          return data.reduce((acc, pl) => {
            acc[pl.name] = pl;
            return acc;
          }, {});
        };
        
        const fetchRoomTypes = async (hotelId) => {
          const { data } = await api.get(`/admin/room-types/by-hotel/${hotelId}`);
          return data;
        };
        
        const createOrder = (orderData) => {
          return api.post('/orders', orderData);
        };
        
        const modules = {
          toolbar: [
            [{ 'header': [1, 2, 3, false] }],
            ['bold', 'italic', 'underline', 'strike'],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'align': [] }],
            [{ 'direction': 'rtl' }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['clean']
          ],
        };
        const formats = [
          'header', 'bold', 'italic', 'underline', 'strike',
          'color', 'background', 'align', 'direction',
          'list', 'bullet'
        ];
        
        export default function OrderPage() {
          const [selectedHotel, setSelectedHotel] = useState(null);
          const [rooms, setRooms] = useState([]);
          const [extras, setExtras] = useState([]);
          const [discountPercent, setDiscountPercent] = useState(0);
          const [numberOfNights, setNumberOfNights] = useState(1);
          const [orderDetails, setOrderDetails] = useState({
            customerName: '',
            customerPhone: '',
            customerEmail: '',
            eventDate: new Date().toISOString().split('T')[0],
            status: '×‘×”××ª× ×”',
            notes: '',
          });
        
          const [isNotesDialogOpen, setIsNotesDialogOpen] = useState(false);
          const [tempNotes, setTempNotes] = useState('');
          const [nextAction, setNextAction] = useState('reset');
          const queryClient = useQueryClient();
          const { user } = useAuthStore(); // âœ¨ ×©×œ×™×¤×ª ×”××©×ª××©
        
          const { data: hotels = [], isLoading: isLoadingHotels } = useQuery({
              queryKey: ['hotels'],
              queryFn: fetchHotels,
          });
        
          const { data: priceLists, isLoading: isLoadingPriceLists } = useQuery({
            queryKey: ['priceListsMap', selectedHotel],
            queryFn: () => fetchPriceListsAsMap(selectedHotel),
            enabled: !!selectedHotel,
          });
        
          const { data: roomTypes = [], isLoading: isLoadingRoomTypes } = useQuery({
            queryKey: ['roomTypes', selectedHotel],
            queryFn: () => fetchRoomTypes(selectedHotel),
            enabled: !!selectedHotel,
          });
        
          const { mutate: saveOrder, isPending: isSaving } = useMutation({
            mutationFn: createOrder,
            onSuccess: (response) => {
              const newOrder = response.data;
              toast.success('×”×”×–×× ×” × ×©××¨×” ×‘×”×¦×œ×—×”!');
        
              if (nextAction === 'view' && newOrder?._id) {
                window.open(`/quote/${newOrder._id}`, '_blank');
              }
        
              setRooms([]);
              setExtras([]);
              setDiscountPercent(0);
              setOrderDetails({
                  customerName: '', customerPhone: '', customerEmail: '',
                  eventDate: new Date().toISOString().split('T')[0],
                  status: '×‘×”××ª× ×”', notes: ''
              });
              setSelectedHotel(null);
              setNumberOfNights(1);
              queryClient.invalidateQueries({ queryKey: ['myOrders'] });
            },
            onError: (err) => {
              toast.error(err.response?.data?.message || '×©×’×™××” ×‘×©××™×¨×ª ×”×”×–×× ×”.');
            },
          });
        
          const totals = useMemo(() => {
            const roomsTotal = rooms.reduce((sum, room) => sum + room.price, 0);
            const extrasTotal = extras.reduce((sum, ex) => sum + (ex.price * ex.quantity), 0);
            const subTotal = roomsTotal + extrasTotal;
            const discountAmount = subTotal * (discountPercent / 100);
            const afterDiscount = subTotal - discountAmount;
            const salesCommission = afterDiscount * 0.03;
        
            return { roomsTotal, extrasTotal, subTotal, discountAmount, finalTotal: afterDiscount, salesCommission };
          }, [rooms, extras, discountPercent]);
        
          useEffect(() => {
              setRooms([]);
              setExtras([]);
          }, [selectedHotel]);
        
          useEffect(() => {
            if (rooms.length > 0 && priceLists) {
                const updatedRooms = rooms.map(room => {
                     const newPrice = calculateRoomTotalPrice(
                         room,
                         priceLists,
                         room.price_list_names,
                         numberOfNights,
                         room.roomSupplement
                     );
                     return { ...room, price: newPrice };
                });
                setRooms(updatedRooms);
            }
            // eslint-disable-next-line react-hooks/exhaustive-deps
          }, [numberOfNights]);
        
          const addRoom = (newRoom) => setRooms(prev => [...prev, newRoom]);
          const removeRoom = (index) => setRooms(prev => prev.filter((_, i) => i !== index));
          const updateRoom = (index, updatedRoom) => setRooms(prev => prev.map((room, i) => i === index ? updatedRoom : room));
        
          const handleDetailsChange = (e) => {
            const { name, value } = e.target;
            setOrderDetails(prev => ({ ...prev, [name]: value }));
          };
        
          const handleStatusChange = (value) => {
            setOrderDetails(prev => ({ ...prev, status: value }));
          };
        
          const handleNightsChange = (e) => {
              const val = parseInt(e.target.value, 10);
              setNumberOfNights(val < 1 ? 1 : val);
          };
        
          const getOrderPayload = () => {
            if (!selectedHotel) { toast.error('×—×•×‘×” ×œ×‘×—×•×¨ ××œ×•×Ÿ.'); return null; }
            if (!orderDetails.customerName) { toast.error('×—×•×‘×” ×œ×”×–×™×Ÿ ×©× ×œ×§×•×—.'); return null; }
            if (rooms.length === 0 && extras.length === 0) { toast.error('×™×© ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ×—×“×¨ ××—×“ ××• ×ª×•×¡×¤×ª.'); return null; }
        
            return {
              ...orderDetails,
              hotel: selectedHotel,
              rooms,
              extras,
              discountPercent,
              total_price: totals.finalTotal,
              notes: orderDetails.notes,
              numberOfNights
            };
          };
        
          const handleFinishOrder = () => {
            const payload = getOrderPayload();
            if (payload) {
                setNextAction('reset');
                saveOrder(payload);
            }
          };
        
          const handleSaveAndQuote = () => {
            const payload = getOrderPayload();
            if (payload) {
                setNextAction('view');
                saveOrder(payload);
            }
          };
        
          const handleOpenNotesDialog = () => {
              setTempNotes(orderDetails.notes || '');
              setIsNotesDialogOpen(true);
          };
        
          const handleSaveNotesFromDialog = () => {
              setOrderDetails(prev => ({ ...prev, notes: tempNotes }));
              setIsNotesDialogOpen(false);
          };
        
          const isLoading = isLoadingHotels || (selectedHotel && (isLoadingPriceLists || isLoadingRoomTypes));
        
          return (
            <div className="container mx-auto p-4 space-y-8">
        
              <Card className="shadow-lg">
                  <CardHeader>
                      <CardTitle className="flex items-center gap-2">×¤×¨×˜×™ ×”×¤× ×™×™×”</CardTitle>
                  </CardHeader>
                  <CardContent>
                      <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 items-end">
                           <div>
                               <Label htmlFor="customerName" className="mb-1.5 block">×©× ×”×œ×§×•×—</Label>
                              <div className="relative">
                                 <User className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                                 <Input id="customerName" name="customerName" value={orderDetails.customerName} onChange={handleDetailsChange} placeholder="×™×©×¨××œ ×™×©×¨××œ×™" required className="pl-10" />
                              </div>
                          </div>
        
                          <div>
                               <Label htmlFor="customerPhone" className="mb-1.5 block">×˜×œ×¤×•×Ÿ</Label>
                               <div className="relative">
                                 <Phone className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                                 <Input id="customerPhone" name="customerPhone" value={orderDetails.customerPhone} onChange={handleDetailsChange} placeholder="050-1234567" className="pl-10" />
                               </div>
                           </div>
        
                           <div>
                               <Label htmlFor="customerEmail" className="mb-1.5 block">××™××™×™×œ</Label>
                               <div className="relative">
                                  <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                                  <Input id="customerEmail" name="customerEmail" type="email" value={orderDetails.customerEmail} onChange={handleDetailsChange} placeholder="client@example.com" className="pl-10" />
                              </div>
                           </div>
        
                           <div>
                               <Label htmlFor="eventDate" className="mb-1.5 block">×ª××¨×™×š ××™×¨×•×¢/×”×’×¢×”</Label>
                               <div className="relative">
                                  <Calendar className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none" />
                                  <Input id="eventDate" name="eventDate" type="date" value={orderDetails.eventDate} onChange={handleDetailsChange} className="pl-10" />
                              </div>
                           </div>
        
                           {/* ×©×•×¨×” 2 */}
                           <div>
                                <Label htmlFor="status" className="mb-1.5 block">×¡×˜×˜×•×¡</Label>
                                <Select value={orderDetails.status} onValueChange={handleStatusChange}>
                                    <SelectTrigger id="status">
                                        <div className="flex items-center gap-2">
                                            <Activity className="h-4 w-4 text-gray-400" />
                                            <SelectValue placeholder="×‘×—×¨ ×¡×˜×˜×•×¡" />
                                        </div>
                                    </SelectTrigger>
                                    <SelectContent>
                                        <SelectItem value="×‘×”××ª× ×”">×‘×”××ª× ×”</SelectItem>
                                        <SelectItem value="×‘×•×¦×¢">×‘×•×¦×¢</SelectItem>
                                        <SelectItem value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</SelectItem>
                                    </SelectContent>
                                </Select>
                          </div>
        
                           <div className="lg:col-span-3">
                              <Label htmlFor="notes" className="mb-1.5 block">×”×¢×¨×•×ª ×œ×”×–×× ×”</Label>
                              <div
                                className="relative min-h-[42px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background cursor-pointer hover:bg-slate-50 transition-colors flex items-center"
                                onClick={handleOpenNotesDialog}
                                title="×œ×—×¥ ×œ×¤×ª×™×—×ª ×¢×•×¨×š ×”×¢×¨×•×ª ××œ×"
                              >
                                  <StickyNote className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                                  <div className="pl-8 w-full overflow-hidden text-ellipsis whitespace-nowrap text-slate-600" dir="auto">
                                      {orderDetails.notes ? (
                                          <span dangerouslySetInnerHTML={{ __html: orderDetails.notes.replace(/<[^>]+>/g, ' ').substring(0, 100) + (orderDetails.notes.length > 100 ? '...' : '') }}></span>
                                      ) : (
                                           <span className="text-muted-foreground">×”×¢×¨×•×ª ×›×œ×œ×™×•×ª... (×œ×—×¥ ×œ×¢×¨×™×›×”)</span>
                                      )}
                                  </div>
                                  <Maximize2 className="absolute bottom-2 left-2 h-3 w-3 text-blue-400 opacity-70" />
                              </div>
                           </div>
                      </div>
                  </CardContent>
              </Card>
        
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                   <div className="lg:col-span-1 space-y-8">
                       <Card className="shadow-lg">
                        <CardHeader><CardTitle className="flex items-center gap-2"><FilePlus2 size={22}/> ×”×•×¡×¤×ª ×—×“×¨ ×—×“×©</CardTitle></CardHeader>
                        <CardContent className="space-y-4">
                            <div>
                                <Label htmlFor="hotel">××œ×•×Ÿ</Label>
                                <Select value={selectedHotel || ''} onValueChange={setSelectedHotel}>
                                    <SelectTrigger id="hotel">
                                        <div className="flex items-center gap-2">
                                            <Hotel className="h-4 w-4 text-gray-400" />
                                            <SelectValue placeholder="×‘×—×¨ ××œ×•×Ÿ..." />
                                        </div>
                                    </SelectTrigger>
                                    <SelectContent>
                                        {isLoadingHotels ?
                                          <SelectItem value="loading" disabled>×˜×•×¢×Ÿ ××œ×•× ×•×ª...</SelectItem> :
                                          hotels.map(hotel => <SelectItem key={hotel._id} value={hotel._id}>{hotel.name}</SelectItem>)
                                        }
                                    </SelectContent>
                                </Select>
                            </div>
                            <hr/>
                            <AddRoomForm
                                priceLists={priceLists || {}}
                                roomTypes={roomTypes || []}
                                numberOfNights={numberOfNights}
                                onNightsChange={handleNightsChange}
                                onAddRoom={addRoom}
                                disabled={!selectedHotel || isLoading}
                                isLoading={isLoading}
                            />
                        </CardContent>
                      </Card>
        
                    <Card className="shadow-lg">
                        <CardHeader><CardTitle className="flex items-center gap-2"><Tag size={22}/> ×ª×•×¡×¤×•×ª ×œ×”×–×× ×”</CardTitle></CardHeader>
                        <CardContent>
                            <OrderExtrasForm extras={extras} onChange={setExtras} />
                        </CardContent>
                    </Card>
                  </div>
        
                  <Card className="lg:col-span-2 shadow-lg">
                    <CardHeader className="flex flex-row items-start justify-between space-y-0 pb-4">
                        <div className="space-y-1">
                            <CardTitle>×¡×™×›×•× ×”×–×× ×”</CardTitle>
                            <CardDescription>
                                {rooms.length > 0 || extras.length > 0
                                    ? `×¡×”"×› ${rooms.length} ×—×“×¨×™× ×•-${extras.length} ×ª×•×¡×¤×•×ª.`
                                    : '×”×˜×‘×œ×” ×ª×ª×¢×“×›×Ÿ ×œ××—×¨ ×”×•×¡×¤×ª ×¤×¨×™×˜×™×.'}
                            </CardDescription>
                        </div>
                        <div className="flex gap-2">
                             <Button
                                variant="outline"
                                size="sm"
                                onClick={handleSaveAndQuote}
                                disabled={isSaving}
                                className="border-blue-600 text-blue-700 hover:bg-blue-50 gap-2 h-9"
                              >
                                <Eye size={16} />
                                {isSaving && nextAction === 'view' ? '×©×•××¨...' :'×”×¦×’ ×•×©××•×¨ ×”×–×× ×”'}
                              </Button>
        
                              <Button
                                size="sm"
                                onClick={handleFinishOrder}
                                disabled={isSaving}
                                className="bg-primary hover:bg-primary/90 gap-2 h-9"
                              >
                                <Save size={16} />
                                {isSaving && nextAction === 'reset' ? '×©×•××¨...' : '×©××•×¨ ×•×¡×™×™×'}
                              </Button>
                        </div>
                    </CardHeader>
        
                    <CardContent>
                        <OrderSummaryTable
                            rooms={rooms}
                            priceLists={priceLists || {}}
                            roomTypes={roomTypes || []}
                            numberOfNights={numberOfNights}
                            onRemoveRoom={removeRoom}
                            onUpdateRoom={updateRoom}
                        />
        
                        <div className="mt-8 bg-slate-50 p-6 rounded-lg border border-slate-100 space-y-3">
                            <div className="flex justify-between text-sm text-gray-600">
                                <span>×¡×”"×› ×—×“×¨×™×:</span>
                                <span>{totals.roomsTotal.toLocaleString()} â‚ª</span>
                            </div>
        
                            {totals.extrasTotal > 0 && (
                                <div className="flex justify-between text-sm text-blue-700 font-medium">
                                    <span>×ª×•×¡×¤×•×ª (××•×œ×/×¦×™×•×“):</span>
                                    <span>+ {totals.extrasTotal.toLocaleString()} â‚ª</span>
                                </div>
                            )}
        
                            <div className="flex justify-between items-center py-2 border-t border-dashed border-gray-300">
                                <span className="font-medium text-gray-700">×”× ×—×” (%):</span>
                                <div className="flex items-center gap-2">
                                    <Input
                                        type="number"
                                        min="0"
                                        max="100"
                                        className="w-16 h-8 text-center bg-white border-slate-300"
                                        value={discountPercent}
                                        onChange={(e) => setDiscountPercent(Number(e.target.value))}
                                    />
                                    <span className="text-red-600 text-sm w-24 text-left font-medium">
                                        - {totals.discountAmount.toLocaleString()} â‚ª
                                    </span>
                                </div>
                            </div>
        
                            <div className="flex justify-between text-2xl font-bold text-slate-900 pt-2 border-t border-gray-300">
                                <span>×¡×”"×› ×œ×ª×©×œ×•×:</span>
                                <span>{totals.finalTotal.toLocaleString()} â‚ª</span>
                            </div>
                        </div>
        
                    </CardContent>
        
                    <CardFooter className="flex flex-col items-end gap-4 bg-slate-50 p-6 rounded-b-xl">
                        {/* âœ¨ ×‘×“×™×§×ª ×”×¨×©××•×ª ×œ×”×¦×’×ª ×¢××œ×•×ª */}
                        {(user?.role === 'admin' || user?.canViewCommissions) && (
                            <div className="w-full max-w-sm text-right">
                                <div className="flex justify-between text-sm text-green-600 font-medium">
                                    <span className="flex items-center gap-1.5"><BadgePercent size={16}/> ×¢××œ×ª×š (3%):</span>
                                    <span>+ {totals.salesCommission.toLocaleString('he-IL', { style: 'currency', currency: 'ILS' })}</span>
                                </div>
                            </div>
                        )}
                    </CardFooter>
                  </Card>
              </div>
        
              <Dialog open={isNotesDialogOpen} onOpenChange={setIsNotesDialogOpen}>
                <DialogContent className="max-w-3xl max-h-[90vh] flex flex-col overflow-hidden">
                    <DialogHeader>
                        <DialogTitle>×¢×¨×™×›×ª ×”×¢×¨×•×ª ×œ×”×–×× ×”</DialogTitle>
                        <DialogDescription>
                            ×”×•×¡×£ ×”×¢×¨×•×ª ××¤×•×¨×˜×•×ª, ×”×“×’×©×•×ª ×•×¦×‘×¢×™× ×©×™×•×¤×™×¢×• ×‘×”×–×× ×”.
                        </DialogDescription>
                    </DialogHeader>
        
                    <div className="flex-1 overflow-y-auto py-2" dir="rtl">
                        <ReactQuill
                            theme="snow"
                            value={tempNotes}
                            onChange={setTempNotes}
                            modules={modules}
                            formats={formats}
                            className="h-64 mb-12"
                            placeholder="×”×§×œ×“ ×›××Ÿ ××ª ×”×”×¢×¨×•×ª..."
                        />
                    </div>
        
                    <DialogFooter className="mt-4">
                        <Button variant="outline" onClick={() => setIsNotesDialogOpen(false)}>×‘×™×˜×•×œ</Button>
                        <Button onClick={handleSaveNotesFromDialog}>×©××•×¨ ×”×¢×¨×•×ª</Button>
                    </DialogFooter>
                </DialogContent>
              </Dialog>
        
            </div>
          );
        }
      ğŸ“„ OrdersPage.jsx
        // client/src/pages/OrdersPage.jsx
        
        import React, { useMemo } from 'react';
        import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
        import { Link } from 'react-router-dom';
        import { format } from 'date-fns';
        import api from '@/utils/api.js';
        import toast from 'react-hot-toast';
        
        // UI Components
        import { Button } from '@/components/ui/Button.jsx';
        import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
        import { Card, CardContent, CardFooter } from '@/components/ui/Card.jsx';
        import { PlusCircle, Trash2, Edit, Eye, Hotel, Phone, Calendar, User, Users, CheckCircle2, Clock, XCircle } from 'lucide-react';
        
        // --- API Functions ---
        const fetchMyOrders = async () => {
          const { data } = await api.get('/orders/my-orders');
          return data;
        };
        
        const deleteOrder = (orderId) => api.delete(`/orders/${orderId}`);
        
        const updateOrderStatus = ({ orderId, status }) => api.put(`/orders/${orderId}`, { status });
        
        export default function OrdersPage() {
          const queryClient = useQueryClient();
        
          const { data: orders, isLoading, isError, error } = useQuery({
            queryKey: ['myOrders'],
            queryFn: fetchMyOrders,
          });
        
          const { mutate: deleteOrderMutation } = useMutation({
               mutationFn: deleteOrder,
              onSuccess: () => {
                  toast.success("×”×”×–×× ×” × ××—×§×”!");
                  queryClient.invalidateQueries({ queryKey: ['myOrders'] });
              },
              onError: () => toast.error("×©×’×™××” ×‘××—×™×§×ª ×”×”×–×× ×”.")
          });
        
          const { mutate: updateStatusMutation } = useMutation({
              mutationFn: updateOrderStatus,
              onSuccess: () => {
                  toast.success("×¡×˜×˜×•×¡ ×¢×•×“×›×Ÿ");
                  queryClient.invalidateQueries({ queryKey: ['myOrders'] });
              },
              onError: () => toast.error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡")
          });
        
          // --- ×œ×•×’×™×§×”: ×§×™×‘×•×¥ ×•××™×•×Ÿ ---
          const processedData = useMemo(() => {
            if (!orders) return { grouped: {}, stats: { waiting: 0, done: 0, irrelevant: 0 } };
        
            const groups = {};
            const stats = { waiting: 0, done: 0, irrelevant: 0 };
        
            // ××™×•×Ÿ: ×§×•×“× ×›×œ ×œ×¤×™ ×¡×˜×˜×•×¡ (×‘×”××ª× ×” ×œ××¢×œ×”), ×•××– ×œ×¤×™ ×ª××¨×™×š
            const statusPriority = { '×‘×”××ª× ×”': 1, '×‘×•×¦×¢': 2, '×œ× ×¨×œ×•×•× ×˜×™': 3 };
        
            const sortedOrders = [...orders].sort((a, b) => {
                const priorityA = statusPriority[a.status] || 4;
                const priorityB = statusPriority[b.status] || 4;
                if (priorityA !== priorityB) return priorityA - priorityB;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
        
            sortedOrders.forEach(order => {
                const hotelName = order.hotel?.name || '×”×–×× ×•×ª ×œ×œ× ×©×™×•×š';
        
                if (!groups[hotelName]) {
                    groups[hotelName] = { '×‘×”××ª× ×”': [], '×‘×•×¦×¢': [], '×œ× ×¨×œ×•×•× ×˜×™': [] };
                }
        
                const targetStatus = groups[hotelName][order.status] ? order.status : '×‘×”××ª× ×”';
                groups[hotelName][targetStatus].push(order);
        
                if (order.status === '×‘×”××ª× ×”') stats.waiting++;
                else if (order.status === '×‘×•×¦×¢') stats.done++;
                else if (order.status === '×œ× ×¨×œ×•×•× ×˜×™') stats.irrelevant++;
            });
        
            return { grouped: groups, stats };
          }, [orders]);
        
          const handleDelete = (orderId) => {
              if (window.confirm("×”×× ×œ××—×•×§ ××ª ×”×”×–×× ×” ×œ×¦××™×ª×•×ª?")) {
                  deleteOrderMutation(orderId);
              }
          }
        
          const handleStatusChange = (orderId, newStatus) => {
              updateStatusMutation({ orderId, status: newStatus });
          }
        
          if (isLoading) return <div className="text-center p-10 text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>;
          if (isError) return <div className="text-center p-10 text-red-600">×©×’×™××”: {error.message}</div>;
        
          const statusDisplayOrder = ['×‘×”××ª× ×”', '×‘×•×¦×¢', '×œ× ×¨×œ×•×•× ×˜×™'];
        
          return (
            <div className="container mx-auto p-4 sm:p-6 space-y-8 bg-white min-h-screen">
        
              {/* ×›×•×ª×¨×ª ×¨××©×™×ª */}
              <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 border-b border-slate-100 pb-6">
                <div>
                  <h1 className="text-3xl font-bold text-slate-900">×”×”×–×× ×•×ª ×©×œ×™</h1>
                  <p className="text-slate-500 mt-1">× ×™×”×•×œ ×•××¢×§×‘ ××—×¨ ×›×œ ×”×¢×¡×§××•×ª ×‘××§×•× ××—×“.</p>
                </div>
                <Button asChild size="lg" className="shadow-none bg-slate-900 hover:bg-slate-800 text-white rounded-lg px-6">
                  <Link to="/new-order"><PlusCircle className="ml-2 h-5 w-5"/> ×”×–×× ×” ×—×“×©×”</Link>
                </Button>
              </div>
        
              {/* ×“×©×‘×•×¨×“ ×¡×˜×˜×™×¡×˜×™×§×” */}
              <div className="grid grid-cols-3 gap-4 bg-slate-50 p-4 rounded-xl border border-slate-200">
                  <div className="flex flex-col items-center justify-center border-l border-slate-200">
                      <span className="text-3xl font-bold text-amber-600">{processedData.stats.waiting}</span>
                      <span className="text-xs text-slate-500 font-medium uppercase tracking-wider mt-1">×‘×”××ª× ×”</span>
                  </div>
                  <div className="flex flex-col items-center justify-center border-l border-slate-200">
                      <span className="text-3xl font-bold text-green-600">{processedData.stats.done}</span>
                      <span className="text-xs text-slate-500 font-medium uppercase tracking-wider mt-1">×‘×•×¦×¢×•</span>
                  </div>
                  <div className="flex flex-col items-center justify-center">
                      <span className="text-3xl font-bold text-slate-400">{processedData.stats.irrelevant}</span>
                      <span className="text-xs text-slate-500 font-medium uppercase tracking-wider mt-1">×œ× ×¨×œ×•×•× ×˜×™</span>
                  </div>
              </div>
        
              {/* ×¨×©×™××ª ×”×”×–×× ×•×ª */}
              <div className="space-y-16">
                {Object.keys(processedData.grouped).length > 0 ? (
                    Object.entries(processedData.grouped).map(([hotelName, hotelStatuses]) => (
                      <section key={hotelName} className="animate-in fade-in slide-in-from-bottom-2 duration-500">
        
                        {/* ×›×•×ª×¨×ª ×”××œ×•×Ÿ */}
                        <div className="flex items-center gap-3 mb-6">
                            <div className="p-2 bg-slate-100 rounded-lg text-slate-700">
                                <Hotel className="h-6 w-6" />
                            </div>
                            <h2 className="text-2xl font-bold text-slate-800">{hotelName}</h2>
                        </div>
        
                        {/* ×¨×©×™××ª ×¡×˜×˜×•×¡×™× */}
                        <div className="space-y-8">
                            {statusDisplayOrder.map(statusKey => {
                                const ordersInStatus = hotelStatuses[statusKey];
                                if (!ordersInStatus || ordersInStatus.length === 0) return null;
        
                                return (
                                    <div key={statusKey}>
                                        {/* ×›×•×ª×¨×ª ×¡×˜×˜×•×¡ */}
                                        <h3 className="text-sm font-bold text-slate-400 mb-4 flex items-center gap-2 uppercase tracking-wide">
                                            {statusKey === '×‘×”××ª× ×”' && <Clock size={14} className="text-amber-500"/>}
                                            {statusKey === '×‘×•×¦×¢' && <CheckCircle2 size={14} className="text-green-500"/>}
                                            {statusKey === '×œ× ×¨×œ×•×•× ×˜×™' && <XCircle size={14} className="text-slate-400"/>}
                                            {statusKey} ({ordersInStatus.length})
                                        </h3>
        
                                        {/* ×’×¨×™×“ ×”×›×¨×˜×™×¡×™×•×ª */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {ordersInStatus.map((order) => (
                                                <OrderCard
                                                    key={order._id}
                                                    order={order}
                                                    onDelete={handleDelete}
                                                    onStatusChange={handleStatusChange}
                                                />
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                      </section>
                    ))
                ) : (
                  <div className="text-center p-16 bg-slate-50 rounded-2xl border border-dashed border-slate-300">
                    <p className="text-slate-500 text-lg font-medium">×”×˜×¨××™× ×œ ×©×œ×š ×¨×™×§ ×›×¨×’×¢.</p>
                    <Button asChild variant="link" className="mt-2 text-blue-600">
                      <Link to="/new-order">×¦×•×¨ ××ª ×”×”×–×× ×” ×”×¨××©×•× ×” ×©×œ×š</Link>
                    </Button>
                  </div>
                )}
              </div>
            </div>
          );
        }
        
        // --- ×¨×›×™×‘ ×”×›×¨×˜×™×¡×™×™×” (Card) ---
        const OrderCard = ({ order, onDelete, onStatusChange }) => {
        
            const roomsCount = order.rooms?.length || 0;
            const totalPeople = order.rooms?.reduce((sum, r) => sum + (r.adults || 0) + (r.teens || 0) + (r.children || 0) + (r.babies || 0), 0) || 0;
            const isIrrelevant = order.status === '×œ× ×¨×œ×•×•× ×˜×™';
        
            // ×¦×‘×¢×™ ×¨×§×¢ ×¢×“×™× ×™× ×œ×›×¤×ª×•×¨ ×”×¡×˜×˜×•×¡ ×‘×œ×‘×“
            const statusStyles = {
                '×‘×”××ª× ×”': 'bg-amber-100 text-amber-800 border-amber-200 hover:bg-amber-200',
                '×‘×•×¦×¢': 'bg-green-100 text-green-800 border-green-200 hover:bg-green-200',
                '×œ× ×¨×œ×•×•× ×˜×™': 'bg-slate-100 text-slate-600 border-slate-200 hover:bg-slate-200',
            };
        
            return (
                <Card
                    // âœ¨ ×›××Ÿ ×”×”×’×“×¨×” ×”××“×•×™×§×ª ×œ×¢×™×§×•×œ×™×: ×œ××¢×œ×” XL, ×œ××˜×” SM (×›××¢×˜ ××¨×•×‘×¢)
                    className={`
                        bg-white border border-slate-200 shadow-sm hover:border-slate-300 hover:shadow-md transition-all duration-200 flex flex-col h-full
                        rounded-t-xl rounded-b-sm
                        ${isIrrelevant ? 'opacity-60 grayscale' : ''}
                    `}
                >
                    {/* ×›×•×ª×¨×ª ×”×›×¨×˜×™×¡: ×¨×§×¢ ××¤×•×¨ ×¢×“×™×Ÿ ×××•×“ ×œ×”×¤×¨×“×” */}
                    <div className="p-4 pb-3 border-b border-slate-100 bg-slate-50/50 rounded-t-xl">
                        <div className="flex justify-between items-start">
                            <div>
                                <span className="font-mono font-bold text-slate-500 text-sm block tracking-wider">#{order.orderNumber}</span>
                                <span className="text-[11px] text-slate-400 flex items-center gap-1 mt-1">
                                    <Calendar size={10} />
                                    {format(new Date(order.createdAt), 'dd/MM/yy')}
                                </span>
                            </div>
                            <div className="flex gap-1 -mt-1 -ml-1">
                                <Button variant="ghost" size="icon" className="h-7 w-7 text-slate-400 hover:text-blue-600" asChild title="×¢×¨×•×š">
                                    <Link to={`/edit-order/${order._id}`}><Edit size={14} /></Link>
                                </Button>
                                <Button variant="ghost" size="icon" className="h-7 w-7 text-slate-400 hover:text-red-600" onClick={() => onDelete(order._id)} title="××—×§">
                                    <Trash2 size={14} />
                                </Button>
                            </div>
                        </div>
                    </div>
        
                    {/* ×’×•×£ ×”×›×¨×˜×™×¡: ×œ×‘×Ÿ × ×§×™ */}
                    <CardContent className="p-4 flex-1 space-y-3 bg-white">
                        {/* ×©× ×œ×§×•×— */}
                        <div>
                            <div className="flex items-center gap-2 text-slate-800 font-bold text-base">
                                <User size={16} className="text-slate-400" />
                                <span className="truncate">{order.customerName}</span>
                            </div>
                            {order.customerPhone && (
                                <a
                                    href={`https://wa.me/972${order.customerPhone.replace(/\D/g, '').replace(/^0/, '')}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="flex items-center gap-1 text-sm text-slate-500 hover:text-green-600 mt-1 w-fit transition-colors ml-6"
                                >
                                    <Phone size={12} />
                                    <span dir="ltr">{order.customerPhone}</span>
                                </a>
                            )}
                        </div>
        
                        {/* ×¤×™×¨×•×˜ ×—×“×¨×™× ×•×× ×©×™× - × ×§×™ ×•×œ×œ× ×¨×§×¢ */}
                        <div className="flex items-center gap-3 text-sm text-slate-600 pt-1 border-t border-dashed border-slate-100 mt-2">
                            <div className="flex items-center gap-1.5 mt-2">
                                <Hotel size={14} className="text-slate-400"/>
                                <span className="font-medium">{roomsCount} ×—×“×¨×™×</span>
                            </div>
                            <span className="text-slate-300 mt-2">|</span>
                            <div className="flex items-center gap-1.5 mt-2">
                                <Users size={14} className="text-slate-400"/>
                                <span className="font-medium">{totalPeople} ××•×¨×—×™×</span>
                            </div>
                        </div>
                    </CardContent>
        
                    {/* ×ª×—×ª×™×ª: ×¨×§×¢ ×œ×‘×Ÿ, ××¡×’×¨×ª ×¢×œ×™×•× ×” ×¢×“×™× ×” */}
                    <CardFooter className="p-3 px-4 border-t border-slate-100 bg-white rounded-b-sm flex justify-between items-center">
                        <div className="text-slate-900 font-bold text-lg">
                            {order.total_price.toLocaleString()} â‚ª
                        </div>
        
                        <div className="flex items-center gap-3">
                            {/* ×›×¤×ª×•×¨ ×”×¦×¦×” */}
                            <Button variant="ghost" size="icon" className="h-8 w-8 text-slate-400 hover:text-amber-600 hover:bg-amber-50 rounded-full" asChild title="×”×¦×’ ×”×¦×¢×”">
                                <Link to={`/quote/${order._id}`} target="_blank">
                                    <Eye size={18} />
                                </Link>
                            </Button>
        
                            {/* ×¡×˜×˜×•×¡ Dropdown ×‘×¢×™×¦×•×‘ Badge */}
                            <div className="min-w-[100px]">
                                <Select
                                    value={order.status}
                                    onValueChange={(val) => onStatusChange(order._id, val)}
                                >
                                    <SelectTrigger
                                        className={`h-8 text-xs font-bold border-0 shadow-none ring-0 focus:ring-0 px-3 rounded-full transition-colors ${statusStyles[order.status] || 'bg-slate-100'}`}
                                    >
                                        <SelectValue />
                                    </SelectTrigger>
                                    <SelectContent>
                                        <SelectItem value="×‘×”××ª× ×”">×‘×”××ª× ×”</SelectItem>
                                        <SelectItem value="×‘×•×¦×¢">×‘×•×¦×¢</SelectItem>
                                        <SelectItem value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</SelectItem>
                                    </SelectContent>
                                </Select>
                            </div>
                        </div>
                    </CardFooter>
                </Card>
            );
        };
      ğŸ“„ PricingLogicPage.jsx
        import React from 'react';
        import {
          Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from "@/components/ui/Card";
        import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/Table";
        import { Calculator, Users, Phone, ArrowRight, Plus, Baby, User as UserIcon } from "lucide-react";
        
        // ×¨×›×™×‘ ×¢×–×¨ ×¤× ×™××™ ×œ×”×¦×’×ª ×“×•×’××”
        const ExampleCard = ({ title, setup, logic, result }) => (
          <Card className="shadow-sm">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-lg">
                {title}
              </CardTitle>
              <CardDescription>{setup}</CardDescription>
            </CardHeader>
            <CardContent className="space-y-2 text-sm">
              <p className="font-medium text-gray-700">××”×œ×š ×”×—×™×©×•×‘:</p>
              {logic}
            </CardContent>
            <CardFooter className="bg-gray-50 dark:bg-slate-800 p-4 rounded-b-xl">
              <p className="text-lg font-bold text-blue-600 dark:text-blue-400">
                ×ª×•×¦××”: {result}
              </p>
            </CardFooter>
          </Card>
        );
        
        // ×”×“×£ ×”×¨××©×™
        export default function PricingLogicPage() {
          return (
            <div className="container mx-auto p-4 sm:p-6 lg:p-8 space-y-8 max-w-5xl">
              <header className="space-y-2">
                <h1 className="text-3xl md:text-4xl font-bold text-gray-900 flex items-center gap-3">
                  <Calculator className="h-8 w-8 text-primary" />
                  ×œ×•×’×™×§×ª ×—×™×©×•×‘ ××—×™×¨×™ ×—×“×¨×™×
                </h1>
                <p className="mt-2 text-lg text-gray-600">
                  ××“×¨×™×š ×–×” ××¡×‘×™×¨ ×œ×¡×•×›× ×™ ×”××›×™×¨×•×ª ×›×™×¦×“ ×”××¢×¨×›×ª ××—×©×‘×ª ××—×™×¨ ×œ×—×“×¨.
                </p>
              </header>
        
              {/* ×©×œ×‘ 1: ×¡×•×’×™ ×”××•×¨×—×™× */}
              <Card>
                <CardHeader>
                  <CardTitle>×©×œ×‘ 1: ××™ × ×—×©×‘ ×‘×ª×•×š ×”×—×“×¨?</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <p>×‘×›×œ ×—×“×¨ ×× ×—× ×• ×¡×•×¤×¨×™× ××¨×‘×¢×” ×¡×•×’×™ ××•×¨×—×™×:</p>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div className="p-4 bg-gray-50 rounded-lg">
                      <Users className="mx-auto h-6 w-6 text-gray-700" />
                      <p className="font-semibold mt-1">××‘×•×’×¨×™×</p>
                    </div>
                    <div className="p-4 bg-gray-50 rounded-lg">
                      <UserIcon className="mx-auto h-6 w-6 text-gray-700" />
                      <p className="font-semibold mt-1">× ×¢×¨×™×</p>
                    </div>
                    <div className="p-4 bg-gray-50 rounded-lg">
                      <UserIcon className="mx-auto h-6 w-6 text-gray-500" />
                      <p className="font-semibold mt-1">×™×œ×“×™×</p>
                    </div>
                    <div className="p-4 bg-gray-50 rounded-lg">
                      <Baby className="mx-auto h-6 w-6 text-gray-700" />
                      <p className="font-semibold mt-1">×ª×™× ×•×§×•×ª</p>
                    </div>
                  </div>
                  <p className="text-lg font-semibold text-red-600 bg-red-50 p-3 rounded-md">
                    â— ×ª×™× ×•×§×•×ª ×ª××™×“ ××—×•×©×‘×™× ×‘× ×¤×¨×“, ×‘×ª×•×¨ ×ª×•×¡×¤×ª ×§×‘×•×¢×”, ×•×œ× "×ª×•×¤×¡×™× ××§×•×" ×‘×–×•×’ ××• ×‘×—×“×¨ ×™×—×™×“.
                  </p>
                </CardContent>
              </Card>
        
              {/* ×©×œ×‘ 2: ×›×œ×œ×™ ×”×—×™×©×•×‘ (×”×’×¨×¡×” ×”××ª×•×§× ×ª) */}
              <Card>
                <CardHeader>
                  <CardTitle>×©×œ×‘ 2: ××™×š × ×§×‘×¢ ×”××—×™×¨ ×œ×¤×™ ××¡×¤×¨ ×”××•×¨×—×™×?</CardTitle>
                  <CardDescription>
                    ×”×—×™×©×•×‘ ××ª×‘×¦×¢ ×œ×¤×™ ×”×§×‘×•×¦×” ×”×¢×™×§×¨×™×ª (××‘×•×’×¨×™×, × ×¢×¨×™×, ×™×œ×“×™×), ×•××– ××•×¡×™×¤×™× ×ª×™× ×•×§×•×ª.
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <h4 className="text-lg font-semibold">×. ×—×“×¨ ×¢× ××•×¨×— ××—×“ (××‘×•×’×¨ / × ×¢×¨ / ×™×œ×“)</h4>
                  <p>×‘×¨×’×¢ ×©×™×© ××“× ××—×“ ×‘×œ×‘×“ ×‘×—×“×¨ (×œ× ××©× ×” ×× ×”×•× ××‘×•×’×¨, × ×¢×¨ ××• ×™×œ×“):</p>
                  <p className="font-bold text-gray-800 p-3 bg-gray-100 rounded-md">
                    ×”××—×™×¨ = "×—×“×¨ ×™×—×™×“" ×œ×¤×™ ×”××—×™×¨×•×Ÿ.
                  </p>
        
                  {/* --- ×”×—×œ×§ ×©×©×•× ×” ×•×”×•×“×’×© --- */}
                  <h4 className="text-lg font-semibold mt-4">×‘. ×—×“×¨ ×¢× ×©× ×™ ××•×¨×—×™× ××• ×™×•×ª×¨ (×œ× ×›×•×œ×œ ×ª×™× ×•×§×•×ª)</h4>
                  <p>×‘×¨×’×¢ ×©×™×© ×œ×¤×—×•×ª ×©× ×™×™× ××ª×•×š: ××‘×•×’×¨×™× / × ×¢×¨×™× / ×™×œ×“×™× â€“ × ×›× ×¡ ×›×œ×œ ××•×¨×›×‘:</p>
                  <ul className="list-disc list-inside space-y-2 rtl pr-4">
                    <li>
                      ×§×•×“× ×›×œ, ×”××¢×¨×›×ª **×××™×™× ×ª** ××ª ×”××•×¨×—×™× ××”"×™×§×¨" ×œ"×–×•×œ" (×”×¡×“×¨ ×”×•×: ××‘×•×’×¨ â‡ × ×¢×¨ â‡ ×™×œ×“).
                    </li>
                    <li>
                      ×”××—×™×¨ ×ª××™×“ ××ª×—×™×œ ×-**"×–×•×’ ×‘×—×“×¨"**. ××—×™×¨ ×–×” "××›×¡×”" ××ª ×©× ×™ ×”××•×¨×—×™× ×”×™×§×¨×™× ×‘×™×•×ª×¨ ×‘×—×“×¨.
                    </li>
                    <li>
                      ×›×œ ××•×¨×— × ×•×¡×£ (×”×—×œ ××”×©×œ×™×©×™ ×‘×¨×©×™××” ×”×××•×™× ×ª) ××©×œ× ×ª×•×¡×¤×ª ×œ×¤×™ ×¡×•×’×•:
                      <ul className="list-circle list-inside space-y-1 rtl pr-6 mt-1">
                        <li>×›×œ <strong>××‘×•×’×¨ ××• × ×¢×¨</strong> × ×•×¡×£ â‡ ××—×™×¨ "× ×¢×¨/××‘×•×’×¨ × ×•×¡×£".</li>
                        <li>×›×œ <strong>×™×œ×“</strong> × ×•×¡×£ â‡ ××—×™×¨ "×™×œ×“ × ×•×¡×£".</li>
                      </ul>
                    </li>
                  </ul>
                  {/* --- ×¡×•×£ ×”×—×œ×§ ×©×©×•× ×” --- */}
        
                  <h4 className="text-lg font-semibold mt-4">×’. ×ª×™× ×•×§×•×ª â€“ ××™×š ×”× ××—×•×©×‘×™×?</h4>
                  <p>×ª×™× ×•×§×•×ª ×œ× × ×›× ×¡×™× ×œ×¡×¤×™×¨×” ×©×œ ×™×—×™×“/×–×•×’/×ª×•×¡×¤×•×ª. ×‘×›×œ ×—×“×¨:</p>
                  <p className="font-bold text-gray-800 p-3 bg-gray-100 rounded-md">
                    ×œ×›×œ ×ª×™× ×•×§ ××•×¡×™×¤×™× ×ª×•×¡×¤×ª ××—×™×¨ ×§×‘×•×¢×” ×œ×¤×™ ×”×©×•×¨×” "×ª×™× ×•×§" ×‘××—×™×¨×•×Ÿ.
                  </p>
                </CardContent>
              </Card>
        
              {/* ×“×•×’×××•×ª (×¢× ×”×“×•×’××” ×”×—×“×©×”) */}
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-gray-900 text-center">×“×•×’×××•×ª</h2>
        
                <Card className="bg-blue-50 border-blue-200">
                  <CardHeader>
                    <CardTitle>××—×™×¨×•×Ÿ ×œ×“×•×’××”</CardTitle>
                    <CardDescription>×”××¡×¤×¨×™× ×›××Ÿ ×”× ×“×•×’××” ×‘×œ×‘×“ ×›×“×™ ×œ×”×¡×‘×™×¨ ××ª ×”×¢×™×§×¨×•×Ÿ.</CardDescription>
                  </CardHeader>
                  <CardContent>
                    <Table className="bg-white rounded-lg">
                      <TableHeader>
                        <TableRow>
                          <TableHead className="text-right">×¡×•×’</TableHead>
                          <TableHead className="text-right">××—×™×¨</TableHead>
                        </TableRow>
                      </TableHeader>
                      <TableBody>
                        <TableRow><TableCell className="font-medium">×—×“×¨ ×™×—×™×“</TableCell><TableCell>1,750 â‚ª</TableCell></TableRow>
                        <TableRow><TableCell className="font-medium">×–×•×’ ×‘×—×“×¨</TableCell><TableCell>2,190 â‚ª</TableCell></TableRow>
                        <TableRow><TableCell className="font-medium">× ×¢×¨/××‘×•×’×¨ × ×•×¡×£</TableCell><TableCell>870 â‚ª</TableCell></TableRow>
                        <TableRow><TableCell className="font-medium">×™×œ×“ × ×•×¡×£</TableCell><TableCell>650 â‚ª</TableCell></TableRow>
                        <TableRow><TableCell className="font-medium">×ª×™× ×•×§</TableCell><TableCell>100 â‚ª</TableCell></TableRow>
                      </TableBody>
                    </Table>
                  </CardContent>
                </Card>
        
                <div className="grid md:grid-cols-2 gap-6">
        
                  <ExampleCard
                    title="×“×•×’××” 1: ×™×œ×“ ×œ×‘×“ ×‘×—×“×¨"
                    setup="0 ××‘×•×’×¨×™×, 0 × ×¢×¨×™×, 1 ×™×œ×“, 0 ×ª×™× ×•×§×•×ª"
                    logic={<p>â† ×™×© ××“× ××—×“ ×‘×—×“×¨ â† ××—×™×¨ <strong>"×—×“×¨ ×™×—×™×“"</strong>.</p>}
                    result="1,750 â‚ª"
                  />
        
                  <ExampleCard
                    title="×“×•×’××” 2: ××‘×•×’×¨ ×•×™×œ×“ ×‘×—×“×¨"
                    setup="1 ××‘×•×’×¨, 0 × ×¢×¨×™×, 1 ×™×œ×“, 0 ×ª×™× ×•×§×•×ª"
                    logic={<p>â† ×™×© ×©× ×™ ×× ×©×™× ×‘×—×“×¨ â† ××—×™×¨ <strong>"×–×•×’ ×‘×—×“×¨"</strong>.</p>}
                    result="2,190 â‚ª"
                  />
        
                  <ExampleCard
                    title="×“×•×’××” 3: ×©× ×™ ××‘×•×’×¨×™× ×•×™×œ×“"
                    setup="2 ××‘×•×’×¨×™×, 0 × ×¢×¨×™×, 1 ×™×œ×“, 0 ×ª×™× ×•×§×•×ª"
                    logic={
                      <ul className="list-disc list-inside rtl pr-4">
                        <li>××™×•×Ÿ ×”××•×¨×—×™×: `[××‘×•×’×¨, ××‘×•×’×¨, ×™×œ×“]`</li>
                        <li>×‘×¡×™×¡ (2 ×”×™×§×¨×™×): `××‘×•×’×¨, ××‘×•×’×¨` â† <strong>"×–×•×’ ×‘×—×“×¨"</strong> = 2,190 â‚ª</li>
                        <li>×ª×•×¡×¤×ª: `×™×œ×“` â† <strong>"×™×œ×“ × ×•×¡×£"</strong> = 650 â‚ª</li>
                      </ul>
                    }
                    result="2,840 â‚ª (2,190 + 650)"
                  />
        
                  {/* --- âœ¨ ×“×•×’××” ×—×“×©×” ×©××¡×‘×™×¨×” ××ª ×”××™×•×Ÿ âœ¨ --- */}
                  <ExampleCard
                    title="×“×•×’××” 4: × ×¢×¨ ×•-2 ×™×œ×“×™× (×›×œ×œ ×”××™×˜×•×‘)"
                    setup="0 ××‘×•×’×¨×™×, 1 × ×¢×¨, 2 ×™×œ×“×™×, 0 ×ª×™× ×•×§×•×ª"
                    logic={
                      <ul className="list-disc list-inside rtl pr-4">
                        <li>××™×•×Ÿ ×”××•×¨×—×™× ××”×™×§×¨ ×œ×–×•×œ: `[× ×¢×¨, ×™×œ×“, ×™×œ×“]`</li>
                        <li>×‘×¡×™×¡ (2 ×”×™×§×¨×™×): `× ×¢×¨, ×™×œ×“` â† <strong>"×–×•×’ ×‘×—×“×¨"</strong> = 2,190 â‚ª</li>
                        <li>×ª×•×¡×¤×ª: `×™×œ×“` (×”×©× ×™) â† <strong>"×™×œ×“ × ×•×¡×£"</strong> = 650 â‚ª</li>
                        <li className="text-xs text-gray-500 pt-1">(×–×” ×–×•×œ ×™×•×ª×¨ ×××©×¨ 2,190 + 870)</li>
                      </ul>
                    }
                    result="2,840 â‚ª (2,190 + 650)"
                  />
        
                  <ExampleCard
                    title="×“×•×’××” 5: ×©× ×™ ××‘×•×’×¨×™×, × ×¢×¨, ×™×œ×“ ×•×ª×™× ×•×§"
                    setup="2 ××‘×•×’×¨×™×, 1 × ×¢×¨, 1 ×™×œ×“, 1 ×ª×™× ×•×§"
                    logic={
                      <ul className="list-disc list-inside rtl pr-4">
                        <li>××™×•×Ÿ ×”××•×¨×—×™×: `[××‘×•×’×¨, ××‘×•×’×¨, × ×¢×¨, ×™×œ×“]`</li>
                        <li>×‘×¡×™×¡ (2 ×”×™×§×¨×™×): `××‘×•×’×¨, ××‘×•×’×¨` â† <strong>"×–×•×’ ×‘×—×“×¨"</strong> = 2,190 â‚ª</li>
                        <li>×ª×•×¡×¤×•×ª (××¢×‘×¨ ×œ×–×•×’):
                          <ul className="list-circle list-inside space-y-1 rtl pr-6 mt-1">
                            <li>`× ×¢×¨` â† <strong>"× ×¢×¨/××‘×•×’×¨ × ×•×¡×£"</strong> = 870 â‚ª</li>
                            <li>`×™×œ×“` â† <strong>"×™×œ×“ × ×•×¡×£"</strong> = 650 â‚ª</li>
                          </ul>
                        </li>
                        <li>×ª×™× ×•×§×•×ª (×ª××™×“ ×‘× ×¤×¨×“):
                          <ul className="list-circle list-inside space-y-1 rtl pr-6 mt-1">
                            <li>`×ª×™× ×•×§` â† <strong>"×ª×™× ×•×§"</strong> = 100 â‚ª</li>
                          </ul>
                        </li>
                      </ul>
                    }
                    result="3,810 â‚ª (2,190 + 870 + 650 + 100)"
                  />
        
                  <ExampleCard
                    title="×“×•×’××” 6: ××§×¨×” ×§×¦×” (×¨×§ ×ª×™× ×•×§×•×ª)"
                    setup="0 ××‘×•×’×¨×™×, 0 × ×¢×¨×™×, 0 ×™×œ×“×™×, 2 ×ª×™× ×•×§×•×ª"
                    logic={
                      <ul className="list-disc list-inside rtl pr-4">
                        <li>×”×§×‘×•×¦×” ×”×¢×™×§×¨×™×ª ×¨×™×§×” (0 ××•×¨×—×™×).</li>
                        <li>â† ×œ× ××—×•×©×‘ "×—×“×¨ ×™×—×™×“" ××• "×–×•×’".</li>
                        <li>â† ××—×•×©×‘ ×¨×§ ×œ×¤×™ <strong>"×ª×™× ×•×§"</strong>: 2 * 100 â‚ª</li>
                      </ul>
                    }
                    result="200 â‚ª"
                  />
                </div>
              </div>
        
              {/* ×—×™×‘×•×¨ ××—×™×¨×•× ×™× */}
              <Card>
                <CardHeader>
                  <CardTitle>×©×œ×‘ 3: ×—×™×©×•×‘ ×›××” ××—×™×¨×•× ×™× ×‘×™×—×“</CardTitle>
                  <CardDescription>
                    ×”××¢×¨×›×ª ×××¤×©×¨×ª ×œ×‘×—×•×¨ ×›××” ××—×™×¨×•× ×™× ×œ××•×ª×• ×—×“×¨ (×œ××©×œ: ×œ×™× ×” + ××•×›×œ).
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <p>××™×š ×–×” ×¢×•×‘×“?</p>
                  <ol className="list-decimal list-inside space-y-2 rtl pr-4">
                    <li>×”××¢×¨×›×ª ××—×©×‘×ª ××ª ××—×™×¨ ×”×—×“×¨ **×‘× ×¤×¨×“** ×œ×›×œ ××—×™×¨×•×Ÿ, ×œ×¤×™ ××•×ª× ×›×œ×œ×™× ×©×¨××™× ×• ×œ××¢×œ×”.</li>
                    <li>××—×¨ ×›×š ×”×™× **××—×‘×¨×ª** ××ª ×›×œ ×”×ª×•×¦××•×ª ×œ××—×™×¨ ××—×“ ×¡×•×¤×™.</li>
                  </ol>
                  <div className="flex flex-col md:flex-row items-center justify-center gap-4 text-center p-4 bg-gray-50 rounded-lg">
                    <div className="p-3 bg-white rounded shadow-sm">
                      <p className="text-sm text-gray-500">×—×™×©×•×‘ ××—×™×¨×•×Ÿ "×œ×™× ×”"</p>
                      <p className="text-xl font-bold">1,000 â‚ª</p>
                    </div>
                    <Plus className="h-5 w-5 text-gray-500" />
                    <div className="p-3 bg-white rounded shadow-sm">
                      <p className="text-sm text-gray-500">×—×™×©×•×‘ ××—×™×¨×•×Ÿ "××¨×•×—×•×ª"</p>
                      <p className="text-xl font-bold">400 â‚ª</p>
                    </div>
                    <Plus className="h-5 w-5 text-gray-500" />
                    <div className="p-3 bg-white rounded shadow-sm">
                      <p className="text-sm text-gray-500">×—×™×©×•×‘ "××˜×¨×§×¦×™×•×ª"</p>
                      <p className="text-xl font-bold">200 â‚ª</p>
                    </div>
                    <ArrowRight className="h-5 w-5 text-gray-500 hidden md:block" />
                    <div className="p-4 bg-blue-100 rounded shadow-sm md:ml-4">
                      <p className="text-sm text-blue-700">××—×™×¨ ×¡×•×¤×™ ×œ×—×“×¨</p>
                      <p className="text-2xl font-bold text-blue-700">1,600 â‚ª</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
        
              {/* ×¡×™×›×•× ×œ×œ×§×•×— */}
              <Card className="border-primary">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Phone className="h-6 w-6 text-primary" />
                    ××™×š ×œ×”×¡×‘×™×¨ ×œ×œ×§×•×— ×‘×˜×œ×¤×•×Ÿ ×‘×§×¦×¨×”?
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-2 text-lg">
                  <p>××¤×©×¨ ×œ×ª×ª ×œ×”× "× ×•×¡×—×”" ×¤×©×•×˜×” ×œ×”×¡×‘×¨:</p>
                  <ul className="list-disc list-inside space-y-2 rtl pr-4 text-gray-700">
                    <li>×§×•×“× ×›×œ ×¨×•××™× ×›××” ×× ×©×™× ×‘×—×“×¨ (×œ× ×›×•×œ×œ ×ª×™× ×•×§×•×ª).</li>
                    <li>×× ×™×© <strong>××—×“</strong> â‡ ×”×•× ××©×œ× ××—×™×¨ <strong>"×—×“×¨ ×™×—×™×“"</strong>.</li>
                    <li>×× ×™×© <strong>×©× ×™×™× ×•××¢×œ×”</strong> â‡ ×”××—×™×¨ ××ª×—×™×œ ×<strong>"×–×•×’ ×‘×—×“×¨"</strong> (×¢×‘×•×¨ ×©× ×™ ×”×™×§×¨×™× ×‘×™×•×ª×¨), ×•×›×œ ××—×“ ××¢×‘×¨ ×œ×–×•×’ ××•×¡×™×£ ×ª×•×¡×¤×ª ×œ×¤×™ ×”×’×™×œ.</li>
                    <li><strong>×ª×™× ×•×§×•×ª</strong> â€“ ×”× ×ª××™×“ ×ª×•×¡×¤×ª ×§×˜× ×” ×•× ×¤×¨×“×ª, ×•×œ× ×ª×•×¤×¡×™× ××§×•× ×©×œ ××‘×•×’×¨/×™×œ×“.</li>
                  </ul>
                </CardContent>
              </Card>
            </div>
          );
        }
      ğŸ“„ QuotePage.jsx
        // client/src/pages/QuotePage.jsx
        
        import React, { useRef, useState, useMemo } from 'react';
        import { useParams, Link } from 'react-router-dom';
        import { useQuery } from '@tanstack/react-query';
        import api from '@/utils/api.js';
        import { format } from 'date-fns';
        import { Button } from '@/components/ui/Button.jsx';
        import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/Dialog";
        import { Input } from "@/components/ui/Input";
        import { Label } from "@/components/ui/Label";
        // âœ¨ ×”×•×¡×¤× ×• ××ª Printer ×œ×¨×©×™××ª ×”××™×™×§×•× ×™×
        import { ArrowRight, Download, Send, User, LoaderCircle, Mail, Calendar, Zap, Printer } from 'lucide-react';
        import { formatPhoneForWhatsApp } from '@/utils/phone.js';
        import html2canvas from 'html2canvas';
        import jsPDF from 'jspdf';
        import toast from 'react-hot-toast';
        
        const API_BASE = import.meta.env.VITE_API_BASE_URL || 'http://localhost:4000';
        const SERVER_ROOT = API_BASE.replace(/\/api$/, '');
        const LOGO_URL = `${SERVER_ROOT}/uploads/company-logo.png?t=${Date.now()}`;
        
        const printStyles = `
          @media print {
            @page { size: A4; margin: 0; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background-color: white; }
            .no-print { display: none !important; }
            .quote-page { box-shadow: none !important; margin: 0 !important; page-break-after: always; }
          }
        `;
        
        const fetchOrder = async (orderId) => (await api.get(`/orders/public/${orderId}`)).data;
        
        const stripHtml = (html) => {
          if (!html) return '';
          return html
            .replace(/<br\s*\/?>/gi, '\n')
            .replace(/<\/p>/gi, '\n')
            .replace(/<[^>]+>/g, '')
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&')
            .replace(/\n+/g, '\n')
            .trim();
        };
        
        export default function QuotePage() {
          const { orderId } = useParams();
          const pagesContainerRef = useRef(null);
          const [isDownloading, setIsDownloading] = useState(false);
          const [isEmailDialogOpen, setIsEmailDialogOpen] = useState(false);
          const [targetEmail, setTargetEmail] = useState('');
          const [isSendingEmail, setIsSendingEmail] = useState(false);
        
          const { data: order, isLoading, isError } = useQuery({
            queryKey: ['publicOrder', orderId],
            queryFn: () => fetchOrder(orderId),
            enabled: !!orderId,
          });
        
          const whatsappNumber = order?.customerPhone ? formatPhoneForWhatsApp(order.customerPhone) : null;
          const hotel = order?.hotel || {};
          const brandColor = hotel?.brandColor || '#b45309';
        
          // --- ×œ×•×’×™×§×ª ×—×œ×•×§×ª ×¢××•×“×™× ---
          const pages = useMemo(() => {
            if (!order) return [];
        
            // 1. × ×¨××•×œ ×—×“×¨×™× + ××ª×Ÿ ××¡×¤×¨ ×¡×™×“×•×¨×™ ×§×‘×•×¢
            const roomItems = (order.rooms || []).map((room, idx) => ({
                _type: 'room',
                _id: `room-${idx}`,
                serialNumber: idx + 1,
                name: room.roomType || '×—×“×¨ ×¨×’×™×œ',
                description: room.price_list_names?.join(' + '),
                roomNote: room.notes,
                details: room,
                price: room.price
            }));
        
            // 2. × ×¨××•×œ ×ª×•×¡×¤×•×ª + ×”××©×š ××¡×¤×•×¨ ×¡×™×“×•×¨×™
            const startExtraIndex = roomItems.length + 1;
            const extraItems = (order.extras || []).map((extra, idx) => ({
                _type: 'extra',
                _id: `extra-${idx}`,
                serialNumber: startExtraIndex + idx,
                name: extra.extraType,
                description: '×ª×•×¡×¤×ª ×œ×”×–×× ×”',
                details: extra,
                price: extra.price * extra.quantity
            }));
        
            // 3. ××™×—×•×“ ×œ×¨×©×™××” ××—×ª (×›×•×œ×œ ×›×•×ª×¨×ª ×œ×œ× ××¡×¤×¨)
            let allContent = [...roomItems];
            if (extraItems.length > 0) {
                allContent.push({ _type: 'header', name: '×ª×•×¡×¤×•×ª ×•×©×“×¨×•×’×™×' });
                allContent = [...allContent, ...extraItems];
            }
        
            // --- ×”×’×“×¨×•×ª ×¢××•×“×™× ---
            const ITEMS_PER_FIRST_PAGE = 4;
            const ITEMS_PER_MIDDLE_PAGE = 7;
            const ITEMS_PER_LAST_PAGE = 7;
        
            const resultPages = [];
            if (allContent.length === 0) {
               resultPages.push({ items: [], isFirst: true, isLast: true, pageIndex: 0 });
               return resultPages;
            }
        
            // --- ×¢××•×“ ×¨××©×•×Ÿ ---
            const firstPageItems = allContent.slice(0, ITEMS_PER_FIRST_PAGE);
            let remainingItems = allContent.slice(ITEMS_PER_FIRST_PAGE);
        
            resultPages.push({
                items: firstPageItems,
                isFirst: true,
                isLast: remainingItems.length === 0,
                pageIndex: 0
            });
        
            let pIndex = 1;
        
            // --- ×¢××•×“×™ ×”××©×š ---
            while (remainingItems.length > 0) {
                if (remainingItems.length <= ITEMS_PER_MIDDLE_PAGE) {
                    // ×× × ×©××¨ ×§×¦×ª, × ×‘×“×•×§ ×× ×–×” ×—×•×¨×’ ××”×¢××•×“ ×”××—×¨×•×Ÿ
                    if (remainingItems.length > ITEMS_PER_LAST_PAGE) {
                        // ×¦×¨×™×š ×œ×¤×¦×œ: ×¢××•×“ ×××¦×¢ + ×¢××•×“ ××—×¨×•×Ÿ
                        const takeCount = remainingItems.length - ITEMS_PER_LAST_PAGE;
                        const chunk = remainingItems.slice(0, takeCount);
                        remainingItems = remainingItems.slice(takeCount);
        
                        resultPages.push({
                            items: chunk,
                            isFirst: false,
                            isLast: false,
                            pageIndex: pIndex
                        });
                        pIndex++;
                    } else {
                        // × ×›× ×¡ ×”×›×œ ×‘×¢××•×“ ×”××—×¨×•×Ÿ
                        resultPages.push({
                            items: remainingItems,
                            isFirst: false,
                            isLast: true,
                            pageIndex: pIndex
                        });
                        remainingItems = [];
                    }
                }
                else {
                    // ×¢××•×“ ×××¦×¢ ××œ×
                    const chunk = remainingItems.slice(0, ITEMS_PER_MIDDLE_PAGE);
                    remainingItems = remainingItems.slice(ITEMS_PER_MIDDLE_PAGE);
        
                    resultPages.push({
                        items: chunk,
                        isFirst: false,
                        isLast: false,
                        pageIndex: pIndex
                    });
                    pIndex++;
                }
            }
        
            return resultPages;
          }, [order]);
        
          const cleanNotes = useMemo(() => stripHtml(order?.notes), [order?.notes]);
        
          const generatePDF = async (action = 'download') => {
            if (!pagesContainerRef.current) return;
            try {
              const pdf = new jsPDF('p', 'mm', 'a4');
              const pdfWidth = pdf.internal.pageSize.getWidth();
        
              const pageElements = pagesContainerRef.current.querySelectorAll('.quote-page');
              for (let i = 0; i < pageElements.length; i++) {
                const pageEl = pageElements[i];
                const canvas = await html2canvas(pageEl, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                });
                const imgData = canvas.toDataURL('image/jpeg', 0.9);
                const imgHeight = canvas.height * (pdfWidth / canvas.width);
                if (i > 0) pdf.addPage();
                pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, imgHeight);
              }
        
              if (action === 'download') {
                const cleanName = (order.customerName || '×œ×§×•×—').replace(/[^a-zA-Z0-9\u0590-\u05FF]/g, '_');
                pdf.save(`×”×¦×¢×ª_××—×™×¨_${cleanName}_${order.orderNumber}.pdf`);
                return true;
              } else if (action === 'blob') {
                return pdf.output('blob');
              }
        
            } catch (err) {
              console.error("PDF Gen Error:", err);
              toast.error('×©×’×™××” ×‘×™×¦×™×¨×ª ×”×§×•×‘×¥');
              return null;
            }
          };
        
          const handleDownloadPDF = async () => {
            if (isDownloading) return;
            setIsDownloading(true);
            const toastId = toast.loading('××›×™×Ÿ ×§×•×‘×¥ PDF...');
            await generatePDF('download');
            toast.success('×”×§×•×‘×¥ ×™×¨×“!', { id: toastId });
            setIsDownloading(false);
          };
        
          const handleSendEmail = async () => {
            if (!targetEmail) return toast.error('× × ×œ×”×–×™×Ÿ ×›×ª×•×‘×ª ××™××™×™×œ');
            setIsSendingEmail(true);
            const toastId = toast.loading('××™×™×¦×¨ ×•×©×•×œ×— ××™×™×œ...');
        
            try {
              const pdfBlob = await generatePDF('blob');
              if (!pdfBlob) throw new Error('Failed to generate PDF');
        
              const formData = new FormData();
              formData.append('pdf', pdfBlob, 'quote.pdf');
              formData.append('email', targetEmail);
              formData.append('customerName', order.customerName);
              await api.post(`/orders/${order._id}/email`, formData, {
                headers: { 'Content-Type': 'multipart/form-data' }
              });
              toast.success(`×”××™×™×œ × ×©×œ×— ×‘×”×¦×œ×—×” ×œ-${targetEmail}`, { id: toastId });
              setIsEmailDialogOpen(false);
              setTargetEmail('');
            } catch (error) {
              console.error(error);
              toast.error('×©×’×™××” ×‘×©×œ×™×—×ª ×”××™×™×œ', { id: toastId });
            } finally {
              setIsSendingEmail(false);
            }
          };
        
          const handleQuickSend = async () => {
              if (!order.customerEmail) {
                   return toast.error('×œ× ×§×™×™× ×›×ª×•×‘×ª ××™×™×œ ×‘×”×–×× ×” ×–×•. ×”×©×ª××© ×‘×©×œ×™×—×” ×™×“× ×™×ª.');
              }
        
              if (!window.confirm(`×œ×©×œ×•×— ××ª ×”×”×¦×¢×” ×›×¢×ª ×œ-${order.customerEmail}?`)) return;
              setIsSendingEmail(true);
              const toastId = toast.loading(`××™×™×¦×¨ ×•×©×•×œ×— ××™×™×œ ×œ-${order.customerEmail}...`);
        
              try {
                   const pdfBlob = await generatePDF('blob');
                   if (!pdfBlob) throw new Error('Failed to generate PDF');
        
                   const formData = new FormData();
                   const fileName = `quote_${order.orderNumber}.pdf`;
                   formData.append('pdf', pdfBlob, fileName);
                   formData.append('email', order.customerEmail);
                   formData.append('customerName', order.customerName);
        
                   await api.post(`/orders/${order._id}/email`, formData, {
                       headers: { 'Content-Type': 'multipart/form-data' }
                   });
                   toast.success('×”××™×™×œ × ×©×œ×— ×œ×œ×§×•×— ×‘×”×¦×œ×—×”!', { id: toastId });
              } catch (error) {
                   console.error(error);
                   toast.error('×©×’×™××” ×‘×©×œ×™×—×ª ×”××™×™×œ ×”××•×˜×•××˜×™', { id: toastId });
              } finally {
                   setIsSendingEmail(false);
              }
          };
        
          if (isLoading) return <div className="h-screen flex items-center justify-center"><LoaderCircle className="animate-spin h-10 w-10 text-amber-600"/></div>;
          if (isError) return <div className="text-center p-10">×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×–×× ×”.</div>;
        
          return (
            <div className="min-h-screen bg-gray-200 pb-10 font-sans">
              <style>{printStyles}</style>
        
              <header className="bg-white border-b px-6 py-4 flex justify-between items-center sticky top-0 z-50 shadow-sm no-print">
                  <div className="flex items-center gap-4">
                      <Button variant="ghost" asChild>
                        <Link to="/orders-history"><ArrowRight className="ml-2 h-4 w-4"/> ×—×–×•×¨</Link>
                      </Button>
                    <span className="font-bold text-gray-700 hidden sm:inline">×ª×¦×•×’×” ××§×“×™××” ({pages.length} ×“×¤×™×)</span>
                  </div>
        
                <div className="flex gap-2">
                    {/* âœ¨ ×›×¤×ª×•×¨ ×”×”×“×¤×¡×” ×”×—×“×© âœ¨ */}
                    <Button
                        onClick={() => window.print()}
                        variant="outline"
                        className="gap-2 border-slate-300 text-slate-700 hover:bg-slate-100 shadow-sm"
                        title="×”×“×¤×¡ ×‘××“×¤×¡×ª"
                    >
                        <Printer className="h-4 w-4"/>
                        <span className="hidden sm:inline">×”×“×¤×¡</span>
                    </Button>
        
                    <Button onClick={handleDownloadPDF} disabled={isDownloading} className="bg-amber-600 hover:bg-amber-700 text-white gap-2 shadow-sm">
                        {isDownloading ? <LoaderCircle className="animate-spin h-4 w-4"/> : <Download className="h-4 w-4"/>}
                        <span className="hidden sm:inline">×”×•×¨×“ PDF</span>
                    </Button>
        
                    {order.customerEmail && (
                       <Button
                         onClick={handleQuickSend}
                         disabled={isSendingEmail || isDownloading}
                         className="gap-2 bg-blue-600 hover:bg-blue-700 text-white shadow-sm"
                         title={`×©×œ×— ××•×˜×•××˜×™×ª ×œ-${order.customerEmail}`}
                       >
                         {isSendingEmail ? <LoaderCircle className="animate-spin h-4 w-4"/> : <Zap className="h-4 w-4" />}
                         <span className="hidden sm:inline">×©×œ×— ×œ×œ×§×•×—</span>
                       </Button>
                    )}
        
                    <Button onClick={() => setIsEmailDialogOpen(true)} variant="outline" className="gap-2 border-blue-600 text-blue-700 hover:bg-blue-50">
                        <Mail className="h-4 w-4" />
                        <span className="hidden sm:inline">×©×œ×— ×œ××™×™×œ ××—×¨</span>
                    </Button>
        
                    {whatsappNumber && (
                         <Button onClick={() => { handleDownloadPDF().then(() => {
                           setTimeout(() => {
                                const text = `×”×™×™ ${order.customerName}, ××¦×•×¨×¤×ª ×”×¦×¢×ª ×”××—×™×¨ ×©×œ×š.`;
                                window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(text)}`, '_blank');
                           }, 1500);
                      }) }} variant="outline" className="gap-2 border-green-600 text-green-700 hover:bg-green-50">
                            <Send className="h-4 w-4" />
                            <span className="hidden sm:inline">×•×•××˜×¡××¤</span>
                         </Button>
                    )}
                </div>
              </header>
        
              <Dialog open={isEmailDialogOpen} onOpenChange={setIsEmailDialogOpen}>
                  <DialogContent className="sm:max-w-[425px]">
                  <DialogHeader><DialogTitle>×©×œ×™×—×ª ×”×¦×¢×” ×‘××™×™×œ (×™×“× ×™)</DialogTitle></DialogHeader>
                  <div className="grid gap-4 py-4">
                     <div className="grid grid-cols-4 items-center gap-4">
                      <Label htmlFor="email" className="text-right">××™×™×œ</Label>
                      <Input id="email" type="email" placeholder="×›×ª×•×‘×ª ××™×™×œ ×”×œ×§×•×—" value={targetEmail} onChange={(e) => setTargetEmail(e.target.value)} className="col-span-3" />
                    </div>
                  </div>
                  <DialogFooter>
                      <Button type="submit" onClick={handleSendEmail} disabled={isSendingEmail}>
                        {isSendingEmail && <LoaderCircle className="ml-2 h-4 w-4 animate-spin" />} ×©×œ×— ×”×¦×¢×”
                    </Button>
                  </DialogFooter>
                </DialogContent>
              </Dialog>
        
              <div className="flex flex-col items-center py-8 gap-8" ref={pagesContainerRef}>
                {pages.map((pageData, index) => (
                    <div
                        key={index}
                        className="quote-page bg-white shadow-2xl w-[210mm] min-h-[297mm] relative text-slate-800 mx-auto flex flex-col"
                        style={{ padding: '15mm' }}
                   >
                        {/* === ×›×•×ª×¨×ª ×•×¤×¨×˜×™× (×¨×§ ×‘×¢××•×“ ×”×¨××©×•×Ÿ) === */}
                        {pageData.isFirst ? (
                            <>
                                <div className="flex justify-between items-start border-b-2 border-gray-100 pb-8 mb-8">
                                   <div className="w-1/2">
                                        <h1 className="text-4xl font-extrabold text-slate-900 mb-2">×”×¦×¢×ª ××—×™×¨</h1>
                                        <p className="text-slate-500 text-sm">×ª××¨×™×š ×”×¤×§×”: {format(new Date(), 'dd/MM/yyyy')}</p>
                                        <p className="text-slate-500 text-sm">××¡×¤×¨ ×”×–×× ×”: <span className="font-mono font-bold text-slate-700">#{order.orderNumber}</span></p>
                                    </div>
                                    <div className="w-1/2 flex flex-col items-end text-left">
                                        <img src={LOGO_URL} alt="Logo" className="h-40 object-contain mb-3" crossOrigin="anonymous" onError={(e) => e.target.style.display = 'none'} />
                                        <div className="text-sm text-gray-500 space-y-1 text-right" dir="ltr">
                                            {hotel.address && <p>{hotel.address}</p>}
                                            {hotel.phone && <p>{hotel.phone}</p>}
                                        </div>
                                    </div>
                                </div>
        
                                <div className="bg-gray-50 rounded-xl p-6 mb-10 border border-gray-100">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2 border-b border-gray-200 pb-2">
                                        <User className="h-5 w-5 text-slate-400"/> ×¤×¨×˜×™ ×”××–××™×Ÿ
                                    </h3>
                                    <div className="grid grid-cols-2 gap-y-4 gap-x-8">
                                        <div><span className="text-xs text-gray-500 uppercase tracking-wider block">×©× ×œ×§×•×—</span><p className="text-lg font-medium">{order.customerName}</p></div>
                                        <div><span className="text-xs text-gray-500 uppercase tracking-wider block">×˜×œ×¤×•×Ÿ</span><p className="text-lg font-medium text-right" dir="ltr">{order.customerPhone}</p></div>
        
                                        {order.customerEmail && (
                                            <div><span className="text-xs text-gray-500 uppercase tracking-wider block">××™××™×™×œ</span><p className="text-base font-medium text-slate-700">{order.customerEmail}</p></div>
                                        )}
                                        {order.eventDate && (
                                            <div><span className="text-xs text-gray-500 uppercase tracking-wider block">×ª××¨×™×š ××™×¨×•×¢/×”×’×¢×”</span><p className="text-lg font-medium">{format(new Date(order.eventDate), 'dd/MM/yyyy')}</p></div>
                                        )}
        
                                        <div><span className="text-xs text-gray-500 uppercase tracking-wider block">××œ×•×Ÿ</span><p className="text-lg font-medium">{hotel.name}</p></div>
                                        <div><span className="text-xs text-gray-500 uppercase tracking-wider block">×œ×™×œ×•×ª</span><p className="text-lg font-medium">{order.numberOfNights || 1}</p></div>
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="border-b border-gray-100 pb-4 mb-6 flex justify-between items-center opacity-60">
                                <span className="text-sm font-bold">×”××©×š ×”×–×× ×” #{order.orderNumber}</span>
                                <span className="text-xs">×“×£ {index + 1} ××ª×•×š {pages.length}</span>
                            </div>
                        )}
        
        
                        {/* === ×˜×‘×œ×ª ×”×¤×™×¨×•×˜ === */}
                        <div className="flex-grow">
                            <h3 className="text-lg font-bold text-slate-800 mb-4">
                                 {pageData.isFirst ? '×¤×™×¨×•×˜ ×”×”×–×× ×”' : '×”××©×š ×¤×™×¨×•×˜'}
                            </h3>
                            <div className="border rounded-lg overflow-hidden">
                                <table className="w-full text-sm text-right">
                                   <thead className="bg-gray-100 text-gray-600">
                                        <tr>
                                            <th className="py-3 px-4 border-b font-semibold w-12 text-center">#</th>
                                            <th className="py-3 px-4 border-b font-semibold">×ª×™××•×¨</th>
                                            <th className="py-3 px-4 border-b font-semibold w-1/3">×”×¨×›×‘ / ×›××•×ª</th>
                                            <th className="py-3 px-4 border-b font-semibold text-left w-32">××—×™×¨</th>
                                       </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {pageData.items.map((item, idx) => {
                                            if (item._type === 'header') {
                                                return (
                                                    <tr key={`header-${idx}`} className="bg-slate-50">
                                                        <td colSpan="4" className="py-2 px-4 font-bold text-slate-700 text-sm border-y">
                                                            {item.name}
                                                        </td>
                                                    </tr>
                                                );
                                            }
        
                                            return (
                                                <tr key={idx}>
                                                    <td className="py-4 px-4 align-top text-gray-500 text-center">{item.serialNumber}</td>
        
                                                    <td className="py-4 px-4 align-top">
                                                         <p className="font-bold text-slate-800 text-base">{item.name}</p>
                                                        {item._type === 'room' && (
                                                            <>
                                                                <p className="text-xs text-gray-500 mt-1 bg-gray-100 inline-block px-2 py-0.5 rounded">
                                                                    {item.description}
                                                                </p>
                                                                {item.roomNote && (
                                                                    <p className="text-xs text-amber-700 mt-1 italic bg-amber-50 px-2 py-1 rounded border border-amber-100/50 inline-block mr-2">
                                                                        ×”×¢×¨×”: {item.roomNote}
                                                                    </p>
                                                                )}
                                                            </>
                                                        )}
                                                        {item._type === 'extra' && (
                                                            <p className="text-xs text-blue-600 mt-1">×ª×•×¡×¤×ª</p>
                                                        )}
                                                    </td>
        
                                                    <td className="py-4 px-4 align-top">
                                                        {item._type === 'room' ? (
                                                            <div className="flex flex-wrap gap-2 text-gray-700">
                                                                {item.details.adults > 0 && <span>{item.details.adults} ××‘×•×’×¨×™×</span>}
                                                                {item.details.teens > 0 && <span>â€¢ {item.details.teens} × ×¢×¨×™×</span>}
                                                                {item.details.children > 0 && <span>â€¢ {item.details.children} ×™×œ×“×™×</span>}
                                                                {item.details.babies > 0 && <span>â€¢ {item.details.babies} ×ª×™× ×•×§×•×ª</span>}
                                                            </div>
                                                        ) : (
                                                            <div className="text-gray-700 font-medium">
                                                                ×›××•×ª: {item.details.quantity}
                                                            </div>
                                                        )}
                                                    </td>
        
                                                    <td className="py-4 px-4 align-top text-left font-medium text-slate-900">
                                                        {item.price.toLocaleString()} â‚ª
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
        
                        {/* === ×¤×•×˜×¨ ×•×”×¢×¨×•×ª (×¨×§ ×‘×¢××•×“ ×”××—×¨×•×Ÿ) === */}
                        {pageData.isLast ? (
                            <div className="mt-auto">
                                {/* 1. ×§×•×“× ×”×”×¢×¨×•×ª */}
                                {order.notes && (
                                    <div className="mb-6 border-t border-dashed border-gray-300 pt-6">
                                        <h4 className="font-bold text-sm text-slate-800 mb-3 underline decoration-amber-400 decoration-2 underline-offset-4">×”×¢×¨×•×ª ×•×“×’×©×™× ×œ×”×–×× ×”:</h4>
                                        <div
                                            className="text-sm text-slate-700 leading-relaxed prose prose-sm max-w-none bg-yellow-50/50 p-4 rounded-lg border border-yellow-100/50"
                                            style={{ whiteSpace: 'pre-wrap' }}
                                        >
                                            {cleanNotes}
                                        </div>
                                    </div>
                                )}
        
                                {/* 2. ××—×¨ ×›×š ×”××—×™×¨ ×•×”×¡×™×›×•× */}
                                <div className="border-t-2 border-slate-100 pt-6 mb-8">
                                    {order.discountPercent > 0 && (
                                        <div className="flex justify-end mb-2 text-sm">
                                            <div className="w-1/2 flex justify-between items-center text-red-600">
                                                <span className="font-medium">×”× ×—×” ({order.discountPercent}%):</span>
                                                <span className="font-bold">
                                                    - {((order.total_price / (1 - order.discountPercent/100)) * (order.discountPercent/100)).toLocaleString(undefined, {maximumFractionDigits: 0})} â‚ª
                                                </span>
                                            </div>
                                        </div>
                                    )}
        
                                    <div className="flex justify-between items-center">
                                        <div className="text-sm text-gray-500 w-1/2">
                                            <p>* ×”×¦×¢×” ×–×• ×ª×§×¤×” ×‘×›×¤×•×£ ×œ×–××™× ×•×ª ×”×—×“×¨×™× ×‘××œ×•×Ÿ.</p>
                                            <p>* ×˜.×œ.×—.</p>
                                        </div>
                                        <div className="text-left">
                                            <p className="text-gray-500 text-sm mb-1">×¡×”"×› ×œ×ª×©×œ×•×:</p>
                                            <p className="text-4xl font-extrabold" style={{ color: brandColor }}>{order.total_price.toLocaleString()} â‚ª</p>
                                        </div>
                                    </div>
                                </div>
        
                                <div className="text-center mt-8">
                                    <div className="w-24 h-1 bg-gray-200 mx-auto mb-4 rounded-full"></div>
                                    <p className="text-gray-400 text-xs">×”×•×¤×§ ×‘×××¦×¢×•×ª ××¢×¨×›×ª × ×™×”×•×œ ×”×–×× ×•×ª â€¢ {hotel.name}</p>
                                </div>
                            </div>
                        ) : (
                            <div className="mt-auto text-center pt-8">
                                <p className="text-gray-300 text-xs">×”××©×š ×‘×¢××•×“ ×”×‘×...</p>
                            </div>
                        )}
        
                   </div>
                ))}
              </div>
        
            </div>
          );
        }
      ğŸ“ admin/
        ğŸ“„ AdminDashboardPage.jsx
          import React, { useMemo } from 'react';
          import { useQuery } from '@tanstack/react-query';
          import { Link } from 'react-router-dom';
          import api from '@/utils/api.js';
          import { useAuthStore } from '@/stores/authStore.js';
          // ×’×¨×¤×™×
          import {
            AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
            PieChart, Pie, Cell, Legend
          } from 'recharts';
          import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/Card.jsx';
          import {
            Shield, ListOrdered, Users, Hotel, Mail, FileText, Tag,
            Megaphone, Network, TrendingUp, CheckCircle
          } from 'lucide-react';
          import LogoUploader from '@/components/admin/LogoUploader.jsx';
          
          const fetchDashboardStats = async () => (await api.get('/admin/dashboard/stats')).data;
          // ×¦×‘×¢ ×”×–×”×‘ ×”××•×ª×’×™
          const BRAND_GOLD = '#bfa15f';
          const PIE_COLORS = ['#bfa15f', '#d4c085', '#a2884f', '#e8debd', '#8f763b'];
          
          export default function AdminDashboardPage() {
            const { user } = useAuthStore();
            const { data, isLoading } = useQuery({
              queryKey: ['adminDashboardStats'],
              queryFn: fetchDashboardStats,
            });
          
            const leadsTrendData = useMemo(() => {
              if (!data?.leadsPerDay) return [];
              return data.leadsPerDay.map(item => ({
                date: item._id,
                count: item.count
              }));
            }, [data]);
          
            const rejectionData = useMemo(() => {
              return data?.rejectionReasons?.map(r => ({ name: r._id || '××—×¨', value: r.count })) || [];
            }, [data]);
          
            const { completedOrdersCount, completedRevenue } = useMemo(() => {
              if (!data?.salesByPerson) return { completedOrdersCount: 0, completedRevenue: 0 };
              return data.salesByPerson.reduce((acc, curr) => ({
                  completedOrdersCount: acc.completedOrdersCount + curr.dealsCount,
                  completedRevenue: acc.completedRevenue + curr.totalRevenue
              }), { completedOrdersCount: 0, completedRevenue: 0 });
            }, [data]);
          
            const closedLeadsCount = useMemo(() => {
                if (!data?.leadStats) return 0;
                return data.leadStats
                  .filter(s => ['closed', 'converted', 'placed', '×‘×•×¦×¢'].includes(s._id))
                  .reduce((acc, curr) => acc + curr.count, 0);
            }, [data]);
          
            const stats = [
              {
                  title: '×”×›× ×¡×•×ª (30 ×™×•×)',
                  value: completedRevenue.toLocaleString() + ' â‚ª',
                  icon: 'ğŸ’°'
              },
              {
                  title: '×”×–×× ×•×ª ×©×‘×•×¦×¢×•',
                  value: completedOrdersCount,
                  icon: <FileText size={22} style={{ color: BRAND_GOLD }} />
              },
              {
                  title: '×œ×™×“×™× ×—×“×©×™×',
                  value: data?.totalLeads || 0,
                  icon: <Mail size={22} style={{ color: BRAND_GOLD }} />
              },
              {
                  title: '×œ×™×“×™× ×©× ×¡×’×¨×•',
                  value: closedLeadsCount,
                  icon: <CheckCircle size={22} style={{ color: BRAND_GOLD }} />
              },
            ];
          
            // ×¨×©×™××ª ×”×§×™×©×•×¨×™× ×”××¢×•×“×›× ×ª - ×œ×œ× ×ª×—×–×•×§×”
            const adminLinks = [
              // × ×™×”×•×œ ×”×–×× ×•×ª ×•×œ×™×“×™×
              { to: '/admin/orders', title: '× ×™×”×•×œ ×”×–×× ×•×ª', description: '×¦×¤×™×™×” ×•×¢×“×›×•×Ÿ ×›×œ ×”×”×–×× ×•×ª.', icon: Shield },
              { to: '/leads', title: '× ×™×”×•×œ ×œ×™×“×™×', description: '×˜×™×¤×•×œ ×‘×¤× ×™×•×ª ×•×©×™× ×•×™ ×¡×˜×˜×•×¡×™×.', icon: Mail },
          
              // ×”×’×“×¨×•×ª ××¢×¨×›×ª
              { to: '/manage-pricelists', title: '××—×™×¨×•× ×™×', description: '× ×™×”×•×œ ××—×™×¨×•× ×™×.', icon: ListOrdered },
              { to: '/admin/users', title: '××©×ª××©×™×', description: '× ×™×”×•×œ ××©×ª××©×™×.', icon: Users },
              { to: '/admin/hotels', title: '××œ×•× ×•×ª', description: '× ×™×”×•×œ ×‘×ª×™ ××œ×•×Ÿ.', icon: Hotel },
              { to: '/admin/extras', title: '×ª×•×¡×¤×•×ª', description: '× ×™×”×•×œ ×¡×•×’×™ ×ª×•×¡×¤×•×ª.', icon: Tag },
          
              // ×©×™×•×•×§ ×•× ×™×”×•×œ
              { to: '/admin/announcements', title: '×”×•×“×¢×•×ª', description: '×”×•×“×¢×•×ª ××¢×¨×›×ª.', icon: Megaphone },
              { to: '/admin/referrers', title: '× ×™×”×•×œ ××•×©×™×•×ª', description: '× ×™×”×•×œ ×©××•×ª ××¤× ×™× ×•× ×¨××•×œ × ×ª×•× ×™×.', icon: Network },
            ];
          
            if (isLoading) return <div className="p-10 text-center text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>;
          
            return (
              <div className="container mx-auto p-6 space-y-8 min-h-screen bg-slate-50">
          
                <header>
                  <h1 className="text-2xl font-bold text-gray-800">×“×©×‘×•×¨×“ ×× ×”×œ×™×</h1>
                  <p className="text-gray-500 text-sm mt-1">×¡×§×™×¨×” ×›×œ×œ×™×ª ×•×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</p>
                </header>
          
                {/* ×›×¨×˜×™×¡×™ ×¡×˜×˜×™×¡×˜×™×§×” */}
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                  {stats.map((stat, i) => (
                    <Card key={i} className="bg-white border border-slate-200 shadow-sm hover:shadow-md transition-all">
                      <CardContent className="p-5">
                        <div className="flex justify-between items-start">
                          <div>
                              <p className="text-sm font-medium text-gray-500">{stat.title}</p>
                              <h3 className="text-2xl font-bold text-gray-800 mt-1">{stat.value}</h3>
                          </div>
                          <div className="p-2 bg-slate-50 rounded-full border border-slate-100">
                              {stat.icon}
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
          
                {/* ××–×•×¨ ×”×’×¨×¤×™× */}
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
                    {/* ×’×¨×£ ×œ×™×“×™× */}
                    <Card className="lg:col-span-2 bg-white border border-slate-200 shadow-sm">
                        <CardHeader className="pb-2 border-b border-slate-50">
                          <div className="flex items-center gap-2">
                            <TrendingUp size={18} style={{ color: BRAND_GOLD }}/>
                            <CardTitle className="text-base text-gray-800">××’××ª ×œ×™×“×™× (30 ×™×•×)</CardTitle>
                          </div>
                        </CardHeader>
                        <CardContent className="h-[300px] pt-4">
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={leadsTrendData} margin={{ top: 5, right: 0, left: 0, bottom: 0 }}>
                                    <defs>
                                        <linearGradient id="colorLeads" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor={BRAND_GOLD} stopOpacity={0.3}/>
                                            <stop offset="95%" stopColor={BRAND_GOLD} stopOpacity={0}/>
                                        </linearGradient>
                                    </defs>
                                    <XAxis
                                      dataKey="date"
                                      tick={{fontSize: 11, fill: '#9ca3af'}}
                                      tickFormatter={(str) => str.substring(5)}
                                      axisLine={false}
                                      tickLine={false}
                                    />
                                    <YAxis
                                      allowDecimals={false}
                                      tick={{fontSize: 11, fill: '#9ca3af'}}
                                      axisLine={false}
                                      tickLine={false}
                                    />
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f3f4f6" />
                                    <Tooltip
                                      contentStyle={{ backgroundColor: '#fff', borderRadius: '6px', border: '1px solid #e5e7eb', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}
                                      labelStyle={{ color: '#6b7280', fontSize: '12px' }}
                                    />
                                    <Area
                                      type="monotone"
                                      dataKey="count"
                                      name="×œ×™×“×™×"
                                      stroke={BRAND_GOLD}
                                      strokeWidth={2}
                                      fillOpacity={1}
                                      fill="url(#colorLeads)"
                                    />
                                </AreaChart>
                            </ResponsiveContainer>
                        </CardContent>
                    </Card>
          
                    {/* ×’×¨×£ ×¡×™×‘×•×ª ×“×—×™×™×” */}
                    <Card className="bg-white border border-slate-200 shadow-sm">
                        <CardHeader className="pb-2 border-b border-slate-50">
                            <CardTitle className="text-base text-gray-800">×¡×™×‘×•×ª ×œ×¡×˜×˜×•×¡ "×œ× ×¨×œ×•×•× ×˜×™"</CardTitle>
                        </CardHeader>
                        <CardContent className="h-[300px] pt-4">
                            {rejectionData.length > 0 ? (
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie
                                            data={rejectionData}
                                            cx="50%" cy="50%"
                                            innerRadius={55}
                                            outerRadius={80}
                                            paddingAngle={2}
                                            dataKey="value"
                                        >
                                            {rejectionData.map((entry, index) => (
                                              <Cell key={`cell-${index}`} fill={PIE_COLORS[index % PIE_COLORS.length]} stroke="none" />
                                            ))}
                                        </Pie>
                                        <Tooltip contentStyle={{borderRadius: '6px', border: '1px solid #e5e7eb', fontSize: '12px'}} />
                                        <Legend verticalAlign="bottom" height={36} iconType="circle" formatter={(value) => <span className="text-xs text-gray-600">{value}</span>}/>
                                    </PieChart>
                                </ResponsiveContainer>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-gray-400">
                                    <Shield size={32} className="mb-2 opacity-20"/>
                                    <p className="text-xs">××™×Ÿ × ×ª×•× ×™× ×”×—×•×“×©</p>
                                </div>
                            )}
                        </CardContent>
                    </Card>
                </div>
          
                <h2 className="text-lg font-semibold text-gray-700 pt-4">×¤×¢×•×œ×•×ª × ×™×”×•×œ</h2>
          
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                    {adminLinks.map(link => (
                        <Link key={link.to} to={link.to} className="group">
                            <Card className="h-full hover:border-[#bfa15f] transition-colors cursor-pointer border border-slate-200 shadow-sm bg-white">
                                <CardContent className="flex flex-col items-center justify-center p-6 text-center space-y-3">
                                    <div
                                        className="p-3 rounded-full transition-colors group-hover:bg-[#f9f7f0]"
                                        style={{ backgroundColor: '#fdfcf8', color: BRAND_GOLD }}
                                    >
                                        <link.icon size={24} />
                                    </div>
                                    <h3 className="font-bold text-gray-800">{link.title}</h3>
                                    <p className="text-xs text-gray-500">{link.description}</p>
                                </CardContent>
                            </Card>
                        </Link>
                    ))}
                </div>
          
                <div className="flex justify-center opacity-40 mt-8"><LogoUploader /></div>
              </div>
            );
          }
        ğŸ“„ AdminMaintenanceDashboard.jsx
          import React, { useMemo } from 'react';
          import { useQuery } from '@tanstack/react-query';
          import { Link } from 'react-router-dom';
          import api from '@/utils/api.js';
          import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
          import { Button } from '@/components/ui/Button.jsx';
          import {
              Paintbrush, Wrench, PlusCircle, CalendarDays, ListChecks,
              CheckCircle2, AlertTriangle, XCircle, ArrowRight, Activity, Hotel, BedDouble
          } from 'lucide-react';
          import {
              BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell
          } from 'recharts';
          
          const fetchAllRoomsStats = async () => {
              const { data } = await api.get('/rooms/all');
              const uniqueHotels = new Set(data.map(r => r.hotel?._id));
              return { rooms: data, hotelCount: uniqueHotels.size };
          };
          
          export default function AdminMaintenanceDashboard() {
              const { data, isLoading } = useQuery({
                  queryKey: ['adminMaintenanceStats'],
                  queryFn: fetchAllRoomsStats,
                  refetchInterval: 30000
              });
          
              const stats = useMemo(() => {
                  if (!data?.rooms) return { total: 0, clean: 0, dirty: 0, maintenance: 0, tasks: 0 };
          
                  const rooms = data.rooms;
                  return {
                      total: rooms.length,
                      clean: rooms.filter(r => r.status === 'clean').length,
                      dirty: rooms.filter(r => r.status === 'dirty').length,
                      maintenance: rooms.filter(r => r.status === 'maintenance').length,
                      tasks: rooms.reduce((acc, r) => acc + (r.tasks?.filter(t => !t.isCompleted).length || 0), 0)
                  };
              }, [data]);
          
              const chartData = [
                  { name: '× ×§×™×™×', value: stats.clean, color: '#22c55e' },
                  { name: '×××ª×™× ×™×', value: stats.dirty, color: '#ef4444' },
                  { name: '×ª×§×œ×•×ª', value: stats.maintenance, color: '#f59e0b' },
              ];
          
              // ×”×’×“×¨×ª ×›×¤×ª×•×¨×™ ×”× ×™×•×•×˜ ×©×œ ××¢×¨×›×ª ×”×ª×¤×¢×•×œ
              const managementLinks = [
                  {
                      title: "×¡×™×“×•×¨ ×¢×‘×•×“×” ×™×•××™",
                      desc: "×”×›× ×ª ×—×“×¨×™× ×œ××—×¨ (Stayover / Checkout)",
                      icon: CalendarDays,
                      to: "/admin/daily-plan",
                      color: "text-blue-600",
                      bg: "bg-blue-50"
                  },
                  {
                      title: "×ª××•× ×ª ××¦×‘ (Live)",
                      desc: "×¦×¤×™×™×” ×‘×œ×•×— ×”×—×“×¨×™× ×‘×–××Ÿ ×××ª",
                      icon: Activity,
                      to: "/admin/rooms-status",
                      color: "text-green-600",
                      bg: "bg-green-50"
                  },
                  {
                      title: "× ×™×”×•×œ × ×”×œ×™× (×¦'×§ ×œ×™×¡×˜)",
                      desc: "×”×’×“×¨×ª ×¨×©×™××•×ª × ×™×§×™×•×Ÿ ×œ×›×œ ××œ×•×Ÿ",
                      icon: ListChecks,
                      to: "/admin/hotels", // ××• × ×ª×™×‘ ×™×™×¢×•×“×™ ×× ×™×©
                      color: "text-purple-600",
                      bg: "bg-purple-50"
                  },
                  {
                      title: "×”×§××ª ×—×“×¨×™×",
                      desc: "×”×•×¡×¤×ª ×—×“×¨×™× ×•×˜×•×•×—×™× ×—×“×©×™×",
                      icon: BedDouble,
                      to: "/admin/rooms/create",
                      color: "text-slate-600",
                      bg: "bg-slate-100"
                  }
              ];
          
              if (isLoading) return <div className="p-10 text-center">×˜×•×¢×Ÿ × ×ª×•× ×™ ×ª×¤×¢×•×œ...</div>;
          
              return (
                  <div className="container mx-auto p-6 space-y-8 min-h-screen bg-slate-50">
          
                      <header className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                          <div>
                              <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-3">
                                  <Wrench className="text-amber-600" /> ××¢×¨×›×ª ×ª×¤×¢×•×œ ×•×—×“×¨×™×
                              </h1>
                              <p className="text-slate-500 mt-1">× ×™×”×•×œ ××¨×›×–×™: × ×™×§×™×•×Ÿ, ××—×–×§×”, ×¡×™×“×•×¨×™ ×¢×‘×•×“×” ×•×”×’×“×¨×•×ª ×—×“×¨×™×.</p>
                          </div>
                          <Button asChild className="gap-2 bg-slate-900 text-white hover:bg-slate-800">
                              <Link to="/maintenance">
                                  <Paintbrush size={16} /> ××¢×‘×¨ ×œ××¡×š ×¢×•×‘×“ ×©×˜×—
                              </Link>
                          </Button>
                      </header>
          
                      {/* ×©×•×¨×ª ×”×¡×˜×˜×™×¡×˜×™×§×” */}
                      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                          <Card className="border-l-4 border-l-blue-500 shadow-sm">
                              <CardContent className="p-6">
                                  <p className="text-sm font-medium text-slate-500">×¡×”"×› ×—×“×¨×™× ×‘××¢×¨×›×ª</p>
                                  <h3 className="text-3xl font-bold text-slate-800 mt-2">{stats.total}</h3>
                                  <p className="text-xs text-slate-400 mt-1">×¤×¨×•×¡×™× ×‘-{data?.hotelCount} ××œ×•× ×•×ª</p>
                              </CardContent>
                          </Card>
          
                          <Card className="border-l-4 border-l-green-500 shadow-sm bg-green-50/30">
                              <CardContent className="p-6 flex justify-between items-center">
                                  <div>
                                      <p className="text-sm font-medium text-green-700">× ×§×™×™× ×•××•×›× ×™×</p>
                                      <h3 className="text-3xl font-bold text-green-800 mt-2">{stats.clean}</h3>
                                  </div>
                                  <CheckCircle2 className="text-green-200 h-10 w-10" />
                              </CardContent>
                          </Card>
          
                          <Card className="border-l-4 border-l-red-500 shadow-sm bg-red-50/30">
                              <CardContent className="p-6 flex justify-between items-center">
                                  <div>
                                      <p className="text-sm font-medium text-red-700">×××ª×™× ×™× ×œ× ×™×§×™×•×Ÿ</p>
                                      <h3 className="text-3xl font-bold text-red-800 mt-2">{stats.dirty}</h3>
                                  </div>
                                  <XCircle className="text-red-200 h-10 w-10" />
                              </CardContent>
                          </Card>
          
                          <Card className="border-l-4 border-l-amber-500 shadow-sm bg-amber-50/30">
                              <CardContent className="p-6 flex justify-between items-center">
                                  <div>
                                      <p className="text-sm font-medium text-amber-700">×ª×§×œ×•×ª / ×‘×˜×™×¤×•×œ</p>
                                      <h3 className="text-3xl font-bold text-amber-800 mt-2">{stats.maintenance}</h3>
                                  </div>
                                  <AlertTriangle className="text-amber-200 h-10 w-10" />
                              </CardContent>
                          </Card>
                      </div>
          
                      {/* ××–×•×¨ ×”× ×™×”×•×œ ×•×”×’×¨×£ */}
                      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
                          {/* ×ª×¤×¨×™×˜ ×¤×¢×•×œ×•×ª ××”×™×¨×•×ª */}
                          <div className="space-y-4">
                              <h2 className="text-lg font-bold text-gray-700">× ×™×”×•×œ ×©×•×˜×£</h2>
                              <div className="grid grid-cols-1 gap-4">
                                  {managementLinks.map((link, idx) => (
                                      <Link key={idx} to={link.to}>
                                          <Card className="hover:shadow-md transition-all cursor-pointer border-slate-200 hover:border-slate-300">
                                              <CardContent className="p-4 flex items-center gap-4">
                                                  <div className={`p-3 rounded-xl ${link.bg} ${link.color}`}>
                                                      <link.icon size={24} />
                                                  </div>
                                                  <div className="flex-1">
                                                      <h3 className="font-bold text-slate-800">{link.title}</h3>
                                                      <p className="text-xs text-slate-500">{link.desc}</p>
                                                  </div>
                                                  <ArrowRight className="text-slate-300" size={18}/>
                                              </CardContent>
                                          </Card>
                                      </Link>
                                  ))}
                              </div>
          
                              {stats.tasks > 0 && (
                                  <div className="bg-amber-50 border border-amber-200 p-4 rounded-xl flex items-start gap-3 mt-6">
                                      <AlertTriangle className="text-amber-500 shrink-0 mt-1" />
                                      <div>
                                          <h4 className="font-bold text-amber-800">×©×™× ×œ×‘!</h4>
                                          <p className="text-sm text-amber-700 mt-1">
                                              ×™×©× ×Ÿ ×›×¨×’×¢ <strong>{stats.tasks}</strong> ××©×™××•×ª ×¤×ª×•×—×•×ª ×‘×›×œ×œ ×”×—×“×¨×™× ×”×“×•×¨×©×•×ª ×”×ª×™×™×—×¡×•×ª.
                                          </p>
                                      </div>
                                  </div>
                              )}
                          </div>
          
                          {/* ×’×¨×£ ×”×—×“×¨×™× */}
                          <Card className="lg:col-span-2 shadow-md flex flex-col">
                              <CardHeader>
                                  <CardTitle>×”×ª×¤×œ×’×•×ª ×¡×˜×˜×•×¡×™×</CardTitle>
                                  <CardDescription>×ª××•× ×ª ××¦×‘ ×’×¨×¤×™×ª ×©×œ ×›×œ×œ ×”××œ×•× ×•×ª</CardDescription>
                              </CardHeader>
                              <CardContent className="flex-1 min-h-[300px] flex items-center justify-center">
                                  <div style={{ width: '100%', height: '350px' }}>
                                      <ResponsiveContainer width="100%" height="100%">
                                          <BarChart data={chartData} layout="vertical" margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                                              <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                              <XAxis type="number" hide />
                                              <YAxis dataKey="name" type="category" width={80} tick={{fontSize: 14, fontWeight: 'bold'}} />
                                              <Tooltip
                                                  cursor={{fill: 'transparent'}}
                                                  contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'}}
                                              />
                                              <Bar dataKey="value" radius={[0, 4, 4, 0]} barSize={50}>
                                                  {chartData.map((entry, index) => (
                                                      <Cell key={`cell-${index}`} fill={entry.color} />
                                                  ))}
                                              </Bar>
                                          </BarChart>
                                      </ResponsiveContainer>
                                  </div>
                              </CardContent>
                          </Card>
                      </div>
                  </div>
              );
          }
        ğŸ“„ AffiliateReportsPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import toast from 'react-hot-toast';
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/Dialog";
          import { Users, Edit, ArrowRightLeft, Search, Trophy, CheckCircle2 } from 'lucide-react';
          
          const fetchStats = async () => (await api.get('/referrers/stats')).data;
          const upsertAlias = (data) => api.post('/referrers', data);
          
          export default function ManageReferrersPage() {
              const [isDialogOpen, setIsDialogOpen] = useState(false);
              const [editData, setEditData] = useState({ source: '', target: '' });
              const [searchTerm, setSearchTerm] = useState('');
              const queryClient = useQueryClient();
          
              const { data: referrers = [], isLoading } = useQuery({
                  queryKey: ['referrerStats'],
                  queryFn: fetchStats
              });
          
              const updateMutation = useMutation({
                  mutationFn: upsertAlias,
                  onSuccess: (res) => {
                      queryClient.invalidateQueries({ queryKey: ['referrerStats'] });
                      toast.success(res.data.message);
                      setIsDialogOpen(false);
                  },
                  onError: () => toast.error('×©×’×™××”')
              });
          
              const filteredList = referrers.filter(r => r.name.toLowerCase().includes(searchTerm.toLowerCase()));
          
              const handleEditClick = (referrer) => {
                  setEditData({ source: referrer.name, target: referrer.name });
                  setIsDialogOpen(true);
              };
          
              return (
                  <div className="container mx-auto p-6 space-y-8">
                      <header>
                          <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3">
                              <Users className="text-blue-600" /> ×“×•×— ×©×•×ª×¤×™× (× ×¡×ª×¨)
                          </h1>
                          <p className="text-gray-600 mt-1">
                              × ×ª×•× ×™× ×¤× ×™××™×™× ×œ×× ×”×œ ×‘×œ×‘×“. ×”××•×›×¨×™× ×¨×•××™× ××ª ×”×œ×™×“ ×›×¨×’×™×œ.
                          </p>
                      </header>
          
                      <Card className="shadow-md">
                          <CardHeader className="pb-3 border-b bg-gray-50/50">
                              <div className="flex justify-between items-center">
                                  <CardTitle>×˜×‘×œ×ª ×‘×™×¦×•×¢×™×</CardTitle>
                                  <div className="relative w-64">
                                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"/>
                                      <Input className="pl-10 bg-white" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder="×—×¤×©..." />
                                  </div>
                              </div>
                          </CardHeader>
                          <CardContent className="p-0">
                              <table className="min-w-full text-sm divide-y divide-gray-200">
                                  <thead className="bg-gray-50 text-gray-500 font-medium">
                                      <tr>
                                          <th className="px-6 py-3 text-right">×©× ×©×•×ª×£</th>
                                          <th className="px-6 py-3 text-right">×œ×™×“×™×</th>
                                          <th className="px-6 py-3 text-right">××›×™×¨×•×ª</th>
                                          <th className="px-6 py-3 text-left">×¤×¢×•×œ×•×ª</th>
                                      </tr>
                                  </thead>
                                  <tbody className="divide-y divide-gray-100 bg-white">
                                      {isLoading ? <tr><td colSpan="4" className="p-6 text-center">×˜×•×¢×Ÿ...</td></tr> :
                                       filteredList.length === 0 ? <tr><td colSpan="4" className="p-6 text-center text-gray-500">××™×Ÿ × ×ª×•× ×™×</td></tr> :
                                       filteredList.map((item, idx) => (
                                          <tr key={idx} className="hover:bg-blue-50/50 transition-colors group">
                                              <td className="px-6 py-4 font-bold text-gray-800 flex items-center gap-2">
                                                  {idx === 0 && <Trophy className="h-4 w-4 text-yellow-500" />}
                                                  {item.name}
                                              </td>
                                              <td className="px-6 py-4"><span className="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full font-bold">{item.count}</span></td>
                                              <td className="px-6 py-4">
                                                  <div className="flex items-center gap-2">
                                                      <span className={`px-2 py-0.5 rounded-full font-bold ${item.sales > 0 ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-400'}`}>
                                                          {item.sales}
                                                      </span>
                                                      {item.count > 0 && <span className="text-xs text-gray-400">({Math.round((item.sales/item.count)*100)}%)</span>}
                                                  </div>
                                              </td>
                                              <td className="px-6 py-4 text-left">
                                                  <Button variant="outline" size="sm" onClick={() => handleEditClick(item)} className="text-blue-600 border-blue-200 hover:bg-blue-50">
                                                      <Edit className="h-3.5 w-3.5 ml-1.5"/> ×¢×¨×•×š ×©×
                                                  </Button>
                                              </td>
                                          </tr>
                                      ))}
                                  </tbody>
                              </table>
                          </CardContent>
                      </Card>
          
                      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
                          <DialogContent>
                              <DialogHeader><DialogTitle>××™×–×•×’ ×©××•×ª</DialogTitle></DialogHeader>
                              <div className="py-4 flex items-center gap-2 justify-center">
                                  <span className="line-through text-red-500">{editData.source}</span>
                                  <ArrowRightLeft className="text-gray-400" />
                                  <Input value={editData.target} onChange={e => setEditData(p => ({...p, target: e.target.value}))} className="w-40 font-bold text-center" />
                              </div>
                              <DialogFooter><Button onClick={() => updateMutation.mutate({ alias: editData.source, officialName: editData.target })}>×©××•×¨ ×•×¢×“×›×Ÿ</Button></DialogFooter>
                          </DialogContent>
                      </Dialog>
                  </div>
              );
          }
        ğŸ“„ DailyPlanPage.jsx
          import React, { useState, useMemo } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import toast from 'react-hot-toast';
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card.jsx';
          import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/Tabs";
          import { CalendarDays, Save, RefreshCw, Hotel, ArrowLeft } from 'lucide-react';
          import { useNavigate } from 'react-router-dom';
          
          const fetchAllRooms = async () => (await api.get('/rooms/all')).data;
          const publishPlan = (plan) => api.post('/rooms/daily-plan', { plan });
          
          export default function DailyPlanPage() {
              const navigate = useNavigate();
              const queryClient = useQueryClient();
          
              // State ××§×•××™ ×œ× ×™×”×•×œ ×”×©×™× ×•×™×™× ×œ×¤× ×™ ×©××™×¨×”
              // ××‘× ×”: { [roomId]: { action: 'checkout'|'stayover'|'none', note: '' } }
              const [planDraft, setPlanDraft] = useState({});
              const { data: rooms = [], isLoading } = useQuery({
                  queryKey: ['allRoomsForPlan'],
                  queryFn: fetchAllRooms,
              });
              const publishMutation = useMutation({
                  mutationFn: publishPlan,
                  onSuccess: (res) => {
                      toast.success(res.data.message);
                      queryClient.invalidateQueries(['allRoomsForPlan']);
                       setPlanDraft({}); // ××™×¤×•×¡ ×”×˜×•×¤×¡ ××—×¨×™ ×©××™×¨×”
                  },
                  onError: () => toast.error('×©×’×™××” ×‘×”×¤×¦×ª ×”×¡×™×“×•×¨')
              });
              // ×§×™×‘×•×¥ ×œ×¤×™ ××œ×•× ×•×ª ×œ×˜×•×‘×ª Tabs
              const hotelsData = useMemo(() => {
                  const groups = {};
                  rooms.forEach(room => {
                      const hName = room.hotel?.name || '××—×¨';
                      if (!groups[hName]) groups[hName] = [];
                      groups[hName].push(room);
                  });
                  return groups;
              }, [rooms]);
              // ×¢×“×›×•×Ÿ ×”-State ×”××§×•××™
              const updateDraft = (roomId, field, value) => {
                  setPlanDraft(prev => ({
                      ...prev,
                      [roomId]: {
                           ...prev[roomId],
                          [field]: value
                      }
                  }));
              };
          
              const handlePublish = () => {
                  // ×”××¨×ª ×”××•×‘×™×™×§×˜ ×œ××¢×¨×š ×©×”×©×¨×ª ××¦×¤×” ×œ×•
                  const payload = Object.entries(planDraft).map(([roomId, data]) => ({
                      roomId,
                      action: data.action,
                       note: data.note
                  }));
                  if (payload.length === 0) return toast("×œ× ×‘×™×¦×¢×ª ×©×™× ×•×™×™×");
          
                  if (window.confirm(`×”×× ×œ×”×¤×™×¥ ×¡×™×“×•×¨ ×¢×‘×•×“×” ×œ-${payload.length} ×—×“×¨×™×? ×¤×¢×•×œ×” ×–×• ×ª××¤×¡ ××ª ×”×¦'×§ ×œ×™×¡×˜×™× ×©×œ×”×.`)) {
                      publishMutation.mutate(payload);
                  }
              };
              if (isLoading) return <div className="p-10 text-center">×˜×•×¢×Ÿ ×—×“×¨×™×...</div>;
          
              return (
                  <div className="container mx-auto p-4 sm:p-6 min-h-screen bg-slate-50 space-y-6">
                      {/* Header */}
                      <header className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                           <div>
                              <h1 className="text-2xl font-bold text-slate-900 flex items-center gap-2">
                                  <CalendarDays className="text-blue-600"/> ×¡×™×“×•×¨ ×¢×‘×•×“×” ×™×•××™
                               </h1>
                              <p className="text-slate-500 text-sm mt-1">×”×’×“×¨×ª ×¡×˜×˜×•×¡×™× ×•×”×•×¨××•×ª ××™×•×—×“×•×ª ×œ××—×¨.</p>
                          </div>
                           <div className="flex gap-2">
                              <Button variant="outline" onClick={() => navigate(-1)}><ArrowLeft className="ml-2 h-4 w-4"/> ×—×–×•×¨</Button>
                              <Button onClick={handlePublish} disabled={publishMutation.isPending} className="bg-blue-600 hover:bg-blue-700">
                                   {publishMutation.isPending ?
          <RefreshCw className="animate-spin ml-2"/> : <Save className="ml-2"/>}
                                  ×”×¤×¥ ×¡×™×“×•×¨ ×¢×‘×•×“×”
                              </Button>
                          </div>
                       </header>
          
                      {/* ×ª×•×›×Ÿ ×¨××©×™ */}
                      <Tabs defaultValue={Object.keys(hotelsData)[0]} className="w-full">
                           <TabsList className="bg-white p-1 border">
                              {Object.keys(hotelsData).map(hotelName => (
                                  <TabsTrigger key={hotelName} value={hotelName} className="data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700">
                                       <Hotel className="w-4 h-4 ml-2"/> {hotelName}
                                  </TabsTrigger>
                              ))}
                           </TabsList>
          
                          {Object.entries(hotelsData).map(([hotelName, hotelRooms]) => (
                              <TabsContent key={hotelName} value={hotelName}>
                                   <Card>
                                      <CardContent className="p-0">
                                          <div className="overflow-x-auto">
                                               <table className="w-full text-sm text-right">
                                                  <thead className="bg-slate-50 text-slate-600 border-b">
                                                       <tr>
                                                           <th className="p-4 w-24">×—×“×¨</th>
                                                          <th className="p-4 w-32">××¦×‘ × ×•×›×—×™</th>
                                                           <th className="p-4 w-48">×¤×¢×•×œ×” ×œ××—×¨</th>
                                                          <th className="p-4">×”×¢×¨×•×ª ××™×•×—×“×•×ª (×©×›×‘×” ×‘')</th>
                                                       </tr>
                                                   </thead>
                                                  <tbody className="divide-y divide-slate-100">
                                                       {hotelRooms.map(room => {
                                                          const draft = planDraft[room._id] || {};
                                                          const isModified = draft.action && draft.action !== 'none';
          
                                                          return (
                                                              <tr key={room._id} className={`hover:bg-blue-50/30 transition-colors ${isModified ? 'bg-blue-50/50' : ''}`}>
                                                                   <td className="p-4 font-bold text-lg">{room.roomNumber}</td>
          
                                                                   {/* ××¦×‘ × ×•×›×—×™ */}
                                                                  <td className="p-4">
                                                                       <span className={`px-2 py-1 rounded text-xs ${
                                                                           room.status === 'clean' ? 'bg-green-100 text-green-700' :
                                                                           room.status === 'maintenance' ? 'bg-red-100 text-red-700' :
                                                                           'bg-amber-100 text-amber-700'
                                                                          }`}>
                                                                           {room.status === 'clean' ? '× ×§×™' :
                                                                           room.status === 'maintenance' ? '×ª×§×•×œ' : '××œ×•×›×œ×š'}
                                                                      </span>
                                                                   </td>
          
                                                                   {/* ×‘×—×™×¨×ª ×¤×¢×•×œ×” */}
                                                                  <td className="p-4">
                                                                       <Select
                                                                           value={draft.action || 'none'}
                                                                          onValueChange={(val) => updateDraft(room._id, 'action', val)}
                                                                       >
                                                                           <SelectTrigger className={`h-9 ${isModified ? 'border-blue-500 ring-1 ring-blue-200' : ''}`}>
                                                                              <SelectValue placeholder="×‘×—×¨..." />
                                                                           </SelectTrigger>
                                                                           <SelectContent>
                                                                               <SelectItem value="none">-- ×œ×œ× ×©×™× ×•×™ --</SelectItem>
                                                                              <SelectItem value="checkout">×¢×–×™×‘×” (Checkout)</SelectItem>
                                                                               <SelectItem value="stayover">× ×©××¨ (Stayover)</SelectItem>
                                                                           </SelectContent>
                                                                       </Select>
                                                                  </td>
          
                                                                   {/* ×”×¢×¨×•×ª */}
                                                                   <td className="p-4">
                                                                      <Input
                                                                           placeholder="×œ××©×œ: ×œ×”×•×¡×™×£ ×œ×•×œ, ×‘×§×‘×•×§ ×™×™×Ÿ..."
                                                                           value={draft.note || ''}
                                                                          onChange={(e) => updateDraft(room._id, 'note', e.target.value)}
                                                                           className={draft.note ? "border-amber-400 bg-amber-50" : ""}
                                                                      />
                                                                   </td>
                                                                </tr>
                                                          );
                                                      })}
                                                  </tbody>
                                              </table>
                                           </div>
                                      </CardContent>
                                   </Card>
                              </TabsContent>
                          ))}
                      </Tabs>
                   </div>
              );
          }
        ğŸ“„ ManageAnnouncementsPage.jsx
          // client/src/pages/admin/ManageAnnouncementsPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import toast from 'react-hot-toast';
          import api from '@/utils/api.js';
          import { format } from 'date-fns';
          import ReactQuill from 'react-quill';
          import 'react-quill/dist/quill.snow.css'; // âœ¨ ×™×™×‘×•× ×”-CSS ×©×œ ×”×¢×•×¨×š
          
          // UI Components
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Label } from '@/components/ui/Label.jsx';
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from "@/components/ui/Dialog";
          import { Megaphone, Trash2, Send, Users, User, Calendar, Edit, PlusCircle } from 'lucide-react';
          
          // API Functions
          const fetchAnnouncements = async () => (await api.get('/announcements/all')).data;
          const createAnnouncement = (data) => api.post('/announcements', data);
          const updateAnnouncement = ({ id, ...data }) => api.put(`/announcements/${id}`, data); // âœ¨ ×¤×•× ×§×¦×™×™×ª ×”×¢×“×›×•×Ÿ
          const deleteAnnouncement = (id) => api.delete(`/announcements/${id}`);
          const fetchUsers = async () => (await api.get('/admin/users')).data;
          
          // --- ×”×’×“×¨×•×ª ×¡×¨×’×œ ×”×›×œ×™× ×©×œ ×”×¢×•×¨×š ---
          const modules = {
            toolbar: [
              [{ 'header': [1, 2, 3, false] }], // ×›×•×ª×¨×•×ª
              ['bold', 'italic', 'underline', 'strike'], // ×¢×™×¦×•×‘ ×‘×¡×™×¡×™
              [{ 'color': [] }, { 'background': [] }], // âœ¨ ×¦×‘×¢×™× ×•××¨×§×¨×™×
              [{ 'align': [] }], // âœ¨ ×™×™×©×•×¨ ×œ×™××™×Ÿ/×©×××œ/××¨×›×–
              [{ 'direction': 'rtl' }], // âœ¨ ×›×™×•×•× ×™×•×ª (×—×©×•×‘ ×œ×¢×‘×¨×™×ª)
              [{ 'list': 'ordered'}, { 'list': 'bullet' }],
              ['clean'] // × ×™×§×•×™ ×¢×™×¦×•×‘
            ],
          };
          
          const formats = [
            'header',
            'bold', 'italic', 'underline', 'strike',
            'color', 'background',
            'align', 'direction',
            'list', 'bullet'
          ];
          
          export default function ManageAnnouncementsPage() {
            const queryClient = useQueryClient();
          
            // State ×œ×“×™××œ×•×’ ×•×œ×˜×•×¤×¡
            const [isDialogOpen, setIsDialogOpen] = useState(false);
            const [editingId, setEditingId] = useState(null); // ×× null -> ×™×¦×™×¨×” ×—×“×©×”, ××—×¨×ª -> ×¢×¨×™×›×”
          
            // Form State
            const [title, setTitle] = useState('');
            const [content, setContent] = useState('');
            const [target, setTarget] = useState('all');
            const [targetUser, setTargetUser] = useState('');
            const [expiresAt, setExpiresAt] = useState('');
          
            // Queries
            const { data: announcements = [], isLoading } = useQuery({
              queryKey: ['allAnnouncements'],
              queryFn: fetchAnnouncements
            });
          
            const { data: users = [] } = useQuery({
              queryKey: ['users'],
              queryFn: fetchUsers,
              enabled: target === 'user'
            });
          
            // Mutations
            const commonMutationOptions = {
              onSuccess: () => {
                queryClient.invalidateQueries({ queryKey: ['allAnnouncements'] });
                handleCloseDialog();
              },
              onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”')
            };
          
            const createMutation = useMutation({
              ...commonMutationOptions,
              mutationFn: createAnnouncement,
              onSuccess: () => {
                  toast.success('×”×”×•×“×¢×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×”!');
                  commonMutationOptions.onSuccess();
              }
            });
          
            const updateMutation = useMutation({
              ...commonMutationOptions,
              mutationFn: updateAnnouncement,
              onSuccess: () => {
                  toast.success('×”×”×•×“×¢×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!');
                  commonMutationOptions.onSuccess();
              }
            });
          
            const deleteMutation = useMutation({
              mutationFn: deleteAnnouncement,
              onSuccess: () => {
                toast.success('×”×”×•×“×¢×” × ××—×§×”.');
                queryClient.invalidateQueries({ queryKey: ['allAnnouncements'] });
              },
              onError: (err) => toast.error('×©×’×™××” ×‘××—×™×§×ª ×”×”×•×“×¢×”')
            });
          
            // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ× ×™×”×•×œ ×”×˜×•×¤×¡
            const handleOpenCreate = () => {
                setEditingId(null);
                setTitle('');
                setContent('');
                setTarget('all');
                setTargetUser('');
                setExpiresAt('');
                setIsDialogOpen(true);
            };
          
            const handleOpenEdit = (announcement) => {
                setEditingId(announcement._id);
                setTitle(announcement.title);
                setContent(announcement.content);
                setTarget(announcement.target);
                setTargetUser(announcement.targetUser?._id || '');
                setExpiresAt(announcement.expiresAt ? new Date(announcement.expiresAt).toISOString().split('T')[0] : '');
                setIsDialogOpen(true);
            };
          
            const handleCloseDialog = () => {
                setIsDialogOpen(false);
                setEditingId(null);
            };
          
            const handleSubmit = (e) => {
              e.preventDefault();
              if (!title || !content) return toast.error('×—×•×‘×” ×œ×”×–×™×Ÿ ×›×•×ª×¨×ª ×•×ª×•×›×Ÿ.');
              if (target === 'user' && !targetUser) return toast.error('×—×•×‘×” ×œ×‘×—×•×¨ ××©×ª××©.');
          
              const payload = {
                title,
                content,
                target,
                targetUser: target === 'user' ? targetUser : null,
                expiresAt: expiresAt ? new Date(expiresAt) : null
              };
          
              if (editingId) {
                  updateMutation.mutate({ id: editingId, ...payload });
              } else {
                  createMutation.mutate(payload);
              }
            };
          
            return (
              <div className="container mx-auto p-4 sm:p-6 lg:p-8 space-y-8">
                <header className="flex justify-between items-center">
                  <div>
                      <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3">
                      <Megaphone className="text-primary" /> × ×™×”×•×œ ×”×•×“×¢×•×ª ××¢×¨×›×ª
                      </h1>
                      <p className="mt-2 text-gray-600">× ×™×”×•×œ ×”×•×“×¢×•×ª ×ª×¤×•×¦×”, ×¢×¨×™×›×” ×•××—×™×§×”.</p>
                  </div>
                  <Button onClick={handleOpenCreate} size="lg" className="gap-2">
                      <PlusCircle className="h-5 w-5"/> ×”×•×“×¢×” ×—×“×©×”
                  </Button>
                </header>
          
                {/* ×¨×©×™××ª ×”×•×“×¢×•×ª ×§×™×™××•×ª */}
                <Card>
                  <CardHeader>
                    <CardTitle>×”×™×¡×˜×•×¨×™×™×ª ×”×•×“×¢×•×ª</CardTitle>
                    <CardDescription>×›×œ ×”×”×•×“×¢×•×ª ×”×¤×¢×™×œ×•×ª ×•×”×™×©× ×•×ª ×‘××¢×¨×›×ª</CardDescription>
                  </CardHeader>
                  <CardContent>
                    {isLoading ? (
                      <p className="text-center py-8 text-gray-500">×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...</p>
                    ) : announcements.length === 0 ? (
                        <div className="text-center py-12 bg-gray-50 rounded-lg border border-dashed">
                            <Megaphone className="h-10 w-10 text-gray-300 mx-auto mb-2" />
                            <p className="text-gray-500">×œ× ×¤×•×¨×¡××• ×”×•×“×¢×•×ª ×¢×“×™×™×Ÿ.</p>
                            <Button variant="link" onClick={handleOpenCreate}>×¦×•×¨ ×”×•×“×¢×” ×¨××©×•× ×”</Button>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                          {announcements.map(msg => (
                              <div key={msg._id} className="flex flex-col justify-between p-5 rounded-xl border bg-white shadow-sm hover:shadow-md transition-all">
                                  <div className="space-y-3">
                                      <div className="flex items-start justify-between">
                                          <span className={`text-xs px-2 py-1 rounded-full font-medium ${msg.target === 'all' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                                              {msg.target === 'all' ?
                                                  <span className="flex items-center gap-1"><Users size={12}/> ×œ×›×•×œ×</span> :
                                                  <span className="flex items-center gap-1"><User size={12}/> {msg.targetUser?.name || '××©×ª××©'}</span>
                                              }
                                          </span>
                                          {msg.expiresAt && new Date(msg.expiresAt) < new Date() && (
                                              <span className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">×¤×’ ×ª×•×§×£</span>
                                          )}
                                      </div>
          
                                      <h4 className="font-bold text-lg text-gray-900 line-clamp-1">{msg.title}</h4>
          
                                      {/* ×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”×ª×•×›×Ÿ (×× ×§×” ×ª×’×™×•×ª HTML) */}
                                      <div
                                          className="text-gray-600 text-sm line-clamp-3 prose prose-sm"
                                          dangerouslySetInnerHTML={{ __html: msg.content }}
                                      />
                                  </div>
          
                                  <div className="mt-4 pt-4 border-t flex items-center justify-between">
                                      <div className="text-xs text-gray-400">
                                          {format(new Date(msg.createdAt), 'dd/MM/yyyy')}
                                      </div>
                                      <div className="flex gap-2">
                                          <Button variant="ghost" size="icon" onClick={() => handleOpenEdit(msg)} className="text-slate-500 hover:text-primary hover:bg-blue-50">
                                              <Edit className="h-4 w-4" />
                                          </Button>
                                          <Button variant="ghost" size="icon" onClick={() => { if(window.confirm('×œ××—×•×§ ××ª ×”×”×•×“×¢×”?')) deleteMutation.mutate(msg._id) }} className="text-slate-500 hover:text-red-600 hover:bg-red-50">
                                              <Trash2 className="h-4 w-4" />
                                          </Button>
                                      </div>
                                  </div>
                              </div>
                          ))}
                        </div>
                    )}
                  </CardContent>
                </Card>
          
                {/* --- ×“×™××œ×•×’ ×™×¦×™×¨×”/×¢×¨×™×›×” --- */}
                <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
                  <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
                      <DialogHeader>
                          <DialogTitle>{editingId ? '×¢×¨×™×›×ª ×”×•×“×¢×”' : '×™×¦×™×¨×ª ×”×•×“×¢×” ×—×“×©×”'}</DialogTitle>
                          <DialogDescription>
                              ×¢×¨×•×š ××ª ×ª×•×›×Ÿ ×”×”×•×“×¢×” ×‘×××¦×¢×•×ª ×”×¢×•×¨×š ×”××ª×§×“×.
                          </DialogDescription>
                      </DialogHeader>
          
                      <form id="announcementForm" onSubmit={handleSubmit} className="space-y-4 py-2">
                          <div>
                              <Label>×›×•×ª×¨×ª ×”×”×•×“×¢×”</Label>
                              <Input
                                  value={title}
                                  onChange={e => setTitle(e.target.value)}
                                  placeholder='×œ×“×•×’××”: ×¢×“×›×•×Ÿ ×—×©×•×‘ ×œ×’×‘×™ ×—×’ ×”×¤×¡×—'
                                  required
                                  className="font-semibold text-lg"
                              />
                          </div>
          
                          <div className="h-auto">
                              <Label className="mb-2 block">×ª×•×›×Ÿ ×”×”×•×“×¢×”</Label>
                              {/* âœ¨ ×”×¢×•×¨×š ×”××ª×§×“× âœ¨ */}
                              <div className="bg-white" dir="rtl">
                                  <ReactQuill
                                      theme="snow"
                                      value={content}
                                      onChange={setContent}
                                      modules={modules}
                                      formats={formats}
                                      className="h-64 mb-12" // mb-12 × ×•×ª×Ÿ ××§×•× ×œ×¡×¨×’×œ ×”×ª×—×ª×•×Ÿ ×©×œ ×”×¢×•×¨×š
                                      placeholder="×”×§×œ×“ ×›××Ÿ ××ª ×ª×•×›×Ÿ ×”×”×•×“×¢×”..."
                                  />
                              </div>
                          </div>
          
                          <div className="grid grid-cols-2 gap-4 pt-4">
                              <div>
                                  <Label>×ª×¤×•×¦×”</Label>
                                  <Select value={target} onValueChange={setTarget}>
                                      <SelectTrigger>
                                          <SelectValue />
                                      </SelectTrigger>
                                      <SelectContent>
                                          <SelectItem value="all">×œ×›×•×œ×</SelectItem>
                                          <SelectItem value="user">××©×ª××© ×¡×¤×¦×™×¤×™</SelectItem>
                                      </SelectContent>
                                  </Select>
                              </div>
          
                              <div>
                                  <Label>×ª×•×§×£ (××•×¤×¦×™×•× ×œ×™)</Label>
                                  <div className="relative">
                                      <Calendar className="absolute left-2 top-2.5 h-4 w-4 text-gray-400 pointer-events-none" />
                                      <Input
                                          type="date"
                                          value={expiresAt}
                                          onChange={e => setExpiresAt(e.target.value)}
                                          className="pl-8"
                                      />
                                  </div>
                              </div>
                          </div>
          
                          {target === 'user' && (
                              <div className="animate-in fade-in slide-in-from-top-2 duration-300">
                                  <Label>×‘×—×¨ ××©×ª××©</Label>
                                  <Select value={targetUser} onValueChange={setTargetUser}>
                                      <SelectTrigger>
                                          <SelectValue placeholder="×—×¤×© ××©×ª××©..." />
                                      </SelectTrigger>
                                      <SelectContent className="max-h-60">
                                          {users.map(u => (
                                              <SelectItem key={u._id} value={u._id}>{u.name} ({u.email})</SelectItem>
                                          ))}
                                      </SelectContent>
                                  </Select>
                              </div>
                          )}
                      </form>
          
                      <DialogFooter>
                          <Button type="button" variant="outline" onClick={handleCloseDialog}>×‘×™×˜×•×œ</Button>
                          <Button type="submit" form="announcementForm" disabled={createMutation.isPending || updateMutation.isPending} className="gap-2">
                              <Send className="h-4 w-4" />
                              {editingId ? '×¢×“×›×Ÿ ×”×•×“×¢×”' : '×¤×¨×¡× ×”×•×“×¢×”'}
                          </Button>
                      </DialogFooter>
                  </DialogContent>
                </Dialog>
              </div>
            );
          }
        ğŸ“„ ManageExtrasPage.jsx
          // client/src/pages/admin/ManageExtrasPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import toast from 'react-hot-toast';
          import api from '@/utils/api.js';
          
          // UI Components
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
          import { PlusCircle, Trash2, Tag, LoaderCircle } from 'lucide-react';
          
          // API Functions
          const fetchExtras = async () => (await api.get('/admin/extras')).data;
          const createExtra = (name) => api.post('/admin/extras', { name });
          const deleteExtra = (id) => api.delete(`/admin/extras/${id}`);
          
          export default function ManageExtrasPage() {
              const [newExtraName, setNewExtraName] = useState('');
              const queryClient = useQueryClient();
          
              const { data: extras = [], isLoading, isError } = useQuery({
                  queryKey: ['extraTypes'],
                  queryFn: fetchExtras,
              });
          
              const createMutation = useMutation({
                  mutationFn: createExtra,
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['extraTypes'] });
                      toast.success('×¡×•×’ ×ª×•×¡×¤×ª × ×•×¡×£ ×‘×”×¦×œ×—×”!');
                      setNewExtraName('');
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××” ×‘×™×¦×™×¨×”')
              });
          
              const deleteMutation = useMutation({
                  mutationFn: deleteExtra,
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['extraTypes'] });
                      toast.success('× ××—×§ ×‘×”×¦×œ×—×”!');
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××” ×‘××—×™×§×”')
              });
          
              const handleAdd = (e) => {
                  e.preventDefault();
                  if (newExtraName.trim()) {
                      createMutation.mutate(newExtraName.trim());
                  }
              };
          
              return (
                  <div className="container mx-auto p-4 sm:p-6 lg:p-8 space-y-8">
                      <header>
                          <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3">
                              <Tag className="text-primary"/> × ×™×”×•×œ ×¡×•×’×™ ×ª×•×¡×¤×•×ª
                          </h1>
                          <p className="mt-2 text-lg text-gray-600">
                              ×›××Ÿ × ×™×ª×Ÿ ×œ×”×’×“×™×¨ ×¡×•×’×™× ×©×œ ×ª×•×¡×¤×•×ª (×›××• "××•×œ×", "×”×’×‘×¨×”") ×©×™×•×¤×™×¢×• ×›××¤×©×¨×•×™×•×ª ×‘×¢×ª ×™×¦×™×¨×ª ×”×–×× ×”.
                          </p>
                      </header>
          
                      {/* ×˜×•×¤×¡ ×”×•×¡×¤×” */}
                      <Card className="border-t-4 border-t-primary shadow-md">
                          <CardHeader>
                              <CardTitle>×”×•×¡×¤×ª ×¡×•×’ ×—×“×©</CardTitle>
                          </CardHeader>
                          <CardContent>
                              <form onSubmit={handleAdd} className="flex gap-4 items-center">
                                  <Input
                                      placeholder="×©× ×”×ª×•×¡×¤×ª (×œ×“×•×’××”: ××•×œ× ×›× ×¡×™×)"
                                      value={newExtraName}
                                      onChange={(e) => setNewExtraName(e.target.value)}
                                      className="max-w-md"
                                      required
                                  />
                                  <Button type="submit" disabled={createMutation.isPending}>
                                      {createMutation.isPending ? <LoaderCircle className="animate-spin ml-2 h-4 w-4"/> : <PlusCircle className="ml-2 h-4 w-4"/>}
                                      ×”×•×¡×£
                                  </Button>
                              </form>
                          </CardContent>
                      </Card>
          
                      {/* ×¨×©×™××” ×§×™×™××ª */}
                      <Card>
                          <CardHeader>
                              <CardTitle>×¨×©×™××ª ×”×ª×•×¡×¤×•×ª ×‘××¢×¨×›×ª</CardTitle>
                              <CardDescription>×¡×”"×› {extras.length} ×¡×•×’×™× ××•×’×“×¨×™×.</CardDescription>
                          </CardHeader>
                          <CardContent>
                              {isLoading ? <div className="text-center p-10"><LoaderCircle className="animate-spin h-8 w-8 mx-auto"/></div> :
                               isError ? <div className="text-center text-red-500">×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×.</div> :
                               extras.length === 0 ?
                                  <div className="text-center py-10 text-gray-500 bg-slate-50 rounded border border-dashed">×¢×“×™×™×Ÿ ×œ× ×”×•×’×“×¨×• ×ª×•×¡×¤×•×ª.</div> :
                                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                      {extras.map((extra) => (
                                          <div key={extra._id} className="flex justify-between items-center p-4 bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                              <span className="font-semibold text-lg text-slate-800">{extra.name}</span>
                                              <Button
                                                  variant="ghost"
                                                  size="icon"
                                                  className="text-slate-400 hover:text-red-600 hover:bg-red-50"
                                                  onClick={() => {
                                                      if(window.confirm('×”×× ×œ××—×•×§ ×¡×•×’ ×–×”?')) deleteMutation.mutate(extra._id);
                                                  }}
                                              >
                                                  <Trash2 size={18} />
                                              </Button>
                                          </div>
                                      ))}
                                  </div>
                              }
                          </CardContent>
                      </Card>
                  </div>
              );
          }
        ğŸ“„ ManageHotelsPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import toast from 'react-hot-toast';
          import api from '@/utils/api.js';
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card.jsx';
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/Dialog";
          import { PlusCircle, Trash2, Hotel, BedDouble, ListChecks, X, ArrowUp, ArrowDown } from 'lucide-react';
          // API Functions
          const fetchHotels = async () => (await api.get('/admin/hotels')).data;
          const createHotel = (name) => api.post('/admin/hotels', { name });
          const deleteHotel = (id) => api.delete(`/admin/hotels/${id}`);
          const updateMasterChecklist = ({ id, checklist }) => api.put(`/admin/hotels/${id}/checklist`, { checklist });
          // Room Types API
          const fetchRoomTypes = async (hotelId) => (await api.get(`/admin/room-types/by-hotel/${hotelId}`)).data;
          const createRoomType = (data) => api.post('/admin/room-types', data);
          const deleteRoomType = (id) => api.delete(`/admin/room-types/${id}`);
          export default function ManageHotelsPage() {
              const [newHotelName, setNewHotelName] = useState('');
              const [selectedHotelForRooms, setSelectedHotelForRooms] = useState(null);
              const [selectedHotelForChecklist, setSelectedHotelForChecklist] = useState(null);
          
              const queryClient = useQueryClient();
              const { data: hotels = [], isLoading, isError } = useQuery({
                  queryKey: ['hotels'],
                  queryFn: fetchHotels,
              });
              const { mutate: create, isPending: isCreating } = useMutation({
                  mutationFn: createHotel,
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['hotels'] });
                      toast.success('×”××œ×•×Ÿ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
                       setNewHotelName('');
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”'),
              });
              const { mutate: remove } = useMutation({
                  mutationFn: deleteHotel,
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['hotels'] });
                      toast.success('×”××œ×•×Ÿ × ××—×§ ×‘×”×¦×œ×—×”!');
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”'),
              });
              const handleAddHotel = (e) => {
                  e.preventDefault();
                  if (newHotelName.trim()) create(newHotelName.trim());
              };
          
              return (
                  <div className="container mx-auto p-4 sm:p-6 lg:p-8 space-y-8">
                      <header>
                          <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3"><Hotel /> × ×™×”×•×œ ×‘×ª×™ ××œ×•×Ÿ</h1>
                           <p className="mt-2 text-gray-600">×”×’×“×¨×ª ××œ×•× ×•×ª, ×¡×•×’×™ ×—×“×¨×™× ×•× ×”×œ×™ ×¢×‘×•×“×” (×¦'×§ ×œ×™×¡×˜).</p>
                      </header>
          
                      <Card>
                           <CardHeader>
                              <CardTitle>×”×•×¡×¤×ª ××œ×•×Ÿ ×—×“×©</CardTitle>
                          </CardHeader>
                          <CardContent>
                               <form onSubmit={handleAddHotel} className="flex items-center gap-4">
                                  <Input
                                      placeholder="×©× ×”××œ×•×Ÿ ×”×—×“×©"
                                       value={newHotelName}
                                      onChange={(e) => setNewHotelName(e.target.value)}
                                       className="flex-grow"
                                      required
                                  />
                                   <Button type="submit" disabled={isCreating}>
                                      <PlusCircle className="ml-2 h-4 w-4" />
                                      {isCreating ? '××•×¡×™×£...' : '×”×•×¡×£'}
                                  </Button>
                              </form>
                          </CardContent>
                       </Card>
          
                      <Card>
                          <CardHeader>
                               <CardTitle>×¨×©×™××ª ×”××œ×•× ×•×ª</CardTitle>
                          </CardHeader>
                          <CardContent>
                              {isLoading && <p>×˜×•×¢×Ÿ...</p>}
                               {isError && <p className="text-red-500">×©×’×™××” ×‘×˜×¢×™× ×”.</p>}
                              <div className="space-y-2">
                                  {hotels.map(hotel => (
                                       <div key={hotel._id} className="flex items-center justify-between p-3 bg-slate-50 rounded-md hover:bg-slate-100 transition-colors">
                                          <span className="font-medium text-lg">{hotel.name}</span>
                                           <div className="flex gap-2">
                                              <Button variant="outline" size="sm" onClick={() => setSelectedHotelForChecklist(hotel)}>
                                                   <ListChecks className="ml-2 h-4 w-4" />
                                                  × ×™×”×•×œ ×¦'×§ ×œ×™×¡×˜
                                               </Button>
          
                                              <Button variant="outline" size="sm" onClick={() => setSelectedHotelForRooms(hotel)}>
                                                   <BedDouble className="ml-2 h-4 w-4" />
                                                  ×¡×•×’×™ ×—×“×¨×™×
                                               </Button>
          
                                              <Button variant="ghost" size="icon" onClick={() => { if (window.confirm(`×œ××—×•×§ ××ª "${hotel.name}"?`)) remove(hotel._id); }}>
                                                  <Trash2 className="h-4 w-4 text-red-500" />
                                               </Button>
                                          </div>
                                      </div>
                                   ))}
                              </div>
                          </CardContent>
                      </Card>
          
                      {/* ×“×™××œ×•×’ × ×™×”×•×œ ×¦'×§ ×œ×™×¡×˜ ×¨××©×™ */}
                      {selectedHotelForChecklist && (
                          <MasterChecklistDialog
                               hotel={selectedHotelForChecklist}
                              isOpen={!!selectedHotelForChecklist}
                              onClose={() => setSelectedHotelForChecklist(null)}
                           />
                      )}
          
                      {/* ×“×™××œ×•×’ × ×™×”×•×œ ×¡×•×’×™ ×—×“×¨×™× */}
                      {selectedHotelForRooms && (
                           <RoomTypesManagerDialog
                              hotel={selectedHotelForRooms}
                              isOpen={!!selectedHotelForRooms}
                               onClose={() => setSelectedHotelForRooms(null)}
                          />
                      )}
                  </div>
              );
          }
          
          // --- ×§×•××¤×•× × ×˜×ª × ×™×”×•×œ ×¦'×§ ×œ×™×¡×˜ ×¨××©×™ ---
          function MasterChecklistDialog({ hotel, isOpen, onClose }) {
              const queryClient = useQueryClient();
              // ×”××¨×” ×××‘× ×” ×™×©×Ÿ ××• ×—×“×© ×œ××‘× ×” ××—×™×“
              const initialList = hotel.masterChecklist && hotel.masterChecklist.length > 0
                  ?
          hotel.masterChecklist
                  : (hotel.defaultTasks || []).map((t, i) => ({ text: t, order: i }));
              const [checklist, setChecklist] = useState(initialList);
              const [newItemText, setNewItemText] = useState('');
              const updateMutation = useMutation({
                  mutationFn: (newChecklist) => updateMasterChecklist({ id: hotel._id, checklist: newChecklist }),
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['hotels'] });
                      // âœ¨ ×”×ª×™×§×•×Ÿ ×›××Ÿ: ×©×™××•×© ×‘××¨×›××•×ª ×›×¤×•×œ×•×ª ×›×“×™ ×œ×× ×•×¢ ×©×‘×™×¨×” ×‘×’×œ×œ ×”×’×¨×© ×‘-"×”×¦'×§"
                      toast.success("×”×¦'×§ ×œ×™×¡×˜ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!");
                      onClose();
                  },
                  onError: () => toast.error('×©×’×™××” ×‘×©××™×¨×”')
              });
              const addItem = () => {
                  if (!newItemText.trim()) return;
                  setChecklist([...checklist, { text: newItemText.trim(), order: checklist.length }]);
                  setNewItemText('');
              };
          
              const removeItem = (index) => {
                  const newList = checklist.filter((_, i) => i !== index);
                  setChecklist(newList);
              };
          
              const moveItem = (index, direction) => {
                  const newList = [...checklist];
                  const item = newList[index];
                  newList.splice(index, 1);
                  newList.splice(index + direction, 0, item);
                  setChecklist(newList);
              };
              return (
                  <Dialog open={isOpen} onOpenChange={onClose}>
                      <DialogContent className="max-w-xl">
                          <DialogHeader>
                               <DialogTitle>× ×™×”×•×œ ×¦'×§ ×œ×™×¡×˜ ×¨××©×™ - {hotel.name}</DialogTitle>
                              <DialogDescription>
                                  ×”×’×“×¨ ××ª ×¡×“×¨ ×”×¤×¢×•×œ×•×ª ×”×§×‘×•×¢. ×¨×©×™××” ×–×• ×ª×•×¤×™×¢ ××•×˜×•××˜×™×ª ×‘×›×œ ×—×“×¨ ×‘×¢×ª ××™×¤×•×¡ ×œ"××œ×•×›×œ×š".
                               </DialogDescription>
                          </DialogHeader>
          
                          <div className="space-y-4 py-4">
                               <div className="flex gap-2">
                                  <Input
                                      placeholder="×”×•×¡×£ ××©×™××” ×§×‘×•×¢×” (×œ××©×œ: ×‘×“×™×§×ª ××™× ×™×‘×¨)..."
                                       value={newItemText}
                                      onChange={e => setNewItemText(e.target.value)}
                                       onKeyDown={e => e.key === 'Enter' && addItem()}
                                  />
                                  <Button onClick={addItem}><PlusCircle/></Button>
                               </div>
          
                              <div className="space-y-2 max-h-[60vh] overflow-y-auto bg-slate-50 p-2 rounded border">
                                  {checklist.map((item, idx) => (
                                       <div key={idx} className="flex justify-between items-center bg-white p-3 rounded border shadow-sm">
                                          <div className="flex items-center gap-2">
                                               <span className="font-mono text-xs text-gray-400 w-6">{idx + 1}.</span>
                                              <span>{item.text}</span>
                                           </div>
                                          <div className="flex gap-1">
                                               <Button variant="ghost" size="icon" className="h-6 w-6" disabled={idx === 0} onClick={() => moveItem(idx, -1)}>
                                                  <ArrowUp size={14}/>
                                               </Button>
                                              <Button variant="ghost" size="icon" className="h-6 w-6" disabled={idx === checklist.length - 1} onClick={() => moveItem(idx, 1)}>
                                                   <ArrowDown size={14}/>
                                              </Button>
                                               <Button variant="ghost" size="icon" className="h-6 w-6 text-red-500 ml-2" onClick={() => removeItem(idx)}>
                                                  <X size={14}/>
                                               </Button>
                                          </div>
                                       </div>
                                  ))}
                                  {checklist.length === 0 && <p className="text-center text-gray-400 py-4">×”×¨×©×™××” ×¨×™×§×”.</p>}
                               </div>
                          </div>
          
                          <div className="flex justify-end gap-2">
                               <Button variant="outline" onClick={onClose}>×‘×™×˜×•×œ</Button>
                              <Button onClick={() => updateMutation.mutate(checklist)} disabled={updateMutation.isPending}>
                                  {updateMutation.isPending ? '×©×•××¨...' : '×©××•×¨ ×©×™× ×•×™×™×'}
                              </Button>
                          </div>
                      </DialogContent>
                  </Dialog>
              );
          }
          
          // --- ×§×•××¤×•× × ×˜×ª × ×™×”×•×œ ×¡×•×’×™ ×—×“×¨×™× ---
          function RoomTypesManagerDialog({ hotel, isOpen, onClose }) {
              const queryClient = useQueryClient();
              const [newType, setNewType] = useState({ name: '', supplementPerNight: 0, isDefault: false });
              const { data: roomTypes = [], isLoading } = useQuery({
                  queryKey: ['roomTypes', hotel._id],
                  queryFn: () => fetchRoomTypes(hotel._id),
                  enabled: !!hotel._id
              });
              const createMutation = useMutation({
                  mutationFn: createRoomType,
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['roomTypes', hotel._id] });
                      toast.success('×¡×•×’ ×—×“×¨ × ×•×¡×£!');
                       setNewType({ name: '', supplementPerNight: 0, isDefault: false });
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '×©×’×™××”')
              });
              const deleteMutation = useMutation({
                  mutationFn: deleteRoomType,
                  onSuccess: () => {
                      queryClient.invalidateQueries({ queryKey: ['roomTypes', hotel._id] });
                      toast.success('×¡×•×’ ×—×“×¨ × ××—×§!');
                  }
              });
              const handleSubmit = (e) => {
                  e.preventDefault();
                  createMutation.mutate({ ...newType, hotel: hotel._id });
              };
          
              return (
                  <Dialog open={isOpen} onOpenChange={onClose}>
                      <DialogContent className="max-w-2xl">
                          <DialogHeader>
                               <DialogTitle>× ×™×”×•×œ ×¡×•×’×™ ×—×“×¨×™× - {hotel.name}</DialogTitle>
                              <DialogDescription>×”×•×¡×£ ×—×“×¨×™× ××™×•×—×“×™× ×•×ª××—×•×¨.</DialogDescription>
                          </DialogHeader>
                          <form onSubmit={handleSubmit} className="bg-slate-50 p-4 rounded-lg border space-y-4 mt-4">
                              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                  <Input placeholder="×©× (×œ××©×œ: ×¡×•×•×™×˜×”)" value={newType.name} onChange={e => setNewType(p => ({ ...p, name: e.target.value }))} required />
                                   <Input type="number" placeholder="×ª×•×¡×¤×ª ×œ×œ×™×œ×”" value={newType.supplementPerNight} onChange={e => setNewType(p => ({ ...p, supplementPerNight: Number(e.target.value) }))} min="0" />
                              </div>
                              <Button type="submit" size="sm" disabled={createMutation.isPending}><PlusCircle className="ml-2 h-4 w-4" /> ×”×•×¡×£</Button>
                          </form>
                          <div className="mt-4 max-h-[300px] overflow-y-auto">
                              {isLoading ?
          <p>×˜×•×¢×Ÿ...</p> : (
                                  <div className="space-y-2">
                                      {roomTypes.map(rt => (
                                           <div key={rt._id} className="flex justify-between items-center p-2 border-b">
                                              <span>{rt.name} (+{rt.supplementPerNight}â‚ª)</span>
                                               <Button variant="ghost" size="icon" onClick={() => {if(window.confirm('×œ××—×•×§?')) deleteMutation.mutate(rt._id)}}><Trash2 className="h-4 w-4 text-red-500"/></Button>
                                          </div>
                                       ))}
                                  </div>
                              )}
                          </div>
                       </DialogContent>
                  </Dialog>
              );
          }
        ğŸ“„ ManageOrdersPage.jsx
          // client/src/pages/admin/ManageOrdersPage.jsx
          
          import React, { useState, useMemo } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import { Link } from 'react-router-dom';
          import api from '@/utils/api.js';
          import { format } from 'date-fns';
          import { Input } from '@/components/ui/Input.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Button } from '@/components/ui/Button.jsx';
          import { Search, SlidersHorizontal, Trash2, Edit, Hotel, AlertTriangle } from 'lucide-react';
          import toast from 'react-hot-toast';
          
          // --- API Functions ---
          const fetchAllOrders = async () => (await api.get('/admin/orders')).data;
          const fetchHotels = async () => (await api.get('/admin/hotels')).data;
          const updateOrderStatus = ({ orderId, newStatus }) => api.put(`/admin/orders/${orderId}`, { status: newStatus });
          const deleteOrderById = (orderId) => api.delete(`/admin/orders/${orderId}`);
          const deleteOrdersByStatus = (status) => api.delete('/admin/orders/by-status', { data: { status } });
          
          const OrderRow = ({ order, onStatusChange, onDelete }) => {
              const statusStyles = { '×‘×”××ª× ×”': 'bg-yellow-100 text-yellow-800', '×‘×•×¦×¢': 'bg-green-100 text-green-800', '×œ× ×¨×œ×•×•× ×˜×™': 'bg-red-100 text-red-800' };
          
              return (
                  <div className="grid grid-cols-12 gap-4 items-center px-4 py-3 border-b hover:bg-slate-50 text-sm">
                      {/* âœ¨ ×¢××•×“×•×ª ×¢×•×“×›× ×• ×›×“×™ ×œ×¤× ×•×ª ××§×•× ×œ××œ×•×Ÿ */}
                      <div className="col-span-2">
                          <p className="font-bold text-slate-800">{order.customerName}</p>
                          <p className="text-slate-500">{order.customerPhone}</p>
                      </div>
                      {/* âœ¨ ×¢××•×“×ª ××œ×•×Ÿ ×—×“×©×” */}
                      <div className="col-span-2 text-slate-600 font-medium">{order.hotel?.name || 'N/A'}</div>
                      <div className="col-span-2 text-slate-600">{order.salespersonName}</div>
                      <div className="col-span-2 text-slate-600">{format(new Date(order.createdAt), 'dd/MM/yy HH:mm')}</div>
                      <div className="col-span-1 font-semibold">{order.total_price.toLocaleString('he-IL')}â‚ª</div>
                      <div className="col-span-2">
                          <Select value={order.status} onValueChange={(newStatus) => onStatusChange(order._id, newStatus)}>
                              <SelectTrigger className={`h-8 text-xs ${statusStyles[order.status]}`}><SelectValue /></SelectTrigger>
                              <SelectContent>
                                  <SelectItem value="×‘×”××ª× ×”">×‘×”××ª× ×”</SelectItem>
                                  <SelectItem value="×‘×•×¦×¢">×‘×•×¦×¢</SelectItem>
                                  <SelectItem value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</SelectItem>
                              </SelectContent>
                          </Select>
                      </div>
                      <div className="col-span-1 text-right flex justify-end gap-1">
                          <Button asChild variant="ghost" size="icon" aria-label="Edit Order">
                              <Link to={`/edit-order/${order._id}`}>
                                  <Edit className="h-4 w-4 text-slate-600" />
                              </Link>
                          </Button>
                          <Button variant="ghost" size="icon" onClick={() => onDelete(order._id)} aria-label="Delete Order">
                              <Trash2 className="h-4 w-4 text-red-500" />
                          </Button>
                      </div>
                  </div>
              );
          };
          
          
          export default function ManageOrdersPage() {
              const [searchTerm, setSearchTerm] = useState('');
              const [statusFilter, setStatusFilter] = useState('all');
              const [hotelFilter, setHotelFilter] = useState('all');
              const queryClient = useQueryClient();
          
              const { data: orders = [], isLoading: isLoadingOrders, isError: isOrdersError, error: ordersError } = useQuery({ queryKey: ['adminAllOrders'], queryFn: fetchAllOrders });
              const { data: hotels = [] } = useQuery({ queryKey: ['hotels'], queryFn: fetchHotels });
          
              const commonMutationOptions = {
                  onSuccess: () => queryClient.invalidateQueries({ queryKey: ['adminAllOrders'] }),
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”'),
              };
          
              const updateStatusMutation = useMutation({ ...commonMutationOptions, mutationFn: updateOrderStatus });
              const deleteOrderMutation = useMutation({ ...commonMutationOptions, mutationFn: deleteOrderById });
              const bulkDeleteMutation = useMutation({
                  ...commonMutationOptions,
                  mutationFn: deleteOrdersByStatus,
                  onSuccess: () => {
                      toast.success('×›×œ ×”×”×–×× ×•×ª ×”×œ× ×¨×œ×•×•× ×˜×™×•×ª × ××—×§×•!');
                      commonMutationOptions.onSuccess();
                  }
              });
          
              const filteredOrders = useMemo(() => {
                  // âœ¨ ×¡×™×“×¨× ×• ××—×“×© ××ª ×”×”×–×× ×•×ª ×œ×¤×™ ×”×ª××¨×™×š ×”×¢×“×›× ×™ ×‘×™×•×ª×¨
                  const sortedOrders = orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          
                  return sortedOrders.filter(order => {
                      const nameMatch = order.customerName.toLowerCase().includes(searchTerm.toLowerCase());
                      const statusMatch = statusFilter === 'all' || order.status === statusFilter;
                      const hotelMatch = hotelFilter === 'all' || order.hotel?._id === hotelFilter;
                      return nameMatch && statusMatch && hotelMatch;
                  });
              }, [orders, searchTerm, statusFilter, hotelFilter]);
          
              if (isLoadingOrders) return <p className="text-center p-8">×˜×•×¢×Ÿ ×”×–×× ×•×ª...</p>;
              if (isOrdersError) return <p className="text-center p-8 text-red-600">×©×’×™××”: {ordersError.message}</p>;
          
              return (
                  <div className="container mx-auto p-4 space-y-6">
                      <header>
                          <h1 className="text-3xl font-bold text-gray-900">× ×™×”×•×œ ×”×–×× ×•×ª ×•×¤× ×™×•×ª</h1>
                          <p className="mt-1 text-gray-600">×—×™×¤×•×©, ×¡×™× ×•×Ÿ ×•×¢×“×›×•×Ÿ ×›×œ ×”×”×–×× ×•×ª ×‘××¢×¨×›×ª.</p>
                      </header>
          
                      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                          <div className="relative md:col-span-2">
                              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                              <Input placeholder="×—×¤×© ×œ×¤×™ ×©× ×œ×§×•×—..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="pl-10" />
                          </div>
                          <Select value={statusFilter} onValueChange={setStatusFilter}>
                              <SelectTrigger><SlidersHorizontal className="ml-2 h-4 w-4" /><SelectValue placeholder="×¡× ×Ÿ ×œ×¤×™ ×¡×˜×˜×•×¡" /></SelectTrigger>
                              <SelectContent>
                                  <SelectItem value="all">×›×œ ×”×¡×˜×˜×•×¡×™×</SelectItem>
                                  <SelectItem value="×‘×”××ª× ×”">×‘×”××ª× ×”</SelectItem>
                                  <SelectItem value="×‘×•×¦×¢">×‘×•×¦×¢</SelectItem>
                                  <SelectItem value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</SelectItem>
                              </SelectContent>
                          </Select>
                          {/* âœ¨ ×¤×™×œ×˜×¨ ×”××œ×•× ×•×ª ×××•×§× ×›××Ÿ */}
                          <Select value={hotelFilter} onValueChange={setHotelFilter}>
                              <SelectTrigger><Hotel className="ml-2 h-4 w-4" /><SelectValue placeholder="×¡× ×Ÿ ×œ×¤×™ ××œ×•×Ÿ" /></SelectTrigger>
                              <SelectContent>
                                  <SelectItem value="all">×›×œ ×”××œ×•× ×•×ª</SelectItem>
                                  {hotels.map(hotel => <SelectItem key={hotel._id} value={hotel._id}>{hotel.name}</SelectItem>)}
                              </SelectContent>
                          </Select>
                      </div>
          
                      {statusFilter === '×œ× ×¨×œ×•×•× ×˜×™' && filteredOrders.length > 0 && (
                           <div className="bg-red-50 border border-red-200 p-4 rounded-lg flex justify-between items-center">
                              <div className="flex items-center gap-2">
                                  <AlertTriangle className="h-5 w-5 text-red-600"/>
                                  <p className="text-red-800 font-medium">× ××¦××• {filteredOrders.length} ×”×–×× ×•×ª ×œ× ×¨×œ×•×•× ×˜×™×•×ª.</p>
                              </div>
                              <Button
                                  variant="destructive"
                                  onClick={() => {
                                      if(window.confirm(`×”×× ×œ××—×•×§ ${filteredOrders.length} ×”×–×× ×•×ª ×œ× ×¨×œ×•×•× ×˜×™×•×ª? ×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨ ×¤×¢×•×œ×” ×–×•.`)) {
                                          bulkDeleteMutation.mutate('×œ× ×¨×œ×•×•× ×˜×™');
                                      }
                                  }}
                              >
                                  <Trash2 className="ml-2 h-4 w-4" /> ××—×§ ×”×›×œ
                              </Button>
                          </div>
                      )}
          
                      <div className="bg-white rounded-lg shadow-md border overflow-hidden">
                           {/* âœ¨ ×›×•×ª×¨×•×ª ×˜×‘×œ×” ××¢×•×“×›× ×•×ª */}
                          <div className="grid grid-cols-12 gap-4 px-4 py-3 bg-slate-50 font-medium text-slate-600 text-sm border-b">
                              <div className="col-span-2">×œ×§×•×—</div>
                              <div className="col-span-2">××œ×•×Ÿ</div>
                              <div className="col-span-2">××™×© ××›×™×¨×•×ª</div>
                              <div className="col-span-2">×ª××¨×™×š</div>
                              <div className="col-span-1">×¡×›×•×</div>
                              <div className="col-span-2">×¡×˜×˜×•×¡</div>
                              <div className="col-span-1"></div>
                          </div>
          
                          <div>
                              {filteredOrders.length > 0 ? (
                                  filteredOrders.map(order =>
                                      <OrderRow
                                          key={order._id}
                                          order={order}
                                          onStatusChange={(orderId, newStatus) => updateStatusMutation.mutate({ orderId, newStatus })}
                                          onDelete={(orderId) => { if (window.confirm('×”×× ×œ××—×•×§ ××ª ×”×”×–×× ×”?')) deleteOrderMutation.mutate(orderId) }}
                                      />
                                  )
                              ) : (
                                  <p className="text-center text-slate-500 p-8">×œ× × ××¦××• ×”×–×× ×•×ª ×”×ª×•×××•×ª ×œ×—×™×¤×•×©.</p>
                              )}
                          </div>
                      </div>
                  </div>
              );
          }
        ğŸ“„ ManagePhysicalRoomsPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import toast from 'react-hot-toast';
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
          import { Layers, ArrowRight } from 'lucide-react';
          
          export default function ManagePhysicalRoomsPage() {
              const [hotelId, setHotelId] = useState('');
              const [roomTypeId, setRoomTypeId] = useState('');
              const [rangeStart, setRangeStart] = useState('');
              const [rangeEnd, setRangeEnd] = useState('');
          
              const queryClient = useQueryClient();
              // ×©×œ×™×¤×ª × ×ª×•× ×™×
              const { data: hotels = [] } = useQuery({ queryKey: ['hotels'], queryFn: async () => (await api.get('/admin/hotels')).data });
              const { data: roomTypes = [] } = useQuery({
                  queryKey: ['roomTypes', hotelId],
                  queryFn: async () => (await api.get(`/admin/room-types/by-hotel/${hotelId}`)).data,
                  enabled: !!hotelId
              });
              // ×™×¦×™×¨×”
              const createMutation = useMutation({
                  mutationFn: (data) => api.post('/rooms/bulk', data),
                  onSuccess: (res) => {
                      toast.success(res.data.message);
                       setRangeStart('');
                      setRangeEnd('');
                  },
                  onError: (err) => toast.error(err.response?.data?.message || '×©×’×™××” ×‘×™×¦×™×¨×”')
              });
              const handleSubmit = () => {
                  if (!hotelId || !roomTypeId || !rangeStart || !rangeEnd) return toast.error('×—×¡×¨×™× ×©×“×•×ª');
                  if (Number(rangeEnd) < Number(rangeStart)) return toast.error('×˜×•×•×— ×œ× ×ª×§×™×Ÿ');
          
                  createMutation.mutate({
                      hotel: hotelId,
                      roomType: roomTypeId,
                      startNumber: rangeStart,
                      endNumber: rangeEnd
                  });
              };
              return (
                  <div className="container mx-auto p-6 max-w-2xl">
                      <Card>
                          <CardHeader>
                             <CardTitle className="flex items-center gap-2"><Layers className="text-blue-600"/> ×”×§××ª ×—×“×¨×™× ×‘××¢×¨×›×ª</CardTitle>
                              <CardDescription>×™×¦×™×¨×” ××”×™×¨×” ×©×œ ×˜×•×•×—×™ ×—×“×¨×™× (×œ××©×œ 101-120)</CardDescription>
                          </CardHeader>
                          <CardContent className="space-y-6">
                               <div className="space-y-2">
                                  <label className="text-sm font-medium">1. ×‘×—×¨ ××œ×•×Ÿ</label>
                                   <Select value={hotelId} onValueChange={setHotelId}>
                                      <SelectTrigger><SelectValue placeholder="×‘×—×¨ ××œ×•×Ÿ..." /></SelectTrigger>
                                      <SelectContent>
                                           {hotels.map(h => <SelectItem key={h._id} value={h._id}>{h.name}</SelectItem>)}
                                      </SelectContent>
                                  </Select>
                               </div>
          
                              <div className="space-y-2">
                                   <label className="text-sm font-medium">2. ×‘×—×¨ ×¡×•×’ ×—×“×¨ (×¢×‘×•×¨ ×”×˜×•×•×— ×”×–×”)</label>
                                  <Select value={roomTypeId} onValueChange={setRoomTypeId} disabled={!hotelId}>
                                      <SelectTrigger><SelectValue placeholder={!hotelId ? "×§×•×“× ×‘×—×¨ ××œ×•×Ÿ" : "×‘×—×¨ ×¡×•×’..."} /></SelectTrigger>
                                      <SelectContent>
                                          {roomTypes.map(rt => <SelectItem key={rt._id} value={rt._id}>{rt.name}</SelectItem>)}
                                       </SelectContent>
                                  </Select>
                              </div>
          
                              <div className="grid grid-cols-2 gap-4 items-end">
                                  <div className="space-y-2">
                                       <label className="text-sm font-medium">×××¡×¤×¨</label>
                                      <Input type="number" placeholder="101" value={rangeStart} onChange={e => setRangeStart(e.target.value)} />
                                  </div>
          
                                   <div className="flex items-center gap-2">
                                      <ArrowRight className="mb-3 text-gray-400" />
                                       <div className="space-y-2 w-full">
                                          <label className="text-sm font-medium">×¢×“ ××¡×¤×¨</label>
                                          <Input type="number" placeholder="120" value={rangeEnd} onChange={e => setRangeEnd(e.target.value)} />
                                      </div>
                                  </div>
                               </div>
          
                              <Button className="w-full mt-4" onClick={handleSubmit} disabled={createMutation.isPending}>
                                  {createMutation.isPending ? '×™×•×¦×¨ ×—×“×¨×™×...' : '×¦×•×¨ ×—×“×¨×™×'}
                              </Button>
                          </CardContent>
                      </Card>
                     </div>
              );
          }
        ğŸ“„ ManagePriceListsPage.jsx
          // client/src/pages/admin/ManagePriceListsPage.jsx
          
          import React, { useState, useEffect } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import toast from 'react-hot-toast';
          import api from '@/utils/api.js';
          import { Button } from '@/components/ui/Button.jsx';
          import { PlusCircle, Trash2, Edit, Lock, Eye, EyeOff, ArrowUpDown } from 'lucide-react';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Switch } from '@/components/ui/Switch'; // âœ¨ ×™×™×‘×•× ×”-Switch
          
          // --- API Functions ---
          const fetchPriceLists = async () => (await api.get('/pricelists')).data;
          const fetchHotels = async () => (await api.get('/admin/hotels')).data;
          const createPriceList = (data) => api.post('/pricelists', data);
          const updatePriceList = ({ id, ...data }) => api.put(`/pricelists/${id}`, data);
          const deletePriceList = (id) => api.delete(`/pricelists/${id}`);
          
          // --- Helper Component for Form Fields ---
          const InputGroup = ({ label, children, icon }) => (
            <div className="relative">
              <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
              <div className="relative">
                  {icon && <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">{icon}</div>}
                 {children}
              </div>
            </div>
          );
          
          // --- Main Page Component ---
          export default function ManagePriceListsPage() {
            const [formData, setFormData] = useState({});
            const [editingId, setEditingId] = useState(null);
            const queryClient = useQueryClient();
          
            const { data: priceLists = [], isLoading: isLoadingPriceLists } = useQuery({
              queryKey: ['priceLists'],
              queryFn: fetchPriceLists,
            });
          
            const { data: hotels = [], isLoading: isLoadingHotels } = useQuery({
              queryKey: ['hotels'],
              queryFn: fetchHotels,
            });
          
            const commonMutationOptions = {
              onSuccess: () => {
                queryClient.invalidateQueries({ queryKey: ['priceLists'] });
                handleClearForm();
              },
              onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”'),
            };
          
            const { mutate: create, isPending: isCreating } = useMutation({
              mutationFn: createPriceList,
              onSuccess: () => { toast.success('××—×™×¨×•×Ÿ × ×•×¦×¨ ×‘×”×¦×œ×—×”!'); commonMutationOptions.onSuccess(); },
              onError: commonMutationOptions.onError,
            });
          
            const { mutate: update, isPending: isUpdating } = useMutation({
              mutationFn: updatePriceList,
              onSuccess: () => { toast.success('××—×™×¨×•×Ÿ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!'); commonMutationOptions.onSuccess(); },
              onError: commonMutationOptions.onError,
            });
          
            const { mutate: remove } = useMutation({
              mutationFn: deletePriceList,
              onSuccess: () => { toast.success('×”××—×™×¨×•×Ÿ × ××—×§!'); commonMutationOptions.onSuccess(); },
              onError: commonMutationOptions.onError,
            });
          
            const handleClearForm = () => {
              // âœ¨ ××™×¤×•×¡ ×›×•×œ×œ ×©×“×•×ª ×—×“×©×™×
              setFormData({
                  name: '', hotel: '',
                  couple: 0, teen: 0, child: 0, baby: 0, single_room: 0,
                  maxNights: 0,
                  displayOrder: 0, isVisible: true
              });
              setEditingId(null);
            };
          
            const handleSelectForEdit = (priceList) => {
              setEditingId(priceList._id);
              // Ensure hotel ID is used for form state
              const formData = {
                  ...priceList,
                  hotel: priceList.hotel._id,
                  // ××‘×˜×™×— ×¢×¨×›×™ ×‘×¨×™×¨×ª ××—×“×œ ×× ×”× ×—×¡×¨×™× ×‘×“××˜×”×‘×™×™×¡ ×™×©×Ÿ
                  displayOrder: priceList.displayOrder || 0,
                  isVisible: priceList.isVisible !== undefined ? priceList.isVisible : true
              };
              setFormData(formData);
            };
          
            const handleSubmit = (e) => {
              e.preventDefault();
              if (!formData.hotel) {
                  toast.error('×—×•×‘×” ×œ×‘×—×•×¨ ××œ×•×Ÿ.');
                  return;
              }
              const dataToSave = { ...formData };
          
              // × ×™×§×•×™ ×©×“×•×ª ××¡×¤×¨×™×™×
              ['couple', 'teen', 'child', 'baby', 'single_room', 'maxNights', 'displayOrder'].forEach(field => {
                  if (dataToSave[field] === '' || dataToSave[field] === undefined) {
                      dataToSave[field] = 0;
                  }
              });
          
              if (editingId) {
                update({ id: editingId, ...dataToSave });
              } else {
                create(dataToSave);
              }
            };
          
            const handleChange = (e) => {
              const { name, value } = e.target;
              setFormData(prev => ({ ...prev, [name]: value }));
            };
          
            const handleSelectChange = (value) => {
                setFormData(prev => ({ ...prev, hotel: value }));
            };
          
            if (isLoadingPriceLists || isLoadingHotels) return <div className="text-center p-10">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>;
          
            return (
              <div className="container mx-auto p-4 space-y-8">
                <header>
                  <h1 className="text-3xl font-bold text-gray-900">× ×™×”×•×œ ××—×™×¨×•× ×™×</h1>
                  <p className="mt-1 text-gray-600">×”×•×¡×£, ×¢×¨×•×š ×•××—×§ ××ª ×”××—×™×¨×•× ×™× ×”×–××™× ×™× ×œ××¢×¨×›×ª ×”×”×–×× ×•×ª.</p>
                </header>
          
                {/* --- Form Section --- */}
                <section className="bg-white p-6 rounded-2xl shadow-sm border">
                  <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="flex justify-between items-center">
                      <h2 className="text-xl font-bold text-gray-800">{editingId ? '×¢×¨×™×›×ª ××—×™×¨×•×Ÿ' : '×™×¦×™×¨×ª ××—×™×¨×•×Ÿ ×—×“×©'}</h2>
                      {editingId && <Button type="button" variant="outline" onClick={handleClearForm}>×¦×•×¨ ×—×“×©</Button>}
                    </div>
          
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <InputGroup label="×©× ×”××—×™×¨×•×Ÿ (×œ××©×œ: ×¡×•×¤×©, ×—×’×™×)">
                          <input name="name" value={formData.name || ''} onChange={handleChange} required className="w-full p-2 border border-gray-300 rounded-md" />
                      </InputGroup>
                      <InputGroup label="×©×™×•×š ×œ××œ×•×Ÿ">
                          <Select value={formData.hotel || ''} onValueChange={handleSelectChange}>
                              <SelectTrigger><SelectValue placeholder="×‘×—×¨ ××œ×•×Ÿ..." /></SelectTrigger>
                              <SelectContent>
                                  {hotels.map(hotel => <SelectItem key={hotel._id} value={hotel._id}>{hotel.name}</SelectItem>)}
                              </SelectContent>
                          </Select>
                      </InputGroup>
                    </div>
          
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                      <InputGroup label="××—×™×¨ ×œ×–×•×’">
                        <input type="number" name="couple" value={formData.couple || 0} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" />
                      </InputGroup>
                      <InputGroup label="××—×™×¨ ×œ×™×—×™×“">
                        <input type="number" name="single_room" value={formData.single_room || 0} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" />
                      </InputGroup>
                      <InputGroup label="××—×™×¨ ×œ× ×¢×¨">
                        <input type="number" name="teen" value={formData.teen || 0} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" />
                      </InputGroup>
                      <InputGroup label="××—×™×¨ ×œ×™×œ×“">
                        <input type="number" name="child" value={formData.child || 0} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" />
                      </InputGroup>
                      <InputGroup label="××—×™×¨ ×œ×ª×™× ×•×§">
                        <input type="number" name="baby" value={formData.baby || 0} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" />
                      </InputGroup>
          
                      {/* âœ¨ ×©×“×” ×”×’×‘×œ×ª ×œ×™×œ×•×ª */}
                      <InputGroup label="×”×’×‘×œ×ª ×œ×™×œ×•×ª (0=×œ×œ×)" icon={<Lock className="h-4 w-4"/>}>
                          <input
                              type="number"
                              name="maxNights"
                              value={formData.maxNights || 0}
                              onChange={handleChange}
                              className="w-full p-2 pl-10 border border-amber-200 bg-amber-50 rounded-md focus:border-amber-500"
                          />
                      </InputGroup>
          
                      {/* âœ¨ ×©×“×” ×¡×“×¨ ×ª×¦×•×’×” */}
                      <InputGroup label="×¡×“×¨ ×ª×¦×•×’×” (×¢×“×™×¤×•×ª)" icon={<ArrowUpDown className="h-4 w-4"/>}>
                          <input
                              type="number"
                              name="displayOrder"
                              value={formData.displayOrder || 0}
                              onChange={handleChange}
                              className="w-full p-2 pl-10 border border-blue-200 bg-blue-50 rounded-md focus:border-blue-500"
                              title="××¡×¤×¨ × ××•×š ×™×•×ª×¨ ×™×•×¤×™×¢ ×¨××©×•×Ÿ ×‘×¨×©×™××”"
                          />
                      </InputGroup>
                    </div>
          
                    {/* âœ¨ ××ª×’ × ×¨××•×ª */}
                    <div className="flex items-center gap-3 bg-slate-50 p-3 rounded-md border">
                        <Switch
                            checked={formData.isVisible ?? true}
                            onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isVisible: checked }))}
                        />
                        <label className="text-sm font-medium text-gray-700 cursor-pointer select-none">×”×¦×’ ××—×™×¨×•×Ÿ ×–×” ×œ××•×›×¨ ×‘×¢×ª ×™×¦×™×¨×ª ×”×–×× ×”</label>
                    </div>
          
                    <div className="flex justify-end">
                      <Button type="submit" disabled={isCreating || isUpdating}>
                        <PlusCircle className="ml-2 h-4 w-4" />
                        {editingId ? '×©××•×¨ ×©×™× ×•×™×™×' : '×”×•×¡×£ ××—×™×¨×•×Ÿ'}
                      </Button>
                    </div>
                  </form>
                </section>
          
          
                {/* --- Price Lists Table Section --- */}
                <section className="bg-white rounded-2xl shadow-sm border overflow-hidden">
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-sm">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-4 py-3 text-right font-medium text-gray-600">×©×</th>
                          <th className="px-4 py-3 text-right font-medium text-gray-600">××œ×•×Ÿ</th>
                          <th className="px-4 py-3 text-right font-medium text-gray-600">××—×™×¨×™× (×–×•×’/×™×—×™×“)</th>
                          <th className="px-4 py-3 text-right font-medium text-gray-600">×¡×“×¨</th> {/* âœ¨ */}
                          <th className="px-4 py-3 text-right font-medium text-gray-600">×¡×˜×˜×•×¡</th> {/* âœ¨ */}
                          <th className="px-4 py-3 text-right font-medium text-gray-600">×¤×¢×•×œ×•×ª</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-gray-200">
                        {priceLists.map((pl) => (
                          <tr key={pl._id} className="hover:bg-gray-50/50">
                            <td className="px-4 py-3 font-medium text-gray-800">
                                {pl.name}
                                {/* ××™× ×“×™×§×¦×™×” ×œ××’×‘×œ×ª ×œ×™×œ×•×ª */}
                                {pl.maxNights > 0 && (
                                    <span className="mr-2 inline-flex items-center gap-1 text-[10px] bg-amber-100 text-amber-800 px-1.5 py-0.5 rounded-full">
                                        <Lock size={8} /> {pl.maxNights} ×œ×™×œ×•×ª
                                    </span>
                                )}
                            </td>
                            <td className="px-4 py-3 text-gray-500">{pl.hotel?.name || 'N/A'}</td>
                            <td className="px-4 py-3 text-gray-600">{pl.couple}â‚ª / {pl.single_room}â‚ª</td>
          
                            {/* âœ¨ ×”×¦×’×ª ×¡×“×¨ */}
                            <td className="px-4 py-3 font-mono text-gray-500">{pl.displayOrder}</td>
          
                            {/* âœ¨ ×”×¦×’×ª × ×¨××•×ª */}
                            <td className="px-4 py-3">
                                {pl.isVisible ?
                                  <span className="flex items-center gap-1 text-green-600 text-xs font-bold"><Eye size={14}/> ×’×œ×•×™</span> :
                                  <span className="flex items-center gap-1 text-gray-400 text-xs"><EyeOff size={14}/> ××•×¡×ª×¨</span>
                                }
                            </td>
          
                            <td className="px-4 py-3 space-x-2 space-x-reverse">
                              <Button variant="outline" size="sm" onClick={() => handleSelectForEdit(pl)}><Edit className="h-4 w-4" /></Button>
                              <Button variant="destructive" size="sm" onClick={() => {if(window.confirm(`×”×× ×œ××—×•×§ ××ª ×”××—×™×¨×•×Ÿ "${pl.name}"?`)) remove(pl._id)}}><Trash2 className="h-4 w-4" /></Button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </section>
              </div>
            );
          }
        ğŸ“„ ManageReferrersPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import toast from 'react-hot-toast';
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/Dialog";
          import { Users, Edit, ArrowRightLeft, Search, Trophy, CheckCircle2, RefreshCw } from 'lucide-react';
          
          const fetchStats = async () => (await api.get('/referrers/stats')).data;
          const upsertAlias = (data) => api.post('/referrers', data);
          const scanHistoryApi = () => api.post('/referrers/scan'); // ×”×¤×•× ×§×¦×™×” ×©××¤×¢×™×œ×” ××ª ×”×¡×¨×™×§×”
          
          export default function ManageReferrersPage() {
              const [isDialogOpen, setIsDialogOpen] = useState(false);
              const [editData, setEditData] = useState({ source: '', target: '' });
              const [searchTerm, setSearchTerm] = useState('');
              const queryClient = useQueryClient();
          
              const { data: referrers = [], isLoading } = useQuery({
                  queryKey: ['referrerStats'],
                  queryFn: fetchStats
              });
          
              const updateMutation = useMutation({
                  mutationFn: upsertAlias,
                  onSuccess: (res) => {
                      queryClient.invalidateQueries({ queryKey: ['referrerStats'] });
                      toast.success(res.data.message);
                      setIsDialogOpen(false);
                  }
              });
          
              // ×”××•×˜×¦×™×” ×œ×¡×¨×™×§×ª ×”×”×™×¡×˜×•×¨×™×”
              const scanMutation = useMutation({
                  mutationFn: scanHistoryApi,
                  onSuccess: (res) => {
                      queryClient.invalidateQueries({ queryKey: ['referrerStats'] });
                      toast.success(res.data.message);
                  },
                  onError: () => toast.error('×©×’×™××” ×‘×¡×¨×™×§×”')
              });
          
              const filteredList = referrers.filter(r => r.name.toLowerCase().includes(searchTerm.toLowerCase()));
          
              const handleEditClick = (referrer) => {
                  setEditData({ source: referrer.name, target: referrer.name });
                  setIsDialogOpen(true);
              };
          
              return (
                  <div className="container mx-auto p-6 space-y-8">
                      <header className="flex justify-between items-end">
                          <div>
                              <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3">
                                  <Users className="text-blue-600" /> ×“×•×— ×©×•×ª×¤×™×
                              </h1>
                              <p className="text-gray-600 mt-1">
                                  ×”×“×•×— ××‘×•×¡×¡ ×¢×œ ×©×“×” × ×¡×ª×¨ ×©×œ× ××•×¦×’ ×œ××•×›×¨×™×.
                              </p>
                          </div>
                          <Button
                              variant="outline"
                              onClick={() => scanMutation.mutate()}
                              disabled={scanMutation.isPending}
                              className="gap-2"
                          >
                              <RefreshCw className={`h-4 w-4 ${scanMutation.isPending ? 'animate-spin' : ''}`} />
                              {scanMutation.isPending ? '×¡×•×¨×§ ×”×™×¡×˜×•×¨×™×”...' : '×¡×¨×•×§ ×•×¢×“×›×Ÿ ×”×™×¡×˜×•×¨×™×”'}
                          </Button>
                      </header>
          
                      <Card className="shadow-md">
                          <CardHeader className="pb-3 border-b bg-gray-50/50">
                              <div className="flex justify-between items-center">
                                  <CardTitle>×‘×™×¦×•×¢×™× ×‘×–××Ÿ ×××ª</CardTitle>
                                  <div className="relative w-64">
                                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"/>
                                      <Input className="pl-10 bg-white" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder="×—×¤×© ×©×..." />
                                  </div>
                              </div>
                          </CardHeader>
                          <CardContent className="p-0">
                              <table className="min-w-full text-sm divide-y divide-gray-200">
                                  <thead className="bg-gray-50 text-gray-500 font-medium">
                                      <tr>
                                          <th className="px-6 py-3 text-right">×©× ×”××¤× ×”</th>
                                          <th className="px-6 py-3 text-right">×œ×™×“×™×</th>
                                          <th className="px-6 py-3 text-right">××›×™×¨×•×ª (closed)</th>
                                          <th className="px-6 py-3 text-left">× ×™×”×•×œ</th>
                                      </tr>
                                  </thead>
                                  <tbody className="divide-y divide-gray-100 bg-white">
                                      {isLoading ? <tr><td colSpan="4" className="p-6 text-center">×˜×•×¢×Ÿ...</td></tr> :
                                       filteredList.length === 0 ? <tr><td colSpan="4" className="p-6 text-center text-gray-500">××™×Ÿ × ×ª×•× ×™× ×œ×”×¦×’×”</td></tr> :
                                       filteredList.map((item, idx) => (
                                          <tr key={idx} className="hover:bg-blue-50/50 transition-colors group">
                                              <td className="px-6 py-4 font-bold text-gray-800 flex items-center gap-2">
                                                  {idx === 0 && <Trophy className="h-4 w-4 text-yellow-500" />}
                                                  {item.name}
                                              </td>
                                              <td className="px-6 py-4"><span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">{item.count}</span></td>
                                              <td className="px-6 py-4">
                                                  <div className="flex items-center gap-2">
                                                      <span className={`px-2 py-0.5 rounded-full font-bold flex items-center gap-1 ${item.sales > 0 ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-400'}`}>
                                                          {item.sales > 0 && <CheckCircle2 size={14} />}
                                                          {item.sales}
                                                      </span>
                                                  </div>
                                              </td>
                                              <td className="px-6 py-4 text-left">
                                                  <Button variant="outline" size="sm" onClick={() => handleEditClick(item)} className="text-blue-600 border-blue-200 hover:bg-blue-50">
                                                      <Edit className="h-3.5 w-3.5 ml-1.5"/> ××™×—×•×“ ×©×
                                                  </Button>
                                              </td>
                                          </tr>
                                      ))}
                                  </tbody>
                              </table>
                          </CardContent>
                      </Card>
          
                      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
                          <DialogContent>
                              <DialogHeader><DialogTitle>××™×–×•×’ ×©××•×ª</DialogTitle></DialogHeader>
                              <div className="py-4 flex items-center gap-2 justify-center">
                                  <span className="line-through text-red-500">{editData.source}</span>
                                  <ArrowRightLeft className="text-gray-400" />
                                  <Input value={editData.target} onChange={e => setEditData(p => ({...p, target: e.target.value}))} className="w-40 font-bold text-center" />
                              </div>
                              <DialogFooter><Button onClick={() => updateMutation.mutate({ alias: editData.source, officialName: editData.target })}>×©××•×¨</Button></DialogFooter>
                          </DialogContent>
                      </Dialog>
                  </div>
              );
          }
        ğŸ“„ ManageUsersPage.jsx
          import React, { useState } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import toast from 'react-hot-toast';
          // UI Components
          import { Button } from '@/components/ui/Button.jsx';
          import { Input } from '@/components/ui/Input.jsx';
          import { Switch } from '@/components/ui/Switch';
          import { Label } from '@/components/ui/Label.jsx';
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogClose } from "@/components/ui/Dialog";
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Users, Trash2, PlusCircle, Briefcase, Wrench, Shield } from 'lucide-react';
          
          // API Functions
          const fetchUsers = async () => (await api.get('/admin/users')).data;
          const updateUser = (userData) => api.put(`/admin/users/${userData._id}`, userData);
          const createUser = (userData) => api.post('/admin/users', userData);
          const deleteUser = (userId) => api.delete(`/admin/users/${userId}`);
          
          // ××™×œ×•×Ÿ ×ª×¦×•×’×” ×œ×ª×¤×§×™×“×™×
          const roleLabels = {
              admin: '×× ×”×œ ××¢×¨×›×ª',
              sales: '××™×© ××›×™×¨×•×ª',
              maintenance: '×ª×—×–×•×§×” ×•× ×§×™×•×Ÿ'
          };
          
          export default function ManageUsersPage() {
              const queryClient = useQueryClient();
              const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);
          
              // âœ¨ ×”×•×¡×¤× ×• ××ª canViewCommissions ×œ×¡×˜×™×™×˜ ×”×”×ª×—×œ×ª×™
              const [newUserForm, setNewUserForm] = useState({
                  name: '', email: '', password: '', role: 'sales',
                  canManagePriceLists: false, canViewCommissions: false
              });
          
              const { data: users = [], isLoading, isError } = useQuery({ queryKey: ['users'], queryFn: fetchUsers });
          
              const commonMutationOptions = {
                  onSuccess: () => queryClient.invalidateQueries({ queryKey: ['users'] }),
                  onError: (err) => toast.error(err.response?.data?.message || '××™×¨×¢×” ×©×’×™××”'),
              };
          
              const updateUserMutation = useMutation({ ...commonMutationOptions, mutationFn: updateUser });
              const createUserMutation = useMutation({
                  ...commonMutationOptions,
                  mutationFn: createUser,
                  onSuccess: () => {
                      commonMutationOptions.onSuccess();
                      setIsCreateDialogOpen(false);
                      setNewUserForm({ name: '', email: '', password: '', role: 'sales', canManagePriceLists: false, canViewCommissions: false });
                      toast.success('××©×ª××© × ×•×¦×¨ ×‘×”×¦×œ×—×”!');
                  },
              });
              const deleteUserMutation = useMutation({ ...commonMutationOptions, mutationFn: deleteUser });
          
              // âœ¨ ×¤×•× ×§×¦×™×” ×’× ×¨×™×ª ×œ×©×™× ×•×™ ×”×¨×©××•×ª
              const handlePermissionChange = (user, field, value) => {
                  updateUserMutation.mutate({ ...user, [field]: value });
              };
          
              const handleCreateUser = (e) => {
                  e.preventDefault();
                  createUserMutation.mutate(newUserForm);
              };
          
              const handleDeleteUser = (userId) => {
                  if (window.confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××©×ª××©?')) {
                      deleteUserMutation.mutate(userId);
                  }
              };
          
              return (
                  <div className="container mx-auto p-4 sm:p-6 lg:p-8 space-y-8">
                      <header className="flex justify-between items-center">
                          <div>
                              <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3"><Users /> × ×™×”×•×œ ××©×ª××©×™×</h1>
                              <p className="mt-2 text-gray-600">×¦×¤×™×™×”, ×”×¨×©××•×ª ×•×™×¦×™×¨×ª ××©×ª××©×™× ×—×“×©×™×.</p>
                          </div>
                          <Button onClick={() => setIsCreateDialogOpen(true)}><PlusCircle className="ml-2" /> ×¦×•×¨ ××©×ª××© ×—×“×©</Button>
                      </header>
          
                      <main className="bg-white rounded-2xl border shadow-sm overflow-hidden">
                          <div className="overflow-x-auto">
                              <table className="min-w-full text-sm">
                                  <thead className="bg-gray-50">
                                      <tr>
                                          <th className="px-4 py-3 text-right font-medium">×©×</th>
                                          <th className="px-4 py-3 text-right font-medium">××™××™×™×œ</th>
                                          <th className="px-4 py-3 text-right font-medium">×ª×¤×§×™×“</th>
                                          <th className="px-4 py-3 text-right font-medium">× ×™×”×•×œ ××—×™×¨×•× ×™×</th>
                                          <th className="px-4 py-3 text-right font-medium">×¦×¤×™×™×” ×‘×¢××œ×•×ª</th> {/* âœ¨ ×¢××•×“×” ×—×“×©×” */}
                                          <th className="px-4 py-3"></th>
                                      </tr>
                                  </thead>
                                  <tbody className="divide-y">
                                      {isLoading && <tr><td colSpan="6" className="p-8 text-center">×˜×•×¢×Ÿ ××©×ª××©×™×...</td></tr>}
                                      {isError && <tr><td colSpan="6" className="p-8 text-center text-red-600">×©×’×™××” ×‘×˜×¢×™× ×ª ××©×ª××©×™×</td></tr>}
          
                                      {users.map(user => (
                                          <tr key={user._id} className="hover:bg-gray-50/50">
                                              <td className="px-4 py-3 font-medium">{user.name}</td>
                                              <td className="px-4 py-3 text-gray-600">{user.email}</td>
                                              <td className="px-4 py-3">
                                                  <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium
                                                      ${user.role === 'admin' ? 'bg-purple-100 text-purple-700' :
                                                      user.role === 'maintenance' ? 'bg-orange-100 text-orange-700' : 'bg-blue-100 text-blue-700'}`}>
                                                      {user.role === 'admin' && <Shield size={12}/>}
                                                      {user.role === 'maintenance' && <Wrench size={12}/>}
                                                      {user.role === 'sales' && <Briefcase size={12}/>}
                                                      {roleLabels[user.role] || user.role}
                                                  </span>
                                              </td>
                                              {/* × ×™×”×•×œ ××—×™×¨×•× ×™× */}
                                              <td className="px-4 py-3">
                                                  <Switch
                                                      checked={user.canManagePriceLists}
                                                      onCheckedChange={(checked) => handlePermissionChange(user, 'canManagePriceLists', checked)}
                                                      disabled={updateUserMutation.isPending || user.role === 'admin'}
                                                      aria-label="× ×™×”×•×œ ××—×™×¨×•× ×™×"
                                                  />
                                              </td>
                                              {/* âœ¨ ×¦×¤×™×™×” ×‘×¢××œ×•×ª */}
                                              <td className="px-4 py-3">
                                                  <Switch
                                                      checked={user.canViewCommissions}
                                                      onCheckedChange={(checked) => handlePermissionChange(user, 'canViewCommissions', checked)}
                                                      disabled={updateUserMutation.isPending || user.role === 'admin'}
                                                      aria-label="×¦×¤×™×™×” ×‘×¢××œ×•×ª"
                                                  />
                                              </td>
                                              <td className="px-4 py-3 text-left">
                                                  <Button variant="ghost" size="icon" onClick={() => handleDeleteUser(user._id)} disabled={user.role === 'admin'}>
                                                      <Trash2 className="h-4 w-4 text-red-500" />
                                                  </Button>
                                              </td>
                                          </tr>
                                      ))}
                                  </tbody>
                              </table>
                          </div>
                      </main>
          
                      {/* Create User Dialog */}
                      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>
                          <DialogContent>
                              <DialogHeader><DialogTitle>×™×¦×™×¨×ª ××©×ª××© ×—×“×©</DialogTitle></DialogHeader>
                              <form id="createUserForm" onSubmit={handleCreateUser} className="space-y-4 pt-4">
                                  <Input name="name" placeholder="×©× ××œ×" value={newUserForm.name} onChange={(e) => setNewUserForm(p => ({...p, name: e.target.value}))} required />
                                  <Input name="email" type="email" placeholder="××™××™×™×œ" value={newUserForm.email} onChange={(e) => setNewUserForm(p => ({...p, email: e.target.value}))} required />
                                  <Input name="password" type="password" placeholder="×¡×™×¡××”" value={newUserForm.password} onChange={(e) => setNewUserForm(p => ({...p, password: e.target.value}))} required />
          
                                  <div>
                                      <Label className="mb-2 block">×ª×¤×§×™×“ ×‘××¢×¨×›×ª</Label>
                                      <Select value={newUserForm.role} onValueChange={(v) => setNewUserForm(p => ({...p, role: v}))}>
                                          <SelectTrigger><SelectValue /></SelectTrigger>
                                          <SelectContent>
                                              <SelectItem value="sales">××™×© ××›×™×¨×•×ª (×¨×’×™×œ)</SelectItem>
                                              <SelectItem value="maintenance">×¢×•×‘×“ ×ª×—×–×•×§×”/× ×§×™×•×Ÿ</SelectItem>
                                              <SelectItem value="admin">×× ×”×œ ××¢×¨×›×ª (Admin)</SelectItem>
                                          </SelectContent>
                                      </Select>
                                  </div>
          
                                  {/* ×”×¨×©××•×ª × ×•×¡×¤×•×ª */}
                                  {newUserForm.role !== 'admin' && newUserForm.role !== 'maintenance' && (
                                      <div className="space-y-3">
                                          <div className="flex items-center space-x-2 space-x-reverse bg-slate-50 p-3 rounded border">
                                              <Switch id="canManage" checked={newUserForm.canManagePriceLists} onCheckedChange={(c) => setNewUserForm(p => ({...p, canManagePriceLists: c}))} />
                                              <Label htmlFor="canManage">×”×¨×©××” ×œ× ×™×”×•×œ ××—×™×¨×•× ×™×</Label>
                                          </div>
                                          {/* âœ¨ ××ª×’ ×—×“×© ×œ×™×¦×™×¨×” */}
                                          <div className="flex items-center space-x-2 space-x-reverse bg-slate-50 p-3 rounded border">
                                              <Switch id="canViewComm" checked={newUserForm.canViewCommissions} onCheckedChange={(c) => setNewUserForm(p => ({...p, canViewCommissions: c}))} />
                                              <Label htmlFor="canViewComm">×”×¨×©××” ×œ×¦×¤×™×™×” ×‘×¢××œ×•×ª</Label>
                                          </div>
                                      </div>
                                  )}
                              </form>
                              <DialogFooter>
                                  <DialogClose asChild><Button variant="outline">×‘×™×˜×•×œ</Button></DialogClose>
                                  <Button type="submit" form="createUserForm" disabled={createUserMutation.isPending}>
                                      {createUserMutation.isPending ? '×™×•×¦×¨...' : '×©××•×¨ ××©×ª××©'}
                                  </Button>
                              </DialogFooter>
                          </DialogContent>
                      </Dialog>
                  </div>
              );
          }
        ğŸ“„ RoomStatusPage.jsx
          import React, { useMemo } from 'react';
          import { useQuery } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card.jsx';
          import { CheckCircle2, XCircle, AlertTriangle, Paintbrush, Hotel } from 'lucide-react';
          
          const fetchAllRooms = async () => (await api.get('/rooms/all')).data;
          export default function RoomStatusPage() {
              // ×˜×•×¢×Ÿ ××ª ×›×œ ×”×—×“×¨×™× ××›×œ ×”××œ×•× ×•×ª (×“×•×¨×© ×”×¨×©××ª ×× ×”×œ)
              const { data: rooms = [], isLoading } = useQuery({
                  queryKey: ['allRoomsAdmin'],
                  queryFn: fetchAllRooms,
                  refetchInterval: 10000 // ×¨×¢× ×•×Ÿ ×›×œ 10 ×©× ×™×•×ª
              });
              const stats = useMemo(() => {
                  const data = {
                      clean: [],
                      dirty: [],      // ×œ× × ×§×™×™× ×©×˜×¨× × ×’×¢×• ×‘×”×
                       partial: [],    // ×”×ª×—×™×œ×• ×œ×¢×‘×•×“ (×—×œ×§ ××”××©×™××•×ª ×‘×•×¦×¢×•)
                      maintenance: [] // ×ª×§×•×œ×™×
                  };
          
                  rooms.forEach(room => {
                       if (room.status === 'clean') {
                          data.clean.push(room);
                      } else if (room.status === 'maintenance') {
                          data.maintenance.push(room);
                       } else {
                          // ×‘×“×™×§×” ×× ×–×” 'dirty' ×¨×’×™×œ ××• 'partial'
                          const completed = room.tasks.filter(t => t.isCompleted).length;
                           if (completed > 0) {
                              data.partial.push(room);
                          } else {
                               data.dirty.push(room);
                          }
                      }
                  });
                  return data;
              }, [rooms]);
          
              if (isLoading) return <div className="p-10 text-center text-gray-500">×˜×•×¢×Ÿ ×ª××•× ×ª ××¦×‘...</div>;
              return (
                  <div className="container mx-auto p-6 space-y-8 min-h-screen bg-slate-50">
                      <header>
                          <h1 className="text-3xl font-bold text-gray-900">×ª××•× ×ª ××¦×‘ ×—×“×¨×™×</h1>
                           <p className="text-gray-500">×“×©×‘×•×¨×“ × ×™×”×•×œ×™ - ×¦×¤×™×™×” ×‘×œ×‘×“</p>
                      </header>
          
                      {/* ×›×¨×˜×™×¡×™ ×¡×™×›×•× */}
                      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                           <StatCard title="×—×“×¨×™× × ×§×™×™×" count={stats.clean.length} color="text-green-600" bg="bg-green-50" icon={<CheckCircle2/>} />
                          <StatCard title="×‘×ª×”×œ×™×š ×¢×‘×•×“×”" count={stats.partial.length} color="text-amber-600" bg="bg-amber-50" icon={<Paintbrush/>} />
                          <StatCard title="×××ª×™× ×™× ×œ× ×§×™×•×Ÿ" count={stats.dirty.length} color="text-slate-600" bg="bg-white" icon={<XCircle/>} />
                           <StatCard title="××•×©×‘×ª×™× / ×ª×§×•×œ×™×" count={stats.maintenance.length} color="text-red-600" bg="bg-red-50" icon={<AlertTriangle/>} />
                      </div>
          
                      {/* ×¤×™×¨×•×˜ ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª */}
                       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          
                          <StatusColumn title="×ª×§×•×œ×™× / ×‘×˜×™×¤×•×œ (Maintenance)" items={stats.maintenance} color="border-red-500" />
          
                          <StatusColumn title="×‘×ª×”×œ×™×š × ×§×™×•×Ÿ (×”×ª×—×™×œ×•)" items={stats.partial} color="border-amber-400" />
          
                          <StatusColumn title="×××ª×™× ×™× (××£ ××©×™××” ×œ× ×‘×•×¦×¢×”)" items={stats.dirty} color="border-slate-300" />
          
                          <StatusColumn title="× ×§×™×™× ×•××•×›× ×™×" items={stats.clean} color="border-green-500" />
          
                       </div>
                  </div>
              );
          }
          
          function StatCard({ title, count, color, bg, icon }) {
              return (
                  <Card className={`${bg} border-none shadow-sm`}>
                      <CardContent className="p-6 flex items-center justify-between">
                           <div>
                              <p className="text-sm font-medium text-gray-600">{title}</p>
                              <p className={`text-4xl font-bold ${color} mt-1`}>{count}</p>
                           </div>
                          <div className={`${color} opacity-20 scale-150`}>{icon}</div>
                      </CardContent>
                  </Card>
              );
          }
          
          function StatusColumn({ title, items, color }) {
              return (
                  <div className={`bg-white rounded-xl shadow-sm border-t-4 ${color} overflow-hidden flex flex-col h-[600px]`}>
                      <div className="p-4 border-b bg-gray-50 font-bold text-gray-700 flex justify-between">
                           <span>{title}</span>
                          <span className="bg-white px-2 rounded text-sm border">{items.length}</span>
                      </div>
                      <div className="flex-1 overflow-y-auto p-2 space-y-2">
                          {items.map(room => (
                              <div key={room._id} className="p-3 border rounded hover:bg-slate-50 transition flex justify-between items-center">
                                   <div>
                                      <span className="font-bold text-lg block">{room.roomNumber}</span>
                                      <span className="text-xs text-gray-400 flex items-center gap-1">
                                           <Hotel size={10}/> {room.hotel?.name}
                                      </span>
                                   </div>
                                  {room.lastCleanedBy && (
                                      <div className="text-[10px] text-gray-400 text-left">
                                           <p>× ×•×§×” ×¢"×™:</p>
                                          <p>{room.lastCleanedBy.name}</p>
                                       </div>
                                  )}
                              </div>
                          ))}
                           {items.length === 0 && <p className="text-center text-gray-300 mt-10 text-sm">××™×Ÿ ×—×“×¨×™× ×‘×¡×˜×˜×•×¡ ×–×”</p>}
                      </div>
                  </div>
              );
          }
        ğŸ“ room/
          ğŸ“„ ManageChecklistsPage.jsx
            import React, { useState } from 'react';
            import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
            import api from '@/utils/api.js';
            import toast from 'react-hot-toast';
            import { Button } from '@/components/ui/Button.jsx';
            import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/Card.jsx';
            import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "@/components/ui/Dialog";
            import { Input } from '@/components/ui/Input.jsx';
            import { ListChecks, PlusCircle, ArrowUp, ArrowDown, X, Hotel } from 'lucide-react';
            
            const fetchHotels = async () => (await api.get('/admin/hotels')).data;
            const updateMasterChecklist = ({ id, checklist }) => api.put(`/admin/hotels/${id}/checklist`, { checklist });
            
            export default function ManageChecklistsPage() {
                const [selectedHotel, setSelectedHotel] = useState(null);
                const { data: hotels = [], isLoading } = useQuery({ queryKey: ['hotels'], queryFn: fetchHotels });
            
                if (isLoading) return <div className="p-8 text-center">×˜×•×¢×Ÿ ××œ×•× ×•×ª...</div>;
            
                return (
                    <div className="container mx-auto p-6 space-y-6">
                        <header>
                            <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-2">
                                <ListChecks className="text-blue-600"/> × ×™×”×•×œ × ×”×œ×™ × ×™×§×™×•×Ÿ (×¦'×§ ×œ×™×¡×˜)
                            </h1>
                            <p className="text-gray-600 mt-1">×›××Ÿ ××’×“×™×¨×™× ××” ×”×¢×•×‘×“×™× ×—×™×™×‘×™× ×œ×‘×¦×¢ ×‘×›×œ × ×™×§×™×•×Ÿ ×—×“×¨.</p>
                        </header>
            
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {hotels.map(hotel => (
                                <Card key={hotel._id} className="hover:shadow-md transition-shadow cursor-pointer border-t-4 border-t-blue-500" onClick={() => setSelectedHotel(hotel)}>
                                    <CardHeader>
                                        <CardTitle className="flex items-center justify-between">
                                            {hotel.name}
                                            <Hotel size={20} className="text-gray-400"/>
                                        </CardTitle>
                                        <CardDescription>
                                            {hotel.masterChecklist?.length || 0} ××©×™××•×ª ××•×’×“×¨×•×ª
                                        </CardDescription>
                                    </CardHeader>
                                    <CardContent>
                                        <Button variant="outline" className="w-full">×¢×¨×•×š ×¨×©×™××”</Button>
                                    </CardContent>
                                </Card>
                            ))}
                        </div>
            
                        {selectedHotel && (
                            <ChecklistDialog
                                hotel={selectedHotel}
                                isOpen={!!selectedHotel}
                                onClose={() => setSelectedHotel(null)}
                            />
                        )}
                    </div>
                );
            }
            
            // --- ××•×ª×• ×“×™××œ×•×’ ×¢×¨×™×›×” ×©×”×™×” ×§×•×“×, ×¢×›×©×™×• ×›×—×œ×§ ××”×“×£ ×”×–×” ---
            function ChecklistDialog({ hotel, isOpen, onClose }) {
                const queryClient = useQueryClient();
                const [checklist, setChecklist] = useState(hotel.masterChecklist || []);
                const [newItemText, setNewItemText] = useState('');
            
                const updateMutation = useMutation({
                    mutationFn: (newChecklist) => updateMasterChecklist({ id: hotel._id, checklist: newChecklist }),
                    onSuccess: () => {
                        queryClient.invalidateQueries({ queryKey: ['hotels'] });
                        toast.success("×”×¨×©×™××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!");
                        onClose();
                    },
                    onError: () => toast.error('×©×’×™××” ×‘×©××™×¨×”')
                });
            
                const addItem = () => {
                    if (!newItemText.trim()) return;
                    setChecklist([...checklist, { text: newItemText.trim(), order: checklist.length }]);
                    setNewItemText('');
                };
            
                const removeItem = (index) => setChecklist(checklist.filter((_, i) => i !== index));
            
                const moveItem = (index, direction) => {
                    const newList = [...checklist];
                    const item = newList[index];
                    newList.splice(index, 1);
                    newList.splice(index + direction, 0, item);
                    setChecklist(newList);
                };
            
                return (
                    <Dialog open={isOpen} onOpenChange={onClose}>
                        <DialogContent className="max-w-xl">
                            <DialogHeader>
                                <DialogTitle>×¢×¨×™×›×ª × ×”×œ×™× - {hotel.name}</DialogTitle>
                                <DialogDescription>×¨×©×™××” ×–×• ×ª×•×¤×™×¢ ××•×˜×•××˜×™×ª ×›×©×”×—×“×¨ ××¡×•××Ÿ ×›"××œ×•×›×œ×š".</DialogDescription>
                            </DialogHeader>
                            <div className="space-y-4 py-4">
                                <div className="flex gap-2">
                                    <Input placeholder="××©×™××” ×—×“×©×” (×œ××©×œ: ×”×—×œ×¤×ª ××’×‘×•×ª)..." value={newItemText} onChange={e => setNewItemText(e.target.value)} onKeyDown={e => e.key === 'Enter' && addItem()} />
                                    <Button onClick={addItem}><PlusCircle/></Button>
                                </div>
                                <div className="space-y-2 max-h-[50vh] overflow-y-auto bg-slate-50 p-2 rounded border">
                                    {checklist.map((item, idx) => (
                                        <div key={idx} className="flex justify-between items-center bg-white p-3 rounded border shadow-sm">
                                            <span className="flex items-center gap-2"><span className="font-mono text-gray-400 text-xs">{idx + 1}.</span> {item.text}</span>
                                            <div className="flex gap-1">
                                                <Button variant="ghost" size="icon" className="h-6 w-6" disabled={idx === 0} onClick={() => moveItem(idx, -1)}><ArrowUp size={14}/></Button>
                                                <Button variant="ghost" size="icon" className="h-6 w-6" disabled={idx === checklist.length - 1} onClick={() => moveItem(idx, 1)}><ArrowDown size={14}/></Button>
                                                <Button variant="ghost" size="icon" className="h-6 w-6 text-red-500 ml-2" onClick={() => removeItem(idx)}><X size={14}/></Button>
                                            </div>
                                        </div>
                                    ))}
                                    {checklist.length === 0 && <p className="text-center text-gray-400 py-4">×”×¨×©×™××” ×¨×™×§×”.</p>}
                                </div>
                            </div>
                            <DialogFooter>
                                <Button variant="outline" onClick={onClose}>×‘×™×˜×•×œ</Button>
                                <Button onClick={() => updateMutation.mutate(checklist)} disabled={updateMutation.isPending}>{updateMutation.isPending ? '×©×•××¨...' : '×©××•×¨ ×©×™× ×•×™×™×'}</Button>
                            </DialogFooter>
                        </DialogContent>
                    </Dialog>
                );
            }
          ğŸ“„ RoomsConsolePage.jsx
            import React from 'react';
            import { Link } from 'react-router-dom';
            import { Card, CardHeader, CardTitle, CardContent, CardDescription } from '@/components/ui/Card.jsx';
            import {
                CalendarDays, ListChecks, Hotel, Wrench, ArrowRight, Activity
            } from 'lucide-react';
            
            export default function RoomsConsolePage() {
                const menuItems = [
                    {
                        title: "×ª××•× ×ª ××¦×‘ (Live)",
                        desc: "×¦×¤×™×™×” ×‘×¡×˜×˜×•×¡×™× ×‘×–××Ÿ ×××ª: × ×§×™, ××œ×•×›×œ×š, ×ª×§×œ×•×ª.",
                        icon: <Activity size={32} className="text-green-600"/>,
                        to: "/admin/rooms-status",
                        color: "border-green-200 hover:border-green-400"
                    },
                    {
                        title: "×¡×™×“×•×¨ ×¢×‘×•×“×” ×™×•××™",
                        desc: "×”×›× ×ª ×—×“×¨×™× ×œ××—×¨ (Stayover / Checkout) ×•×”×•×¨××•×ª.",
                        icon: <CalendarDays size={32} className="text-blue-600"/>,
                        to: "/admin/daily-plan",
                        color: "border-blue-200 hover:border-blue-400"
                    },
                    {
                        title: "× ×™×”×•×œ ×¦'×§ ×œ×™×¡×˜×™×",
                        desc: "×”×’×“×¨×ª ×¨×©×™××ª ×”××©×™××•×ª ×”×§×‘×•×¢×” ×œ×›×œ ××œ×•×Ÿ.",
                        icon: <ListChecks size={32} className="text-purple-600"/>,
                        to: "/admin/rooms-checklists", // ×”× ×ª×™×‘ ×”×—×“×© ×©×™×¦×¨× ×•
                        color: "border-purple-200 hover:border-purple-400"
                    },
                    {
                        title: "××¨×›×– ×‘×§×¨×” ×ª×¤×¢×•×œ×™",
                        desc: "×“×©×‘×•×¨×“ ×× ×”×œ×™× ×”×›×•×œ×œ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×•×’×¨×¤×™×.",
                        icon: <Wrench size={32} className="text-amber-600"/>,
                        to: "/admin/maintenance",
                        color: "border-amber-200 hover:border-amber-400"
                    },
                    {
                        title: "×”×§××ª ×—×“×¨×™×",
                        desc: "×”×•×¡×¤×ª ×—×“×¨×™× ×—×“×©×™× ×œ××¢×¨×›×ª (Bulk).",
                        icon: <Hotel size={32} className="text-slate-600"/>,
                        to: "/admin/rooms/create",
                        color: "border-slate-200 hover:border-slate-400"
                    }
                ];
            
                return (
                    <div className="container mx-auto p-6 space-y-8">
                        <header>
                            <h1 className="text-3xl font-bold text-gray-900">× ×™×”×•×œ ××¢×¨×š ×”×—×“×¨×™×</h1>
                            <p className="text-gray-600 mt-2">×›×œ ×”×›×œ×™× ×œ× ×™×”×•×œ ×”×ª×¤×¢×•×œ, ×”× ×™×§×™×•×Ÿ ×•×”×ª×—×–×•×§×” ×‘××§×•× ××—×“.</p>
                        </header>
            
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {menuItems.map((item, idx) => (
                                <Link key={idx} to={item.to} className="block group h-full">
                                    <Card className={`h-full transition-all duration-200 hover:shadow-md border-t-4 ${item.color}`}>
                                        <CardHeader>
                                            <div className="flex justify-between items-start">
                                                <div className="p-3 bg-slate-50 rounded-xl group-hover:scale-110 transition-transform">
                                                    {item.icon}
                                                </div>
                                                <ArrowRight className="text-gray-300 group-hover:text-gray-600"/>
                                            </div>
                                            <CardTitle className="mt-4 text-xl">{item.title}</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <CardDescription className="text-base">{item.desc}</CardDescription>
                                        </CardContent>
                                    </Card>
                                </Link>
                            ))}
                        </div>
                    </div>
                );
            }
      ğŸ“ maintenance/
        ğŸ“„ MaintenanceDashboardPage.jsx
          // client/src/pages/maintenance/MaintenanceDashboardPage.jsx
          import React, { useState, useMemo, useEffect } from 'react';
          import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
          import api from '@/utils/api.js';
          import toast from 'react-hot-toast';
          import { Button } from '@/components/ui/Button.jsx';
          import { Card, CardContent } from '@/components/ui/Card.jsx';
          import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/Select";
          import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from "@/components/ui/Dialog";
          import { Input } from "@/components/ui/Input.jsx";
          import { Checkbox } from "@/components/ui/Checkbox.jsx";
          import { Switch } from "@/components/ui/Switch";
          import { Label } from "@/components/ui/Label";
          import {
              Hotel, CheckCircle2, Paintbrush, Search, Plus,
              ClipboardCheck, AlertCircle, CheckSquare, Wrench, Clock, Star
          } from 'lucide-react';
          const fetchHotels = async () => (await api.get('/admin/hotels')).data;
          const fetchRooms = async (hotelId) => (await api.get(`/rooms/${hotelId}`)).data;
          // ... (MaintenanceDashboardPage ×”×¨××©×™×ª × ×©××¨×ª ×–×”×” ×¢×“ ×œ-RoomManagementDialog) ...
          export default function MaintenanceDashboardPage() {
              const [selectedHotelId, setSelectedHotelId] = useState(null);
              const [hotelName, setHotelName] = useState('');
              const [searchTerm, setSearchTerm] = useState('');
              const [selectedRoomId, setSelectedRoomId] = useState(null);
              const queryClient = useQueryClient();
              const { data: hotels = [] } = useQuery({
                  queryKey: ['hotels'],
                  queryFn: fetchHotels,
              });
              useEffect(() => {
                  if (hotels.length > 0 && !selectedHotelId) {
                      const zippori = hotels.find(h => h.name.includes('×¦×™×¤×•×¨×™ ×‘×›×¤×¨')) || hotels[0];
                      setSelectedHotelId(zippori._id);
                      setHotelName(zippori.name);
                  }
              }, [hotels, selectedHotelId]);
              const { data: rooms = [], isLoading } = useQuery({
                  queryKey: ['rooms', selectedHotelId],
                  queryFn: () => fetchRooms(selectedHotelId),
                  enabled: !!selectedHotelId,
                  refetchInterval: 3000
              });
          
              const filteredRooms = useMemo(() => {
                  if (!rooms) return [];
                  return rooms.filter(r => r.roomNumber.includes(searchTerm));
              }, [rooms, searchTerm]);
              const activeRoomData = useMemo(() => {
                  if (!selectedRoomId || !rooms) return null;
                  return rooms.find(r => r._id === selectedRoomId);
              }, [rooms, selectedRoomId]);
              return (
                  <div className="min-h-screen bg-slate-50 pb-20">
                      <div className="bg-white shadow-sm sticky top-0 z-10 border-b p-4 space-y-4">
                          <div className="flex justify-between items-center">
                             <div>
                                  <h1 className="text-2xl font-bold text-slate-800 flex gap-2 items-center">
                                      <Paintbrush className="text-blue-600"/> ×ª×¤×¢×•×œ ×•× ×™×§×™×•×Ÿ
                                  </h1>
                                  {hotelName && <p className="text-sm text-slate-500 mt-1 font-medium">{hotelName}</p>}
                              </div>
                          </div>
                          <div className="relative">
                              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                             <Input placeholder="×—×¤×© ××¡×¤×¨ ×—×“×¨..." className="pl-10 text-lg" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                          </div>
                      </div>
          
                      <div className="container mx-auto p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                          {isLoading ?
          <p className="text-center col-span-full py-10">×˜×•×¢×Ÿ ×—×“×¨×™×...</p> : filteredRooms.map(room => (
                              <RoomCard key={room._id} room={room} onClick={() => setSelectedRoomId(room._id)} />
                          ))}
                      </div>
          
                      {activeRoomData && (
                          <RoomManagementDialog
                              room={activeRoomData}
                              hotelId={selectedHotelId}
                              isOpen={!!selectedRoomId}
                              onClose={() => setSelectedRoomId(null)}
                          />
                      )}
                  </div>
              );
          }
          
          function RoomCard({ room, onClick }) {
              const isMaintenance = room.status === 'maintenance';
              const isClean = room.status === 'clean';
              const tasks = room.tasks || [];
              const totalTasks = tasks.length;
              const completedTasks = tasks.filter(t => t.isCompleted).length;
              const isPartial = !isClean && !isMaintenance && completedTasks > 0;
              let cardStyle = 'bg-white border-slate-200';
              let icon = <ClipboardCheck size={16}/>;
              let text = `${totalTasks - completedTasks} ××©×™××•×ª`;
              let textColor = 'text-slate-600';
          
              if (isMaintenance) {
                  cardStyle = 'bg-red-50 border-red-500 shadow-red-100';
                  icon = <Wrench size={16}/>;
                  text = '×‘×ª×™×§×•×Ÿ / ×ª×§×•×œ';
                  textColor = 'text-red-700';
              } else if (isClean) {
                  cardStyle = 'bg-green-50 border-green-500 shadow-green-100';
                  icon = <CheckCircle2 size={16}/>;
                  text = '× ×§×™ ×•××•×›×Ÿ';
                  textColor = 'text-green-700';
              } else if (isPartial) {
                  cardStyle = 'bg-amber-50 border-amber-400 shadow-amber-100';
                  icon = <Paintbrush size={16}/>;
                  text = `×‘×ª×”×œ×™×š (${completedTasks}/${totalTasks})`;
                  textColor = 'text-amber-700';
              }
          
              return (
                  <Card className={`cursor-pointer transition-all hover:scale-[1.02] hover:shadow-lg border-t-4 ${cardStyle}`} onClick={onClick}>
                      <CardContent className="p-4 text-center flex flex-col justify-between h-full min-h-[100px]">
                         <div>
                              <div className="text-3xl font-black text-slate-800">{room.roomNumber}</div>
                              <div className="text-xs text-slate-500 font-medium">{room.roomType?.name}</div>
                          </div>
                           <div className={`flex items-center justify-center gap-2 font-bold text-sm mt-3 ${textColor}`}>
                              {icon}<span>{text}</span>
                          </div>
                      </CardContent>
                  </Card>
              );
          }
          
          // --- âœ¨ ×›××Ÿ ××ª×¨×—×© ×”×§×¡×: 3 ×©×›×‘×•×ª ×•×™×–×•××œ×™×•×ª ---
          function RoomManagementDialog({ room, hotelId, isOpen, onClose }) {
              const [newTaskText, setNewTaskText] = useState('');
              const [isTemporary, setIsTemporary] = useState(true);
              const queryClient = useQueryClient();
              const queryKey = ['rooms', hotelId];
              // ... (××•×ª×Ÿ ××•×˜×¦×™×•×ª ××•×¤×˜×™××™×•×ª ×›×¤×™ ×©×”×™×• ×§×•×“×, ×œ×œ× ×©×™× ×•×™ ×‘×§×•×“ ×”××•×˜×¦×™×”) ...
              // ×§×™×¦×•×¨ ×œ×¦×•×¨×š ×§×¨×™××•×ª: ×× ×™ ×× ×™×— ×©××ª×” ××©×ª××© ×‘××•×˜×¦×™×•×ª ××”×§×•×‘×¥ ×”×§×•×“×.
              // ×× ×¦×¨×™×š ××•×ª×Ÿ ×©×•×‘, ×ª×’×™×“ ×œ×™.
              // ×‘×•× × × ×™×— ×©×”×Ÿ ×›××Ÿ.
              // --- ×©×—×–×•×¨ ×”××•×˜×¦×™×•×ª ×œ×‘×™×˜×—×•×Ÿ ---
              const addTaskMutation = useMutation({
                  mutationFn: (data) => api.post(`/rooms/${room._id}/tasks`, data),
                  onMutate: async (vars) => {
                      await queryClient.cancelQueries(queryKey);
                       const previousRooms = queryClient.getQueryData(queryKey);
                      queryClient.setQueryData(queryKey, (oldRooms) => {
                          return oldRooms.map(r => {
                              if (r._id === room._id) {
                                  // ×§×‘×™×¢×ª ×¡×•×’ ×–×× ×™ ×œ×¦×•×¨×š ×ª×¦×•×’×”
                                  const type = vars.isTemporary ? 'daily' : 'maintenance';
                                   const tempTask = {
                                      _id: Math.random().toString(),
                                      description: vars.description,
                                       isCompleted: false,
                                      type: type,
                                       temp: true
                                  };
          return { ...r, tasks: [...r.tasks, tempTask], status: 'dirty' };
                              }
                              return r;
          });
                      });
                      setNewTaskText('');
                      return { previousRooms };
                  },
                  onError: (err, v, context) => queryClient.setQueryData(queryKey, context.previousRooms),
                  onSettled: () => queryClient.invalidateQueries(queryKey)
              });
              const toggleTaskMutation = useMutation({
                  mutationFn: ({ taskId, isCompleted }) => api.patch(`/rooms/${room._id}/tasks/${taskId}`, { isCompleted }),
                  onMutate: async ({ taskId, isCompleted }) => {
                      await queryClient.cancelQueries(queryKey);
                      const previousRooms = queryClient.getQueryData(queryKey);
                      queryClient.setQueryData(queryKey, (oldRooms) => {
                          return oldRooms.map(r => {
                              if (r._id === room._id) {
                                   const updatedTasks = r.tasks.map(t => t._id === taskId ? { ...t, isCompleted } : t);
                                  return { ...r, tasks: updatedTasks };
                              }
                              return r;
                          });
                      });
                       return { previousRooms };
                  },
                  onError: (err, v, context) => queryClient.setQueryData(queryKey, context.previousRooms),
                  onSettled: () => queryClient.invalidateQueries(queryKey)
              });
              const setStatusMutation = useMutation({
                  mutationFn: (status) => api.patch(`/rooms/${room._id}/status`, { status }),
                  onMutate: async (status) => {
                      await queryClient.cancelQueries(queryKey);
                      const previousRooms = queryClient.getQueryData(queryKey);
                       queryClient.setQueryData(queryKey, (oldRooms) => oldRooms.map(r => r._id === room._id ? { ...r, status } : r));
                      onClose();
                      return { previousRooms };
                  },
                   onError: (err, v, context) => queryClient.setQueryData(queryKey, context.previousRooms),
                  onSettled: () => { queryClient.invalidateQueries(queryKey); toast.success('×¡×˜×˜×•×¡ ×¢×•×“×›×Ÿ!'); }
              });
              const handleAddTask = () => {
                  if(newTaskText.trim()) {
                      addTaskMutation.mutate({ description: newTaskText, isTemporary });
          }
              };
              // âœ¨ ×—×œ×•×§×” ×œ-3 ×§×‘×•×¦×•×ª
              const maintenanceTasks = room.tasks.filter(t => t.type === 'maintenance');
              const dailyTasks = room.tasks.filter(t => t.type === 'daily');
              const standardTasks = room.tasks.filter(t => t.type === 'standard' || (!t.type && t.isSystemTask));
              // ×ª××™×›×” ×œ××—×•×¨
          
              const TaskItem = ({ task }) => (
                  <div className={`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${
                       task.isCompleted ? 'bg-slate-50 border-slate-100 opacity-60' : 'bg-white border-slate-200 shadow-sm hover:border-blue-300'
                      }`}
                  onClick={() => !task.temp && toggleTaskMutation.mutate({ taskId: task._id, isCompleted: !task.isCompleted })}>
                      <Checkbox checked={task.isCompleted} onCheckedChange={()=>{}} disabled={task.temp}/>
                      <span className={`flex-1 ${task.isCompleted ? 'line-through' : 'font-medium'}`}>
                           {task.description} {task.temp && '(...)'}
                      </span>
                  </div>
              );
              return (
                  <Dialog open={isOpen} onOpenChange={onClose}>
                      <DialogContent className="max-w-lg max-h-[95vh] overflow-y-auto flex flex-col">
                          <DialogHeader>
                             <DialogTitle className="text-2xl flex justify-between items-center">
                                  <span>×—×“×¨ {room.roomNumber}</span>
                                  <span className={`text-sm px-3 py-1 rounded-full ${
                                     room.status === 'clean' ? 'bg-green-100 text-green-800' :
                                      room.status === 'maintenance' ? 'bg-red-100 text-red-800' : 'bg-slate-100 text-slate-800'
                             }`}>
                                      {room.status === 'clean' ? '× ×§×™' : room.status === 'maintenance' ? '×‘×ª×™×§×•×Ÿ' : '×œ× × ×§×™'}
                                  </span>
                             </DialogTitle>
                              <DialogDescription>×¦'×§ ×œ×™×¡×˜ ××‘×¦×¢×™ ×™×•××™</DialogDescription>
                          </DialogHeader>
          
                          <div className="flex-1 space-y-6 py-2 overflow-y-auto">
          
                              {/* ×©×›×‘×” ×’': ×ª×§×œ×•×ª (××“×•× - ×”×›×™ ×—×©×•×‘) */}
                              {maintenanceTasks.length > 0 && (
                                  <div className="space-y-2 border-r-4 border-red-500 pr-3 bg-red-50/50 p-2 rounded">
                                      <h3 className="font-bold text-red-700 flex items-center gap-2"><AlertCircle size={16}/> ×ª×§×œ×•×ª ×¤×ª×•×—×•×ª</h3>
                                       {maintenanceTasks.map(t => <TaskItem key={t._id} task={t} />)}
                                  </div>
                              )}
          
                              {/* ×©×›×‘×” ×‘': ×“×’×©×™× ×™×•××™×™× (×¦×”×•×‘ - ×©×™× ×œ×‘) */}
                              {dailyTasks.length > 0 && (
                                   <div className="space-y-2 border-r-4 border-amber-400 pr-3 bg-amber-50/50 p-2 rounded">
                                      <h3 className="font-bold text-amber-700 flex items-center gap-2"><Star size={16}/> ×“×’×©×™× ×œ×”×™×•×</h3>
                                          {dailyTasks.map(t => <TaskItem key={t._id} task={t} />)}
                                  </div>
                              )}
          
                              {/* ×©×›×‘×” ×': ×¡×˜× ×“×¨×˜ (×›×—×•×œ/××¤×•×¨ - ×”×©×’×¨×”) */}
                              <div className="space-y-2">
                                  <h3 className="font-bold text-slate-700 flex items-center gap-2"><CheckSquare size={16}/> × ×•×”×œ × ×™×§×™×•×Ÿ ×¨×’×™×œ</h3>
                                     <div className="bg-slate-50 p-2 rounded-lg space-y-2">
                                      {standardTasks.map(t => <TaskItem key={t._id} task={t} />)}
                                       {standardTasks.length === 0 && <p className="text-gray-400 text-sm p-2">×œ× ×”×•×’×“×¨ × ×•×”×œ ×§×‘×•×¢.</p>}
                                  </div>
                              </div>
          
                               {/* ××–×•×¨ ×”×•×¡×¤×” (×× ×”×œ×™×/×¢×•×‘×“×™×) */}
                              <div className="bg-white p-3 rounded border border-dashed border-slate-300">
                                   <label className="text-sm font-bold text-slate-700 mb-2 block">×”×•×¡×¤×ª ×“×™×•×•×— / ×‘×§×©×”:</label>
                                  <div className="flex gap-2 mb-2">
                                      <Input
                                           placeholder={isTemporary ? "×‘×§×©×” ×œ×”×™×•× (×œ×•×œ, ×™×™×Ÿ...)" : "×“×™×•×•×— ×ª×§×œ×” ×§×‘×•×¢×” (××–×’×Ÿ...)"}
                                          value={newTaskText}
                                          onChange={e => setNewTaskText(e.target.value)}
                                           onKeyDown={e => e.key === 'Enter' && handleAddTask()}
                                      />
                                       <Button onClick={handleAddTask} size="icon"><Plus/></Button>
                                  </div>
                                  <div className="flex items-center gap-2">
                                       <Switch id="temp-mode" checked={isTemporary} onCheckedChange={setIsTemporary} />
                                      <Label htmlFor="temp-mode" className="text-xs text-slate-600">
                                           {isTemporary ? '×–×× ×™ ×œ×”×™×•× (×“×’×©)' : '×ª×§×œ×” ×§×‘×•×¢×” (×ª×—×–×•×§×”)'}
                                      </Label>
                                  </div>
                              </div>
                          </div>
          
                          <DialogFooter className="flex-col gap-3 sm:flex-row sm:justify-between items-center border-t pt-4 mt-2">
                               <Button variant="destructive" className="w-full sm:w-auto gap-2" onClick={() => setStatusMutation.mutate('maintenance')}>
                                  <Wrench size={16}/> ×ª×§×•×œ
                              </Button>
                               <div className="flex gap-2 w-full sm:w-auto">
                                  <Button variant="outline" className="flex-1" onClick={() => setStatusMutation.mutate('dirty')}>×œ× × ×§×™</Button>
                                  <Button className="flex-1 bg-green-600 hover:bg-green-700 gap-2" onClick={() => setStatusMutation.mutate('clean')}>
                                       <CheckCircle2 size={16}/> ×¡×™×•× ×•××™×©×•×¨
                                  </Button>
                               </div>
                          </DialogFooter>
                      </DialogContent>
                  </Dialog>
              );
          }
    ğŸ“ stores/
      ğŸ“„ accountStore.js
        // client/src/stores/accountStore.js
        
        import { create } from 'zustand';
        // The import path has been changed to a relative path to avoid alias issues.
        import api from '../utils/api';
        
        export const useAccountStore = create((set) => ({
          accounts: [],
          loading: false,
          error: null,
        
          /**
           * Fetches accounts from the correct endpoint.
           * FIX: This now points to the correct API endpoint (`/dashboard/summary`)
           * and correctly extracts the `accounts` array from the response.
           */
          fetchAccounts: async () => {
            set({ loading: true, error: null });
            try {
              const { data } = await api.get('/dashboard/summary');
              // Ensure we set an array, even if data.accounts is missing.
              set({ accounts: data?.accounts || [], loading: false });
            } catch (err) {
              const errorMsg = err.response?.data?.message || '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×—×©×‘×•× ×•×ª';
              set({ error: errorMsg, loading: false, accounts: [] });
              console.error("Failed to fetch accounts:", errorMsg);
            }
          },
        }));
      ğŸ“„ authStore.js
        // client/src/stores/authStore.js
        
        import { create } from 'zustand';
        import { devtools } from 'zustand/middleware';
        // Import the injector function from api.js. Using a relative path for safety.
        import { injectAuthStore } from '../utils/api';
        
        const getInitialState = () => {
          try {
            const user = JSON.parse(localStorage.getItem('user'));
            return { user, isAuthenticated: !!user };
          } catch (error) {
            return { user: null, isAuthenticated: false };
          }
        };
        
        export const useAuthStore = create(
          devtools(
            (set) => ({
              ...getInitialState(),
        
              login: (userData) => {
                if (!userData || !userData._id) {
                  console.error("Login action called with invalid user data:", userData);
                  return;
                }
                localStorage.setItem('user', JSON.stringify(userData));
                set({ user: userData, isAuthenticated: true }, false, 'LOGIN_ACTION');
              },
        
              logout: () => {
                localStorage.removeItem('user');
                set({ user: null, isAuthenticated: false }, false, 'LOGOUT_ACTION');
              },
            }),
            { name: "Auth Store" }
          )
        );
        
        // --- THIS IS THE FIX ---
        // After the store is created, we inject its API into the api.js module.
        // This breaks the circular dependency.
        injectAuthStore(useAuthStore.getState());
        
        // We also subscribe to future changes, although it's less critical for login/logout
        // which don't change at runtime.
        useAuthStore.subscribe(state => {
          injectAuthStore(state);
        });
      ğŸ“„ depositsStore.js
        // client/src/stores/depositsStore.js
        
        import { create } from 'zustand';
        import api from '../utils/api';
        import toast from 'react-hot-toast';
        
        export const useDepositsStore = create((set, get) => ({
          deposits: [],
          loading: false,
          error: null,
        
          // ×¤×¢×•×œ×” ×œ×˜×¢×™× ×ª ×›×œ ×”×¤×™×§×“×•× ×•×ª ××”×©×¨×ª
          fetchDeposits: async () => {
            set({ loading: true, error: null });
            try {
              const { data } = await api.get('/deposits');
              set({ deposits: data || [], loading: false });
            } catch (err) {
              const errorMsg = err.response?.data?.message || '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¤×™×§×“×•× ×•×ª';
              set({ error: errorMsg, loading: false });
              toast.error(errorMsg);
            }
          },
        
          // ×¤×¢×•×œ×” ×œ×”×•×¡×¤×ª ×¤×™×§×“×•×Ÿ ×—×“×©
          addDeposit: async (depositData) => {
            try {
              await api.post('/deposits', depositData);
              toast.success('×”×¤×™×§×“×•×Ÿ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
              get().fetchDeposits(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××” ×”××œ××” ××”×©×¨×ª
              return true; // ×œ×”×•×“×™×¢ ×œ×˜×•×¤×¡ ×©×”×¤×¢×•×œ×” ×”×¦×œ×™×—×”
            } catch (err) {
              toast.error(err.response?.data?.message || '×©×’×™××” ×‘×”×•×¡×¤×ª ×”×¤×™×§×“×•×Ÿ');
              return false; // ×œ×”×•×“×™×¢ ×œ×˜×•×¤×¡ ×©×”×¤×¢×•×œ×” × ×›×©×œ×”
            }
          },
        
          // ===>> ×”×•×¡×¤×ª ×”×¤×•× ×§×¦×™×•×ª ×”×—×¡×¨×•×ª <<===
        
          // ×¤×¢×•×œ×” ×œ×©×‘×™×¨×ª ×¤×™×§×“×•×Ÿ
          breakDeposit: async (depositId) => {
            try {
              const { data } = await api.post(`/deposits/${depositId}/break`);
              toast.success(data.message || '×”×¤×™×§×“×•×Ÿ × ×©×‘×¨ ×‘×”×¦×œ×—×”!');
              get().fetchDeposits(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
            } catch (err) {
               toast.error(err.response?.data?.message || '×©×’×™××” ×‘×©×‘×™×¨×ª ×”×¤×™×§×“×•×Ÿ');
            }
          },
        
          // ×¤×¢×•×œ×” ×œ××©×™×›×ª ×¤×™×§×“×•×Ÿ
          withdrawDeposit: async (depositId) => {
             try {
              const { data } = await api.post(`/deposits/${depositId}/withdraw`);
              toast.success(data.message || '×”×¤×™×§×“×•×Ÿ × ×¤×¨×¢ ×•× ××©×š ×‘×”×¦×œ×—×”!');
              get().fetchDeposits(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
            } catch (err) {
               toast.error(err.response?.data?.message || '×©×’×™××” ×‘××©×™×›×ª ×”×¤×™×§×“×•×Ÿ');
            }
          }
        }));
      ğŸ“„ financeStore.js
        import { create } from 'zustand';
        import api from '@/utils/api.js'; // ×©×™××•×© ×‘×× ×•×¢ ×”×ª×§×©×•×¨×ª ×”××¨×›×–×™
        
        // ×‘×¨×™×¨×ª ××—×“×œ ×œ××§×¨×” ×©××™×Ÿ ×¤×¨×•×¤×™×œ ×œ××©×ª××©
        const defaultProfile = {
          checking: 0,
          cash: 0,
          deposits: 0,
          stocks: 0,
        };
        
        export const useFinanceStore = create((set, get) => ({
          profile: null,
          loading: true,
          error: null,
        
          // ×¤×¢×•×œ×” ×œ×©×œ×™×¤×ª ×”×¤×¨×•×¤×™×œ ××”×©×¨×ª
          fetchProfile: async () => {
            set({ loading: true, error: null });
            try {
              // ×”× ×ª×™×‘ ×”× ×›×•×Ÿ ×”×•× /api/finances ×›×¤×™ ×©××•×’×“×¨ ×‘×©×¨×ª
              const { data } = await api.get('/finances');
              set({ profile: data || defaultProfile, loading: false });
            } catch (err) {
              const errorMessage = err.response?.data?.message || err.message;
              set({ error: errorMessage, loading: false, profile: defaultProfile });
              console.error("Failed to fetch finance profile:", err);
            }
          },
        
          // ×¤×¢×•×œ×” ×œ×¢×“×›×•×Ÿ ×”×¤×¨×•×¤×™×œ ×‘×©×¨×ª
          updateProfile: async (newProfileData) => {
            const originalProfile = get().profile;
            // ×¢×“×›×•×Ÿ ××•×¤×˜×™××™ ××™×™×“×™ ×©×œ ×”×××©×§
            set({ profile: { ...originalProfile, ...newProfileData } });
            try {
              const { data } = await api.post('/finances', newProfileData);
              set({ profile: data }); // ×¢×“×›×•×Ÿ ×¡×•×¤×™ ×¢× ×”××™×“×¢ ×”××“×•×™×§ ××”×©×¨×ª
            } catch (err) {
              const errorMessage = err.response?.data?.message || "×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¤×¨×•×¤×™×œ";
              set({ error: errorMessage, profile: originalProfile }); // ×”×—×–×¨×ª ×”××¦×‘ ×œ×§×“××•×ª×• ×‘××§×¨×” ×©×œ ×©×’×™××”
              console.error("Failed to update finance profile:", err);
            }
          },
        }));
      ğŸ“„ fundStore.js
        import { create } from 'zustand';
        import api from '@/utils/api.js';
        import toast from 'react-hot-toast';
        
        export const useFundStore = create((set, get) => ({
          funds: [],
          loading: false,
          error: null,
        
          fetchFunds: async () => {
            set({ loading: true });
            try {
              const { data } = await api.get('/funds');
              set({ funds: data, loading: false });
            } catch (err) {
              toast.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×¨× ×•×ª');
              set({ error: err.message, loading: false });
            }
          },
        
          addFund: async (fundData) => {
            try {
              const { data: newFund } = await api.post('/funds', fundData);
              set((state) => ({ funds: [newFund, ...state.funds] }));
              toast.success('×”×§×¨×Ÿ × ×•×¡×¤×” ×‘×”×¦×œ×—×”!');
            } catch (err) {
              toast.error(err.response?.data?.message || '×©×’×™××” ×‘×”×•×¡×¤×ª ×”×§×¨×Ÿ');
            }
          },
        
          refreshPrices: async () => {
            const originalFunds = get().funds;
            set({ loading: true });
            toast.loading('××¨×¢× ×Ÿ ××—×™×¨×™×...');
            try {
              const { data } = await api.post('/funds/refresh');
              set({ funds: data, loading: false });
              toast.dismiss();
              toast.success('×”××—×™×¨×™× ×¢×•×“×›× ×•!');
            } catch (err) {
              toast.dismiss();
              toast.error('×©×’×™××” ×‘×¨×¢× ×•×Ÿ ×”××—×™×¨×™×');
              set({ funds: originalFunds, loading: false });
            }
          },
        
          sellFund: async (fundId) => {
             // ... ×œ×•×’×™×§×” ×“×•××” ×¢× ×§×¨×™××ª API ×œ-POST /api/funds/:id/sell
          },
        
          deleteFund: async (fundId) => {
            // ... ×œ×•×’×™×§×” ×“×•××” ×¢× ×§×¨×™××ª API ×œ-DELETE /api/funds/:id
          }
        }));
      ğŸ“„ projectsStore.js
        import { create } from 'zustand';
        import * as projectApi from '@/utils/projects';
        
        const useProjectsStore = create((set, get) => ({
          projects: [],
          activeProject: null,
          loading: false,
          error: null,
        
          // Helper to update a project in the state array and the active project if necessary
          _updateProjectState: (updatedProject) => {
            const projects = get().projects.map(p => p._id === updatedProject._id ? updatedProject : p);
            const activeProject = get().activeProject?._id === updatedProject._id ? updatedProject : get().activeProject;
            return { projects, activeProject };
          },
        
          // --- Actions ---
          fetchProjects: async () => {
            set({ loading: true, error: null });
            try {
              const projects = await projectApi.getProjects();
              set({ projects, loading: false });
            } catch (err) {
              set({ error: err, loading: false });
            }
          },
        
          fetchProject: async (id) => {
            set({ loading: true, error: null });
            try {
              const project = await projectApi.getProject(id);
              const { projects } = get()._updateProjectState(project);
              set({ projects, activeProject: project, loading: false });
            } catch (err) {
              set({ error: err, loading: false });
            }
          },
        
          createProject: async (payload) => {
            set({ loading: true, error: null });
            try {
              const newProject = await projectApi.createProject(payload);
              set(state => ({ projects: [newProject, ...state.projects], loading: false }));
              return newProject;
            } catch (err) {
              set({ error: err, loading: false });
              throw err;
            }
          },
        
          deleteProject: async (id) => {
            set({ loading: true, error: null });
            try {
              await projectApi.deleteProject(id);
              set(state => ({
                projects: state.projects.filter(p => p._id !== id),
                activeProject: state.activeProject?._id === id ? null : state.activeProject,
                loading: false
              }));
            } catch (err) {
              set({ error: err, loading: false });
            }
          },
        
          // --- Task & Fund Actions ---
          // A generic handler for actions that update a single project
          _handleProjectUpdate: async (apiCall) => {
            set({ loading: true, error: null });
            try {
              const updatedProject = await apiCall();
              const newState = get()._updateProjectState(updatedProject);
              set({ ...newState, loading: false });
            } catch (err) {
              set({ error: err, loading: false });
            }
          },
        
          addTask: async (projectId, task) => {
            await get()._handleProjectUpdate(() => projectApi.addTask(projectId, task));
          },
        
          toggleTask: async (projectId, taskId) => {
            await get()._handleProjectUpdate(() => projectApi.toggleTask(projectId, taskId));
          },
        
          deleteTask: async (projectId, taskId) => {
            await get()._handleProjectUpdate(() => projectApi.deleteTask(projectId, taskId));
          },
        
          addFund: async (projectId, fund) => {
            await get()._handleProjectUpdate(() => projectApi.addFund(projectId, fund));
          },
        
        }));
        
        export default useProjectsStore;
      ğŸ“„ stockStore.js
        // client/src/stores/stockStore.js
        
        import { create } from 'zustand';
        import api from '@/utils/api.js';
        import toast from 'react-hot-toast';
        
        export const useStockStore = create((set, get) => ({
          stocks: [],
          loading: false,
          error: null,
        
          // Helper functions to manage state
          _startLoading: () => set({ loading: true, error: null }),
          _setError: (error) => set({ loading: false, error }),
        
          // Actions
          fetchStocks: async () => {
            get()._startLoading();
            try {
              const { data } = await api.get('/stocks');
              set({ stocks: data, loading: false });
            } catch (err) {
              const errorMsg = err.response?.data?.message || '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×× ×™×•×ª';
              get()._setError(errorMsg);
              toast.error(errorMsg);
            }
          },
        
          addStock: async (stockData) => {
            get()._startLoading();
            try {
              const { data: newStock } = await api.post('/stocks', stockData);
              set((state) => ({ stocks: [newStock, ...state.stocks], loading: false }));
              toast.success(`×× ×™×™×ª ${newStock.ticker} × ×•×¡×¤×” ×‘×”×¦×œ×—×”!`);
            } catch (err) {
              const errorMsg = err.response?.data?.message || '×©×’×™××” ×‘×”×•×¡×¤×ª ×× ×™×”';
              get()._setError(errorMsg);
              toast.error(errorMsg);
            }
          },
        
          deleteStock: async (stockId) => {
            const originalStocks = get().stocks;
            // Optimistic update
            set((state) => ({
              stocks: state.stocks.filter((s) => s._id !== stockId),
            }));
            try {
              await api.delete(`/stocks/${stockId}`);
              toast.success('×”×× ×™×” × ××—×§×”.');
            } catch (err) {
              toast.error('×©×’×™××” ×‘××—×™×§×ª ×”×× ×™×”.');
              set({ stocks: originalStocks }); // Revert on error
            }
          },
        
          sellStock: async (stockId) => {
            try {
              const { data } = await api.post(`/stocks/${stockId}/sell`);
              toast.success(data.message);
              get().fetchStocks(); // Refetch all stocks and potentially account balances
            } catch(err) {
              const errorMsg = err.response?.data?.message || '×©×’×™××” ×‘××›×™×¨×ª ×”×× ×™×”';
              toast.error(errorMsg);
            }
          },
        
          refreshPrices: async () => {
            try {
              const { data } = await api.post('/stocks/refresh-prices');
              set({ stocks: data.stocks });
              toast.success(data.message);
            } catch (err) {
              const errorMsg = err.response?.data?.message || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ××—×™×¨×™×';
              toast.error(errorMsg);
            }
          },
        }));
      ğŸ“„ tzitzitStore.js
        import { create } from "zustand";
        import api from "@/utils/api"; // Now it's safe to import directly
        
        export const useTzitzitStore = create((set) => ({
          orders: [],
          loading: false,
          error: null,
        
          fetchOrders: async () => {
            set({ loading: true, error: null });
            try {
              const { data } = await api.get("/tzitzit");
              set({ orders: data, loading: false });
            } catch (err) {
              const errorMsg = err.response?.data?.message || "×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×";
              set({ error: errorMsg, loading: false });
            }
          },
        
          addOrder: async (orderData) => {
            // This function now returns the new order on success
            // or throws an error on failure.
            try {
              const { data: newOrder } = await api.post("/tzitzit", orderData);
              set((state) => ({
                orders: [newOrder, ...state.orders],
              }));
              return newOrder;
            } catch (err) {
              console.error("Failed to add order:", err);
              throw err;
            }
          },
        
          payOrder: async (id, amount) => {
            try {
              const { data: updatedOrder } = await api.patch(`/tzitzit/${id}/pay`, { amount });
              set((state) => ({
                orders: state.orders.map((o) => (o._id === id ? updatedOrder : o)),
              }));
              return updatedOrder;
            } catch (err) {
              console.error("Failed to pay order:", err);
              throw err;
            }
          },
        }));
    ğŸ“ utils/
      ğŸ“„ api.js
        import axios from 'axios';
        
        // --- âœ¨ ×–×”×• ×”×—×œ×§ ×”×—×©×•×‘ âœ¨ ---
        // 1. ×§×‘×¢ ××ª ×›×ª×•×‘×ª ×”-API ×”××œ××” ××ª×•×š ××©×ª× ×” ×”×¡×‘×™×‘×”
        //    ×× ×”××©×ª× ×” ×”×•× '.../api', ××– API_URL ×™×”×™×” '.../api'
        //    ×× ×”××©×ª× ×” ×œ× ×§×™×™× (×œ××©×œ ×‘-build), ×”-URL ×™×”×™×” '/api'
        const API_URL = import.meta.env.VITE_API_BASE_URL || '/api';
        
        // 2. ×”×“×¤×¡ ×œ-console ×›×“×™ ×œ×•×•×“× ×©×–×” ×¢×•×‘×“
        console.log(`Connecting to API at: ${API_URL}`);
        // ----------------------
        
        let authStoreApi = {
          login: () => console.error('Auth store not initialized for API utility.'),
          logout: () => console.error('Auth store not initialized for API utility.'),
        };
        
        export function injectAuthStore(store) {
          authStoreApi = store;
        }
        
        const api = axios.create({
          // 3. ×”×©×ª××© ×‘×›×ª×•×‘×ª ×”××œ××” (×©×›×‘×¨ ×›×•×œ×œ×ª /api)
          baseURL: API_URL,
          withCredentials: true,
        });
        
        let csrfTokenPromise = null;
        
        const getCsrfToken = () => {
          if (!csrfTokenPromise) {
            // ×”×§×¨×™××” ×”×–×• ×ª×•×¡×™×£ '/csrf-token' ×œ-baseURL
            // ×•×™×™×¦×¨: https://zipori.onrender.com/api/csrf-token
            csrfTokenPromise = api.get('/csrf-token')
              .then(response => {
                const csrfToken = response.data.csrfToken;
                api.defaults.headers.common['X-CSRF-Token'] = csrfToken;
                return csrfToken;
              })
              .catch(error => {
                console.error('Could not get CSRF token', error);
                csrfTokenPromise = null;
                return Promise.reject(error);
              });
          }
          return csrfTokenPromise;
        };
        
        api.interceptors.request.use(async (config) => {
          if (config.url === '/csrf-token') {
            return config;
          }
          if (!api.defaults.headers.common['X-CSRF-Token']) {
            await getCsrfToken();
          }
          return config;
        }, (error) => Promise.reject(error));
        
        let isRefreshing = false;
        let failedQueue = [];
        
        const processQueue = (error, token = null) => {
          failedQueue.forEach(prom => error ? prom.reject(error) : prom.resolve(token));
          failedQueue = [];
        };
        
        api.interceptors.response.use(
          response => response,
          async (error) => {
            const originalRequest = error.config;
        
            // ----------------------------------------------------------------
            // ğŸ¯ ×”×ª×™×§×•×Ÿ × ××¦× ×›××Ÿ ğŸ¯
            // ×”×•×¡×¤× ×• ×ª× ××™ ×©××•×•×“× ×©×”×‘×§×©×” ×©× ×›×©×œ×” ×”×™× *×œ×* ×‘×§×©×ª ×”×œ×•×’×™×Ÿ.
            // ×× ×‘×§×©×ª ×”×œ×•×’×™×Ÿ × ×›×©×œ×ª ×¢× 401, ×–×” ××•××¨ ×©×”×¡×™×¡××” ×©×’×•×™×”,
            // ×•×× ×—× ×• ×œ× ×¨×•×¦×™× ×œ× ×¡×•×ª "×œ×¨×¢× ×Ÿ" ×˜×•×§×Ÿ ×‘××¦×‘ ×›×–×”.
            // ----------------------------------------------------------------
            if (
              error.response?.status === 401 &&
              !originalRequest._retry &&
              originalRequest.url !== '/auth/login' // <-- ğŸ¯ ×–×• ×”×©×•×¨×” ×©×”×•×¡×¤× ×•
            ) {
              if (isRefreshing) {
                return new Promise((resolve, reject) => {
                  failedQueue.push({ resolve, reject });
                }).then(() => api(originalRequest));
              }
        
              originalRequest._retry = true;
              isRefreshing = true;
        
              try {
                const { data } = await api.post('/auth/refresh');
                authStoreApi.login(data.user);
                processQueue(null);
                return api(originalRequest);
              } catch (refreshError) {
                processQueue(refreshError);
                authStoreApi.logout();
                return Promise.reject(refreshError);
              } finally {
                isRefreshing = false;
              }
            }
            return Promise.reject(error);
          }
        );
        
        export default api;
      ğŸ“„ cn.js
        import { clsx } from 'clsx';
        import { twMerge } from 'tailwind-merge';
        
        export function cn(...inputs) {
          return twMerge(clsx(inputs));
        }
      ğŸ“„ phone.js
        // client/src/utils/phone.js
        
        /**
         * ×× ×§×” ×•××¤×¨××˜ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×™×©×¨××œ×™ ×œ×¤×•×¨××˜ ×‘×™× ×œ××•××™ (×œ×œ× +)
         * @param {string} phone - ××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×œ××©×œ 050-1234567)
         * @returns {string|null} - ××¡×¤×¨ ×‘×¤×•×¨××˜ (972501234567) ××• null ×× ×œ× ×ª×§×™×Ÿ
         */
        export function formatPhoneForWhatsApp(phone) {
          if (!phone || typeof phone !== 'string') {
            return null;
          }
        
          // ×”×¡×¨×ª ×›×œ ×ª×• ×©××™× ×• ×¡×¤×¨×”
          let digits = phone.replace(/\D/g, '');
        
          // ×˜×™×¤×•×œ ×‘×§×™×“×•××ª
          if (digits.startsWith('0')) {
            // ×”×¤×™×›×ª 050... ×œ- 97250...
            digits = '972' + digits.substring(1);
          } else if (digits.startsWith('972')) {
            // ×”××¡×¤×¨ ×›×‘×¨ ×‘×¤×•×¨××˜ ×”× ×›×•×Ÿ
          } else if (digits.length === 9 && !digits.startsWith('0')) {
            // ××§×¨×” ×©×œ ××¡×¤×¨ ×œ×œ× 0 ×”×ª×—×œ×ª×™ (×œ××©×œ 501234567)
            digits = '972' + digits;
          } else {
            // ××¡×¤×¨ ×œ× ××–×•×”×”
            return null;
          }
        
          // ×‘×“×™×§×ª ××•×¨×š ×¡×•×¤×™ (972 + 9 ×¡×¤×¨×•×ª = 12)
          if (digits.length === 12) {
            return digits;
          }
        
          return null;
        }
      ğŸ“„ projects.js
        import api from '@/utils/api.js'; // ×©×™××•×© ×‘×§×•×‘×¥ ×”×ª×§×©×•×¨×ª ×”××¨×›×–×™
        
        // --- Project CRUD ---
        export const getProjects = async () => {
          const { data } = await api.get('/projects');
          return data;
        };
        
        export const getProject = async (id) => {
          const { data } = await api.get(`/projects/${id}`);
          return data;
        };
        
        export const createProject = async (body) => {
          const { data } = await api.post('/projects', body);
          return data;
        };
        
        export const updateProject = async (id, body) => {
          const { data } = await api.patch(`/projects/${id}`, body);
          return data;
        };
        
        export const deleteProject = async (id) => {
          const { data } = await api.delete(`/projects/${id}`);
          return data;
        };
        
        // --- Funds ---
        export const addFund = async (projectId, fund) => {
          const { data } = await api.post(`/projects/${projectId}/funds`, fund);
          return data;
        };
        
        // --- Tasks ---
        export const addTask = async (projectId, task) => {
          const { data } = await api.post(`/projects/${projectId}/tasks`, task);
          return data;
        };
        
        export const toggleTask = async (projectId, taskId) => {
          const { data } = await api.patch(`/projects/${projectId}/tasks/${taskId}/toggle`);
          return data;
        };
        
        export const deleteTask = async (projectId, taskId) => {
          const { data } = await api.delete(`/projects/${projectId}/tasks/${taskId}`);
          return data;
        };
      ğŸ“„ zaz
  ğŸ“„ tailwind.config.js
    /** @type {import('tailwindcss').Config} */
    export default {
        darkMode: ["class"],
        content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
      ],
      theme: {
      	extend: {
      		fontFamily: {
      			sans: [
      				'Assistant',
      				'sans-serif'
      			]
      		},
      		borderRadius: {
      			lg: 'var(--radius)',
      			md: 'calc(var(--radius) - 2px)',
      			sm: 'calc(var(--radius) - 4px)'
      		},
      		colors: {
      			background: 'hsl(var(--background))',
      			foreground: 'hsl(var(--foreground))',
      			card: {
      				DEFAULT: 'hsl(var(--card))',
      				foreground: 'hsl(var(--card-foreground))'
      			},
      			popover: {
      				DEFAULT: 'hsl(var(--popover))',
      				foreground: 'hsl(var(--popover-foreground))'
      			},
      			primary: {
      				DEFAULT: 'hsl(var(--primary))',
      				foreground: 'hsl(var(--primary-foreground))'
      			},
      			secondary: {
      				DEFAULT: 'hsl(var(--secondary))',
      				foreground: 'hsl(var(--secondary-foreground))'
      			},
      			muted: {
      				DEFAULT: 'hsl(var(--muted))',
      				foreground: 'hsl(var(--muted-foreground))'
      			},
      			accent: {
      				DEFAULT: 'hsl(var(--accent))',
      				foreground: 'hsl(var(--accent-foreground))'
      			},
      			destructive: {
      				DEFAULT: 'hsl(var(--destructive))',
      				foreground: 'hsl(var(--destructive-foreground))'
      			},
      			border: 'hsl(var(--border))',
      			input: 'hsl(var(--input))',
      			ring: 'hsl(var(--ring))',
      			chart: {
      				'1': 'hsl(var(--chart-1))',
      				'2': 'hsl(var(--chart-2))',
      				'3': 'hsl(var(--chart-3))',
      				'4': 'hsl(var(--chart-4))',
      				'5': 'hsl(var(--chart-5))'
      			}
      		}
      	}
      },
      plugins: [require("tailwindcss-animate")],
    }
  ğŸ“„ vite.config.js
    import { defineConfig } from 'vite';
    import react from '@vitejs/plugin-react';
    import path from 'path';
    import { fileURLToPath } from 'url';
    
    const __dirname = path.dirname(fileURLToPath(import.meta.url));
    
    export default defineConfig({
      plugins: [react()],
      resolve: {
        alias: {
          '@': path.resolve(__dirname, 'src'),
          'react': path.resolve(__dirname, '../node_modules/react'),
          'react-dom': path.resolve(__dirname, '../node_modules/react-dom'),
        },
        dedupe: ['react', 'react-dom'],
    
        // --- ×”×•×¡×£ ××ª ×”×©×•×¨×” ×”×–×• ---
        // ×–×” ××•××¨ ×œ-Vite ×œ×—×¤×© ×’× ×§×‘×¦×™ .jsx, .js ×•×›×•'
        extensions: ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json']
        // ---------------------------------
      },
      optimizeDeps: {
        include: ['react', 'react-dom', 'react/jsx-runtime', 'react/jsx-dev-runtime'],
        exclude: [],
      },
      server: {
        port: 5173,
        proxy: {
          '/api': {
            target: 'http://localhost:4000',
            changeOrigin: true,
          },
          '/uploads': {
            target: 'http://localhost:4000',
            changeOrigin: true,
          },
        },
      },
      build: {
        chunkSizeWarningLimit: 2000,
      },
    });
ğŸ“„ directory_structure.txt
ğŸ“„ docker-compose.yml
ğŸš« node_modules/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)
ğŸ“„ package-lock.json
ğŸ“„ package.json
ğŸ“ python/
  ğŸ“„ folder_copier_gui.py
    #!/usr/bin/env python3
    # -*- coding: utf-8 -*-
    
    import os
    import sys
    import shutil
    from pathlib import Path
    from dataclasses import dataclass
    from typing import Optional, Tuple, List, Iterable
    
    from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor, as_completed
    import multiprocessing
    
    from PyQt6 import QtCore, QtGui, QtWidgets
    
    EXCLUDED_DIR_NAME = "node_modules"
    
    # ============================ Copy Task (top-level for processes) ============================
    
    @dataclass
    class CopyJob:
        src: str
        dst: str
        overwrite: bool
    
    def copy_file_job(job: CopyJob) -> Tuple[bool, str, str, Optional[str]]:
        """
        ×¤×•× ×§×¦×™×” ×˜×”×•×¨×” (top-level) ×›×“×™ ×©×ª×”×™×” pickle-able ×¢×‘×•×¨ ProcessPool.
        ××—×–×™×¨×”: (ok, src, dst, error_message)
        """
        try:
            src_path = Path(job.src)
            dst_path = Path(job.dst)
    
            if dst_path.exists() and not job.overwrite:
                return True, job.src, job.dst, None  # ×“×™×œ×•×’ × ×—×©×‘ ×”×¦×œ×—×” ×©×§×˜×”
    
            # ×˜×™×¤×•×œ ×‘×¡×™××œ×™× ×§: × ×¢×ª×™×§ ××ª ×”×™×¢×“ ×× ×”×•× ×§×•×‘×¥, ××—×¨×ª × ×“×œ×’
            if src_path.is_symlink():
                try:
                    real = src_path.resolve(strict=True)
                    if real.is_file():
                        shutil.copy2(real, dst_path)
                        return True, job.src, job.dst, None
                    else:
                        return True, job.src, job.dst, None  # ×“×™×œ×•×’
                except Exception as e:
                    return False, job.src, job.dst, f"symlink error: {e}"
            else:
                shutil.copy2(src_path, dst_path)
                return True, job.src, job.dst, None
    
        except Exception as e:
            return False, job.src, job.dst, str(e)
    
    
    # ============================ Worker (runs in main proc; farms jobs to pool) ============================
    
    class FastCopyWorker(QtCore.QObject):
        progress = QtCore.pyqtSignal(int, int)     # copied, total (total may be 0 in quick mode)
        log = QtCore.pyqtSignal(str)
        finished = QtCore.pyqtSignal(bool)         # success
        fatal = QtCore.pyqtSignal(str)
        total_known = QtCore.pyqtSignal(int)       # announce total when known (accurate mode)
    
        def __init__(self, src: Path, dst: Path, overwrite: bool, mode: str, workers: int, quick_mode: bool):
            super().__init__()
            self.src = src
            self.dst = dst
            self.overwrite = overwrite
            self.mode = mode  # "threads" or "processes"
            self.workers = max(1, workers)
            self.quick_mode = quick_mode
            self._cancel = False
    
        @QtCore.pyqtSlot()
        def start(self):
            try:
                # ×•×œ×™×“×¦×™×” ×‘×¡×™×¡×™×ª
                if not self.src.exists():
                    self.fatal.emit("×ª×™×§×™×™×ª ×”××§×•×¨ ×œ× ×§×™×™××ª.")
                    self.finished.emit(False)
                    return
                if not self.src.is_dir():
                    self.fatal.emit("×”××§×•×¨ ××™× ×• ×ª×™×§×™×™×”.")
                    self.finished.emit(False)
                    return
                try:
                    if self.dst.resolve().is_relative_to(self.src.resolve()):
                        self.fatal.emit("×ª×™×§×™×™×ª ×”×™×¢×“ ×‘×ª×•×š ×ª×™×§×™×™×ª ×”××§×•×¨. ×‘×—×¨/×™ ×™×¢×“ ××—×¨.")
                        self.finished.emit(False)
                        return
                except AttributeError:
                    s, d = str(self.src.resolve()), str(self.dst.resolve())
                    if d.startswith(s + os.sep):
                        self.fatal.emit("×ª×™×§×™×™×ª ×”×™×¢×“ ×‘×ª×•×š ×ª×™×§×™×™×ª ×”××§×•×¨. ×‘×—×¨/×™ ×™×¢×“ ××—×¨.")
                        self.finished.emit(False)
                        return
    
                self.dst.mkdir(parents=True, exist_ok=True)
    
                # ×”×›× ×ª ×¨×©×™××ª ××©×™××•×ª (Quick Mode: ×‘×œ×™ ×¡×¤×™×¨×” ××•×§×“××ª)
                if self.quick_mode:
                    self.log.emit("××¦×‘ ××”×™×¨: ××ª×—×™×œ ××™×™×“ â€” ×‘×œ×™ ×¡×¤×™×¨×” ××•×§×“××ª.")
                    total = 0  # ×œ× ×™×“×•×¢
                    self.total_known.emit(0)
                    jobs_iter = self._iter_jobs_incremental(self.src, self.dst)
                    # × ×‘×¦×¢ ×”×¢×ª×§×” ×ª×•×š ×›×“×™ ×™×¦×™×¨×ª ×”××©×™××•×ª
                    success = self._execute_streaming(jobs_iter, total)
                    self.finished.emit(success)
                    return
                else:
                    self.log.emit("××¦×‘ ××“×•×™×§: ×¡×•×¤×¨ ×§×‘×¦×™× ×œ×¤× ×™ ×”×¢×ª×§×”â€¦")
                    jobs = list(self._collect_jobs(self.src, self.dst))
                    total = len(jobs)
                    self.total_known.emit(max(1, total))
                    self.log.emit(f"× ××¦××• {total} ×§×‘×¦×™× ×œ×”×¢×ª×§×” (node_modules ××•×—×¨×’).")
                    success = self._execute_jobs(jobs, total)
                    self.finished.emit(success)
                    return
    
            except Exception as e:
                self.fatal.emit(f"×©×’×™××” ×§×¨×™×˜×™×ª: {e}")
                self.finished.emit(False)
    
        def cancel(self):
            self._cancel = True
    
        # ----- Build jobs -----
        def _collect_jobs(self, src: Path, dst: Path) -> Iterable[CopyJob]:
            for root, dirs, files in os.walk(src, topdown=True, followlinks=False):
                if self._cancel:
                    break
                # ×”×—×¨×’×ª node_modules
                dirs[:] = [d for d in dirs if d != EXCLUDED_DIR_NAME]
    
                root_path = Path(root)
                rel = root_path.relative_to(src)
                target_dir = dst / rel
                target_dir.mkdir(parents=True, exist_ok=True)
    
                for f in files:
                    if self._cancel:
                        break
                    src_f = root_path / f
                    dst_f = target_dir / f
                    yield CopyJob(str(src_f), str(dst_f), self.overwrite)
    
        def _iter_jobs_incremental(self, src: Path, dst: Path) -> Iterable[CopyJob]:
            # ×›××• collect, ××‘×œ ××—×–×™×¨ generator "×—×™" ×©× ×¦×¨×š ×ª×•×š ×›×“×™ ×”×¢×ª×§×”
            return self._collect_jobs(src, dst)
    
        # ----- Execute jobs -----
        def _get_executor(self):
            if self.mode == "processes":
                # ×”×¢×¨×”: ×œ×ª×”×œ×™×›×™× ×™×© overhead ×’×“×•×œ ×™×•×ª×¨, ×œ× ×ª××™×“ ×¢×“×™×£ ×œ-I/O
                return ProcessPoolExecutor(max_workers=self.workers, mp_context=multiprocessing.get_context("spawn"))
            else:
                return ThreadPoolExecutor(max_workers=self.workers)
    
        def _execute_jobs(self, jobs: List[CopyJob], total: int) -> bool:
            if self._cancel:
                self.log.emit("×‘×•×˜×œ ×œ×¤× ×™ ×”×ª×—×œ×”.")
                return False
            copied = 0
            errors = 0
            with self._get_executor() as ex:
                futures = [ex.submit(copy_file_job, job) for job in jobs]
                for fut in as_completed(futures):
                    if self._cancel:
                        self.log.emit("×‘×™×˜×•×œ ×”×ª×‘×§×© â€” ××—×›×” ×œ×¡×™×•× ××©×™××•×ª ×¤×¢×™×œ×•×ªâ€¦")
                        break
                    ok, s, d, err = fut.result()
                    if ok:
                        # ×œ× × ×›×‘×™×“ ×¢×œ ×”×œ×•×’ ×‘×›×œ ×©×•×¨×” â€” ××‘×œ ×›×Ÿ × ×¢×“×›×Ÿ ×›×œ ×¤×¨×•×’×¨×¡
                        # self.log.emit(f"OK: {s} -> {d}")
                        pass
                    else:
                        errors += 1
                        self.log.emit(f"â— ×©×’×™××”: {s} â†’ {d}: {err}")
                    copied += 1
                    self.progress.emit(copied, max(1, total))
    
            if self._cancel:
                self.log.emit("×‘×•×˜×œ ×¢×œ ×™×“×™ ×”××©×ª××©.")
                return False
    
            if errors > 0:
                self.log.emit(f"âš ï¸ ×”×¡×ª×™×™× ×¢× {errors} ×©×’×™××•×ª.")
                return False
            self.log.emit("âœ… ×”×¡×ª×™×™× ×‘×”×¦×œ×—×”.")
            return True
    
        def _execute_streaming(self, jobs_iter: Iterable[CopyJob], total_unknown: int) -> bool:
            """
            ××¦×‘ ××”×™×¨: ×œ× ×™×•×“×¢×™× total ××¨××©.
            × ×¨×™×¥ ×‘×××’×¨ (Threads/Processes) ×•× ×¢×“×›×Ÿ progress ×›××•× ×” ××¦×˜×‘×¨ (indeterminate ×‘-UI).
            """
            if self._cancel:
                self.log.emit("×‘×•×˜×œ ×œ×¤× ×™ ×”×ª×—×œ×”.")
                return False
    
            copied = 0
            errors = 0
            inflight = set()
    
            with self._get_executor() as ex:
                for job in jobs_iter:
                    if self._cancel:
                        self.log.emit("×‘×™×˜×•×œ ×”×ª×‘×§×© â€” ×××ª×™×Ÿ ×œ×¡×™×•× ×”××©×™××•×ª ×©×¨×¦×•×ªâ€¦")
                        break
                    fut = ex.submit(copy_file_job, job)
                    inflight.add(fut)
    
                    # × ×™×§×•×™ Futures ×©×”×¡×ª×™×™××• ×›×“×™ ×œ× ×œ× ×¤×— ×–×™×›×¨×•×Ÿ
                    done = [f for f in inflight if f.done()]
                    for f in done:
                        inflight.remove(f)
                        ok, s, d, err = f.result()
                        if not ok:
                            errors += 1
                            self.log.emit(f"â— ×©×’×™××”: {s} â†’ {d}: {err}")
                        copied += 1
                        # ××¢×“×›× ×™× ×‘-total=0 ×›×“×™ ×©×”-UI ×™×¢×‘×•×“ ×‘××¦×‘ ×‘×œ×ª×™-×§×‘×•×¢ (marquee)
                        self.progress.emit(copied, 0)
    
                # ×¡×™×•×: ×œ×—×›×•×ª ×œ×›×œ ×”××©×™××•×ª ×”×¤×¢×™×œ×•×ª
                for f in as_completed(inflight):
                    ok, s, d, err = f.result()
                    if not ok:
                        errors += 1
                        self.log.emit(f"â— ×©×’×™××”: {s} â†’ {d}: {err}")
                    copied += 1
                    self.progress.emit(copied, 0)
    
            if self._cancel:
                self.log.emit("×‘×•×˜×œ ×¢×œ ×™×“×™ ×”××©×ª××©.")
                return False
    
            if errors > 0:
                self.log.emit(f"âš ï¸ ×”×¡×ª×™×™× ×¢× {errors} ×©×’×™××•×ª.")
                return False
            self.log.emit("âœ… ×”×¡×ª×™×™× ×‘×”×¦×œ×—×”.")
            return True
    
    
    # ============================ Modern UI ============================
    
    class DropLineEdit(QtWidgets.QLineEdit):
        def __init__(self):
            super().__init__()
            self.setAcceptDrops(True)
    
        def dragEnterEvent(self, e: QtGui.QDragEnterEvent):
            if e.mimeData().hasUrls():
                urls = e.mimeData().urls()
                if urls and Path(urls[0].toLocalFile()).is_dir():
                    e.acceptProposedAction()
                    return
            super().dragEnterEvent(e)
    
        def dropEvent(self, e: QtGui.QDropEvent):
            urls = e.mimeData().urls()
            if urls:
                p = Path(urls[0].toLocalFile())
                if p.is_dir():
                    self.setText(str(p))
            super().dropEvent(e)
    
    
    class Card(QtWidgets.QFrame):
        def __init__(self, title: str):
            super().__init__()
            self.setObjectName("Card")
            self.setStyleSheet("""
            QFrame#Card {
                border: 1px solid rgba(255,255,255,0.10);
                border-radius: 14px;
                background: rgba(255,255,255,0.04);
            }
            QLabel[heading="true"] {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 6px;
            }
            """)
            v = QtWidgets.QVBoxLayout(self)
            v.setContentsMargins(14, 14, 14, 14)
            title_lbl = QtWidgets.QLabel(title)
            title_lbl.setProperty("heading", True)
            v.addWidget(title_lbl)
            self.body = QtWidgets.QVBoxLayout()
            v.addLayout(self.body)
    
    
    class MainWindow(QtWidgets.QMainWindow):
        def __init__(self):
            super().__init__()
            self.setWindowTitle("××¢×ª×™×§ ×ª×™×§×™×•×ª â€” ××”×™×¨ ×•×¨×‘Ö¾×œ×™×‘×•×ª (××“×œ×’ node_modules)")
            self.setMinimumSize(900, 600)
    
            central = QtWidgets.QWidget()
            self.setCentralWidget(central)
            grid = QtWidgets.QGridLayout(central)
            grid.setContentsMargins(16, 16, 16, 16)
            grid.setHorizontalSpacing(14)
            grid.setVerticalSpacing(14)
    
            # Paths
            self.card_paths = Card("×‘×—×™×¨×ª × ×ª×™×‘×™×")
            grid.addWidget(self.card_paths, 0, 0, 1, 2)
    
            form = QtWidgets.QGridLayout()
            self.card_paths.body.addLayout(form)
    
            self.src_edit = DropLineEdit()
            self.dst_edit = DropLineEdit()
            btn_src = QtWidgets.QPushButton("×‘×—×¨â€¦")
            btn_dst = QtWidgets.QPushButton("×‘×—×¨â€¦")
            btn_src.clicked.connect(self.pick_src)
            btn_dst.clicked.connect(self.pick_dst)
    
            form.addWidget(QtWidgets.QLabel("×ª×™×§×™×™×ª ××§×•×¨:"), 0, 0)
            form.addWidget(self.src_edit, 0, 1)
            form.addWidget(btn_src, 0, 2)
    
            form.addWidget(QtWidgets.QLabel("×ª×™×§×™×™×ª ×™×¢×“:"), 1, 0)
            form.addWidget(self.dst_edit, 1, 1)
            form.addWidget(btn_dst, 1, 2)
    
            # Options
            self.card_opts = Card("××¤×©×¨×•×™×•×ª ×‘×™×¦×•×¢×™×")
            grid.addWidget(self.card_opts, 1, 0, 1, 2)
            h = QtWidgets.QHBoxLayout()
            self.card_opts.body.addLayout(h)
    
            self.overwrite_chk = QtWidgets.QCheckBox("×œ×”×—×œ×™×£ ×§×‘×¦×™× ×§×™×™××™× (overwrite)")
            self.quick_mode_chk = QtWidgets.QCheckBox("××¦×‘ ××”×™×¨ (×‘×œ×™ ×¡×¤×™×¨×” ××•×§×“××ª)")
            self.quick_mode_chk.setChecked(True)
    
            self.mode_combo = QtWidgets.QComboBox()
            self.mode_combo.addItems(["Threads (××•××œ×¥ ×œ-I/O)", "Processes (×ª×”×œ×™×›×™×)"])
            self.workers_spin = QtWidgets.QSpinBox()
            self.workers_spin.setRange(1, max(2, (os.cpu_count() or 4) * 4))
            self.workers_spin.setValue(min(32, max(8, (os.cpu_count() or 8) * 2)))
    
            h.addWidget(self.overwrite_chk)
            h.addWidget(self.quick_mode_chk)
            h.addStretch(1)
            h.addWidget(QtWidgets.QLabel("××•×“:"))
            h.addWidget(self.mode_combo)
            h.addWidget(QtWidgets.QLabel("××¡×³ ×¢×•×‘×“×™×:"))
            h.addWidget(self.workers_spin)
    
            # Progress
            self.card_prog = Card("×”×ª×§×“××•×ª")
            grid.addWidget(self.card_prog, 2, 0, 1, 2)
            self.progress = QtWidgets.QProgressBar()
            self.progress.setMinimum(0)
            self.progress.setValue(0)
            self.progress_lbl = QtWidgets.QLabel("××•×›×Ÿ")
            self.card_prog.body.addWidget(self.progress)
            self.card_prog.body.addWidget(self.progress_lbl)
    
            # Buttons
            self.start_btn = QtWidgets.QPushButton("×”×ª×—×œ ×”×¢×ª×§×”")
            self.start_btn.setProperty("primary", True)
            self.cancel_btn = QtWidgets.QPushButton("×‘×˜×œ")
            self.cancel_btn.setEnabled(False)
            grid.addWidget(self.start_btn, 3, 0)
            grid.addWidget(self.cancel_btn, 3, 1)
    
            self.start_btn.clicked.connect(self.start_copy)
            self.cancel_btn.clicked.connect(self.cancel_copy)
    
            # Log
            self.card_log = Card("×œ×•×’")
            grid.addWidget(self.card_log, 4, 0, 1, 2)
            self.log_view = QtWidgets.QPlainTextEdit()
            self.log_view.setReadOnly(True)
            self.log_view.setStyleSheet("font-family: Consolas, 'Courier New', monospace; font-size: 12px;")
            self.card_log.body.addWidget(self.log_view)
    
            # Styling
            self._apply_style()
            QtGui.QShortcut(QtGui.QKeySequence("Ctrl+L"), self, activated=self.clear_log)
    
            # Worker wiring
            self._thread = None
            self._worker = None
    
        def _apply_style(self):
            try:
                import qdarktheme
                qdarktheme.setup_theme("dark")  # 'auto' ×’× ×¢×•×‘×“; ×©××ª×™ 'dark' ×œ×™×¦×™×‘×•×ª
            except Exception:
                QtWidgets.QApplication.setStyle("Fusion")
                palette = QtGui.QPalette()
                palette.setColor(QtGui.QPalette.ColorRole.Window, QtGui.QColor(35, 38, 41))
                palette.setColor(QtGui.QPalette.ColorRole.WindowText, QtCore.Qt.GlobalColor.white)
                palette.setColor(QtGui.QPalette.ColorRole.Base, QtGui.QColor(25, 27, 30))
                palette.setColor(QtGui.QPalette.ColorRole.Text, QtCore.Qt.GlobalColor.white)
                palette.setColor(QtGui.QPalette.ColorRole.Button, QtGui.QColor(45, 48, 53))
                palette.setColor(QtGui.QPalette.ColorRole.ButtonText, QtCore.Qt.GlobalColor.white)
                palette.setColor(QtGui.QPalette.ColorRole.Highlight, QtGui.QColor(88, 139, 255))
                palette.setColor(QtGui.QPalette.ColorRole.HighlightedText, QtCore.Qt.GlobalColor.black)
                QtWidgets.QApplication.setPalette(palette)
    
            self.setStyleSheet("""
            QPushButton {
                border: 1px solid rgba(255,255,255,0.15);
                border-radius: 10px;
                padding: 8px 14px;
                background: qlineargradient(x1:0,y1:0,x2:0,y2:1,
                            stop:0 rgba(255,255,255,0.08),
                            stop:1 rgba(255,255,255,0.03));
            }
            QPushButton:hover { border-color: rgba(255,255,255,0.35); }
            QPushButton:pressed { background: rgba(255,255,255,0.12); }
            QPushButton[primary="true"] {
                background: qlineargradient(x1:0,y1:0,x2:0,y2:1,
                            stop:0 #556BFF, stop:1 #3A54F5);
                border: none; color: white; font-weight: 600;
            }
            QLineEdit, QPlainTextEdit {
                border: 1px solid rgba(255,255,255,0.15);
                border-radius: 8px;
                padding: 6px 8px;
                background: rgba(255,255,255,0.04);
            }
            QProgressBar {
                border: 1px solid rgba(255,255,255,0.15);
                border-radius: 8px;
                text-align: center;
                height: 20px;
            }
            QProgressBar::chunk {
                border-radius: 8px;
                background-color: #6ea1ff;
            }
            """)
    
        # ---- UI helpers ----
        def append_log(self, line: str):
            self.log_view.appendPlainText(line)
            self.log_view.verticalScrollBar().setValue(self.log_view.verticalScrollBar().maximum())
    
        def clear_log(self):
            self.log_view.setPlainText("")
    
        def pick_src(self):
            d = QtWidgets.QFileDialog.getExistingDirectory(self, "×‘×—×¨ ×ª×™×§×™×™×ª ××§×•×¨", str(Path.home()))
            if d:
                self.src_edit.setText(d)
    
        def pick_dst(self):
            d = QtWidgets.QFileDialog.getExistingDirectory(self, "×‘×—×¨ ×ª×™×§×™×™×ª ×™×¢×“", str(Path.home()))
            if d:
                self.dst_edit.setText(d)
    
        # ---- Copy flow ----
        def start_copy(self):
            src = Path(self.src_edit.text().strip())
            dst = Path(self.dst_edit.text().strip())
            if not src or not dst:
                QtWidgets.QMessageBox.warning(self, "×—×¡×¨ × ×ª×™×‘", "×× × ×‘×—×¨/×™ ×’× ×ª×™×§×™×™×ª ××§×•×¨ ×•×’× ×ª×™×§×™×™×ª ×™×¢×“.")
                return
            if src == dst:
                QtWidgets.QMessageBox.critical(self, "×©×’×™××”", "×ª×™×§×™×™×ª ×”××§×•×¨ ×•×”×™×¢×“ ××™× ×Ÿ ×™×›×•×œ×•×ª ×œ×”×™×•×ª ×–×”×•×ª.")
                return
    
            mode_text = self.mode_combo.currentText()
            mode = "threads" if mode_text.startswith("Threads") else "processes"
            workers = int(self.workers_spin.value())
            quick = self.quick_mode_chk.isChecked()
    
            self.clear_log()
            self.append_log(f"××ª×—×™×œ ×”×¢×ª×§×” ({mode}, workers={workers}, quick={quick})â€¦")
            self.progress.setValue(0)
            if quick:
                # ××¦×‘ indeterminate
                self.progress.setMaximum(0)
                self.progress_lbl.setText("××¢×ª×™×§... (×œ×œ× ×¡×¤×™×¨×” ××•×§×“××ª)")
            else:
                self.progress.setMaximum(1)
                self.progress_lbl.setText("×¡×•×¤×¨ ×§×‘×¦×™×...")
    
            # Thread for worker object
            self._thread = QtCore.QThread(self)
            self._worker = FastCopyWorker(src, dst, self.overwrite_chk.isChecked(), mode, workers, quick)
            self._worker.moveToThread(self._thread)
    
            self._thread.started.connect(self._worker.start)
            self._worker.log.connect(self.append_log)
            self._worker.fatal.connect(self.on_fatal)
            self._worker.finished.connect(self.on_finished)
            self._worker.finished.connect(self._thread.quit)
            self._worker.finished.connect(self._worker.deleteLater)
            self._thread.finished.connect(self._thread.deleteLater)
            self._worker.progress.connect(self.on_progress)
            self._worker.total_known.connect(self.on_total_known)
    
            self.start_btn.setEnabled(False)
            self.cancel_btn.setEnabled(True)
    
            self._thread.start()
    
        def cancel_copy(self):
            if self._worker:
                self._worker.cancel()
                self.append_log("×× ×¡×” ×œ×‘×˜×œ...")
    
        @QtCore.pyqtSlot(int)
        def on_total_known(self, total: int):
            if total <= 0:
                # Quick mode already set to indeterminate above
                return
            self.progress.setMaximum(max(1, total))
            self.progress.setValue(0)
            self.progress_lbl.setText(f"×¡×š ×”×›×œ ×§×‘×¦×™×: {total}")
    
        @QtCore.pyqtSlot(int, int)
        def on_progress(self, copied: int, total: int):
            if total <= 0:
                # indeterminate state
                self.progress.setMaximum(0)
                self.progress_lbl.setText(f"×”×•×¢×ª×§×•: {copied} (××¦×‘ ××”×™×¨)")
            else:
                if self.progress.maximum() != total:
                    self.progress.setMaximum(total)
                self.progress.setValue(copied)
                self.progress_lbl.setText(f"×”×•×¢×ª×§×•: {copied} / {total}")
    
        @QtCore.pyqtSlot(str)
        def on_fatal(self, msg: str):
            self.append_log(f"âŒ {msg}")
            QtWidgets.QMessageBox.critical(self, "×©×’×™××”", msg)
    
        @QtCore.pyqtSlot(bool)
        def on_finished(self, success: bool):
            self.cancel_btn.setEnabled(False)
            self.start_btn.setEnabled(True)
            if success:
                self.progress_lbl.setText("×”×¡×ª×™×™× ×‘×”×¦×œ×—×”.")
            else:
                self.progress_lbl.setText("×”×¡×ª×™×™× (×¢× ×‘×¢×™×•×ª/×‘×™×˜×•×œ).")
            # ×”×—×–×¨×ª progress ×œ××¦×‘ ×¨×’×™×œ
            if self.progress.maximum() == 0:
                self.progress.setMaximum(1)
                self.progress.setValue(1)
    
    
    # ============================ Entrypoint ============================
    
    def main():
        multiprocessing.freeze_support()  # ×ª×•××š ×‘-Windows ×‘×¢×ª ×©×™××•×© ×‘-ProcessPool
        app = QtWidgets.QApplication(sys.argv)
        app.setLayoutDirection(QtCore.Qt.LayoutDirection.RightToLeft)
        win = MainWindow()
        win.setWindowIcon(QtGui.QIcon.fromTheme("folder"))
        win.show()
        sys.exit(app.exec())
    
    if __name__ == "__main__":
        main()
  ğŸ“„ gooZip.py
    import os
    import shutil
    import zipfile
    import tkinter as tk
    from tkinter import filedialog, messagebox
    
    # ×¨×©×™××ª ×ª×™×§×™×•×ª ×©×™×© ×œ×“×œ×’ ×¢×œ×™×”×Ÿ
    SKIP_DIRS = {"node_modules", ".git", "__pycache__"}
    
    def copy_filtered_directory(src, dst):
        """
        ××¢×ª×™×§ ×ª×™×§×™×™×” ×›×•×œ×œ ××‘× ×”, ×ª×•×š ×“×™×œ×•×’ ×¢×œ ×ª×™×§×™×•×ª ××¡×•×™××•×ª ×œ×¤×™ ×©×.
        """
        for root, dirs, files in os.walk(src):
            # ×—×™×©×•×‘ ×”× ×ª×™×‘ ×”×™×—×¡×™ ×›×“×™ ×œ×©×—×–×¨ ××ª ×”××‘× ×”
            rel_path = os.path.relpath(root, src)
            dest_path = os.path.join(dst, rel_path)
            os.makedirs(dest_path, exist_ok=True)
    
            # ×¡×™× ×•×Ÿ ×ª×™×§×™×•×ª ×œ× ×¨×¦×•×™×•×ª
            dirs[:] = [d for d in dirs if d not in SKIP_DIRS]
    
            # ×”×¢×ª×§×ª ×§×‘×¦×™×
            for file in files:
                src_file = os.path.join(root, file)
                dst_file = os.path.join(dest_path, file)
                try:
                    shutil.copy2(src_file, dst_file)
                except Exception as e:
                    print(f"âŒ ×©×’×™××” ×‘×”×¢×ª×§×” ×©×œ {src_file}: {e}")
    
    def zip_directory(source_dir, zip_path):
        """
        ×™×•×¦×¨ ×§×•×‘×¥ ZIP ×ª×•×š ×©××™×¨×” ×¢×œ ××‘× ×” ×ª×™×§×™×•×ª ××œ×.
        """
        with zipfile.ZipFile(zip_path, 'w', zipfile.ZIP_DEFLATED) as zf:
            for root, _, files in os.walk(source_dir):
                for file in files:
                    abs_path = os.path.join(root, file)
                    rel_path = os.path.relpath(abs_path, source_dir)
                    zf.write(abs_path, arcname=rel_path)
    
    def main():
        # ×‘×—×™×¨×ª ×ª×™×§×™×™×ª ××§×•×¨
        root = tk.Tk()
        root.withdraw()
        src_dir = filedialog.askdirectory(title="×‘×—×¨ ×ª×§×™×™×” ×œ×”×¢×ª×§×” ×•×œ×›×™×•×•×¥")
    
        if not src_dir:
            print("âŒ ×œ× × ×‘×—×¨×” ×ª×§×™×™×”.")
            return
    
        # ×‘×—×™×¨×ª ×™×¢×“ ×œ×§×•×‘×¥ ZIP (×›×•×œ×œ ×©× ×§×•×‘×¥)
        zip_path = filedialog.asksaveasfilename(
            title="×‘×—×¨ ××™×§×•× ×•×©× ×œ×§×•×‘×¥ ×”-ZIP",
            defaultextension=".zip",
            filetypes=[("Zip Files", "*.zip")]
        )
    
        if not zip_path:
            print("âŒ ×œ× × ×‘×—×¨ ××™×§×•× ×œ×©××™×¨×ª ×”-ZIP.")
            return
    
        print(f"\nğŸ“‚ ××§×•×¨: {src_dir}")
        print(f"ğŸ“¦ ×™×¢×“ ZIP: {zip_path}")
    
        # ×™×¦×™×¨×ª ×ª×§×™×™×” ×–×× ×™×ª ×œ×”×¢×ª×§×”
        temp_copy_dir = os.path.join(os.path.dirname(zip_path), "_temp_filtered_copy")
        if os.path.exists(temp_copy_dir):
            shutil.rmtree(temp_copy_dir)
        os.makedirs(temp_copy_dir)
    
        # ×”×¢×ª×§×ª ×§×‘×¦×™× ×¢× ×¡×™× ×•×Ÿ ×ª×™×§×™×•×ª
        copy_filtered_directory(src_dir, temp_copy_dir)
    
        # ×™×¦×™×¨×ª ×§×•×‘×¥ ZIP
        zip_directory(temp_copy_dir, zip_path)
    
        # × ×™×§×•×™ ×–×× ×™
        shutil.rmtree(temp_copy_dir)
    
        print(f"\nâœ… ×§×•×‘×¥ ZIP × ×•×¦×¨ ×‘×”×¦×œ×—×” ×‘× ×ª×™×‘: {zip_path}")
        messagebox.showinfo("×”×¦×œ×—×”", f"×”×§×•×‘×¥ × ×•×¦×¨ ×‘×”×¦×œ×—×”:\n{zip_path}")
    
    if __name__ == "__main__":
        main()
  ğŸ“„ morrning.py
    # rubiks_visual_solver.py
    # ××¢×¨×›×ª ×•×™×–×•××œ×™×ª ×ª×œ×ªÖ¾×××“ ×œ×§×•×‘×™×™×ª ×¨×•×‘×™×§ ×¢× ×¡×§×¨××‘×œ, ×ª× ×•×¢×•×ª, "×¤×ª×¨×•×Ÿ" ×¢"×™ Undo,
    # HUD ×¢×©×™×¨ ×‘×¢×‘×¨×™×ª (×¢××™×“ ×œ×™×•× ×™×§×•×“), ×—×œ×§×™×§×™ × ×™×¦×•×¥, ×¨×§×¢ ×—×™, ×•××—×•×•×ª ×¢×›×‘×¨.
    # ×ª×œ×•×™×•×ª: pygame, PyOpenGL, PyOpenGL_accelerate
    # ×‘×“×•×§ ×‘×¤×™×™×ª×•×Ÿ 3.11+ (×›×•×œ×œ 3.13).
    
    import sys
    import math
    import random
    from dataclasses import dataclass
    from typing import List, Tuple, Optional
    
    import pygame
    from pygame.locals import *
    # × ×¢×“×™×£ freetype ×¢×‘×•×¨ ×¢×‘×¨×™×ª/×™×•× ×™×§×•×“; ×× ××™×Ÿ, × ×™×¤×•×œ ×œ-pygame.font
    try:
        import pygame.freetype as ft
        HAS_FT = True
    except Exception:
        HAS_FT = False
    
    from OpenGL.GL import *
    from OpenGL.GLU import *
    
    # ==========================
    # ×¦×‘×¢×™×, ×§×‘×•×¢×™×, ×¢×–×¨
    # ==========================
    
    COLORS = {
        'U': (0.95, 0.95, 0.95),  # ×œ×‘×Ÿ
        'R': (0.90, 0.10, 0.10),  # ××“×•×
        'F': (0.10, 0.70, 0.10),  # ×™×¨×•×§
        'D': (0.98, 0.90, 0.10),  # ×¦×”×•×‘
        'L': (0.98, 0.55, 0.10),  # ×›×ª×•×
        'B': (0.10, 0.30, 0.95),  # ×›×—×•×œ
        'K': (0.07, 0.07, 0.07),  # ×©×—×•×¨ ×œ××¡×’×¨×•×ª
    }
    
    FACES = ['U', 'R', 'F', 'D', 'L', 'B']
    
    # ×¦×™×•×¨
    STICKER_SIZE = 0.96
    GAP = 0.06
    CUBE_HALF = 1.5
    LINE_W = 2.0
    
    # ×× ×™××¦×™×” ×•×ª×¦×•×’×”
    DEFAULT_FPS = 60
    
    def clamp(v, lo, hi):
        return max(lo, min(hi, v))
    
    def ease_out_cubic(t):  # t in [0,1]
        return 1 - pow(1 - t, 3)
    
    def ease_in_out_quad(t):
        return 2*t*t if t < 0.5 else 1 - pow(-2*t + 2, 2)/2
    
    # ==========================
    # ××¦×‘ ×”×§×•×‘×™×™×” ×•×”××”×œ×›×™×
    # ==========================
    
    def rotate_face_cw(face):
        return [[face[2 - j][i] for j in range(3)] for i in range(3)]
    
    def rotate_face_ccw(face):
        return [[face[j][2 - i] for j in range(3)] for i in range(3)]
    
    @dataclass
    class CubeState:
        U: List[List[str]]
        R: List[List[str]]
        F: List[List[str]]
        D: List[List[str]]
        L: List[List[str]]
        B: List[List[str]]
    
        @staticmethod
        def solved():
            return CubeState(
                U=[[ 'U' for _ in range(3)] for _ in range(3)],
                R=[[ 'R' for _ in range(3)] for _ in range(3)],
                F=[[ 'F' for _ in range(3)] for _ in range(3)],
                D=[[ 'D' for _ in range(3)] for _ in range(3)],
                L=[[ 'L' for _ in range(3)] for _ in range(3)],
                B=[[ 'B' for _ in range(3)] for _ in range(3)],
            )
    
        def copy(self):
            return CubeState(
                U=[row[:] for row in self.U],
                R=[row[:] for row in self.R],
                F=[row[:] for row in self.F],
                D=[row[:] for row in self.D],
                L=[row[:] for row in self.L],
                B=[row[:] for row in self.B],
            )
    
    # --- ××”×œ×›×™× ---
    
    def move_U(s: CubeState):
        s.U = rotate_face_cw(s.U)
        s.F[0], s.R[0], s.B[0], s.L[0] = s.L[0][:], s.F[0][:], s.R[0][:], s.B[0][:]
    
    def move_U_prime(s: CubeState):
        s.U = rotate_face_ccw(s.U)
        s.F[0], s.R[0], s.B[0], s.L[0] = s.R[0][:], s.B[0][:], s.L[0][:], s.F[0][:]
    
    def move_D(s: CubeState):
        s.D = rotate_face_cw(s.D)
        s.F[2], s.L[2], s.B[2], s.R[2] = s.R[2][:], s.F[2][:], s.L[2][:], s.B[2][:]
    
    def move_D_prime(s: CubeState):
        s.D = rotate_face_ccw(s.D)
        s.F[2], s.L[2], s.B[2], s.R[2] = s.L[2][:], s.B[2][:], s.R[2][:], s.F[2][:]
    
    def move_R(s: CubeState):
        s.R = rotate_face_cw(s.R)
        colU = [s.U[i][2] for i in range(3)]
        colF = [s.F[i][2] for i in range(3)]
        colD = [s.D[i][2] for i in range(3)]
        colB = [s.B[i][0] for i in range(3)]
        for i in range(3):
            s.U[i][2] = s.F[i][2]
            s.F[i][2] = s.D[i][2]
            s.D[i][2] = colB[2 - i]
            s.B[i][0] = colU[2 - i]
    
    def move_R_prime(s: CubeState):
        s.R = rotate_face_ccw(s.R)
        colU = [s.U[i][2] for i in range(3)]
        colF = [s.F[i][2] for i in range(3)]
        colD = [s.D[i][2] for i in range(3)]
        colB = [s.B[i][0] for i in range(3)]
        for i in range(3):
            s.U[i][2] = colB[2 - i]
            s.F[i][2] = colU[i]
            s.D[i][2] = colF[i]
            s.B[i][0] = colD[2 - i]
    
    def move_L(s: CubeState):
        s.L = rotate_face_cw(s.L)
        colU = [s.U[i][0] for i in range(3)]
        colF = [s.F[i][0] for i in range(3)]
        colD = [s.D[i][0] for i in range(3)]
        colB = [s.B[i][2] for i in range(3)]
        for i in range(3):
            s.U[i][0] = colB[2 - i]
            s.F[i][0] = colU[i]
            s.D[i][0] = colF[i]
            s.B[i][2] = colD[2 - i]
    
    def move_L_prime(s: CubeState):
        s.L = rotate_face_ccw(s.L)
        colU = [s.U[i][0] for i in range(3)]
        colF = [s.F[i][0] for i in range(3)]
        colD = [s.D[i][0] for i in range(3)]
        colB = [s.B[i][2] for i in range(3)]
        for i in range(3):
            s.U[i][0] = colF[i]
            s.F[i][0] = colD[i]
            s.D[i][0] = colB[2 - i]
            s.B[i][2] = colU[2 - i]
    
    def move_F(s: CubeState):
        s.F = rotate_face_cw(s.F)
        rowU = s.U[2][:]
        colR = [s.R[i][0] for i in range(3)]
        rowD = s.D[0][:]
        colL = [s.L[i][2] for i in range(3)]
        s.U[2] = colL[::-1]
        for i in range(3):
            s.R[i][0] = rowU[i]
        s.D[0] = colR[::-1]
        for i in range(3):
            s.L[i][2] = rowD[i]
    
    def move_F_prime(s: CubeState):
        s.F = rotate_face_ccw(s.F)
        rowU = s.U[2][:]
        colR = [s.R[i][0] for i in range(3)]
        rowD = s.D[0][:]
        colL = [s.L[i][2] for i in range(3)]
        s.U[2] = [colR[i] for i in range(3)]
        for i in range(3):
            s.R[i][0] = rowD[i]
        s.D[0] = [colL[2 - i] for i in range(3)]
        for i in range(3):
            s.L[i][2] = rowU[i]
    
    def move_B(s: CubeState):
        s.B = rotate_face_cw(s.B)
        rowU = s.U[0][:]
        colR = [s.R[i][2] for i in range(3)]
        rowD = s.D[2][:]
        colL = [s.L[i][0] for i in range(3)]
        s.U[0] = [colR[i] for i in range(3)][::-1]
        for i in range(3):
            s.R[i][2] = rowD[i]
        s.D[2] = [colL[i] for i in range(3)][::-1]
        for i in range(3):
            s.L[i][0] = rowU[i]
    
    def move_B_prime(s: CubeState):
        s.B = rotate_face_ccw(s.B)
        rowU = s.U[0][:]
        colR = [s.R[i][2] for i in range(3)]
        rowD = s.D[2][:]
        colL = [s.L[i][0] for i in range(3)]
        s.U[0] = [colL[i] for i in range(3)]
        for i in range(3):
            s.R[i][2] = rowU[i]
        s.D[2] = [colR[i] for i in range(3)]
        for i in range(3):
            s.L[i][0] = rowD[i]
    
    def move_double(fn, s: CubeState):
        fn(s); fn(s)
    
    MOVE_FUNCS = {
        'U' : move_U,  "U'": move_U_prime, 'U2': lambda s: move_double(move_U, s),
        'D' : move_D,  "D'": move_D_prime, 'D2': lambda s: move_double(move_D, s),
        'R' : move_R,  "R'": move_R_prime, 'R2': lambda s: move_double(move_R, s),
        'L' : move_L,  "L'": move_L_prime, 'L2': lambda s: move_double(move_L, s),
        'F' : move_F,  "F'": move_F_prime, 'F2': lambda s: move_double(move_F, s),
        'B' : move_B,  "B'": move_B_prime, 'B2': lambda s: move_double(move_B, s),
    }
    
    def invert_move(m: str) -> str:
        if m.endswith("2"): return m
        return m[:-1] if m.endswith("'") else m + "'"
    
    # ==========================
    # ×¨×™× ×“×•×¨
    # ==========================
    
    def draw_square(color, verts):
        glColor3f(*color)
        glBegin(GL_QUADS)
        for v in verts: glVertex3f(*v)
        glEnd()
    
    def draw_border(verts):
        glColor3f(*COLORS['K'])
        glLineWidth(LINE_W)
        glBegin(GL_LINE_LOOP)
        for v in verts: glVertex3f(*v)
        glEnd()
    
    def vadd(a,b): return (a[0]+b[0], a[1]+b[1], a[2]+b[2])
    def vscale(a,s): return (a[0]*s, a[1]*s, a[2]*s)
    
    def face_plane(face_char):
        H = CUBE_HALF
        if face_char == 'U':
            normal=(0,1,0); base=(0,H,0);    axis_u=(1,0,0);  axis_v=(0,0,-1)
        elif face_char == 'D':
            normal=(0,-1,0); base=(0,-H,0);  axis_u=(1,0,0);  axis_v=(0,0,1)
        elif face_char == 'F':
            normal=(0,0,1); base=(0,0,H);    axis_u=(1,0,0);  axis_v=(0,-1,0)
        elif face_char == 'B':
            normal=(0,0,-1); base=(0,0,-H);  axis_u=(-1,0,0); axis_v=(0,-1,0)
        elif face_char == 'R':
            normal=(1,0,0); base=(H,0,0);    axis_u=(0,0,-1); axis_v=(0,-1,0)
        elif face_char == 'L':
            normal=(-1,0,0); base=(-H,0,0);  axis_u=(0,0,1);  axis_v=(0,-1,0)
        else:
            normal=(0,0,0); base=(0,0,0); axis_u=(1,0,0); axis_v=(0,1,0)
        return normal, base, axis_u, axis_v
    
    def draw_face(face_char: str, face_grid: List[List[str]]):
        _, base, axis_u, axis_v = face_plane(face_char)
        cell = (STICKER_SIZE - GAP) / 3.0
        for r in range(3):
            for c in range(3):
                color = COLORS[face_grid[r][c]]
                du = (c - 1) * cell
                dv = (r - 1) * cell
                center = vadd(base, vadd(vscale(axis_u, du), vscale(axis_v, dv)))
                half = cell/2 - GAP/2
                p1 = vadd(center, vadd(vscale(axis_u, -half), vscale(axis_v, -half)))
                p2 = vadd(center, vadd(vscale(axis_u,  half), vscale(axis_v, -half)))
                p3 = vadd(center, vadd(vscale(axis_u,  half), vscale(axis_v,  half)))
                p4 = vadd(center, vadd(vscale(axis_u, -half), vscale(axis_v,  half)))
                verts = [p1,p2,p3,p4]
                draw_square(color, verts)
                draw_border(verts)
    
    def draw_cube(state: CubeState):
        draw_face('U', state.U)
        draw_face('R', state.R)
        draw_face('F', state.F)
        draw_face('D', state.D)
        draw_face('L', state.L)
        draw_face('B', state.B)
    
    # ==========================
    # HUD ×•×˜×§×¡×˜ (×¢××™×“ ×œ×¢×‘×¨×™×ª)
    # ==========================
    
    class TextRenderer:
        def __init__(self, size=18):
            self.size = size
            self.ft_font = None
            self.pg_font = None
            self._init_fonts()
    
        def _try_ft(self, name, sz):
            if not HAS_FT: return None
            try:
                f = ft.SysFont(name, sz, bold=False)
                r = f.get_rect("×‘×“×™×§×” ×˜×§×¡×˜")
                if r.width > 0: return f
            except Exception:
                pass
            return None
    
        def _try_pg(self, name, sz):
            try:
                f = pygame.font.SysFont(name, sz)
                if f.size("×‘×“×™×§×” ×˜×§×¡×˜")[0] > 0: return f
            except Exception:
                pass
            return None
    
        def _init_fonts(self):
            pygame.font.init()
            candidates = ["Noto Sans Hebrew", "Rubik", "Arial", "Segoe UI", "Tahoma"]
            # × ×¡×” freetype
            for nm in candidates:
                ftf = self._try_ft(nm, self.size)
                if ftf:
                    self.ft_font = ftf
                    return
            # × ×¤×™×œ×” ×œ-pygame.font
            for nm in candidates:
                pgf = self._try_pg(nm, self.size)
                if pgf:
                    self.pg_font = pgf
                    return
            # ××—×¨×•×Ÿ
            if HAS_FT:
                self.ft_font = ft.Font(None, self.size)
            else:
                self.pg_font = pygame.font.Font(None, self.size)
    
        def render(self, surface, text, pos, color=(235,235,240), shadow=True):
            x,y = pos
            if self.ft_font:
                if shadow:
                    self.ft_font.render_to(surface, (x+1,y+1), text, (0,0,0,100))
                self.ft_font.render_to(surface, (x,y), text, color)
            else:
                # pygame.font
                try:
                    s = self.pg_font.render(text, True, color)
                except pygame.error:
                    # ×”×¡×¨×ª ×ª×•×•×™× ×‘×¢×™×™×ª×™×™× ×œ×”×¦×’×” ×•×œ× ×œ×”×¤×™×œ ××ª ×”×ª×•×›× ×™×ª
                    safe = text.encode("ascii","ignore").decode() or "."
                    s = self.pg_font.render(safe, True, color)
                if shadow:
                    sh = self.pg_font.render(text, True, (0,0,0))
                    surface.blit(sh, (x+1,y+1))
                surface.blit(s, (x,y))
    
    # ==========================
    # ×—×œ×§×™×§×™× ×¤×©×•×˜×™× ×œ× ×™×¦×•×¥
    # ==========================
    
    class Particle:
        def __init__(self):
            self.reset()
    
        def reset(self, around=(0,0,0)):
            ax, ay, az = around
            # ××™×§×•× ×§×¨×•×‘ ×œ×§×•×‘×™×™×”
            self.x = ax + random.uniform(-2.2, 2.2)
            self.y = ay + random.uniform(-2.2, 2.2)
            self.z = az + random.uniform(-2.2, 2.2)
            self.vy = random.uniform(0.002, 0.01)
            self.life = random.uniform(1.0, 2.5)
            self.size = random.uniform(0.01, 0.04)
            self.color = (random.uniform(0.7,1.0), random.uniform(0.2,0.6), random.uniform(0.8,1.0))
            self.alive = True
    
        def update(self, dt):
            if not self.alive: return
            self.y += self.vy * dt
            self.life -= 0.001 * dt
            if self.life <= 0:
                self.alive = False
    
        def draw(self):
            if not self.alive: return
            glPointSize(max(1.0, self.size*300))
            glBegin(GL_POINTS)
            glColor4f(self.color[0], self.color[1], self.color[2], clamp(self.life/2.5, 0.15, 0.9))
            glVertex3f(self.x, self.y, self.z)
            glEnd()
    
    # ==========================
    # ×‘×§×¨, ×¡×§×¨××‘×œ, ×ª×•×¨ ××”×œ×›×™×
    # ==========================
    
    class RubiksController:
        def __init__(self):
            self.state = CubeState.solved()
            self.history: List[str] = []  # ×”×™×¡×˜×•×¨×™×™×ª ××”×œ×›×™× (×œ×¤×ª×¨×•×Ÿ Undo)
            self.queue: List[str] = []    # ×ª×•×¨ ×‘×™×¦×•×¢ ×× ×™××˜×™×‘×™
            self.last_scramble: List[str] = []
    
        def do_move(self, m: str, record=True):
            MOVE_FUNCS[m](self.state)
            if record:
                self.history.append(m)
    
        def do_moves(self, moves: List[str], record=True):
            for m in moves:
                self.do_move(m, record=record)
    
        def invert_history(self) -> List[str]:
            return [invert_move(m) for m in reversed(self.history)]
    
        def enqueue(self, moves: List[str], clear_queue=False):
            if clear_queue: self.queue.clear()
            self.queue.extend(moves)
    
        def scramble(self, length=25):
            basics = ['U','D','L','R','F','B']
            suffixes = ['', "'", '2']
            moves = []
            prev_axis = None
            for _ in range(length):
                while True:
                    f = random.choice(basics)
                    suf = random.choice(suffixes)
                    m = f + suf
                    axis = 'UD' if f in ['U','D'] else ('LR' if f in ['L','R'] else 'FB')
                    if axis != prev_axis:
                        prev_axis = axis
                        moves.append(m)
                        break
            # × ×ª×—×™×œ ×××™×¤×•×¡ ×›×“×™ ×©×”×™×¡×˜×•×¨×™×™×ª ×”×¤×ª×¨×•×Ÿ ×ª×”×™×” ×‘×“×™×•×§ ×”×¡×§×¨××‘×œ
            self.reset()
            self.do_moves(moves, record=True)
            self.last_scramble = moves[:]
            return moves
    
        def reset(self):
            self.state = CubeState.solved()
            self.history.clear()
            self.queue.clear()
    
    # ==========================
    # ××¦×œ××” ×•×§×œ×˜
    # ==========================
    
    class Camera:
        def __init__(self):
            self.rot_x = 28
            self.rot_y = -40
            self.distance = 6.3
            self._dragging = False
            self._last = (0,0)
            self.auto_orbit = True
            self.orbit_speed = 0.12
    
        def apply(self):
            glTranslatef(0, 0, -self.distance)
            glRotatef(self.rot_x, 1, 0, 0)
            glRotatef(self.rot_y, 0, 1, 0)
    
        def update_auto(self, dt):
            if self.auto_orbit:
                self.rot_y += self.orbit_speed * dt
    
        def mouse_down(self, pos):
            self._dragging = True
            self._last = pos
            self.auto_orbit = False
    
        def mouse_up(self):
            self._dragging = False
    
        def mouse_motion(self, pos):
            if not self._dragging: return
            dx = pos[0] - self._last[0]
            dy = pos[1] - self._last[1]
            self.rot_y += dx * 0.3
            self.rot_x = clamp(self.rot_x + dy * 0.3, -89, 89)
            self._last = pos
    
        def mouse_wheel(self, delta):
            self.distance = clamp(self.distance - delta*0.4, 3.5, 12.0)
    
    # ==========================
    # ××¤×œ×™×§×¦×™×”
    # ==========================
    
    class App:
        def __init__(self, width=1100, height=800):
            pygame.init()
            pygame.display.set_caption("×§×•×‘×™×™×ª ×¨×•×‘×™×§ â€“ ×”×“××™×” ×—×™×” (Undo Solver)")
            pygame.display.set_mode((width, height), DOUBLEBUF | OPENGL)
            self.clock = pygame.time.Clock()
            self.width = width
            self.height = height
    
            # OpenGL ×‘×¡×™×¡×™
            glEnable(GL_DEPTH_TEST)
            glEnable(GL_MULTISAMPLE)
            glEnable(GL_BLEND)
            glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)
            glClearColor(0.06, 0.06, 0.09, 1.0)
    
            gluPerspective(45, (width/height), 0.1, 100.0)
    
            self.controller = RubiksController()
            self.camera = Camera()
            self.txt = TextRenderer(size=18)
    
            # ×× ×™××¦×™×™×ª ××”×œ×›×™×
            self.anim_move: Optional[str] = None
            self.anim_elapsed = 0.0
            self.anim_duration_ms = 220  # × ×™×ª×Ÿ ×œ×©×™× ×•×™ ×¢× A
            self.animating_whole_cube = True  # ×¤×©×˜×•×ª: ×¡×™×‘×•×‘ ×›×œ×œ×™
            self.last_dt = 0
    
            # ×—×œ×§×™×§×™×
            self.particles = [Particle() for _ in range(160)]
    
            # UI ××¦×‘×™×
            self.show_help = True
            self.wireframe = False
    
        # --------- ×¦×™×•×¨×™ ×¨×§×¢/×§×¨×§×¢/××¡×’×¨×ª ---------
    
        def draw_background_quad(self):
            # ×’×¨×“×™×× ×˜ ××•×¤×§×™/××œ×›×¡×•× ×™
            glDisable(GL_DEPTH_TEST)
            glMatrixMode(GL_PROJECTION)
            glPushMatrix()
            glLoadIdentity()
            glOrtho(0, 1, 0, 1, -1, 1)
            glMatrixMode(GL_MODELVIEW)
            glPushMatrix()
            glLoadIdentity()
    
            glBegin(GL_QUADS)
            glColor3f(0.05, 0.06, 0.11)
            glVertex2f(0,0)
            glVertex2f(1,0)
            glColor3f(0.10, 0.11, 0.20)
            glVertex2f(1,1)
            glVertex2f(0,1)
            glEnd()
    
            glPopMatrix()
            glMatrixMode(GL_PROJECTION)
            glPopMatrix()
            glMatrixMode(GL_MODELVIEW)
            glEnable(GL_DEPTH_TEST)
    
        def draw_ground_shadow(self):
            # ×“×™×¡×§ ×›×”×” ××ª×—×ª ×œ×§×•×‘×™×™×”
            glPushMatrix()
            glTranslatef(0, -1.9, 0)
            glRotatef(90, 1, 0, 0)
            glColor4f(0,0,0,0.25)
            glBegin(GL_TRIANGLE_FAN)
            glVertex3f(0,0,0)
            for i in range(64):
                ang = i/64 * math.tau
                glVertex3f(math.cos(ang)*2.2, math.sin(ang)*2.2, 0)
            glEnd()
            glPopMatrix()
    
        # --------- HUD ---------
    
        def draw_panel(self, rect, alpha=110):
            x,y,w,h = rect
            surf = pygame.Surface((w,h), pygame.SRCALPHA)
            pygame.draw.rect(surf, (20,25,35,alpha), (0,0,w,h), border_radius=14)
            pygame.display.get_surface().blit(surf, (x,y))
    
        def draw_hud(self, fps):
            screen = pygame.display.get_surface()
            # ×¤×× ×œ ×¢×œ×™×•×Ÿ
            self.draw_panel((10, 10, self.width-20, 88), alpha=90)
            pad = 18
            self.txt.render(screen, "SPACE=×¡×§×¨××‘×œ   S=×¤×ª×¨×•×Ÿ(Undo)   C=××™×¤×•×¡   A=××”×™×¨×•×ª ×× ×™××¦×™×”   W=Wireframe   H=×¢×–×¨×”   ×¢×›×‘×¨=×¡×™×‘×•×‘/×–×•×", (20, 18))
            self.txt.render(screen, f"××”×œ×›×™× ×‘×”×™×¡×˜×•×¨×™×”: {len(self.controller.history)} | ×‘×ª×•×¨: {len(self.controller.queue)} | ×× ×™××¦×™×”: {self.anim_duration_ms}ms | FPS: {int(fps)}", (20, 42))
            if self.controller.last_scramble:
                scr = " ".join(self.controller.last_scramble[:24])
                self.txt.render(screen, f"×¡×§×¨××‘×œ ××—×¨×•×Ÿ: {scr}{' ...' if len(self.controller.last_scramble)>24 else ''}", (20, 66))
    
            # ×¤×× ×œ ×ª×—×ª×•×Ÿ (×¢×–×¨×”)
            if self.show_help:
                h = 120
                self.draw_panel((10, self.height - h - 10, self.width-20, h), alpha=90)
                y = self.height - h
                lines = [
                    "×ª× ×•×¢×•×ª: U/D/L/R/F/B (Shift+××•×ª = ×’×¨×©), ×•×—×™×¦×™× ×œ×¡×™×‘×•×‘ ××¦×œ××”.",
                    "×’×œ×’×œ×ª ×¢×›×‘×¨ ×œ×–×•×. ×—×™×¦×™×/×’×¨×™×¨×” ×œ×œ×›×™×“×ª ×–×•×•×™×ª.",
                    "×¤×ª×¨×•×Ÿ Undo ××—×–×™×¨ ××ª ×›×œ ×”××”×œ×›×™× ×©× ×¢×©×• ×“×¨×š ×”××¢×¨×›×ª (×›×•×œ×œ ×”×¡×§×¨××‘×œ) â€” ×¤×ª×¨×•×Ÿ ××œ× ×œ×¡×§×¨××‘×œ ×”× ×•×›×—×™.",
                ]
                yy = y + 10
                for ln in lines:
                    self.txt.render(screen, ln, (20, yy))
                    yy += 26
    
            # ×¤×¡ ×”×ª×§×“××•×ª ×§×˜×Ÿ ×‘×–××Ÿ ××”×œ×š
            if self.anim_move is not None:
                prog = clamp(self.anim_elapsed / self.anim_duration_ms, 0.0, 1.0)
                prog = ease_out_cubic(prog)
                bar_w = int((self.width - 40) * prog)
                pygame.draw.rect(screen, (60,180,250,220), (20, 102, bar_w, 6), border_radius=3)
    
        # --------- ×§×œ×˜ ---------
    
        def process_input(self):
            for event in pygame.event.get():
                if event.type == QUIT:
                    pygame.quit(); sys.exit(0)
                elif event.type == KEYDOWN:
                    mod = pygame.key.get_mods()
                    shift = (mod & KMOD_SHIFT) != 0
                    if event.key == K_ESCAPE:
                        pygame.quit(); sys.exit(0)
                    elif event.key == K_SPACE:
                        self.controller.scramble(25)
                    elif event.key == K_s:
                        sol = self.controller.invert_history()
                        self.controller.enqueue(sol, clear_queue=True)
                        self.controller.history.clear()
                    elif event.key == K_c:
                        self.controller.reset()
                    elif event.key == K_a:
                        # ××”×™×¨/××™×˜×™
                        self.anim_duration_ms = 90 if self.anim_duration_ms == 220 else 220
                    elif event.key == K_h:
                        self.show_help = not self.show_help
                    elif event.key == K_w:
                        self.wireframe = not self.wireframe
                        glPolygonMode(GL_FRONT_AND_BACK, GL_LINE if self.wireframe else GL_FILL)
                    elif event.key in (K_LEFT, K_RIGHT, K_UP, K_DOWN):
                        if event.key == K_LEFT:  self.camera.rot_y -= 7
                        if event.key == K_RIGHT: self.camera.rot_y += 7
                        if event.key == K_UP:    self.camera.rot_x -= 7
                        if event.key == K_DOWN:  self.camera.rot_x += 7
                    else:
                        keymap = {K_u:'U', K_d:'D', K_l:'L', K_r:'R', K_f:'F', K_b:'B'}
                        if event.key in keymap:
                            m = keymap[event.key] + ("'" if shift else "")
                            self.controller.enqueue([m])
                elif event.type == MOUSEBUTTONDOWN:
                    if event.button == 1:
                        self.camera.mouse_down(event.pos)
                    elif event.button == 4:  # ×’×œ×’×œ×ª ×œ××¢×œ×”
                        self.camera.mouse_wheel(+1)
                    elif event.button == 5:  # ×’×œ×’×œ×ª ×œ××˜×”
                        self.camera.mouse_wheel(-1)
                elif event.type == MOUSEBUTTONUP:
                    if event.button == 1:
                        self.camera.mouse_up()
                elif event.type == MOUSEMOTION:
                    self.camera.mouse_motion(event.pos)
    
        # --------- ×× ×™××¦×™×™×ª ××”×œ×š ---------
    
        def start_next_animation_if_needed(self):
            if self.anim_move is None and self.controller.queue:
                self.anim_move = self.controller.queue.pop(0)
                self.anim_elapsed = 0.0
    
        def advance_animation(self, dt_ms):
            if self.anim_move is None: return
            self.anim_elapsed += dt_ms
            t = clamp(self.anim_elapsed / self.anim_duration_ms, 0.0, 1.0)
            if t >= 1.0 - 1e-3:
                # ×”×©×œ× ××ª ×”××”×œ×š ×‘×¤×•×¢×œ (×”-state ×›×‘×¨ ×™×ª×¢×“×›×Ÿ)
                MOVE_FUNCS[self.anim_move](self.controller.state)
                self.controller.history.append(self.anim_move)
                self.anim_move = None
                self.anim_elapsed = 0.0
    
        def apply_animation_rotation(self):
            if self.anim_move is None: return
            # ×¤×©×˜×•×ª: ××¡×•×‘×‘ ××ª ×›×œ ×”×§×•×‘×™×™×” ×¡×‘×™×‘ ×¦×™×¨ ×›×œ×œ×™ ×›×“×™ ×œ×ª×ª ×ª×—×•×©×ª ×ª× ×•×¢×”.
            axis_map = {
                'U': (0,1,0), "U'": (0,1,0), 'U2': (0,1,0),
                'D': (0,-1,0), "D'": (0,-1,0), 'D2': (0,-1,0),
                'R': (1,0,0), "R'": (1,0,0), 'R2': (1,0,0),
                'L': (-1,0,0), "L'": (-1,0,0), 'L2': (-1,0,0),
                'F': (0,0,1), "F'": (0,0,1), 'F2': (0,0,1),
                'B': (0,0,-1), "B'": (0,0,-1), 'B2': (0,0,-1),
            }
            ax = axis_map[self.anim_move]
            # ×™×¢×“: 90 ××• 180 ××¢×œ×•×ª; ×›×™×•×•×Ÿ ×œ×¤×™ ×’×¨×©
            target = 180.0 if self.anim_move.endswith("2") else 90.0
            sign = -1.0 if self.anim_move.endswith("'") else 1.0
            t = clamp(self.anim_elapsed / self.anim_duration_ms, 0.0, 1.0)
            ang = ease_in_out_quad(t) * target * sign
            glRotatef(ang, ax[0], ax[1], ax[2])
    
        # --------- ×œ×•×œ××ª ×”×¦×™×•×¨ ---------
    
        def draw_scene(self, dt_ms):
            # ×¨×§×¢ ×“×•Ö¾×××“×™
            self.draw_background_quad()
    
            # 3D
            glClear(GL_DEPTH_BUFFER_BIT)
            glPushMatrix()
            self.camera.apply()
            self.camera.update_auto(dt_ms)
    
            # ×¦×œ/×§×¨×§×¢
            self.draw_ground_shadow()
    
            # ×—×œ×§×™×§×™×
            for p in self.particles:
                if not p.alive:
                    p.reset()
                p.update(dt_ms)
                p.draw()
    
            # ×ª××•×¨×” ××–×•×™×¤×ª ×§×œ×” (×©×™× ×•×™ ×‘×”×™×¨×•×ª ×œ×¤×™ ×–×•×•×™×ª)
            glEnable(GL_POLYGON_OFFSET_FILL)
            glPolygonOffset(1.0, 1.0)
    
            # ×¡×™×‘×•×‘ ×× ×™××¦×™×™×ª ××”×œ×š
            glPushMatrix()
            self.apply_animation_rotation()
    
            # ×¦×™×•×¨ ×”×§×•×‘×™×™×”
            draw_cube(self.controller.state)
            glPopMatrix()
    
            glDisable(GL_POLYGON_OFFSET_FILL)
            glPopMatrix()
    
            # HUD
            self.draw_hud(self.clock.get_fps())
            pygame.display.flip()
    
        # --------- ×¨×™×¦×” ---------
    
        def run(self):
            while True:
                dt_ms = self.clock.tick(DEFAULT_FPS)
                self.last_dt = dt_ms
                self.process_input()
                self.start_next_animation_if_needed()
                self.advance_animation(dt_ms)
                self.draw_scene(dt_ms)
    
    # ==========================
    # main
    # ==========================
    
    def main():
        try:
            App().run()
        except Exception as e:
            # ×”×“×¤×¡×” ×™×“×™×“×•×ª×™×ª â€” ×‘×œ×™ ×œ×”×¤×™×œ ××ª ×—×œ×•×Ÿ ×”××¡×•×£ ×‘×©×§×˜
            print("××™×¨×¢×” ×©×’×™××”:", e)
            try:
                pygame.quit()
            except Exception:
                pass
    
    if __name__ == "__main__":
        main()
  ğŸ“„ net.py
    #!/usr/bin/env python3
    """
    scan_lan.py â€“ ×¡×¨×™×§×” ××”×™×¨×” ×©×œ ×›×œ ×”××›×©×™×¨×™× ×‘×¨×©×ª-LAN ×”××§×•××™×ª.
    
    ×ª×œ×•×™×•×™×•×ª:
    1.  nmap   â€“ ×™×© ×œ×”×ª×§×™×Ÿ ×‘××—×©×‘ (https://nmap.org/download.html)
    2.  Python 3.x (××™×Ÿ ×¡×¤×¨×™×•×ª × ×™×— ×”×—×¦×“ ×©×œ×™×©×™ â€“ ×¨×§ stdlib)
    
    ×”×¤×¢×œ×”:
        python scan_lan.py
    """
    import json
    import os
    import shutil
    import socket
    import subprocess
    import sys
    import xml.etree.ElementTree as ET
    
    
    # -----------------------------------------------------------
    #  ×›×œ×™ ×¢×–×¨: ××™×ª×•×¨ ×›×ª×•×‘×ª IP ××§×•××™×ª ×•×”×¡×§×ª ×˜×•×•×— CIDR ×¡×‘×™×¨
    # -----------------------------------------------------------
    def get_local_ip() -> str:
        """××—×–×™×¨ ××ª ×›×ª×•×‘×ª IP ×©×œ ×”××—×©×‘ ×‘×¨×©×ª ×”××§×•××™×ª."""
        with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s:
            # "××ª×—×‘×¨" ×œ-8.8.8.8 ×›×“×™ ×©×”-OS ×™×‘×—×¨ ×××©×§ ×¨×©×ª ×¤×¢×™×œ
            s.connect(("8.8.8.8", 80))
            return s.getsockname()[0]
    
    
    def guess_cidr(ip: str) -> str:
        """
        ×’×•×–×¨ ×˜×•×•×— CIDR ××”-IP:
          * â€10.x.x.x  â†’ â€10.0.0.0/8
          * â€172.x.y.z â†’ â€172.x.0.0/16
          * ××—×¨×ª (×œ×¨×•×‘ â€192.168.x.y) â†’ â€192.168.x.0/24
        """
        octets = ip.split(".")
        if ip.startswith("10."):
            return "10.0.0.0/8"
        if ip.startswith("172."):
            return f"{octets[0]}.{octets[1]}.0.0/16"
        # ×‘×¨×™×¨×ª-××—×“×œ â€“ /24
        return f"{octets[0]}.{octets[1]}.{octets[2]}.0/24"
    
    
    # -----------------------------------------------------------
    #  ×¡×¨×™×§×ª Nmap ×•-XML Parsing
    # -----------------------------------------------------------
    def run_nmap(network: str) -> str:
        """××¨×™×¥ nmapâ€-sn ×•××—×–×™×¨ ××ª ×¤×œ×˜-XML ×›-string."""
        nmap_bin = shutil.which("nmap")
        if not nmap_bin:
            sys.exit("âŒ  nmap ×œ× ××•×ª×§×Ÿ ××• ×œ× × ××¦× ×‘-PATH â€“ ×”×ª×§×Ÿ ×•×”×¨×¥ ×©×•×‘.")
        cmd = [nmap_bin, "-sn", network, "-oX", "-"]  # STDOUT â‡’ XML
        res = subprocess.run(cmd, capture_output=True, text=True)
        if res.returncode != 0:
            sys.exit(f"âŒ  nmap × ×›×©×œ ({res.returncode}):\n{res.stderr}")
        return res.stdout
    
    
    def parse_nmap_xml(xml_data: str) -> list[dict]:
        """××¤×¢× ×— ××ª ×”-XML ×•××—×–×™×¨ ×¨×©×™××ª dict-×™×: ip, mac, vendor."""
        hosts = []
        root = ET.fromstring(xml_data)
        for host in root.findall("host"):
            if host.findtext("status/@state", default="down") != "up":
                continue
            ip_elem  = host.find("address[@addrtype='ipv4']")
            mac_elem = host.find("address[@addrtype='mac']")
            hosts.append({
                "ip": ip_elem.attrib["addr"] if ip_elem is not None else None,
                "mac": mac_elem.attrib.get("addr") if mac_elem is not None else None,
                "vendor": mac_elem.attrib.get("vendor") if mac_elem is not None else None,
            })
        return hosts
    
    
    # -----------------------------------------------------------
    #  main â€“ ×”×’×™×•×Ÿ ×¨××©×™
    # -----------------------------------------------------------
    def main() -> None:
        local_ip = get_local_ip()
        cidr     = guess_cidr(local_ip)
        print(f"ğŸ”  ××–×”×” ×¨×©×ª: {cidr}  (×”××—×©×‘: {local_ip})")
        xml_out  = run_nmap(cidr)
        devices  = parse_nmap_xml(xml_out)
    
        if not devices:
            print("×œ× × ××¦××• ××›×©×™×¨×™× (××•×œ×™ ×›×•×œ× ×›×‘×•×™×™× / ×—×¡×•××™×-Ping).")
            return
    
        print("\nğŸ“‹  ××›×©×™×¨×™× ××—×•×‘×¨×™×:")
        for dev in devices:
            vendor = f" ({dev['vendor']})" if dev["vendor"] else ""
            print(f" â€¢ {dev['ip']:15}  {dev['mac'] or '---':17}{vendor}")
    
        # ××¤×©×¨ ×’× ×œ×™×™×¦× JSON ×œ×©×™××•×© ×‘×ª×•×›× ×” ××—×¨×ª:
        # with open("lan_devices.json", "w", encoding="utf-8") as f:
        #     json.dump(devices, f, ensure_ascii=False, indent=2)
    
    
    if __name__ == "__main__":
        main()
  ğŸ“„ simpel.py
    import os
    import tkinter as tk
    from tkinter import filedialog, messagebox
    
    MAX_DEPTH = 5
    SKIP_DIRS = {"node_modules", ".git", "__pycache__","package-lock.json"}
    PRINT_CONTENT_EXTENSIONS = {".py", ".js", ".ts", ".jsx", ".tsx", ".html", ".css",".prisma", ".mjs", ".cjs", ".env", ".md", "Dockerfile","docker-compose.yml", ".jsonc", ".eslintrc.json", "tsconfig.json"}
    
    
    def scan_directory(path, indent=0, output_lines=None, current_depth=0, print_content=False):
        if output_lines is None:
            output_lines = []
    
        if current_depth > MAX_DEPTH:
            output_lines.append("  " * indent + "ğŸ”½ ... (×¢×•×“ ×ª×™×§×™×•×ª ×”×•×¡×ª×¨×•)")
            return output_lines
    
        try:
            items = sorted(os.listdir(path))
        except PermissionError:
            output_lines.append("  " * indent + f"[â›” ××™×Ÿ ×”×¨×©××”]: {path}")
            return output_lines
    
        for item in items:
            full_path = os.path.join(path, item)
    
            if os.path.isdir(full_path) and item in SKIP_DIRS:
                print(f"â­ï¸ ××“×œ×’ ×¢×œ ×ª×™×§×™×™×”: {full_path}")
                output_lines.append("  " * indent + f"ğŸš« {item}/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)")
                continue
    
            print(f"â–¶ï¸ ×¡×•×¨×§: {full_path}")
    
            if os.path.isdir(full_path):
                output_lines.append("  " * indent + f"ğŸ“ {item}/")
                scan_directory(full_path, indent + 1, output_lines, current_depth + 1, print_content)
            else:
                output_lines.append("  " * indent + f"ğŸ“„ {item}")
                ext = os.path.splitext(item)[1].lower()
                if print_content and ext in PRINT_CONTENT_EXTENSIONS:
                    try:
                        with open(full_path, "r", encoding="utf-8", errors="ignore") as f:
                            lines = f.readlines()
                            for line in lines:
                                output_lines.append("  " * (indent + 1) + line.rstrip())
                    except Exception as e:
                        output_lines.append("  " * (indent + 1) + f"[×©×’×™××” ×‘×§×¨×™××”: {e}]")
    
        return output_lines
    
    def ask_include_content():
        root = tk.Tk()
        root.withdraw()
        result = messagebox.askyesno(
            "×”×× ×œ×›×œ×•×œ ×ª×•×›×Ÿ ×§×‘×¦×™×?",
            "×”×× ××ª×” ×¨×•×¦×” ×©×”×§×•×“ ×™×“×¤×™×¡ ×’× ××ª ×ª×•×›×Ÿ ×§×‘×¦×™ ×”×§×•×“ (×•×œ× ×¨×§ ××ª ×©××•×ª×™×”×)?"
        )
        return result
    
    def main():
        root = tk.Tk()
        root.withdraw()
        folder_path = filedialog.askdirectory(title="×‘×—×¨ ×ª×§×™×™×” ×œ×¡×¨×™×§×”")
    
        if not folder_path:
            print("âŒ ×œ× × ×‘×—×¨×” ×ª×§×™×™×”.")
            return
    
        include_content = ask_include_content()
        print(f"\nğŸ“‚ ×¡×•×¨×§ ××ª: {folder_path} (×¢×“ ×¢×•××§ {MAX_DEPTH})")
        print(f"ğŸ“„ ×›×•×œ×œ ×ª×•×›×Ÿ ×§×‘×¦×™×: {'×›×Ÿ' if include_content else '×œ×'}\n")
    
        structure_lines = scan_directory(folder_path, print_content=include_content)
    
        print("\nğŸ“‹ ××‘× ×” ××œ×:\n")
        for line in structure_lines:
            print(line)
    
        output_file = os.path.join(folder_path, "directory_structure.txt")
        with open(output_file, "w", encoding="utf-8") as f:
            f.write("\n".join(structure_lines))
    
        print(f"\nâœ… × ×©××¨ ×‘: {output_file}")
    
    if __name__ == "__main__":
        main()
  ğŸ“„ skriptName.py
    import os
    import tkinter as tk
    from tkinter import filedialog, messagebox
    
    # ×¢×•××§ ××§×¡×™××œ×™
    MAX_DEPTH = 7
    
    # ×ª×™×§×™×•×ª ×©××•×ª×¨ ×œ×¡×¨×•×§ ×‘×¨××” ×”×¢×œ×™×•× ×” ×‘×œ×‘×“
    ALLOWED_ROOT_DIRS = {"client", "server"}
    
    # ×ª×™×§×™×•×ª ×©×™×© ×œ×“×œ×’ ×¢×œ×™×”×Ÿ ×‘×ª×•×š client/server
    SKIP_DIRS = {"node_modules", ".git", "__pycache__", "package-lock.json", ".venv"}
    
    # ×§×‘×¦×™× ×©×™×© ×œ×“×œ×’ ×¢×œ×™×”×
    SKIP_FILES = {
        "index-DEKCV7q4.js",
    }
    
    # ×¡×™×•××•×ª ×©××•×ª×¨ ×œ×”×¦×™×’
    PRINT_CONTENT_EXTENSIONS = {".js", ".ts", ".html", ".css", ".jsx", ".md"}
    
    
    def scan_directory(path, indent=0, output_lines=None, current_depth=0, print_content=False):
        if output_lines is None:
            output_lines = []
    
        # ×¢×•××§ ××§×¡×™××œ×™
        if current_depth > MAX_DEPTH:
            output_lines.append("  " * indent + "ğŸ”½ ... (×”×¢×•××§ ×”×’×™×¢ ×œ××§×¡×™××•×)")
            return output_lines
    
        try:
            items = sorted(os.listdir(path))
        except Exception as e:
            output_lines.append("  " * indent + f"[×©×’×™××” ×‘×’×™×©×”]: {e}")
            return output_lines
    
        for item in items:
            full_path = os.path.join(path, item)
    
            # ×©×œ×‘ 1: ×‘×¨××” ×”×¨××©×•× ×”, ×œ× ×œ×¡×¨×•×§ ×©×•× ×“×‘×¨ ×—×•×¥ ×-client/server
            if indent == 0 and item not in ALLOWED_ROOT_DIRS:
                continue
    
            # ×©×œ×‘ 2: ×“×™×œ×•×’ ×¢×œ ×ª×™×§×™×•×ª ××¡×•×¨×•×ª
            if os.path.isdir(full_path) and item in SKIP_DIRS:
                output_lines.append("  " * indent + f"ğŸš« {item}/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)")
                continue
    
            # ×©×œ×‘ 3: ×“×™×œ×•×’ ×¢×œ ×§×‘×¦×™× ××¡×•×¨×™×
            if not os.path.isdir(full_path) and item in SKIP_FILES:
                output_lines.append("  " * indent + f"ğŸš« {item} (× ×¤×¡×œ ×œ×¡×¨×™×§×”)")
                continue
    
            # ×ª×™×§×™×™×” ×¨×’×™×œ×”
            if os.path.isdir(full_path):
                output_lines.append("  " * indent + f"ğŸ“ {item}/")
                scan_directory(full_path, indent + 1, output_lines, current_depth + 1, print_content)
    
            # ×§×•×‘×¥
            else:
                ext = os.path.splitext(item)[1].lower()
    
                if ext not in PRINT_CONTENT_EXTENSIONS:
                    continue
    
                output_lines.append("  " * indent + f"ğŸ“„ {item}")
    
                if print_content:
                    try:
                        with open(full_path, "r", encoding="utf-8", errors="ignore") as f:
                            for line in f:
                                output_lines.append("  " * (indent + 1) + line.rstrip())
                    except Exception as e:
                        output_lines.append("  " * (indent + 1) + f"[×©×’×™××” ×‘×§×¨×™××”: {e}]")
    
        return output_lines
    
    
    def ask_include_content():
        root = tk.Tk()
        root.withdraw()
        result = messagebox.askyesno(
            "×”×× ×œ×›×œ×•×œ ×ª×•×›×Ÿ ×§×‘×¦×™×?",
            "×œ×›×œ×•×œ ××ª ×ª×•×›×Ÿ ×§×‘×¦×™ ×”×§×•×“ (×•×œ× ×¨×§ ××ª ×©××•×ª×™×”×)?"
        )
        root.destroy()
        return result
    
    
    def main():
        root = tk.Tk()
        root.withdraw()
    
        folder_path = filedialog.askdirectory(title="×‘×—×¨ ×ª×§×™×™×” ×œ×¡×¨×™×§×”")
    
        if not folder_path:
            print("âŒ ×œ× × ×‘×—×¨×” ×ª×§×™×™×”.")
            return
    
        include_content = ask_include_content()
        print(f"\nğŸ“‚ ×¡×•×¨×§ ××ª: {folder_path}")
    
        structure_lines = scan_directory(folder_path, print_content=include_content)
    
        print("\nğŸ“‹ ×”×¡×¨×™×§×” ×”×¡×ª×™×™××”. ×©×•××¨ ×œ×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”...")
    
        desktop_path = os.path.join(os.path.expanduser("~"), "Desktop")
        output_file = os.path.join(desktop_path, "directory_structure.txt")
    
        try:
            with open(output_file, "w", encoding="utf-8") as f:
                f.write("\n".join(structure_lines))
    
            print(f"\nâœ… × ×©××¨ ×‘×”×¦×œ×—×”:\n{output_file}")
            messagebox.showinfo("×”×¦×œ×—×”", f"×”×§×•×‘×¥ × ×©××¨ ×¢×œ ×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”:\n\n{output_file}")
    
        except Exception as e:
            print(f"\nâŒ ×©×’×™××” ×‘×©××™×¨×”: {e}")
            messagebox.showerror("×©×’×™××”", f"×œ× ×”×¦×œ×—×ª×™ ×œ×©××•×¨ ××ª ×”×§×•×‘×¥:\n{e}")
    
    
    if __name__ == "__main__":
        main()
  ğŸ“„ to_copy.py
    import os
    import shutil
    import tkinter as tk
    from tkinter import filedialog, messagebox
    
    # --- ×”×’×“×¨×•×ª ×’×œ×•×‘×œ×™×•×ª ---
    
    # ×¢×•××§ ××§×¡×™××œ×™ (×œ×¡×¨×™×§×ª ×”×˜×§×¡×˜ ×‘×œ×‘×“)
    MAX_DEPTH = 7
    
    # ×ª×™×§×™×•×ª ×©×™×© ×œ×“×œ×’ ×¢×œ×™×”×Ÿ (×’× ×‘×”×¢×ª×§×” ×•×’× ×‘×¡×¨×™×§×”)
    SKIP_DIRS = {"node_modules", ".git", "__pycache__", "package-lock.json", ".venv"}
    
    # ×§×‘×¦×™× ×©×™×© ×œ×“×œ×’ ×¢×œ×™×”× (×’× ×‘×”×¢×ª×§×” ×•×’× ×‘×¡×¨×™×§×”)
    SKIP_FILES = {
        "index-DEKCV7q4.js",
    }
    
    # ×¡×™×•××•×ª ×©××•×ª×¨ ×œ×”×¦×™×’ (×¨×§ ×‘×¡×¨×™×§×ª ×”×˜×§×¡×˜)
    PRINT_CONTENT_EXTENSIONS = {".js", ".ts", ".html", ".css", ".jsx", ".md"}
    
    
    # --- ×¤×•× ×§×¦×™×” 1: ×”×¢×ª×§×” ××¡×•× × ×ª ---
    
    def copy_filtered_directory(src_path, dest_path, indent=0, stats=None):
        """
        ××¢×ª×™×§ ×ª×™×§×™×™×” ×©×œ××”, ×ª×•×š ×“×™×œ×•×’ ×¢×œ ×ª×™×§×™×•×ª ×•×§×‘×¦×™× ×‘×¨×©×™××•×ª ×”-SKIP.
        """
        if stats is None:
            stats = {'copied': 0, 'skipped': 0, 'errors': 0}
    
        try:
            if not os.path.exists(dest_path):
                os.makedirs(dest_path, exist_ok=True)
    
            items = sorted(os.listdir(src_path))
        except Exception as e:
            print("  " * indent + f"[×©×’×™××” ×‘×’×™×©×” ×œ-{src_path}]: {e}")
            stats['errors'] += 1
            return stats
    
        for item in items:
            full_src_path = os.path.join(src_path, item)
            full_dest_path = os.path.join(dest_path, item)
    
            # ×‘×“×™×§×” ×× ×–×• ×ª×™×§×™×™×”
            if os.path.isdir(full_src_path):
                # ×©×œ×‘ 1: ×“×™×œ×•×’ ×¢×œ ×ª×™×§×™×•×ª ××¡×•×¨×•×ª
                if item in SKIP_DIRS:
                    print("  " * indent + f"ğŸš« {item}/ (××“×œ×’ ×‘×”×¢×ª×§×”)")
                    stats['skipped'] += 1
                    continue
    
                # ×ª×™×§×™×™×” ××•×ª×¨×ª - ×”××©×š ×¨×§×•×¨×¡×™×‘×™
                copy_filtered_directory(full_src_path, full_dest_path, indent + 1, stats)
    
            # ×–×” ×§×•×‘×¥
            else:
                # ×©×œ×‘ 2: ×“×™×œ×•×’ ×¢×œ ×§×‘×¦×™× ××¡×•×¨×™×
                if item in SKIP_FILES:
                    print("  " * indent + f"ğŸš« {item} (××“×œ×’ ×‘×”×¢×ª×§×”)")
                    stats['skipped'] += 1
                    continue
    
                # ×§×•×‘×¥ ××•×ª×¨ - ×”×¢×ª×§ ××•×ª×•
                try:
                    # ×™×¦×™×¨×ª ×ª×™×§×™×™×ª ××‘ ×× ×¦×¨×™×š
                    os.makedirs(os.path.dirname(full_dest_path), exist_ok=True)
                    shutil.copy2(full_src_path, full_dest_path)
                    stats['copied'] += 1
                except Exception as e:
                    print("  " * indent + f"âŒ ×©×’×™××” ×‘×”×¢×ª×§×ª {item}: {e}")
                    stats['errors'] += 1
    
        return stats
    
    # --- ×¤×•× ×§×¦×™×” 2: ×¡×¨×™×§×ª ××‘× ×” (××”×¡×§×¨×™×¤×˜ ×”××§×•×¨×™ ×©×œ×š) ---
    
    def scan_directory(path, indent=0, output_lines=None, current_depth=0, print_content=False):
        """
        ×¡×•×¨×§ ××ª ××‘× ×” ×”×ª×™×§×™×™×” ×•×™×•×¦×¨ ×¨×©×™××ª ×˜×§×¡×˜.
        """
        if output_lines is None:
            output_lines = []
    
        if current_depth > MAX_DEPTH:
            output_lines.append("  " * indent + "ğŸ”½ ... (×”×¢×•××§ ×”×’×™×¢ ×œ××§×¡×™××•×)")
            return output_lines
    
        try:
            items = sorted(os.listdir(path))
        except Exception as e:
            output_lines.append("  " * indent + f"[×©×’×™××” ×‘×’×™×©×”]: {e}")
            return output_lines
    
        for item in items:
            full_path = os.path.join(path, item)
    
            # ×©×œ×‘ 1: ×“×™×œ×•×’ ×¢×œ ×ª×™×§×™×•×ª ××¡×•×¨×•×ª
            if os.path.isdir(full_path) and item in SKIP_DIRS:
                output_lines.append("  " * indent + f"ğŸš« {item}/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)")
                continue
    
            # ×©×œ×‘ 2: ×“×™×œ×•×’ ×¢×œ ×§×‘×¦×™× ××¡×•×¨×™×
            if not os.path.isdir(full_path) and item in SKIP_FILES:
                output_lines.append("  " * indent + f"ğŸš« {item} (× ×¤×¡×œ ×œ×¡×¨×™×§×”)")
                continue
    
            # ×ª×™×§×™×™×” ×¨×’×™×œ×”
            if os.path.isdir(full_path):
                output_lines.append("  " * indent + f"ğŸ“ {item}/")
                scan_directory(full_path, indent + 1, output_lines, current_depth + 1, print_content)
    
            # ×§×•×‘×¥
            else:
                ext = os.path.splitext(item)[1].lower()
                if ext not in PRINT_CONTENT_EXTENSIONS:
                    continue  # ××“×œ×’ ×¢×œ ×§×‘×¦×™× ×œ× ×¨×œ×•×•× ×˜×™×™× (×›××• ×ª××•× ×•×ª) ×‘×¡×¨×™×§×”
    
                output_lines.append("  " * indent + f"ğŸ“„ {item}")
    
                if print_content:
                    try:
                        with open(full_path, "r", encoding="utf-8", errors="ignore") as f:
                            for line in f:
                                output_lines.append("  " * (indent + 1) + line.rstrip())
                    except Exception as e:
                        output_lines.append("  " * (indent + 1) + f"[×©×’×™××” ×‘×§×¨×™××”: {e}]")
    
        return output_lines
    
    
    # --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ (××”×¡×§×¨×™×¤×˜ ×”××§×•×¨×™) ---
    
    def ask_include_content():
        root = tk.Tk()
        root.withdraw()
        result = messagebox.askyesno(
            "×©×œ×‘ 2: ×”×× ×œ×›×œ×•×œ ×ª×•×›×Ÿ ×§×‘×¦×™×?",
            "×”×”×¢×ª×§×” ×”×¡×ª×™×™××”.\n×›×¢×ª × ×¡×¨×•×§ ××ª ×”×ª×™×§×™×™×” ×”×—×“×©×”.\n\n×”×× ×œ×›×œ×•×œ ××ª ×ª×•×›×Ÿ ×§×‘×¦×™ ×”×§×•×“ (×•×œ× ×¨×§ ××ª ×©××•×ª×™×”×)?"
        )
        root.destroy()
        return result
    
    
    # --- ×¤×•× ×§×¦×™×” ×¨××©×™×ª (Main) ---
    
    def main():
        root = tk.Tk()
        root.withdraw()
    
        # --- ×—×œ×§ 1: ×‘×—×™×¨×ª ×ª×™×§×™×•×ª ---
        source_path = filedialog.askdirectory(title="×©×œ×‘ 1: ×‘×—×¨ ×ª×™×§×™×™×ª ××§×•×¨ (×××™×¤×” ×œ×”×¢×ª×™×§)")
        if not source_path:
            print("âŒ ×‘×•×˜×œ - ×œ× × ×‘×—×¨×” ×ª×™×§×™×™×ª ××§×•×¨.")
            return
    
        dest_path = filedialog.askdirectory(title="×©×œ×‘ 1: ×‘×—×¨ ×ª×™×§×™×™×ª ×™×¢×“ (×œ××Ÿ ×œ×”×¢×ª×™×§)")
        if not dest_path:
            print("âŒ ×‘×•×˜×œ - ×œ× × ×‘×—×¨×” ×ª×™×§×™×™×ª ×™×¢×“.")
            return
    
        if os.path.normpath(source_path) == os.path.normpath(dest_path):
            messagebox.showerror("×©×’×™××”", "×ª×™×§×™×™×ª ×”××§×•×¨ ×•×ª×™×§×™×™×ª ×”×™×¢×“ ×œ× ×™×›×•×œ×•×ª ×œ×”×™×•×ª ×–×”×•×ª.")
            return
    
        # --- ×—×œ×§ 2: ×‘×™×¦×•×¢ ×”×”×¢×ª×§×” ---
        print(f"\n--- ×©×œ×‘ 1: ××ª×—×™×œ ×”×¢×ª×§×” ××¡×•× × ×ª ---")
        print(f"   ××§×•×¨: {source_path}")
        print(f"   ×™×¢×“:  {dest_path}\n")
    
        copy_stats = copy_filtered_directory(source_path, dest_path)
    
        print(f"\n--- ×¡×™×•× ×©×œ×‘ 1: ×”×”×¢×ª×§×” ×”×•×©×œ××” ---")
        print(f"   ×§×‘×¦×™× ×©×”×•×¢×ª×§×•: {copy_stats['copied']}")
        print(f"   ×¤×¨×™×˜×™× ×©×“×•×œ×’×•: {copy_stats['skipped']}")
        print(f"   ×©×’×™××•×ª: {copy_stats['errors']}")
    
        # --- ×—×œ×§ 3: ×‘×™×¦×•×¢ ×”×¡×¨×™×§×” ---
        print(f"\n--- ×©×œ×‘ 2: ××ª×—×™×œ ×¡×¨×™×§×ª ××‘× ×” ---")
        print(f"   ×¡×•×¨×§ ××ª ×ª×™×§×™×™×ª ×”×™×¢×“: {dest_path}")
    
        include_content = ask_include_content()
        structure_lines = scan_directory(dest_path, print_content=include_content)
    
        print("--- ×¡×™×•× ×©×œ×‘ 2: ×”×¡×¨×™×§×” ×”×•×©×œ××”. ×©×•××¨ ×§×•×‘×¥ ×¡×™×›×•×... ---")
    
        # --- ×—×œ×§ 4: ×©××™×¨×ª ×§×•×‘×¥ ×”×¡×™×›×•× ---
        try:
            # ×—×™×©×•×‘ ×©× ×•× ×ª×™×‘ ×”×§×•×‘×¥ ×œ×¤×™ ×”×“×¨×™×©×” ×©×œ×š
            dest_folder_name = os.path.basename(os.path.normpath(dest_path))
            parent_dir = os.path.dirname(os.path.normpath(dest_path))
            output_file_name = f"{dest_folder_name}.txt"
            output_file_path = os.path.join(parent_dir, output_file_name)
    
            with open(output_file_path, "w", encoding="utf-8") as f:
                f.write("\n".join(structure_lines))
    
            success_msg = (
                f"âœ… ×”×ª×”×œ×™×š ×”××©×•×œ×‘ ×”×¦×œ×™×—!\n\n"
                f"1. ×”×ª×™×§×™×™×” ×”×•×¢×ª×§×” (×œ×œ× ×§×‘×¦×™ ×–×‘×œ) ××œ:\n{dest_path}\n\n"
                f"2. ×§×•×‘×¥ ×¡×™×›×•× ×”××‘× ×” × ×©××¨ ×œ×™×“×”:\n{output_file_path}"
            )
            print(f"\n{success_msg}")
            messagebox.showinfo("×”×¦×œ×—×”", success_msg)
    
        except Exception as e:
            error_msg = f"âŒ ×©×’×™××” ×‘×©××™×¨×ª ×§×•×‘×¥ ×”×¡×™×›×•×: {e}"
            print(f"\n{error_msg}")
            messagebox.showerror("×©×’×™××”", error_msg)
    
    
    if __name__ == "__main__":
        main()
ğŸ“„ render.yaml
ğŸ“„ rubiks.html
  <!doctype html>
  <html lang="he" dir="rtl">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>×§×•×‘×™×™×ª ×¨×•×‘×™×§ â€“ HTML/JS × ×§×™ ×•×¢×•×‘×“</title>
  <style>
    html,body { height:100%; margin:0; background:#0b0f16; color:#fff; font-family:Arial }
    #app { position:fixed; inset:0 }
    canvas { width:100%; height:100%; display:block }
  </style>
  </head>
  <body>
  <div id="app"></div>
  
  <script type="module">
  import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
  import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";
  
  const app = document.getElementById('app');
  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  app.appendChild(renderer.domElement);
  
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0b0f16);
  
  const camera = new THREE.PerspectiveCamera(50, innerWidth/innerHeight, 0.1, 100);
  camera.position.set(6, 4.2, 7);
  scene.add(camera);
  
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; controls.dampingFactor = .06;
  controls.minDistance = 3.5; controls.maxDistance = 16;
  
  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const dir = new THREE.DirectionalLight(0xffffff, 0.75);
  dir.position.set(6,7,6);
  scene.add(dir);
  
  const FACE = { U:0xf2f2f2, R:0xe31b1b, F:0x1eb34a, D:0xfff066, L:0xff8b2a, B:0x1f55f2, K:0x0f1219 };
  const cubeGroup = new THREE.Group(); scene.add(cubeGroup);
  const cubelets = [];
  const gap = 0.04, cubie = 0.96, step = cubie + gap;
  const geo = new THREE.BoxGeometry(cubie, cubie, cubie);
  
  function mat(c){ return new THREE.MeshPhongMaterial({ color:c }); }
  function matsFor(x,y,z) {
    const m = new Array(6).fill(mat(FACE.K));
    if (x=== 1) m[0] = mat(FACE.R);
    if (x===-1) m[1] = mat(FACE.L);
    if (y=== 1) m[2] = mat(FACE.U);
    if (y===-1) m[3] = mat(FACE.D);
    if (z=== 1) m[4] = mat(FACE.F);
    if (z===-1) m[5] = mat(FACE.B);
    return m;
  }
  
  for (let xi=-1; xi<=1; xi++){
    for (let yi=-1; yi<=1; yi++){
      for (let zi=-1; zi<=1; zi++){
        const mesh = new THREE.Mesh(geo, matsFor(xi,yi,zi));
        mesh.userData.coord = new THREE.Vector3(xi, yi, zi);
        mesh.position.set(xi*step, yi*step, zi*step);
        cubeGroup.add(mesh);
        cubelets.push(mesh);
      }
    }
  }
  
  function easeInOut(t) { return t<.5 ? 2*t*t : 1 - Math.pow(-2*t+2,2)/2; }
  function tweenRotation(group, axis, angle, ms){
    return new Promise(resolve=>{
      const start = performance.now();
      const startQ = group.quaternion.clone();
      const targetQ = startQ.clone().multiply(new THREE.Quaternion().setFromAxisAngle(axis, angle));
      function tick(t){
        const dt=(t-start)/ms, p = dt>=1? 1 : easeInOut(dt);
        group.quaternion.slerpQuaternions(startQ, targetQ, p); // â† ×›××Ÿ ×”×ª×™×§×•×Ÿ
        if(dt<1) requestAnimationFrame(tick); else resolve();
      }
      requestAnimationFrame(tick);
    });
  }
  
  // ×“×•×’××”: ×¡×™×‘×•×‘ ××•×˜×•××˜×™ ×›×œ 2 ×©× ×™×•×ª
  (async function autoSpin(){
    while(true){
      await tweenRotation(cubeGroup, new THREE.Vector3(0,1,0), Math.PI/2, 500);
      await new Promise(r=>setTimeout(r, 1500));
    }
  })();
  
  window.addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });
  
  (function animate(){
    controls.update();
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  })();
  </script>
  </body>
  </html>
ğŸ“ server/
  ğŸ“„ .env
  ğŸ“„ .env.example
  ğŸ“„ app.js
    import dotenv from 'dotenv';
    dotenv.config();
    import express from 'express';
    import cors from 'cors';
    import helmet from 'helmet';
    import cookieParser from 'cookie-parser';
    import mongoSanitize from 'express-mongo-sanitize';
    import mongoose from 'mongoose';
    import csurf from 'csurf';
    
    import path from 'path';
    import { fileURLToPath } from 'url';
    
    // --- ×™×™×‘×•× × ×ª×™×‘×™× ---
    import authRoutes from './routes/auth.js';
    import priceListRoutes from './routes/priceListRoutes.js';
    import orderRoutes from './routes/orderRoutes.js';
    import adminOrderRoutes from './routes/adminOrders.js';
    import adminUserRoutes from './routes/adminUsers.js';
    import adminProductRoutes from './routes/adminProducts.js';
    import adminHotelRoutes from './routes/adminHotels.js';
    import webhookRoutes from './routes/webhookRoutes.js';
    import leadRoutes from './routes/leadRoutes.js';
    import adminDashboardRoutes from './routes/adminDashboard.js';
    import adminRoomTypeRoutes from './routes/adminRoomTypes.js';
    import announcementRoutes from './routes/announcementRoutes.js';
    import adminExtraTypesRoutes from './routes/adminExtraTypes.js';
    import uploadRoutes from './routes/uploadRoutes.js';
    import referrerRoutes from './routes/referrerRoutes.js';
    import roomRoutes from './routes/roomRoutes.js';
    import pushRoutes from './routes/pushRoutes.js'; // âœ¨ ×™×™×‘×•× ×”×—×“×©
    
    try {
      await mongoose.connect(process.env.MONGO_URI);
      console.log('âœ” Mongo connected');
    } catch (err) {
      console.error('Mongo connection error:', err);
      process.exit(1);
    }
    
    const app = express();
    
    const __filename = fileURLToPath(import.meta.url);
    const __dirname = path.dirname(__filename);
    
    app.use(helmet({ crossOriginResourcePolicy: false }));
    const allowedOrigins = [
      process.env.CLIENT_URL,
      'http://localhost:5173',
      'https://localhost:5173',
      "https://zipori-client.onrender.com"
    ];
    
    const filteredOrigins = allowedOrigins.filter(Boolean);
    
    app.use(cors({
      origin: filteredOrigins,
      credentials: true
    }));
    
    app.use(express.json());
    app.use(cookieParser());
    app.use(mongoSanitize());
    
    const uploadsPath = path.join(__dirname, 'uploads');
    app.use('/uploads', express.static(uploadsPath));
    
    const csrfProtection = csurf({
      cookie: {
        httpOnly: true,
        secure: true,
        sameSite: 'None'
      },
    });
    
    app.use('/api/auth', authRoutes);
    app.use('/api/webhooks', webhookRoutes);
    
    app.get('/api/csrf-token', csrfProtection, (req, res) => {
      const token = req.csrfToken();
      res.cookie('XSRF-TOKEN', token, {
        httpOnly: false,
        sameSite: 'None',
        secure: true
      });
      res.json({ csrfToken: token });
    });
    
    app.use('/api', (req, res, next) => {
      if (
        req.path.startsWith('/auth') ||
        req.path.startsWith('/webhooks') ||
        req.path === '/csrf-token'
      ) {
        return next();
      }
      csrfProtection(req, res, next);
    });
    
    // --- ×—×™×‘×•×¨ × ×ª×™×‘×™ API ---
    app.use('/api/pricelists', priceListRoutes);
    app.use('/api/orders', orderRoutes);
    app.use('/api/admin/orders', adminOrderRoutes);
    app.use('/api/admin/users', adminUserRoutes);
    app.use('/api/admin/products', adminProductRoutes);
    app.use('/api/admin/hotels', adminHotelRoutes);
    app.use('/api/leads', leadRoutes);
    app.use('/api/admin/dashboard', adminDashboardRoutes);
    app.use('/api/admin/room-types', adminRoomTypeRoutes);
    app.use('/api/announcements', announcementRoutes);
    app.use('/api/upload', uploadRoutes);
    app.use('/api/admin/extras', adminExtraTypesRoutes);
    app.use('/api/rooms', roomRoutes);
    app.use('/api/referrers', referrerRoutes);
    app.use('/api/push', pushRoutes); // âœ¨ ×”×¤×¢×œ×ª ×”× ×ª×™×‘ ×”×—×“×©
    
    const clientBuildPath = path.join(__dirname, '..', 'client', 'dist');
    app.use(express.static(clientBuildPath));
    
    app.use('*', (req, res) => {
      if (req.path.startsWith('/api/')) {
        return res.status(404).json({ message: 'API route not found.' });
      }
    
      const indexHtmlPath = path.resolve(clientBuildPath, 'index.html');
    
      res.sendFile(indexHtmlPath, (err) => {
        if (err) {
          res.status(500).send(`Error serving index.html: ${err.message}.`);
        }
      });
    });
    
    const PORT = process.env.PORT || 4000;
    app.listen(PORT, () => console.log(`âœ” Server is booming on port ${PORT}`));
    
    export default app;
  ğŸ“ config/
    ğŸ“„ db.js
      import mongoose from 'mongoose';
      
      const connectDB = async () => {
        try {
          const conn = await mongoose.connect(process.env.MONGO_URI);
          console.log(`âœ” MongoDB Connected: ${conn.connection.host}`);
        } catch (error) {
          console.error(`âŒ MongoDB Connection Error: ${error.message}`);
          process.exit(1);
        }
      };
      
      export default connectDB;
    ğŸ“„ middlewares.js
      import express from 'express';
      import cors from 'cors';
      import cookieParser from 'cookie-parser';
      import morgan from 'morgan';
      import helmet from 'helmet';
      import { publicLimiter } from '../middlewares/rateLimiter.js';
      
      export const configureMiddlewares = (app) => {
        app.use(helmet());
        app.use(cors({
          origin: process.env.CLIENT_URL,
          credentials: true,
        }));
        app.use(express.json({ limit: '10kb' }));
        app.use(express.urlencoded({ extended: true }));
        app.use(cookieParser());
      
        if (process.env.NODE_ENV === 'development') {
          app.use(morgan('dev'));
        }
      
        app.use(publicLimiter);
      };
    ğŸ“„ routes.js
      import csurf              from 'csurf';
      import authRoutes         from '../routes/auth.js';
      import tzitzitRoutes      from '../routes/tzitzitRoutes.js';
      
      /* ×—×“×© */
      import projectRoutes      from '../routes/projectRoutes.js';
      
      import { requireAuth }    from '../middlewares/authMiddleware.js';
      
      export const configureRoutes = (app) => {
        /* ---------- ××¡×œ×•×œ×™× ×¦×™×‘×•×¨×™×™× ---------- */
        app.use('/api/auth', authRoutes);
      
        /* ---------- ×”×’× ×ª CSRF ---------- */
        const csrfProtection = csurf({
          cookie: {
            httpOnly : true,
            secure   : process.env.NODE_ENV === 'production',
            sameSite : 'strict',
          },
        });
      
        // × ×§×•×“×ª ×§×‘×œ×ª ×˜×•×§×Ÿ
        app.get('/api/csrf-token', csrfProtection, (req, res) => {
          res.json({ csrfToken: req.csrfToken() });
        });
      
        // ×œ×”×—×™×œ CSRF ×¢×œ ×›×œ ××” ×©××ª×—×ª
        app.use(csrfProtection);
      
        /* ---------- ××¡×œ×•×œ×™× ××•×’× ×™× ---------- */
        app.use('/api/tzitzit',  requireAuth, tzitzitRoutes);
      
        /* ---------- ××¡×œ×•×œ ××•×’×Ÿ ×—×“×©: ×¤×¨×•×™×§×˜×™× ×›×¡×¤×™×™× ---------- */
        app.use('/api/projects', requireAuth, projectRoutes);
      };
  ğŸ“ controllers/
    ğŸ“„ accountController.js
      // server/controllers/transactionController.js
      import Transaction from '../models/Transaction.js';
      import Account     from '../models/Account.js';
      
      /** â˜‘ï¸ ×¢×–×¨ ×¤× ×™××™ ×œ×¢×“×›×•×Ÿ ×™×ª×¨×” */
      async function adjustBalance(accountId, diff) {
        await Account.findByIdAndUpdate(accountId, { $inc: { balance: diff } });
      }
      
      /** GET /api/transactions?from=yyyy-mm-dd&to=yyyy-mm-dd&category=... */
      export async function getAll(req, res) {
        const { from, to, category } = req.query;
        const filter = { userId: req.user._id };
        if (from && to)  filter.date = { $gte: new Date(from), $lte: new Date(to) };
        if (category && category !== '×›×œ ×”×§×˜×’×•×¨×™×•×ª') filter.category = category;
        const data = await Transaction.find(filter).sort({ date: -1 });
        res.json(data);
      }
      
      /** POST /api/transactions */
      export async function create(req, res) {
        const { date, type, category, amount, description, accountId } = req.body;
        if (!date || !amount)
          return res.status(400).json({ msg: '×ª××¨×™×š ×•×¡×›×•× ×—×•×‘×”' });
      
        const doc = await Transaction.create({
          userId: req.user._id,
          date,
          type,
          category,
          amount,
          description,
          account: accountId,
        });
      
        await adjustBalance(
          accountId,
          type === '×”×›× ×¡×”' ? amount : -amount
        );
      
        res.status(201).json(doc);
      }
      
      /** PUT /api/transactions/:id */
      export async function update(req, res) {
        const { id } = req.params;
        const trx = await Transaction.findOne({ _id: id, userId: req.user._id });
        if (!trx) return res.status(404).json({ msg: '×œ× × ××¦×' });
      
        // ×”×—×–×¨ ××ª ×”×™×ª×¨×” ×”×™×©× ×”
        await adjustBalance(
          trx.account,
          trx.type === '×”×›× ×¡×”' ? -trx.amount : trx.amount
        );
      
        // ×¢×“×›×•×Ÿ ×©×“×•×ª ××•×ª×¨×™×
        Object.assign(trx, req.body);
        await trx.save();
      
        // ×¢×“×›×Ÿ ×™×ª×¨×” ×—×“×©×”
        await adjustBalance(
          trx.account,
          trx.type === '×”×›× ×¡×”' ? trx.amount : -trx.amount
        );
      
        res.json(trx);
      }
      
      /** DELETE /api/transactions/:id */
      export async function remove(req, res) {
        const { id } = req.params;
        const trx = await Transaction.findOneAndDelete({
          _id: id,
          userId: req.user._id,
        });
        if (!trx) return res.status(404).json({ msg: '×œ× × ××¦×' });
      
        await adjustBalance(
          trx.account,
          trx.type === '×”×›× ×¡×”' ? -trx.amount : trx.amount
        );
      
        res.json({ ok: true });
      }
      export default { getAll, create, update, remove };
    ğŸ“ admin/
      ğŸ“„ dashboardController.js
        // server/controllers/admin/dashboardController.js
        import { catchAsync } from '../../middlewares/errorHandler.js';
        import Order from '../../models/Order.js';
        import User from '../../models/userModel.js';
        import InboundEmail from '../../models/InboundEmail.js';
        
        export const getDashboardStats = catchAsync(async (req, res, next) => {
          const thirtyDaysAgo = new Date();
          thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        
          const [
            orderStats,
            totalUsers,
            totalLeads,
            leadsPerDay,
            salesByPerson,    // âœ¨ ×—×“×©
            rejectionReasons, // âœ¨ ×—×“×©
            leadConversion    // âœ¨ ×—×“×©
          ] = await Promise.all([
            // 1. ×¡×™×›×•× ×”×–×× ×•×ª ×›×œ×œ×™
            Order.aggregate([
              {
                $group: {
                  _id: null,
                  totalSales: { $sum: "$total_price" },
                  totalOrders: { $sum: 1 }
                }
              }
            ]),
        
            // 2. ×¡×š ××©×ª××©×™×
            User.countDocuments(),
        
            // 3. ×¡×š ×œ×™×“×™× ×”×—×•×“×©
            InboundEmail.countDocuments({ receivedAt: { $gte: thirtyDaysAgo } }),
        
            // 4. ×’×¨×£ ×œ×™×“×™× ×™×•××™
            InboundEmail.aggregate([
              { $match: { receivedAt: { $gte: thirtyDaysAgo } } },
              { $group: { _id: { $dateToString: { format: "%Y-%m-%d", date: "$receivedAt" } }, count: { $sum: 1 } } },
              { $sort: { _id: 1 } }
            ]),
        
            // 5. ×‘×™×¦×•×¢×™ ×× ×©×™ ××›×™×¨×•×ª
            Order.aggregate([
                {
                    $match: {
                        status: { $in: ['×‘×•×¦×¢', 'placed', 'converted'] },
                        createdAt: { $gte: thirtyDaysAgo }
                    }
                },
                { $group: { _id: "$salespersonName", dealsCount: { $sum: 1 }, totalRevenue: { $sum: "$total_price" } } },
                { $sort: { totalRevenue: -1 } }
            ]),
        
            // 6. ×¤×™×œ×•×— ×¡×™×‘×•×ª "×œ× ×¨×œ×•×•× ×˜×™" (×”×–×× ×•×ª)
            Order.aggregate([
                { $match: { status: { $in: ['×œ× ×¨×œ×•×•× ×˜×™', 'not_relevant'] }, createdAt: { $gte: thirtyDaysAgo } } },
                { $group: { _id: "$rejectionReason", count: { $sum: 1 } } },
                { $sort: { count: -1 } }
            ]),
        
            // 7. ×¡×˜×˜×•×¡ ×œ×™×“×™×
            InboundEmail.aggregate([
                { $match: { receivedAt: { $gte: thirtyDaysAgo } } },
                { $group: { _id: "$status", count: { $sum: 1 } } }
            ])
          ]);
        
          // ××™×—×•×“ ×¡×™×‘×•×ª ×“×—×™×™×” ×’× ××”×œ×™×“×™×
          const leadRejections = await InboundEmail.aggregate([
              { $match: { status: 'not_relevant', receivedAt: { $gte: thirtyDaysAgo } } },
              { $group: { _id: "$rejectionReason", count: { $sum: 1 } } }
          ]);
        
          const combinedRejections = [...rejectionReasons];
          leadRejections.forEach(lr => {
              const existing = combinedRejections.find(r => r._id === lr._id);
              if (existing) existing.count += lr.count;
              else combinedRejections.push(lr);
          });
        
          res.status(200).json({
            totalSales: orderStats[0]?.totalSales || 0,
            totalOrders: orderStats[0]?.totalOrders || 0,
            totalUsers,
            totalLeads,
            leadsPerDay,
            salesByPerson,
            rejectionReasons: combinedRejections,
            leadStats: leadConversion
          });
        });
      ğŸ“„ extraTypeController.js
        import ExtraType from '../../models/ExtraType.js';
        import { catchAsync } from '../../middlewares/errorHandler.js';
        
        export const getExtraTypes = catchAsync(async (req, res) => {
            const types = await ExtraType.find({}).sort({ name: 1 });
            res.json(types);
        });
        
        export const createExtraType = catchAsync(async (req, res) => {
            const { name } = req.body;
            const newType = await ExtraType.create({ name });
            res.status(201).json(newType);
        });
        
        export const deleteExtraType = catchAsync(async (req, res) => {
            await ExtraType.findByIdAndDelete(req.params.id);
            res.status(204).send();
        });
      ğŸ“„ hotelAdminController.js
        import Hotel from '../../models/Hotel.js';
        import PriceList from '../../models/PriceList.js';
        import { catchAsync } from '../../middlewares/errorHandler.js';
        import AppError from '../../utils/AppError.js';
        
        // ×©×œ×™×¤×ª ×›×œ ×”××œ×•× ×•×ª
        export const getAllHotels = catchAsync(async (req, res) => {
            const hotels = await Hotel.find({}).sort({ name: 1 });
            res.status(200).json(hotels);
        });
        
        // ×™×¦×™×¨×ª ××œ×•×Ÿ ×—×“×©
        export const createHotel = catchAsync(async (req, res) => {
            const { name } = req.body;
            if (!name) throw new AppError('×©× ×”××œ×•×Ÿ ×”×•× ×©×“×” ×—×•×‘×”.', 400);
            const newHotel = await Hotel.create({ name });
            res.status(201).json(newHotel);
        });
        
        // âœ¨ ×¢×“×›×•×Ÿ ×”×ª×‘× ×™×ª ×”×¨××©×™×ª (Master Checklist)
        // ××§×‘×œ ××¢×¨×š ×©×œ ××•×‘×™×™×§×˜×™×: [{ text: '...', order: 1 }, ...]
        export const updateMasterChecklist = catchAsync(async (req, res) => {
            const { id } = req.params;
            const { checklist } = req.body;
        
            const hotel = await Hotel.findByIdAndUpdate(
                id,
                { masterChecklist: checklist },
                { new: true }
            );
        
            if (!hotel) throw new AppError('×”××œ×•×Ÿ ×œ× × ××¦×.', 404);
            res.json(hotel);
        });
        
        // ×¤×•× ×§×¦×™×™×ª Legacy (× ×©××¨×ª ×œ××§×¨×” ×©×¢×“×™×™×Ÿ ×™×© ×§×¨×™××•×ª ×™×©× ×•×ª)
        export const updateHotelTasks = catchAsync(async (req, res) => {
            const { id } = req.params;
            const { tasks } = req.body;
            // ×××™×¨×™× ×¤×•×¨××˜ ×™×©×Ÿ ×œ×—×“×© ×× ×¦×¨×™×š, ××• ×©×•××¨×™× ×‘×©×“×” ×”×™×©×Ÿ
            const hotel = await Hotel.findByIdAndUpdate(id, { defaultTasks: tasks }, { new: true });
            res.json(hotel);
        });
        
        // ××—×™×§×ª ××œ×•×Ÿ
        export const deleteHotel = catchAsync(async (req, res) => {
            const { id } = req.params;
            const priceListsExist = await PriceList.exists({ hotel: id });
            if (priceListsExist) throw new AppError('×œ× × ×™×ª×Ÿ ×œ××—×•×§ ××œ×•×Ÿ ×©××©×•×™×›×™× ××œ×™×• ××—×™×¨×•× ×™×.', 400);
        
            const hotel = await Hotel.findByIdAndDelete(id);
            if (!hotel) throw new AppError('×”××œ×•×Ÿ ×œ× × ××¦×.', 404);
            res.status(204).send();
        });
      ğŸ“„ orderAdminController.js
        // server/controllers/admin/orderAdminController.js
        
        import Order from '../../models/Order.js';
        
        /**
         * @desc    ×§×‘×œ×ª ×›×œ ×”×”×–×× ×•×ª ×‘××¢×¨×›×ª (×œ×× ×”×œ×™×)
         * @route   GET /api/admin/orders
         * @access  Admin
         */
        export const getAllOrders = async (req, res) => {
          try {
            console.log('Fetching all orders from MongoDB...');
            const orders = await Order.find({}).sort({ createdAt: -1 }).populate('user', 'name email').populate('hotel', 'name');
            res.json(orders);
          } catch (error) {
            console.error('Critical Error: Failed to fetch all orders from MongoDB.', error);
            res.status(500).json({ message: "×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×–×× ×•×ª." });
          }
        };
        
        /**
         * @desc    ×¢×“×›×•×Ÿ ×”×–×× ×” ×§×™×™××ª (×œ××©×œ, ×©×™× ×•×™ ×¡×˜×˜×•×¡)
         * @route   PUT /api/admin/orders/:id
         * @access  Admin
         */
        export const updateOrder = async (req, res) => {
          const { id } = req.params;
          const { customerName, customerPhone, status, notes } = req.body;
        
          try {
            const order = await Order.findById(id);
            if (!order) {
              return res.status(404).json({ message: "×”×”×–×× ×” ×œ× × ××¦××”." });
            }
        
            if (customerName) order.customerName = customerName;
            if (customerPhone) order.customerPhone = customerPhone;
            if (status) order.status = status;
            if (notes) order.notes = notes;
        
            const updatedOrder = await order.save();
            res.json(updatedOrder);
          } catch (error) {
            res.status(500).json({ message: "×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×”×–×× ×”." });
          }
        };
        
        /**
         * @desc    ××—×™×§×ª ×”×–×× ×”
         * @route   DELETE /api/admin/orders/:id
         * @access  Admin
         */
        export const deleteOrder = async (req, res) => {
            try {
                const order = await Order.findByIdAndDelete(req.params.id);
                if (!order) {
                    return res.status(404).json({ message: '×”×”×–×× ×” ×œ× × ××¦××”' });
                }
                res.json({ message: '×”×”×–×× ×” × ××—×§×” ×‘×”×¦×œ×—×”' });
            } catch (error) {
                res.status(500).json({ message: '×©×’×™××” ×‘××—×™×§×ª ×”×”×–×× ×”' });
            }
        };
      ğŸ“„ productAdminController.js
        // server/controllers/admin/productAdminController.js
        
        import Product from '../../models/Product.js';
        import { catchAsync } from '../../middlewares/errorHandler.js';
        
        // GET /api/admin/products - ×©×œ×™×¤×ª ×›×œ ×”××•×¦×¨×™× ×-MongoDB
        export const getAllProducts = catchAsync(async (req, res, next) => {
            const products = await Product.find({ isActive: true }).sort({ createdAt: -1 });
            // Add productId for client compatibility if needed
            const productsWithId = products.map(p => ({ ...p.toObject(), productId: p._id }));
            res.status(200).json(productsWithId);
        });
        
        // POST /api/admin/products - ×™×¦×™×¨×ª ××•×¦×¨ ×—×“×© ×‘-MongoDB
        export const createProduct = catchAsync(async (req, res, next) => {
            const newProduct = await Product.create(req.body);
            res.status(201).json({ ...newProduct.toObject(), productId: newProduct._id });
        });
        
        // PUT /api/admin/products/:id - ×¢×“×›×•×Ÿ ××•×¦×¨ ×§×™×™× ×‘-MongoDB
        export const updateProduct = catchAsync(async (req, res, next) => {
            const { id } = req.params;
            const updatedProduct = await Product.findByIdAndUpdate(id, req.body, { new: true, runValidators: true });
        
            if (!updatedProduct) {
                return res.status(404).json({ message: "×”××•×¦×¨ ×œ× × ××¦×." });
            }
        
            res.status(200).json({ ...updatedProduct.toObject(), productId: updatedProduct._id });
        });
        
        // DELETE /api/admin/products/:id - ××—×™×§×ª ××•×¦×¨ (×¡×™××•×Ÿ ×›××•×©×‘×ª) ×‘-MongoDB
        export const deleteProduct = catchAsync(async (req, res, next) => {
            const { id } = req.params;
            const product = await Product.findByIdAndUpdate(id, { isActive: false });
        
            if (!product) {
                return res.status(404).json({ message: "×”××•×¦×¨ ×œ× × ××¦×." });
            }
        
            res.status(204).send(); // No Content
        });
      ğŸ“„ referralController.js
        import InboundEmail from '../../models/InboundEmail.js';
        import ReferralAlias from '../../models/ReferralAlias.js';
        import { catchAsync } from '../../middlewares/errorHandler.js';
        
        // ×“×•×— ×¡×˜×˜×™×¡×˜×™×§×” ×œ××•×©×™×•×ª
        export const getReferralStats = catchAsync(async (req, res) => {
            const { startDate, endDate } = req.query;
        
            // ×˜×•×•×— ×ª××¨×™×›×™× (×‘×¨×™×¨×ª ××—×“×œ: ×›×œ ×”×–××Ÿ, ××• ××” ×©× ×‘×—×¨)
            const matchStage = { referrer: { $ne: null } };
            if (startDate && endDate) {
                matchStage.receivedAt = {
                    $gte: new Date(startDate),
                    $lte: new Date(endDate)
                };
            }
        
            const stats = await InboundEmail.aggregate([
                { $match: matchStage },
                {
                    $group: {
                        _id: "$referrer",
                        totalLeads: { $sum: 1 },
                        convertedLeads: {
                            $sum: { $cond: [{ $in: ["$status", ["converted", "placed", "×‘×•×¦×¢"]] }, 1, 0] }
                        }
                    }
                },
                {
                    $project: {
                        referrerName: "$_id",
                        totalLeads: 1,
                        convertedLeads: 1,
                        conversionRate: {
                            $multiply: [{ $divide: ["$convertedLeads", "$totalLeads"] }, 100]
                        }
                    }
                },
                { $sort: { totalLeads: -1 } }
            ]);
        
            res.json(stats);
        });
        
        // ×¢×“×›×•×Ÿ ×©× ××¤× ×” (Smart Rename)
        export const updateReferralName = catchAsync(async (req, res) => {
            const { oldName, newName } = req.body;
        
            if (!oldName || !newName) {
                return res.status(400).json({ message: '×—×•×‘×” ×œ×¡×¤×§ ×©× ×™×©×Ÿ ×•×©× ×—×“×©' });
            }
        
            // 1. ×¢×“×›×•×Ÿ ×¨×˜×¨×•××§×˜×™×‘×™ ×©×œ ×›×œ ×”×œ×™×“×™× ×”×§×™×™××™×
            await InboundEmail.updateMany(
                { referrer: oldName },
                { referrer: newName }
            );
        
            // 2. ×©××™×¨×ª ×”×›×œ×œ ×œ×¢×ª×™×“ (Alias)
            // ×‘×•×“×§×™× ×× ×›×‘×¨ ×§×™×™× ×—×•×§ ×œ×©× ×”×–×”, ×× ×›×Ÿ ××¢×“×›× ×™×, ×× ×œ× ×™×•×¦×¨×™× ×—×“×©
            await ReferralAlias.findOneAndUpdate(
                { originalName: oldName },
                { targetName: newName },
                { upsert: true, new: true }
            );
        
            res.json({ message: `×”×©× ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×” ×-${oldName} ×œ-${newName} ×‘×›×œ ×”×”×™×¡×˜×•×¨×™×” ×•×œ×¢×ª×™×“.` });
        });
      ğŸ“„ roomTypeController.js
        // server/controllers/admin/roomTypeController.js
        import RoomType from '../../models/RoomType.js';
        import { catchAsync } from '../../middlewares/errorHandler.js';
        import AppError from '../../utils/AppError.js';
        
        // ×§×‘×œ×ª ×›×œ ×¡×•×’×™ ×”×—×“×¨×™× ×©×œ ××œ×•×Ÿ ××¡×•×™×
        export const getRoomTypesByHotel = catchAsync(async (req, res, next) => {
          const { hotelId } = req.params;
        
          // ×©×œ×™×¤×” ××”-DB ×•××™×•×Ÿ ×œ×¤×™ ×”××—×™×¨ (××”×–×•×œ ×œ×™×§×¨)
          const roomTypes = await RoomType.find({ hotel: hotelId }).sort({ supplementPerNight: 1 });
        
          res.status(200).json(roomTypes);
        });
        
        // ×™×¦×™×¨×ª ×¡×•×’ ×—×“×¨ ×—×“×©
        export const createRoomType = catchAsync(async (req, res, next) => {
          const { hotel, name, supplementPerNight, isDefault } = req.body;
        
          if (!hotel || !name) {
            return next(new AppError('××œ×•×Ÿ ×•×©× ×—×“×¨ ×”× ×©×“×•×ª ×—×•×‘×”.', 400));
          }
        
          try {
            // ×× ×¡×•××Ÿ ×›×‘×¨×™×¨×ª ××—×“×œ, × ×¡×™×¨ ××ª ×”×¡×™××•×Ÿ ×××—×¨×™× ×‘××•×ª×• ××œ×•×Ÿ
            if (isDefault) {
              await RoomType.updateMany({ hotel }, { isDefault: false });
            }
        
            const newRoomType = await RoomType.create({
              hotel,
              name,
              supplementPerNight: Number(supplementPerNight) || 0,
              isDefault: !!isDefault
            });
        
            res.status(201).json(newRoomType);
          } catch (error) {
            // ×˜×™×¤×•×œ ×‘×©×’×™××ª ×›×¤×™×œ×•×ª (×©× ×—×“×¨ ×§×™×™× ×‘××•×ª×• ××œ×•×Ÿ)
            if (error.code === 11000) {
              return next(new AppError('×¡×•×’ ×—×“×¨ ×‘×©× ×–×” ×›×‘×¨ ×§×™×™× ×‘××œ×•×Ÿ ×©× ×‘×—×¨.', 400));
            }
            // ×”×¢×‘×¨×ª ×©××¨ ×”×©×’×™××•×ª ×œ×˜×™×¤×•×œ ×”×›×œ×œ×™
            throw error;
          }
        });
        
        // ×¢×“×›×•×Ÿ ×¡×•×’ ×—×“×¨ ×§×™×™×
        export const updateRoomType = catchAsync(async (req, res, next) => {
          const { id } = req.params;
          const { name, supplementPerNight, isDefault, hotel } = req.body;
        
          try {
            // ×× ××¢×“×›× ×™× ×œ-Default, ×¦×¨×™×š ×œ××¤×¡ ××ª ×”××—×¨×™×
            if (isDefault && hotel) {
               await RoomType.updateMany({ hotel }, { isDefault: false });
            }
        
            const updatedRoomType = await RoomType.findByIdAndUpdate(id, {
              name,
              supplementPerNight,
              isDefault
            }, {
              new: true, // ×”×—×–×¨ ××ª ×”××•×‘×™×™×§×˜ ×”××¢×•×“×›×Ÿ
              runValidators: true
            });
        
            if (!updatedRoomType) {
              return next(new AppError('×¡×•×’ ×—×“×¨ ×œ× × ××¦×.', 404));
            }
        
            res.status(200).json(updatedRoomType);
          } catch (error) {
             if (error.code === 11000) {
                return next(new AppError('×¡×•×’ ×—×“×¨ ×‘×©× ×–×” ×›×‘×¨ ×§×™×™× ×‘××œ×•×Ÿ ×©× ×‘×—×¨.', 400));
              }
              throw error;
          }
        });
        
        // ××—×™×§×ª ×¡×•×’ ×—×“×¨
        export const deleteRoomType = catchAsync(async (req, res, next) => {
          const { id } = req.params;
        
          const deleted = await RoomType.findByIdAndDelete(id);
        
          if (!deleted) {
            return next(new AppError('×¡×•×’ ×—×“×¨ ×œ× × ××¦×.', 404));
          }
        
          res.status(204).send();
        });
      ğŸ“„ userAdminController.js
        import User from '../../models/userModel.js';
        import bcrypt from 'bcryptjs';
        
        export const getAllUsers = async (req, res) => {
            try {
                const users = await User.find({}).select('-passwordHash').sort({ name: 1 });
                res.json(users);
            } catch (error) {
                res.status(500).json({ message: '×©×’×™××” ×‘×˜×¢×™× ×ª ×”××©×ª××©×™×' });
            }
        };
        
        export const updateUserPermissions = async (req, res) => {
            // âœ¨ ×”×•×¡×¤× ×• ××ª canViewCommissions
            const { role, canManagePriceLists, canViewCommissions } = req.body;
            try {
                const user = await User.findById(req.params.id);
                if (user) {
                    if (role) user.role = role;
                    if (canManagePriceLists !== undefined) user.canManagePriceLists = canManagePriceLists;
                    if (canViewCommissions !== undefined) user.canViewCommissions = canViewCommissions; // âœ¨ ×¢×“×›×•×Ÿ
        
                    await user.save();
                    res.json({ message: '×”×¨×©××•×ª ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”' });
                } else {
                    res.status(404).json({ message: '××©×ª××© ×œ× × ××¦×' });
                }
            } catch (error) {
                console.error("Update User Error:", error);
                res.status(500).json({ message: '×©×’×™××” ×‘×¢×“×›×•×Ÿ: ' + error.message });
            }
        };
        
        export const createUser = async (req, res) => {
            // âœ¨ ×”×•×¡×¤× ×• ××ª canViewCommissions
            const { name, email, password, role, canManagePriceLists, canViewCommissions } = req.body;
        
            if (!name || !email || !password) {
                return res.status(400).json({ message: '×©×, ××™××™×™×œ ×•×¡×™×¡××” ×”× ×©×“×•×ª ×—×•×‘×”' });
            }
        
            try {
                const userExists = await User.findOne({ email });
                if (userExists) {
                    return res.status(400).json({ message: '××©×ª××© ×¢× ××™××™×™×œ ×–×” ×›×‘×¨ ×§×™×™×' });
                }
        
                const passwordHash = await bcrypt.hash(password, 12);
        
                let finalRole = 'sales';
                if (role && ['admin', 'sales', 'maintenance'].includes(role)) {
                    finalRole = role;
                }
        
                const user = await User.create({
                    name,
                    email,
                    passwordHash,
                    role: finalRole,
                    canManagePriceLists: canManagePriceLists || false,
                    canViewCommissions: canViewCommissions || false, // âœ¨ ×©××™×¨×”
                });
        
                res.status(201).json({
                    _id: user._id,
                    name: user.name,
                    email: user.email,
                    role: user.role,
                });
            } catch (error) {
                console.error("CRITICAL ERROR Creating User:", error);
                res.status(500).json({ message: '×©×’×™××” ×‘×™×¦×™×¨×ª ×”××©×ª××©: ' + error.message });
            }
        };
        
        export const deleteUser = async (req, res) => {
            try {
                const user = await User.findById(req.params.id);
                if (user) {
                    if (user.role === 'admin') {
                        return res.status(400).json({ message: '×œ× × ×™×ª×Ÿ ×œ××—×•×§ ××©×ª××© ×× ×”×œ' });
                    }
                    await User.findByIdAndDelete(req.params.id);
                    res.json({ message: '×”××©×ª××© × ××—×§ ×‘×”×¦×œ×—×”' });
                } else {
                    res.status(404).json({ message: '××©×ª××© ×œ× × ××¦×' });
                }
            } catch (error) {
                res.status(500).json({ message: '×©×’×™××” ×‘××—×™×§×”' });
            }
        };
    ğŸ“„ announcementController.js
      // server/controllers/announcementController.js
      import Announcement from '../models/Announcement.js';
      import { catchAsync } from '../middlewares/errorHandler.js';
      import AppError from '../utils/AppError.js';
      
      /**
       * @desc    ×§×‘×œ×ª ×”×•×“×¢×•×ª ×¦×™×‘×•×¨×™×•×ª ×¨×œ×•×•× ×˜×™×•×ª ×œ××©×ª××© ×”××—×•×‘×¨
       * @route   GET /api/announcements
       * @access  Private (User)
       */
      export const getPublicAnnouncements = catchAsync(async (req, res, next) => {
        const now = new Date();
      
        const announcements = await Announcement.find({
          $and: [
            // ×ª× ××™ 1: ×”×”×•×“×¢×” ××™×•×¢×“×ª ×œ×›×•×œ× ××• ×¡×¤×¦×™×¤×™×ª ×œ××©×ª××© ×”×–×”
            { $or: [
                { target: 'all' },
                { targetUser: req.user._id }
              ]
            },
            // ×ª× ××™ 2: ×”×”×•×“×¢×” ×œ× ×¤×’×” (××• ×©××™×Ÿ ×œ×” ×ª××¨×™×š ×ª×¤×•×’×”)
            { $or: [
                { expiresAt: { $gt: now } },
                { expiresAt: null }
              ]
            }
          ]
        }).sort({ createdAt: -1 }); // ×”×—×“×© ×‘×™×•×ª×¨ ×œ××¢×œ×”
      
        res.status(200).json(announcements);
      });
      
      /**
       * @desc    ×§×‘×œ×ª ×›×œ ×”×”×•×“×¢×•×ª (×œ×××©×§ × ×™×”×•×œ)
       * @route   GET /api/announcements/all
       * @access  Admin
       */
      export const getAllAnnouncements = catchAsync(async (req, res, next) => {
        const announcements = await Announcement.find()
          .populate('targetUser', 'name email')
          .sort({ createdAt: -1 });
      
        res.status(200).json(announcements);
      });
      
      /**
       * @desc    ×™×¦×™×¨×ª ×”×•×“×¢×” ×—×“×©×”
       * @route   POST /api/announcements
       * @access  Admin
       */
      export const createAnnouncement = catchAsync(async (req, res, next) => {
        const { title, content, target, targetUser, expiresAt } = req.body;
      
        if (!title || !content) {
          return next(new AppError('×›×•×ª×¨×ª ×•×ª×•×›×Ÿ ×”× ×©×“×•×ª ×—×•×‘×”.', 400));
        }
      
        const announcement = await Announcement.create({
          title,
          content,
          target,
          // ×× ×”×™×¢×“ ×”×•× ××©×ª××© ×¡×¤×¦×™×¤×™, ×—×•×‘×” ×œ×©××•×¨ ××ª ×”-ID ×©×œ×•
          targetUser: target === 'user' ? targetUser : null,
          expiresAt: expiresAt || null,
          authorName: req.user.name // × ×œ×§×— ××•×˜×•××˜×™×ª ××”××©×ª××© ×”××—×•×‘×¨
        });
      
        res.status(201).json(announcement);
      });
      
      /**
       * @desc    ×¢×“×›×•×Ÿ ×”×•×“×¢×” ×§×™×™××ª
       * @route   PUT /api/announcements/:id
       * @access  Admin
       */
      export const updateAnnouncement = catchAsync(async (req, res, next) => {
          const { id } = req.params;
          const { title, content, target, targetUser, expiresAt } = req.body;
      
          if (!title || !content) {
            return next(new AppError('×›×•×ª×¨×ª ×•×ª×•×›×Ÿ ×”× ×©×“×•×ª ×—×•×‘×”.', 400));
          }
      
          const announcement = await Announcement.findByIdAndUpdate(
            id,
            {
              title,
              content,
              target,
              targetUser: target === 'user' ? targetUser : null,
              expiresAt: expiresAt || null
            },
            { new: true, runValidators: true }
          );
      
          if (!announcement) {
            return next(new AppError('×”×•×“×¢×” ×œ× × ××¦××”.', 404));
          }
      
          res.status(200).json(announcement);
        });
      
      /**
       * @desc    ××—×™×§×ª ×”×•×“×¢×”
       * @route   DELETE /api/announcements/:id
       * @access  Admin
       */
      export const deleteAnnouncement = catchAsync(async (req, res, next) => {
        const { id } = req.params;
        const announcement = await Announcement.findByIdAndDelete(id);
      
        if (!announcement) {
          return next(new AppError('×”×•×“×¢×” ×œ× × ××¦××”.', 404));
        }
      
        res.status(204).send();
      });
    ğŸ“„ authController.js
      import bcrypt from 'bcryptjs';
      import jwt from 'jsonwebtoken';
      import User from '../models/userModel.js';
      import { createAndSendTokens } from '../utils/tokenHandler.js';
      
      export const registerUser = async (req, res) => {
        const { name, email, password, role } = req.body;
      
        if (!name || !email || !password)
          return res.status(400).json({ message: '×©×, ××™××™×™×œ ×•×¡×™×¡××” ×”× ×©×“×•×ª ×—×•×‘×”' });
      
        const exists = await User.findOne({ email });
        if (exists)
          return res.status(400).json({ message: '××©×ª××© ×¢× ××™××™×™×œ ×–×” ×›×‘×¨ ×§×™×™×' });
      
        const strong = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,}$/;
        if (!strong.test(password))
          return res.status(400).json({ message: '×”×¡×™×¡××” ×—×œ×©×” ××“×™. × ×“×¨×©×™× 8 ×ª×•×•×™×, ××•×ª ×’×“×•×œ×”, ×§×˜× ×”, ××¡×¤×¨ ×•×ª×• ××™×•×—×“.' });
      
        const hash = await bcrypt.hash(password, 12);
      
        let finalRole = 'sales';
        const validRoles = ['admin', 'sales', 'maintenance'];
      
        if (role && validRoles.includes(role)) {
          finalRole = role;
        }
      
        const user = await User.create({
          name,
          email,
          passwordHash: hash,
          role: finalRole
        });
      
        // âœ¨ ×©×œ×™×—×ª ×”×”×¨×©××•×ª ×”×—×“×©×•×ª ×œ×§×œ×™×™× ×˜
        const userPayload = {
            _id: user._id,
            name: user.name,
            email: user.email,
            role: user.role,
            canManagePriceLists: user.canManagePriceLists,
            canViewCommissions: user.canViewCommissions
        };
      
        createAndSendTokens(user, res);
        return res.status(201).json({ message: "×”×”×¨×©××” ×”×•×©×œ××” ×‘×”×¦×œ×—×”", user: userPayload });
      };
      
      export const loginUser = async (req, res) => {
        const { email, password } = req.body;
      
        if (!email || !password)
          return res.status(400).json({ message: '×—×¡×¨ ××™××™×™×œ ××• ×¡×™×¡××”' });
      
        const user = await User.findOne({ email });
        if (!user)
          return res.status(401).json({ message: '××©×ª××© ×œ× ×§×™×™×' });
      
        if (user.isLocked)
          return res.status(423).json({ message: '×”×—×©×‘×•×Ÿ × ×¢×•×œ ×–×× ×™×ª' });
      
        if (!(await bcrypt.compare(password, user.passwordHash))) {
          await user.incrementLoginAttempts();
          return res.status(401).json({ message: '×¡×™×¡××” ×©×’×•×™×”' });
        }
      
        await user.resetLoginAttempts();
      
        // âœ¨ ×©×œ×™×—×ª ×”×”×¨×©××•×ª ×”×—×“×©×•×ª ×œ×§×œ×™×™× ×˜
        const userPayload = {
            _id: user._id,
            name: user.name,
            email: user.email,
            role: user.role,
            canManagePriceLists: user.canManagePriceLists,
            canViewCommissions: user.canViewCommissions
        };
      
        createAndSendTokens(user, res);
        return res.status(200).json({ message: "×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”", user: userPayload });
      };
      
      export const logout = async (req, res) => {
          res.clearCookie('jwt');
          res.clearCookie('refreshToken');
          return res.sendStatus(204);
      };
      
      export const refresh = async (req, res) => {
        const { refreshToken } = req.cookies;
        if (!refreshToken) {
          return res.status(401).json({ message: 'No refresh token provided.' });
        }
        try {
          const decoded = jwt.verify(refreshToken, process.env.JWT_REFRESH_SECRET);
          const user = await User.findById(decoded.id);
          if (!user || user.tokenVersion !== decoded.v) {
            return res.status(403).json({ message: 'Forbidden. Please log in again.' });
          }
          createAndSendTokens(user, res);
      
          // âœ¨ ×©×œ×™×—×ª ×”×”×¨×©××•×ª ×”×—×“×©×•×ª ×œ×§×œ×™×™× ×˜
          const userPayload = {
              _id: user._id,
              name: user.name,
              email: user.email,
              role: user.role,
              canManagePriceLists: user.canManagePriceLists,
              canViewCommissions: user.canViewCommissions
          };
          return res.status(200).json({ message: "Tokens refreshed successfully", user: userPayload });
        } catch (error) {
          return res.status(403).json({ message: 'Invalid or expired refresh token.' });
        }
      };
    ğŸ“„ dashboardController.js
      // server/controllers/dashboardController.js
      import Transaction from '../models/Transaction.js';
      import Project from '../models/Project.js';
      import Account from '../models/Account.js';
      import { startOfMonth, subMonths, endOfMonth } from 'date-fns';
      
      export const getDashboardData = async (req, res, next) => {
          try {
              const userId = req.user._id; // ××’×™×¢ ××”-requireAuth middleware
              const today = new Date();
      
              // 1. ×”×’×“×¨×ª ×˜×•×•×—×™ ×ª××¨×™×›×™×
              const thisMonthStart = startOfMonth(today);
              const prevMonthStart = startOfMonth(subMonths(today, 1));
              const prevMonthEnd = endOfMonth(subMonths(today, 1));
      
              // 2. ×‘×™×¦×•×¢ ×›×œ ×”×©××™×œ×ª×•×ª ×‘××§×‘×™×œ ×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×
              const [
                  accounts,
                  monthlyAggregation,
                  categoryAggregation,
                  projects,
                  balanceChartDataRaw
              ] = await Promise.all([
                  Account.find({ userId }).lean(),
                  Transaction.aggregate([
                      { $match: { userId, date: { $gte: prevMonthStart } } },
                      { $group: {
                          _id: { month: { $month: "$date" }, type: "$type" },
                          total: { $sum: "$amount" }
                      }}
                  ]),
                  Transaction.aggregate([
                       { $match: { userId, type: '×”×•×¦××”', date: { $gte: prevMonthStart } } },
                       { $group: {
                           _id: { category: "$category", month: { $month: "$date" } },
                           total: { $sum: "$amount" }
                       }}
                  ]),
                  Project.find({ owner: userId }).sort({ createdAt: -1 }).lean(),
                  Transaction.aggregate([
                      { $match: { userId } },
                      { $sort: { date: 1 } },
                      { $group: {
                          _id: { $dateToString: { format: "%Y-%m-%d", date: "$date" } },
                          dailyChange: { $sum: { $cond: [{ $eq: ["$type", "×”×›× ×¡×”"] }, "$amount", { $multiply: ["$amount", -1] }] }}
                      }},
                      { $sort: { _id: 1 } }
                  ])
              ]);
      
              // 3. ×¢×™×‘×•×“ × ×ª×•× ×™ ×¡×™×›×•× ×—×•×“×©×™
              const thisMonthNum = today.getMonth() + 1;
              const prevMonthNum = prevMonthStart.getMonth() + 1;
              const monthlySummary = {
                  thisMonth: { income: 0, expense: 0 },
                  prevMonth: { income: 0, expense: 0 }
              };
              monthlyAggregation.forEach(item => {
                  const target = item._id.month === thisMonthNum ? monthlySummary.thisMonth : monthlySummary.prevMonth;
                  if (item._id.type === '×”×›× ×¡×”') target.income = item.total;
                  if (item._id.type === '×”×•×¦××”') target.expense = item.total;
              });
      
              // 4. ×¢×™×‘×•×“ × ×ª×•× ×™ ×§×˜×’×•×¨×™×•×ª
              const categorySummary = {};
              categoryAggregation.forEach(item => {
                  const categoryName = item._id.category;
                  if (!categorySummary[categoryName]) {
                      categorySummary[categoryName] = { current: 0, previous: 0 };
                  }
                  if (item._id.month === thisMonthNum) {
                      categorySummary[categoryName].current = item.total;
                  } else {
                      categorySummary[categoryName].previous = item.total;
                  }
              });
      
              // 5. ×¢×™×‘×•×“ × ×ª×•× ×™ ×’×¨×£
              let cumulativeBalance = 0;
              const balanceChartData = balanceChartDataRaw.map(item => {
                  cumulativeBalance += item.dailyChange;
                  return { date: item._id, balance: cumulativeBalance };
              });
      
              // 6. ×”×¨×›×‘×ª ×”×ª×’×•×‘×” ×”×¡×•×¤×™×ª
              res.json({
                  accounts,
                  monthlySummary,
                  categorySummary,
                  projects,
                  balanceChartData
              });
      
          } catch (error) {
              next(error); // ×”×¢×‘×¨×ª ×”×©×’×™××” ×œ-errorHandler
          }
      };
    ğŸ“„ leadController.js
      import InboundEmail from '../models/InboundEmail.js';
      import ReferrerAlias from '../models/ReferrerAlias.js';
      import { catchAsync } from '../middlewares/errorHandler.js';
      import AppError from '../utils/AppError.js';
      
      // ×¢×–×¨: ××¦×™××ª ×©× ×¨×©××™
      export async function getOfficialReferrerName(rawName) {
          if (!rawName) return null;
          const cleanName = rawName.trim();
          const aliasEntry = await ReferrerAlias.findOne({ alias: cleanName });
          return aliasEntry ? aliasEntry.officialName : cleanName;
      }
      
      // ×¢×–×¨: × ×™×ª×•×— ×˜×§×¡×˜
      export async function parseLeadBodyAsync(rawBody) {
        const data = {
          parsedName: null,
          parsedPhone: null,
          parsedNote: null,
          conversationLink: null,
          rawReferrer: null
        };
      
        if (typeof rawBody !== 'string') return data;
      
        try {
          // ×¤×•×¨××˜ ×‘×•×˜ ×¨×’×™×œ
          const nameMatch = rawBody.match(/×©× ××œ×:\s*([\s\S]*?)\s*××¡×¤×¨ ×•×•××˜×¦××¤/);
          if (nameMatch && nameMatch[1]) data.parsedName = nameMatch[1].trim();
      
          const waPhoneMatch = rawBody.match(/××¡×¤×¨ ×•×•××˜×¦××¤\s*([\s\S]*?)\s*××¡×¤×¨ ×œ×—×–×¨×”/);
          if (waPhoneMatch && waPhoneMatch[1]) {
             let phone = waPhoneMatch[1].trim().replace(/[^0-9+]/g, '');
             if (phone.startsWith('0')) phone = '972' + phone.substring(1);
             data.parsedPhone = phone;
          }
      
          let noteMatch = rawBody.match(/×”×¢×¨×”:\s*([\s\S]*?)\s*View Conversation/);
          if (!noteMatch) noteMatch = rawBody.match(/×”×¢×¨×”:\s*([\s\S]*?)$/);
          if (noteMatch && noteMatch[1]) data.parsedNote = noteMatch[1].trim();
      
          const linkMatch = rawBody.match(/View Conversation\s*<(.*?)>/);
          if (linkMatch && linkMatch[1]) data.conversationLink = linkMatch[1].trim();
      
          // ×–×™×”×•×™ "×”×’×¢×ª×™ ×“×¨×š"
          const referralPattern = /×”×’×¢×ª×™\s+×“×¨×š\s+(.+)/i;
          const referralMatch = rawBody.match(referralPattern);
      
          if (referralMatch && referralMatch[1]) {
              let rawReferrer = referralMatch[1].trim().split(/\s+/).slice(0, 2).join(' ');
              rawReferrer = rawReferrer.replace(/[.,;!]$/, '');
              data.rawReferrer = rawReferrer;
          }
      
          return data;
      
        } catch (error) {
          console.error("Error parsing lead body:", error);
          return data;
        }
      }
      
      // --- ×¤×•× ×§×¦×™×•×ª × ×™×”×•×œ ---
      
      export const getAllLeads = catchAsync(async (req, res) => {
        const leads = await InboundEmail.find({})
          .sort({ receivedAt: -1 })
          .populate('handledBy', 'name')
          .limit(200);
        res.status(200).json(leads);
      });
      
      // ×¢×™×‘×•×“ ×™×“× ×™ (×× ×¦×¨×™×š)
      export const processLead = catchAsync(async (req, res, next) => {
        const { id } = req.params;
        const lead = await InboundEmail.findById(id);
        if (!lead) return next(new AppError('×¤× ×™×™×” ×œ× × ××¦××”', 404));
      
        const parsedData = await parseLeadBodyAsync(lead.body);
      
        // ×× ××¦×× ×• ××¤× ×” ×‘×¢×™×‘×•×“ ×—×•×–×¨, × ×¢×“×›×Ÿ ××ª ×”×©×“×” ×”× ×¡×ª×¨
        if (parsedData.rawReferrer) {
            lead.referrer = await getOfficialReferrerName(parsedData.rawReferrer);
        }
      
        Object.assign(lead, {
            parsedName: parsedData.parsedName || lead.parsedName,
            parsedPhone: parsedData.parsedPhone || lead.parsedPhone,
            parsedNote: parsedData.parsedNote || lead.parsedNote,
            conversationLink: parsedData.conversationLink || lead.conversationLink,
            status: 'processed',
            handledBy: req.user._id
        });
      
        const updatedLead = await lead.save();
        res.status(200).json(updatedLead);
      });
      
      export const updateLeadStatus = catchAsync(async (req, res, next) => {
        const { id } = req.params;
        const { status, rejectionReason } = req.body; // <-- ×ª×™×§×•×Ÿ: ×§×•×¨× ××ª ×©× ×™ ×”×©×“×•×ª
        const lead = await InboundEmail.findById(id);
        if (!lead) return next(new AppError('×¤× ×™×™×” ×œ× × ××¦××”', 404));
      
        lead.status = status;
      
        // --- âœ¨ ×”×•×¡×¤×” ---
        if (status === 'not_relevant') {
            lead.rejectionReason = rejectionReason || '×œ× ×¦×•×™× ×” ×¡×™×‘×”';
        }
        if (status === 'new' || status === 'in_progress' || status === 'closed') {
            lead.rejectionReason = null; // ××™×¤×•×¡ ×”×¡×™×‘×” ×× ×”×œ×™×“ ×—×•×–×¨ ×œ×˜×™×¤×•×œ
        }
        // --- ×¡×•×£ ×”×•×¡×¤×” ---
      
        if (status === 'closed') lead.handledBy = req.user._id;
        else if (status === 'new') {
          lead.handledBy = null;
          lead.referrer = null;
        }
      
        await lead.save();
        res.status(200).json(lead);
      });
      
      export const deleteLead = catchAsync(async (req, res, next) => {
        await InboundEmail.findByIdAndDelete(req.params.id);
        res.status(204).send();
      });
    ğŸ“„ orderController.js
      // server/controllers/orderController.js
      import Order from '../models/Order.js';
      import PriceList from '../models/PriceList.js';
      import RoomType from '../models/RoomType.js';
      import { calculateRoomTotalPrice } from '../lib/priceCalculator.js';
      import { getNextSequenceValue } from '../models/Counter.js';
      import nodemailer from 'nodemailer'; // ×•×“× ×©×”×ª×§× ×ª: npm install nodemailer
      
      // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×—×™×©×•×‘ ××—×™×¨ ×¡×•×¤×™
      const calculateFinalTotal = (roomsPrice, extras, discountPercent) => {
          let extrasTotal = 0;
          if (extras && Array.isArray(extras)) {
              extrasTotal = extras.reduce((sum, ex) => sum + (ex.price * ex.quantity), 0);
          }
      
          const subTotal = roomsPrice + extrasTotal;
          const discountAmount = subTotal * (discountPercent / 100);
      
          return Math.max(0, subTotal - discountAmount);
      };
      
      export const createOrder = async (req, res) => {
        const {
          hotel,
          rooms,
          notes,
          customerName,
          customerPhone,
          status,
          numberOfNights = 1,
          extras = [],
          discountPercent = 0,
          customerEmail,
          eventDate
        } = req.body;
      
        if (!hotel) return res.status(400).json({ message: '×—×•×‘×” ×œ×‘×—×•×¨ ××œ×•×Ÿ.' });
        if (!customerName) return res.status(400).json({ message: '×©× ×”×œ×§×•×— ×”×•× ×©×“×” ×—×•×‘×”.' });
        if ((!rooms || rooms.length === 0) && (!extras || extras.length === 0)) {
          return res.status(400).json({ message: '×”×”×–×× ×” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª ×—×“×¨ ××—×“ ××• ×ª×•×¡×¤×ª ××—×ª.' });
        }
      
        try {
          const priceListsFromDB = await PriceList.find({ hotel });
          const priceListsMap = Object.fromEntries(
            priceListsFromDB.map(pl => [pl.name, pl.toObject()])
          );
      
          const hotelRoomTypes = await RoomType.find({ hotel });
          const roomTypesMap = Object.fromEntries(
            hotelRoomTypes.map(rt => [rt._id.toString(), rt])
          );
      
          let roomsTotalPrice = 0;
      
          const roomsWithServerPrice = (rooms || []).map(room => {
            let supplement = 0;
            let roomTypeName = '×¨×’×™×œ';
      
            if (room.roomTypeId && roomTypesMap[room.roomTypeId]) {
              const rt = roomTypesMap[room.roomTypeId];
              supplement = rt.supplementPerNight || 0;
              roomTypeName = rt.name;
            }
      
            const price = calculateRoomTotalPrice(
              room,
              priceListsMap,
              room.price_list_names,
              numberOfNights,
              supplement
            );
      
            roomsTotalPrice += price;
      
            return {
              ...room,
              price,
              roomType: roomTypeName,
              roomSupplement: supplement,
              notes: room.notes
            };
          });
      
          const finalPrice = calculateFinalTotal(roomsTotalPrice, extras, discountPercent);
          const orderNumber = await getNextSequenceValue('orderNumber');
      
          const newOrderInMongo = await Order.create({
              orderNumber,
              hotel,
              user: req.user.id,
              salespersonName: req.user.name,
              customerName,
              customerPhone,
              customerEmail,
              eventDate: eventDate ? new Date(eventDate) : new Date(),
              status: status || '×‘×”××ª× ×”',
              numberOfNights,
              rooms: roomsWithServerPrice,
              extras,
              discountPercent,
              total_price: finalPrice,
              notes,
          });
      
          res.status(201).json(newOrderInMongo);
        } catch (error) {
          console.error("Order creation error:", error);
          res.status(500).json({ message: "×©×’×™××” ×‘×©××™×¨×ª ×”×”×–×× ×”." });
        }
      };
      
      export const updateOrder = async (req, res) => {
          try {
              const {
                  hotel, rooms, notes, customerName, customerPhone, status, total_price, numberOfNights,
                  extras, discountPercent, customerEmail, eventDate
              } = req.body;
      
              const order = await Order.findById(req.params.id);
      
              if (!order) return res.status(404).json({ message: '×”×”×–×× ×” ×œ× × ××¦××”' });
              if (order.user.toString() !== req.user.id && req.user.role !== 'admin') {
                  return res.status(403).json({ message: '××™×Ÿ ×”×¨×©××” ×œ×¢×¨×•×š ×”×–×× ×” ×–×•' });
              }
      
              let roomsTotalPrice = 0;
              let roomsWithServerPrice = order.rooms;
      
              if (rooms || numberOfNights || hotel) {
                  const hotelIdForCalc = hotel || order.hotel;
                  const nightsForCalc = numberOfNights || order.numberOfNights || 1;
      
                  const priceListsFromDB = await PriceList.find({ hotel: hotelIdForCalc });
                  const priceListsMap = Object.fromEntries(priceListsFromDB.map(pl => [pl.name, pl.toObject()]));
      
                  const hotelRoomTypes = await RoomType.find({ hotel: hotelIdForCalc });
                  const roomTypesMap = Object.fromEntries(hotelRoomTypes.map(rt => [rt._id.toString(), rt]));
      
                  const roomsToProcess = rooms || order.rooms;
      
                  roomsWithServerPrice = roomsToProcess.map(room => {
                      let supplement = 0;
                      let roomTypeName = room.roomType || '×¨×’×™×œ';
      
                      if (room.roomTypeId && roomTypesMap[room.roomTypeId]) {
                          const rt = roomTypesMap[room.roomTypeId];
                          supplement = rt.supplementPerNight || 0;
                          roomTypeName = rt.name;
                      } else if (room.roomSupplement !== undefined) {
                          supplement = room.roomSupplement;
                      }
      
                      const price = calculateRoomTotalPrice(room, priceListsMap, room.price_list_names, nightsForCalc, supplement);
                      roomsTotalPrice += price;
      
                      return {
                          ...room,
                          price,
                          roomType: roomTypeName,
                          roomSupplement: supplement,
                          notes: room.notes
                      };
                  });
              } else {
                  roomsTotalPrice = order.rooms.reduce((sum, r) => sum + r.price, 0);
              }
      
              const currentExtras = extras !== undefined ? extras : order.extras;
              const currentDiscount = discountPercent !== undefined ? discountPercent : order.discountPercent;
      
              let finalPrice = calculateFinalTotal(roomsTotalPrice, currentExtras, currentDiscount);
              if (total_price !== undefined) finalPrice = total_price;
      
              // ×¢×“×›×•×Ÿ ×©×“×•×ª
              order.hotel = hotel ?? order.hotel;
              order.customerName = customerName ?? order.customerName;
              order.customerPhone = customerPhone ?? order.customerPhone;
              order.customerEmail = customerEmail ?? order.customerEmail;
              if (eventDate) order.eventDate = new Date(eventDate);
      
              order.status = status ?? order.status;
              order.notes = notes ?? order.notes;
              order.numberOfNights = numberOfNights ?? order.numberOfNights;
              order.rooms = roomsWithServerPrice;
              order.extras = currentExtras;
              order.discountPercent = currentDiscount;
              order.total_price = finalPrice;
      
              const updatedOrder = await order.save();
              res.json(updatedOrder);
          } catch (error) {
              console.error("Order update error:", error);
              res.status(500).json({ message: "×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×”×–×× ×”" });
          }
      };
      
      export const getMyOrders = async (req, res) => {
          try {
              const orders = await Order.find({ user: req.user.id }).sort({ orderNumber: -1 }).populate('hotel', 'name');
              res.json(orders);
          } catch (error) {
              res.status(500).json({ message: "×©×’×™××” ×‘×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×™×ª ×”×”×–×× ×•×ª." });
          }
      };
      
      export const getAllOrders = async (req, res) => {
        try {
          const orders = await Order.find({}).sort({ orderNumber: -1 }).populate('user', 'name').populate('hotel', 'name');
          res.json(orders);
        } catch (error) {
          res.status(500).json({ message: "×©×’×™××” ×‘×˜×¢×™× ×ª ×›×œ ×”×”×–×× ×•×ª." });
        }
      };
      
      export const getOrderById = async (req, res) => {
          try {
              const order = await Order.findById(req.params.id).populate('user', 'name').populate('hotel', 'name');
              if (!order) return res.status(404).json({ message: '×”×”×–×× ×” ×œ× × ××¦××”' });
              if (order.user._id.toString() !== req.user.id && req.user.role !== 'admin') {
                  return res.status(403).json({ message: '××™×Ÿ ×”×¨×©××” ×œ×¦×¤×•×ª ×‘×”×–×× ×” ×–×•' });
              }
              res.json(order);
          } catch (error) {
              res.status(500).json({ message: "×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×–×× ×”" });
          }
      };
      
      export const getPublicQuoteById = async (req, res) => {
          try {
              const order = await Order.findById(req.params.id)
                  .populate('hotel', 'name brandColor logoUrl address phone');
      
              if (!order) return res.status(404).json({ message: '×”×”×–×× ×” ×œ× × ××¦××”' });
      
              res.json({
                  orderNumber: order.orderNumber,
                  hotel: order.hotel,
                  customerName: order.customerName,
                  customerPhone: order.customerPhone,
                  customerEmail: order.customerEmail,
                  eventDate: order.eventDate,
                  createdAt: order.createdAt,
                  rooms: order.rooms,
                  total_price: order.total_price,
                  numberOfNights: order.numberOfNights,
                  extras: order.extras,
                  discountPercent: order.discountPercent,
                  notes: order.notes
              });
          } catch (error) {
              res.status(500).json({ message: "×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×–×× ×”" });
          }
      };
      
      export const deleteOrder = async (req, res) => {
          try {
              const order = await Order.findById(req.params.id);
              if (!order) return res.status(404).json({ message: '×”×”×–×× ×” ×œ× × ××¦××”' });
              if (order.user.toString() !== req.user.id && req.user.role !== 'admin') {
                  return res.status(403).json({ message: '××™×Ÿ ×”×¨×©××” ×œ××—×•×§ ×”×–×× ×” ×–×•' });
              }
              await Order.findByIdAndDelete(req.params.id);
              res.json({ message: '×”×”×–×× ×” × ××—×§×”' });
          } catch (error) {
              res.status(500).json({ message: '×©×’×™××” ×‘××—×™×§×ª ×”×”×–×× ×”' });
          }
      };
      
      // âœ¨ ×¤×•× ×§×¦×™×” ×œ×©×œ×™×—×ª ×”×¦×¢×ª ××—×™×¨ ×‘××™×™×œ
      export const sendOrderEmail = async (req, res) => {
          try {
              const { email, customerName } = req.body;
              const pdfBuffer = req.file?.buffer;
      
              if (!email || !pdfBuffer) {
                  return res.status(400).json({ message: '×—×¡×¨ ×›×ª×•×‘×ª ××™××™×™×œ ××• ×§×•×‘×¥ PDF' });
              }
      
              // ×”×’×“×¨×ª ×”×˜×¨× ×¡×¤×•×¨×˜×¨ (×©×¨×ª ×”××™×™×œ)
              // ×”×’×“×¨×ª ×”×˜×¨× ×¡×¤×•×¨×˜×¨ ×¢× ×”×’×“×¨×•×ª ×¡×¤×¦×™×¤×™×•×ª ×œ×©×¨×ª×™× ×‘×¢× ×Ÿ
              const transporter = nodemailer.createTransport({
                  host: 'smtp.gmail.com',
                  port: 465, // ×©×™××•×© ×‘×¤×•×¨×˜ 465 (SSL) ×©×¢×•×‘×“ ×˜×•×‘ ×™×•×ª×¨ ×‘×©×¨×ª×™ ×¢× ×Ÿ
                  secure: true, // ×—×•×‘×” ×¢×‘×•×¨ ×¤×•×¨×˜ 465
                  auth: {
                      user: process.env.EMAIL_USER,
                      pass: process.env.EMAIL_PASS
                  },
                  // ×”×’×“×¨×•×ª × ×•×¡×¤×•×ª ×œ×× ×™×¢×ª ×ª×§×œ×•×ª
                  tls: {
                      // ××œ ×ª×™×›×©×œ ×× ×”××™×©×•×¨ ×œ× ××•×©×œ× (×¢×•×–×¨ ×œ×¤×¢××™× ×‘×©×¨×ª×™ ×¤×™×ª×•×—)
                      rejectUnauthorized: false
                  }
              });
      
              const mailOptions = {
                  from: `"×”×¦×¢×•×ª ××—×™×¨" <${process.env.EMAIL_USER}>`,
                  to: email,
                  subject: `×”×¦×¢×ª ××—×™×¨ ×¢×‘×•×¨ ${customerName}`,
                  html: `
                      <div dir="rtl" style="font-family: Arial, sans-serif;">
                          <h2>×©×œ×•× ${customerName},</h2>
                          <p>×ª×•×“×” ×©×¤× ×™×ª ××œ×™× ×•.</p>
                          <p>××¦×•×¨×¤×ª ×”×¦×¢×ª ×”××—×™×¨ ×›×§×•×‘×¥ PDF ×œ×‘×§×©×ª×š.</p>
                          <br>
                          <p>×‘×‘×¨×›×”,</p>
                          <p>×¦×•×•×ª ×”×”×–×× ×•×ª</p>
                      </div>
                  `,
                  attachments: [
                      {
                          filename: 'quote.pdf',
                          content: pdfBuffer,
                          contentType: 'application/pdf'
                      }
                  ]
              };
      
              await transporter.sendMail(mailOptions);
              res.status(200).json({ message: 'Email sent successfully' });
      
          } catch (error) {
              console.error('Error sending email:', error);
              res.status(500).json({ message: '×©×’×™××” ×‘×©×œ×™×—×ª ×”××™×™×œ', error: error.message });
          }
      };
    ğŸ“„ priceListController.js
      import PriceList from '../models/PriceList.js';
      
      /**
       * @desc    ×§×‘×œ×ª ×›×œ ×”××—×™×¨×•× ×™× (×¢× ×¡×™× ×•×Ÿ ×œ×¤×™ ××œ×•×Ÿ, ×¤×¢×™×œ/×œ× ×¤×¢×™×œ ×•××™×•×Ÿ)
       * @route   GET /api/pricelists?hotelId=:hotelId&active=true
       * @access  Private
       */
      export const getAllPriceLists = async (req, res) => {
        try {
          const { hotelId, active } = req.query;
          const filter = {};
      
          if (hotelId) {
            filter.hotel = hotelId;
          }
      
          // âœ¨ ×× × ×©×œ×— ×”×¤×¨××˜×¨ active=true, × ×—×–×™×¨ ×¨×§ ××—×™×¨×•× ×™× ×’×œ×•×™×™×
          if (active === 'true') {
            filter.isVisible = true;
          }
      
          console.log(`Fetching price lists from MongoDB with filter:`, filter);
      
          // âœ¨ ××™×•×Ÿ: ×§×•×“× ×œ×¤×™ displayOrder (×¢×•×œ×”), ×•××– ×œ×¤×™ ×©× (×× ×”×¡×“×¨ ×–×”×”)
          const priceListsFromDB = await PriceList.find(filter)
            .sort({ displayOrder: 1, name: 1 })
            .populate('hotel', 'name');
      
          res.json(priceListsFromDB);
        } catch (dbError) {
          console.error('Failed to fetch price lists from MongoDB.', dbError);
          res.status(500).json({ message: "×©×’×™××” ×‘×˜×¢×™× ×ª ×”××—×™×¨×•× ×™×." });
        }
      };
      
      /**
       * @desc    ×™×¦×™×¨×ª ××—×™×¨×•×Ÿ ×—×“×©
       * @route   POST /api/pricelists
       * @access  Private (×“×•×¨×© ×”×¨×©××ª × ×™×”×•×œ ××—×™×¨×•× ×™×)
       */
      export const createPriceList = async (req, res) => {
        // âœ¨ ×”×•×¡×¤× ×• ××ª displayOrder ×•-isVisible
        const { name, couple, teen, child, baby, single_room, hotel, maxNights, displayOrder, isVisible } = req.body;
      
        if (!name || !hotel) {
          return res.status(400).json({ message: "×©× ×”××—×™×¨×•×Ÿ ×•×©×™×•×š ×œ××œ×•×Ÿ ×”× ×©×“×•×ª ×—×•×‘×”" });
        }
      
        try {
          const newPriceListInMongo = await PriceList.create({
            name,
            hotel,
            couple,
            teen,
            child,
            baby,
            single_room,
            maxNights: maxNights || 0,
            displayOrder: displayOrder || 0, // âœ¨ ×©××™×¨×ª ×”×¡×“×¨
            isVisible: isVisible !== undefined ? isVisible : true, // âœ¨ ×©××™×¨×ª ×”× ×¨××•×ª
            user: req.user.id,
          });
          res.status(201).json(newPriceListInMongo);
        } catch (error) {
          if (error.code === 11000) {
            return res.status(400).json({ message: "×©× ××—×™×¨×•×Ÿ ×–×” ×›×‘×¨ ×§×™×™× ×¢×‘×•×¨ ×”××œ×•×Ÿ ×©× ×‘×—×¨." });
          }
          res.status(500).json({ message: "×©×’×™××” ×‘×™×¦×™×¨×ª ×”××—×™×¨×•×Ÿ." });
        }
      };
      
      /**
       * @desc    ×¢×“×›×•×Ÿ ××—×™×¨×•×Ÿ ×§×™×™×
       * @route   PUT /api/pricelists/:id
       * @access  Private (×“×•×¨×© ×”×¨×©××ª × ×™×”×•×œ ××—×™×¨×•× ×™×)
       */
      export const updatePriceList = async (req, res) => {
        const { id } = req.params;
        // ××¤×¨×§×™× ××ª ×”×’×•×£ ×›×“×™ ×œ××¤×©×¨ ×¢×“×›×•×Ÿ ×©×œ ×›×œ ×”×©×“×•×ª
        const { name, ...otherFields } = req.body;
      
        if (!name) {
          return res.status(400).json({ message: "×©× ×”××—×™×¨×•×Ÿ ×”×•× ×©×“×” ×—×•×‘×”" });
        }
      
        try {
           const findQuery = { _id: id };
           if (req.user.role !== 'admin') {
              findQuery.user = req.user.id;
           }
      
          const updatedPriceList = await PriceList.findOneAndUpdate(
            findQuery,
            { name, ...otherFields }, // âœ¨ ×–×” ×™×¢×“×›×Ÿ ×’× ××ª isVisible ×•-displayOrder ×× × ×©×œ×—×•
            { new: true, runValidators: true }
          );
      
          if (!updatedPriceList) {
            return res.status(404).json({ message: "×”××—×™×¨×•×Ÿ ×œ× × ××¦× ××• ×©××™×Ÿ ×œ×š ×”×¨×©××” ×œ×¢×¨×•×š ××•×ª×•." });
          }
          res.json(updatedPriceList);
        } catch (error) {
           if (error.code === 11000) {
            return res.status(400).json({ message: "×©× ××—×™×¨×•×Ÿ ×–×” ×›×‘×¨ ×§×™×™× ×¢×‘×•×¨ ×”××œ×•×Ÿ ×©× ×‘×—×¨." });
          }
          res.status(500).json({ message: "×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”××—×™×¨×•×Ÿ" });
        }
      };
      
      /**
       * @desc    ××—×™×§×ª ××—×™×¨×•×Ÿ
       * @route   DELETE /api/pricelists/:id
       * @access  Private (×“×•×¨×© ×”×¨×©××ª × ×™×”×•×œ ××—×™×¨×•× ×™×)
       */
      export const deletePriceList = async (req, res) => {
        const { id } = req.params;
        try {
          const findQuery = { _id: id };
          if (req.user.role !== 'admin') {
              findQuery.user = req.user.id;
          }
      
          const deletedPriceList = await PriceList.findOneAndDelete(findQuery);
      
          if (!deletedPriceList) {
            return res.status(404).json({ message: "×”××—×™×¨×•×Ÿ ×œ× × ××¦× ××• ×©××™×Ÿ ×œ×š ×”×¨×©××” ×œ××—×•×§ ××•×ª×•." });
          }
      
          res.json({ message: "×”××—×™×¨×•×Ÿ × ××—×§ ×‘×”×¦×œ×—×”" });
        } catch (error) {
          res.status(500).json({ message: "×©×’×™××” ×‘××—×™×§×ª ×”××—×™×¨×•×Ÿ" });
        }
      };
    ğŸ“„ rateController.js
      import RateHistory from '../models/RateHistory.js';
      
      export const updatePrimeRate = async (req, res, next) => {
        try {
          const { rate, date } = req.body;
          if (rate === undefined || !date) {
            return res.status(400).json({ message: 'Rate and date are required.' });
          }
      
          // `findOneAndUpdate` ×¢× `upsert` ×™×¢×“×›×Ÿ ×× ×§×™×™× ×ª××¨×™×š ×–×”×”, ××• ×™×™×¦×•×¨ ×¨×©×•××” ×—×“×©×”
          const newRate = await RateHistory.findOneAndUpdate(
            { date: new Date(date), indexName: 'prime' },
            { rate: parseFloat(rate) },
            { new: true, upsert: true, setDefaultsOnInsert: true }
          );
      
          res.status(201).json({ message: 'Prime rate updated successfully.', rate: newRate });
        } catch (error) {
          next(error);
        }
      };
    ğŸ“„ referrerController.js
      import ReferrerAlias from '../models/ReferrerAlias.js';
      import InboundEmail from '../models/InboundEmail.js';
      import { catchAsync } from '../middlewares/errorHandler.js';
      
      // === 1. ×“×•×— ×‘×™×¦×•×¢×™× ××”×™×¨ (×œ×œ× ×¡×¨×™×§×ª ×˜×§×¡×˜) ===
      export const getReferrerStats = catchAsync(async (req, res) => {
        // ××’×¨×’×¦×™×” ×™×©×™×¨×” ××”×“××˜×”×‘×™×™×¡ - ×”×›×™ ××”×™×¨ ×©×™×©
        const stats = await InboundEmail.aggregate([
          { $match: { referrer: { $ne: null } } }, // ×¨×§ ×œ×™×“×™× ×¢× ××¤× ×”
          {
            $group: {
              _id: "$referrer",
              count: { $sum: 1 },
              sales: {
                  $sum: { $cond: [{ $eq: ["$status", "closed"] }, 1, 0] }
              }
            }
          },
          { $sort: { count: -1 } }
        ]);
      
        // ××™×¤×•×™ ×œ×¤×•×¨××˜ ×©×”×§×œ×™×™× ×˜ ×¦×¨×™×š
        const formattedStats = stats.map(s => ({
            name: s._id,
            count: s.count,
            sales: s.sales,
            isOfficial: true // ×”× ×—×”: ××” ×©× ×©××¨ ×‘-referrer ×›×‘×¨ ×¢×‘×¨ × ×¨××•×œ
        }));
      
        res.json(formattedStats);
      });
      
      // === 2. ×›×¤×ª×•×¨ ×”×§×¡×: ×¡×¨×™×§×ª ×”×™×¡×˜×•×¨×™×” ×•×ª×™×§×•×Ÿ ×¨×˜×¨×•××§×˜×™×‘×™ ===
      export const scanHistory = catchAsync(async (req, res) => {
          const leads = await InboundEmail.find({});
          const aliases = await ReferrerAlias.find({});
          const aliasMap = aliases.reduce((acc, curr) => ({ ...acc, [curr.alias]: curr.officialName }), {});
      
          let updatedCount = 0;
      
          for (const lead of leads) {
              // ×œ×•×’×™×§×ª ×”×—×™×œ×•×¥ (××•×ª×” ×œ×•×’×™×§×” ×›××• ×‘-Webhook)
              const text = (lead.parsedNote || '') + ' ' + (lead.body || '');
              const match = text.match(/(?:×”×’×¢×ª×™|×¤× ×™×ª×™|×‘××ª×™)\s*(?:×“×¨×š|×|××”|×‘×”××œ×¦×ª|×¢"×™)\s+(.+)/i);
      
              if (match && match[1]) {
                  let rawName = match[1].trim().split(/\s+/).slice(0, 2).join(' ');
                  rawName = rawName.replace(/[.,;!?-]$/, '');
      
                  // × ×¨××•×œ
                  const finalName = aliasMap[rawName] || rawName;
      
                  // ×¢×“×›×•×Ÿ ×”×©×“×” ×”× ×¡×ª×¨ ×‘×œ×‘×“
                  if (lead.referrer !== finalName) {
                      lead.referrer = finalName;
                      await lead.save();
                      updatedCount++;
                  }
              }
          }
      
          res.json({ message: `×¡×¨×™×§×” ×”×¡×ª×™×™××”. ${updatedCount} ×œ×™×“×™× ×”×™×¡×˜×•×¨×™×™× ×ª×•×™×’×• ××—×“×©.` });
      });
      
      // === 3. ×™×¦×™×¨×ª ×—×•×§ ===
      export const upsertAlias = catchAsync(async (req, res) => {
        const { alias, officialName } = req.body;
        if (!alias || !officialName) return res.status(400).json({ message: '×—×¡×¨ ××™×“×¢' });
      
        await ReferrerAlias.findOneAndUpdate(
          { alias: alias.trim() },
          { officialName: officialName.trim() },
          { new: true, upsert: true }
        );
      
        // ×¢×“×›×•×Ÿ ××™×™×“×™ ×©×œ ×›×œ ×”×œ×™×“×™× ×”×§×™×™××™× ×¢× ×”×©× ×”×™×©×Ÿ
        await InboundEmail.updateMany(
            { referrer: alias.trim() },
            { $set: { referrer: officialName.trim() } }
        );
      
        res.json({ message: '×”×—×•×§ × ×©××¨ ×•×”×œ×™×“×™× ×¢×•×“×›× ×•.' });
      });
    ğŸ“„ roomController.js
      import Room from '../models/Room.js';
      import Hotel from '../models/Hotel.js';
      import { catchAsync } from '../middlewares/errorHandler.js';
      import AppError from '../utils/AppError.js';
      
      // --- 1. ×©×œ×™×¤×ª ×›×œ ×”×—×“×¨×™× (×œ×× ×”×œ×™×) ---
      export const getAllRooms = catchAsync(async (req, res) => {
        const rooms = await Room.find({})
          .populate('roomType', 'name')
          .populate('hotel', 'name')
          .populate('lastCleanedBy', 'name')
          .sort({ hotel: 1, roomNumber: 1 });
      
        res.json(rooms);
      });
      
      // --- 2. ×©×œ×™×¤×ª ×—×“×¨×™× ×œ×¢×•×‘×“×™× (×¢× ×¡×™× ×•×Ÿ ×™×•××™) ---
      export const getRoomsByHotel = catchAsync(async (req, res) => {
        const { hotelId } = req.params;
      
        let rooms = await Room.find({ hotel: hotelId })
          .populate('roomType', 'name')
          .populate('lastCleanedBy', 'name')
          .sort({ roomNumber: 1 });
      
        // × ×™×§×•×™ ×•×™×–×•××œ×™ ×©×œ ××©×™××•×ª ×™×•××™×•×ª ×©×ª×•×§×¤×Ÿ ×¤×’ (×× × ×©××¨×• ×›××œ×• ×‘×˜×¢×•×ª)
        const todayStart = new Date();
        todayStart.setHours(0,0,0,0);
      
        rooms = rooms.map(room => {
            const activeTasks = room.tasks.filter(t => {
                // ××©×™××•×ª ×™×•××™×•×ª ('daily') - ××¦×™×’×™× ×¨×§ ×× ×”×ª××¨×™×š ×”×•× ×”×™×•× ×•××¢×œ×”
                if (t.type === 'daily' && t.date && new Date(t.date) < todayStart) {
                    return false;
                }
                return true; // standard ×•-maintenance ×ª××™×“ ××•×¦×’×™×
            });
      
            const roomObj = room.toObject();
            roomObj.tasks = activeTasks;
            return roomObj;
        });
      
        res.json(rooms);
      });
      
      // --- 3. ×™×¦×™×¨×ª ×—×“×¨×™× (Bulk) - ×˜×¢×™× ×” ×¨××©×•× ×™×ª ××”×ª×‘× ×™×ª ---
      export const createBulkRooms = catchAsync(async (req, res, next) => {
        const { hotel, roomType, startNumber, endNumber } = req.body;
      
        if (!hotel || !roomType || !startNumber || !endNumber) {
          return next(new AppError('×—×¡×¨×™× × ×ª×•× ×™×.', 400));
        }
      
        // ×©×œ×™×¤×ª ×”×ª×‘× ×™×ª ×”×¨××©×™×ª ××”××œ×•×Ÿ
        const hotelDoc = await Hotel.findById(hotel);
        const checklist = hotelDoc?.masterChecklist && hotelDoc.masterChecklist.length > 0
            ? hotelDoc.masterChecklist
            : [{ text: '× ×™×§×™×•×Ÿ ×›×œ×œ×™ (×‘×¨×™×¨×ª ××—×“×œ)', order: 1 }];
      
        const start = parseInt(startNumber);
        const end = parseInt(endNumber);
        const createdRooms = [];
      
        for (let i = start; i <= end; i++) {
          const roomNumStr = i.toString();
          const exists = await Room.findOne({ hotel, roomNumber: roomNumStr });
      
          if (!exists) {
              createdRooms.push({
                  hotel,
                  roomNumber: roomNumStr,
                  roomType,
                  status: 'dirty',
                  // ×™×¦×™×¨×ª ××©×™××•×ª ××¡×•×’ 'standard'
                  tasks: checklist.map(item => ({
                      description: item.text,
                      type: 'standard',
                      isSystemTask: true // Legacy flag
                  }))
              });
      }
        }
      
        if (createdRooms.length > 0) {
          await Room.insertMany(createdRooms);
        }
      
        res.status(201).json({ message: `× ×•×¦×¨×• ${createdRooms.length} ×—×“×¨×™× ×—×“×©×™×.` });
      });
      
      // --- 4. ×”×•×¡×¤×ª ××©×™××” (×™×“× ×™×ª / ×™×•××™×ª) ---
      export const addTask = catchAsync(async (req, res, next) => {
          const { id } = req.params;
          const { description, isTemporary } = req.body; // isTemporary ××’×™×¢ ××”×§×œ×™×™× ×˜
      
          if (!description) return next(new AppError('×—×•×‘×” ×œ×”×–×™×Ÿ ×ª×™××•×¨', 400));
      
          const room = await Room.findById(id);
          if (!room) return next(new AppError('×—×“×¨ ×œ× × ××¦×', 404));
      
          // ×§×‘×™×¢×ª ×¡×•×’ ×”××©×™××”
          // ×× ×–×× ×™ -> daily, ××—×¨×ª -> maintenance (×ª×§×œ×”/×—×•×¡×¨)
          const type = isTemporary ? 'daily' : 'maintenance';
          const date = isTemporary ? new Date() : null;
      
           room.tasks.push({
              description,
              addedBy: req.user._id,
              type: type,
              date: date,
              isSystemTask: false
          });
      
           if (room.status === 'clean') room.status = 'dirty';
      
          await room.save();
          res.json(room);
      });
      
      // --- 5. ×¡×™××•×Ÿ ××©×™××” ×›×‘×•×¦×¢×” ---
      export const toggleTask = catchAsync(async (req, res, next) => {
          const { id, taskId } = req.params;
          const { isCompleted } = req.body;
      
          const room = await Room.findById(id);
          if (!room) return next(new AppError('×—×“×¨ ×œ× × ××¦×', 404));
      
          const task = room.tasks.id(taskId);
          if (!task) return next(new AppError('××©×™××” ×œ× × ××¦××”', 404));
      
          task.isCompleted = isCompleted;
          task.completedBy = isCompleted ? req.user._id : null;
      
          // âœ¨ ×œ×•×’×™×§×” ××™×•×—×“×ª ×œ×ª×§×œ×•×ª (Maintenance):
          // ×× ×–×• ×ª×§×œ×” ×•×”×™× ×¡×•×× ×” ×›×‘×•×¦×¢×” - ×”×× ×œ××—×•×§ ××•×ª×” ××™×“?
          // ×œ×¤×™ ×”××¤×™×•×Ÿ: "×‘×¨×’×¢ ×©×”×¢×•×‘×“ ××¡××Ÿ V â€“ ×”×ª×§×œ×” × ×¢×œ××ª".
          if (task.type === 'maintenance' && isCompleted) {
              // ××•×¤×¦×™×” ×': ××—×™×§×” ×¤×™×–×™×ª (Uncomment ×›×“×™ ×œ××—×•×§)
              // room.tasks.pull(taskId);
      
              // ××•×¤×¦×™×” ×‘': ×”×©××¨×” ×›"×‘×•×¦×¢" ×¢×“ ×”×¨×¢× ×•×Ÿ ×”×‘× (×›×“×™ ×©×”×× ×”×œ ×™×¨××” ×©×ª×•×§×Ÿ)
              // ×›×¨×’×¢ × ×©××™×¨ ××•×ª×” ××¡×•×× ×ª. ×‘×“×£ ×”×¡×˜×˜×•×¡ ×”×™×•××™ × × ×§×” ××•×ª×”.
          }
      
          await room.save();
          res.json(room);
      });
      
      // --- 6. ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ / ××™×¤×•×¡ ×—×“×¨ (×”×œ×•×’×™×§×” ×”×—×›××”) ---
      export const updateRoomStatus = catchAsync(async (req, res, next) => {
          const { id } = req.params;
          const { status } = req.body;
      
          const room = await Room.findById(id);
          if (!room) return next(new AppError('×—×“×¨ ×œ× × ××¦×', 404));
      
          // ×× ×”×•×¤×›×™× ×œ××œ×•×›×œ×š ('dirty') -> ×–×”×• "××™×¤×•×¡ ×—×“×¨" ×œ×™×•× ×—×“×©/××•×¨×— ×—×“×©
          if (status === 'dirty' && room.status !== 'dirty') {
      
              // 1. ×©××™×¨×ª ×”×ª×§×œ×•×ª ×”×¤×ª×•×—×•×ª ×‘×œ×‘×“ (Maintenance ×©×œ× ×‘×•×¦×¢×•)
              // (×•×’× ×ª×§×œ×•×ª ×©×‘×•×¦×¢×• ××¤×©×¨ ×œ× ×§×•×ª ×¢×›×©×™×• ×× ×¨×•×¦×™× ×”×™×¡×˜×•×¨×™×” × ×§×™×™×”)
               const openMaintenanceTasks = room.tasks.filter(t => t.type === 'maintenance' && !t.isCompleted);
      
              // 2. ×˜×¢×™× ×ª ×”×ª×‘× ×™×ª ×”×¢×“×›× ×™×ª ××”××œ×•×Ÿ
              const hotelDoc = await Hotel.findById(room.hotel);
              const checklist = hotelDoc?.masterChecklist || [];
      
              const newStandardTasks = checklist.map(item => ({
                  description: item.text,
                  type: 'standard',
                  isCompleted: false,
                  isSystemTask: true
              }));
              // 3. ×‘× ×™×™×” ××—×“×© ×©×œ ××¢×¨×š ×”××©×™××•×ª
              // (×”×¢×¨×”: ××©×™××•×ª 'daily' × ××—×§×•×ª ×›×™ ×”×Ÿ ×”×™×• ×¨×œ×•×•× ×˜×™×•×ª ×œ×™×•× ×”×§×•×“×)
              room.tasks = [...newStandardTasks, ...openMaintenanceTasks];
      }
          else if (status === 'clean') {
              room.lastCleanedAt = new Date();
              room.lastCleanedBy = req.user._id;
          }
      
          room.status = status;
          await room.save();
          res.json(room);
      });
      
      // --- 7. ××—×™×§×ª ×—×“×¨ ---
      export const deleteRoom = catchAsync(async (req, res) => {
          await Room.findByIdAndDelete(req.params.id);
          res.status(204).send();
      });
      
      // --- 8. ×”×—×œ×ª ×¡×™×“×•×¨ ×¢×‘×•×“×” (××”×× ×”×œ) ---
      export const applyDailyPlan = catchAsync(async (req, res, next) => {
          const { plan } = req.body; // ××¢×¨×š ×©×œ: { roomId, action, note }
      
          if (!plan || !Array.isArray(plan)) {
              return next(new AppError('××‘× ×” × ×ª×•× ×™× ×œ× ×ª×§×™×Ÿ', 400));
          }
      
          const todayStart = new Date();
          todayStart.setHours(0,0,0,0);
          const endOfDay = new Date();
          endOfDay.setHours(23,59,59,999);
      
          let updatedCount = 0;
      
          // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×¤× ×™××™×ª ×œ×˜×¢×™× ×ª ×¦'×§ ×œ×™×¡×˜ ×‘×¨×™×¨×ª ××—×“×œ
          const getChecklistWithFallback = (hotelDoc) => {
              const checklist = hotelDoc?.masterChecklist;
              if (checklist && checklist.length > 0) {
                  return checklist.map(item => ({
                      description: item.text,
                      type: 'standard',
                      isCompleted: false,
                      isSystemTask: true
                  }));
              }
              // Fallback
              return [{
                  description: '× ×™×§×™×•×Ÿ ×›×œ×œ×™ (×‘×¨×™×¨×ª ××—×“×œ)',
                  type: 'standard',
                  isCompleted: false,
                  isSystemTask: true
              }];
          };
      
          // ×œ×•×œ××” ×¢×œ ×›×œ ×©×•×¨×” ×‘×˜×‘×œ×” ×©×”×× ×”×œ ×©×œ×—
          for (const item of plan) {
               const { roomId, action, note } = item;
      
              // ×× ×œ× × ×‘×—×¨×” ×¤×¢×•×œ×” ("×œ×œ× ×©×™× ×•×™"), ××“×œ×’×™×
              if (!action || action === 'none') continue;
      
              const room = await Room.findById(roomId);
              if (!room) continue;
      
              // ×©×œ×™×¤×ª ×”×¦'×§ ×œ×™×¡×˜ ×”×§×‘×•×¢ ×©×œ ×”××œ×•×Ÿ
              const hotelDoc = await Hotel.findById(room.hotel);
              // ×©×™××•×© ×‘×¤×•× ×§×¦×™×™×ª ×”×’×™×‘×•×™ ×©×™×¦×¨× ×• ×§×•×“× ×›×“×™ ×œ×•×•×“× ×©×ª××™×“ ×™×© ××©×™××•×ª
              const standardChecklist = getChecklistWithFallback(hotelDoc);
      
              // 1. ×©××™×¨×ª ×ª×§×œ×•×ª (Maintenance) - ×œ× × ×•×’×¢×™× ×‘×”×Ÿ!
              const existingMaintenance = room.tasks.filter(t => t.type === 'maintenance' && !t.isCompleted);
      
              // 2. ×™×¦×™×¨×ª ××©×™××•×ª ×¡×˜× ×“×¨×˜ (×œ×¤×™ ×¡×•×’ ×”×¤×¢×•×œ×”)
              const newStandardTasks = standardChecklist.map(t => ({
                  ...t,
                  // ×× ×–×” Stayover, ××•×œ×™ × ×¨×¦×” ×œ×¡××Ÿ ××©×”×• ××—×¨? ×›×¨×’×¢ × ×˜×¢×Ÿ ××ª ×”×¡×˜× ×“×¨×˜
                  isCompleted: false,
                   createdAt: new Date()
              }));
      
              // 3. ×™×¦×™×¨×ª ××©×™××” ××”×”×¢×¨×” ×”×™×•××™×ª (×× ×™×©) - ×©×›×‘×” ×‘'
              const dailyTasks = [];
              if (note && note.trim()) {
                  dailyTasks.push({
                      description: note.trim(),
                      type: 'daily',
                      date: endOfDay, // ×ª×•×§×£ ×œ×”×™×•× ×‘×œ×‘×“
                       isCompleted: false,
                      isSystemTask: false,
                      addedBy: req.user._id
                  });
              }
      
              // 4. ×¢×“×›×•×Ÿ ×”×—×“×¨
              // ×©×™× ×œ×‘: ×× ×—× ×• ×“×•×¨×¡×™× ××ª ×”-tasks ×”×§×•×“××™× (×œ××¢×˜ ×ª×§×œ×•×ª)
              room.tasks = [...existingMaintenance, ...dailyTasks, ...newStandardTasks];
              // ×¡×™××•×Ÿ ×›××œ×•×›×œ×š ×›×“×™ ×©×™×•×¤×™×¢ ×‘×¦×‘×¢ ×”××ª××™× ×œ×¢×•×‘×“
              room.status = 'dirty';
              await room.save();
              updatedCount++;
          }
      
          res.json({ message: `×¡×™×“×•×¨ ×”×¢×‘×•×“×” ×”×•×¤×¥ ×‘×”×¦×œ×—×” ×œ-${updatedCount} ×—×“×¨×™×.` });
      });
  ğŸ“„ createAdmin.js
    import mongoose from 'mongoose';
    import dotenv from 'dotenv';
    import bcrypt from 'bcrypt';
    import User from './models/userModel.js';
    
    dotenv.config();
    
    const createAdmin = async () => {
      try {
        await mongoose.connect(process.env.MONGO_URI);
        console.log('âœ… ××—×•×‘×¨ ×œÖ¾MongoDB');
    
        const email = 'yosefdaean@gmail.com';
        const password = '0546205955'; // ×©× ×” ×œ×¡×™×¡××” ×—×–×§×”
        const name = 'Yosef Admin';   // âœ¨ ×”×•×¡×¤× ×• ××ª ×©× ×”×× ×”×œ
    
        const existing = await User.findOne({ email });
    
        if (existing) {
          console.log('âš ï¸ ××©×ª××© ×× ×”×œ ×›×‘×¨ ×§×™×™×');
          return process.exit(0);
        }
    
        const hashedPassword = await bcrypt.hash(password, 12);
    
        await User.create({
          name, // âœ¨ ×”×©×“×” ×”×—×“×© ×•×”× ×“×¨×©
          email,
          passwordHash: hashedPassword, // âœ¨ ×ª×™×§× ×• ××ª ×©× ×”×©×“×” ×œ-passwordHash
          role: 'admin',
        });
    
        console.log(`ğŸ‰ × ×•×¦×¨ ××©×ª××© ×× ×”×œ: ${email}`);
        process.exit(0);
      } catch (err) {
        console.error('âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×× ×”×œ:', err);
        process.exit(1);
      }
    };
    
    createAdmin();
  ğŸ“ credentials/
    ğŸ“„ ca3.json
  ğŸ“ cron/
  ğŸ“„ import-script.js
    import mongoose from 'mongoose';
    import sqlite3 from 'sqlite3';
    import dotenv from 'dotenv';
    
    // ×˜×¢×™× ×ª ×”××•×“×œ×™× ×××¡×“ ×”× ×ª×•× ×™× ×”×—×“×©
    import User from './models/userModel.js';
    import Transaction from './models/Transaction.js';
    import FinanceProfile from './models/FinanceProfile.js';
    
    dotenv.config();
    
    // ===================================================================
    // --- âš™ï¸ ×”×’×“×¨×•×ª: ×©× ×” ××ª 3 ×”×¢×¨×›×™× ×”×‘××™× ---
    // ===================================================================
    
    // 1. ×›×ª×•×‘×ª ×”×—×™×‘×•×¨ ×œ××¡×“ ×”× ×ª×•× ×™× ×”×—×“×© (MongoDB)
    const MONGO_URI = process.env.MONGO_URI || 'mongodb://localhost:27017/your_db_name';
    
    // 2. ×”× ×ª×™×‘ ×”××œ× ×œ×§×•×‘×¥ ××¡×“ ×”× ×ª×•× ×™× ×”×™×©×Ÿ (SQLite)
    const SQLITE_DB_PATH = 'C:/path/to/your/fin3an3ce.db'; // <-- ×©× ×” ×œ× ×ª×™×‘ ×”××“×•×™×§ ×©×œ×š!
    
    // 3. ×›×ª×•×‘×ª ×”××™××™×™×œ ×©×œ ×”××©×ª××© ×‘××ª×¨ ×©××œ×™×• ××ª×” ×¨×•×¦×” ×œ×™×™×‘× ××ª ×”× ×ª×•× ×™×
    const USER_EMAIL = 'your-email@example.com'; // <-- ×©× ×” ×œ××™××™×™×œ ×©×œ×š!
    
    // ===================================================================
    
    const accountMapper = (oldAccountName) => {
      if (!oldAccountName) return 'checking';
      const name = oldAccountName.toLowerCase();
      if (name.includes('×¢×•"×©') || name.includes('checking')) return 'checking';
      if (name.includes('××–×•××Ÿ') || name.includes('cash')) return 'cash';
      return 'checking'; // ×‘×¨×™×¨×ª ××—×“×œ
    };
    
    const runImport = async () => {
      console.log('--- ××ª×—×™×œ ×¡×§×¨×™×¤×˜ ×™×™×‘×•× ×—×“-×¤×¢××™ ---');
    
      // ×”×ª×—×‘×¨×•×ª ×œ-MongoDB
      try {
        await mongoose.connect(MONGO_URI);
        console.log('âœ… ×”×ª×—×‘×¨×•×ª ×œ-MongoDB ×”×¦×œ×™×—×”.');
      } catch (error) {
        console.error('âŒ ×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª ×œ-MongoDB:', error.message);
        return;
      }
    
      // ××¦×™××ª ×”××©×ª××© ×‘-MongoDB
      const user = await User.findOne({ email: USER_EMAIL });
      if (!user) {
        console.error(`âŒ ×œ× × ××¦× ××©×ª××© ×¢× ×”××™××™×™×œ: ${USER_EMAIL}`);
        await mongoose.disconnect();
        return;
      }
      console.log(`âœ… × ××¦× ××©×ª××©: ${user.name} (${user._id})`);
    
      // ×§×¨×™××ª ×”× ×ª×•× ×™× ×-SQLite
      const db = new sqlite3.Database(SQLITE_DB_PATH, sqlite3.OPEN_READONLY, (err) => {
        if (err) return console.error('âŒ ×©×’×™××” ×‘×¤×ª×™×—×ª ×§×•×‘×¥ SQLite:', err.message);
      });
    
      console.log('ğŸ“– ×§×•×¨× × ×ª×•× ×™× ××§×•×‘×¥ SQLite...');
      db.all("SELECT date, description, amount, type, category, account FROM transactions", [], async (err, rows) => {
        if (err) {
          console.error('âŒ ×©×’×™××” ×‘×§×¨×™××ª ×˜×‘×œ×ª ×”×¢×¡×§××•×ª:', err.message);
          db.close();
          await mongoose.disconnect();
          return;
        }
        console.log(`ğŸ“Š × ××¦××• ${rows.length} ×¢×¡×§××•×ª ×‘×§×•×‘×¥ ×”×™×©×Ÿ.`);
        db.close();
    
        // ×¢×™×‘×•×“ ×•×”×›× ×ª ×”× ×ª×•× ×™× ×œ×”×›× ×¡×”
        const transactionsToInsert = rows.map(row => ({
          user: user._id,
          date: new Date(row.date),
          description: row.description || '×œ×œ× ×ª×™××•×¨',
          amount: Math.abs(Number(row.amount)) || 0,
          type: row.type === 'expense' || row.type === '×”×•×¦××”' ? '×”×•×¦××”' : '×”×›× ×¡×”',
          category: row.category || '×›×œ×œ×™',
          account: accountMapper(row.account),
        }));
    
        try {
          // ×‘×™×¦×•×¢ ×¤×¢×•×œ×•×ª ×‘-MongoDB
          console.log('ğŸ—‘ï¸ ××•×—×§ ×¢×¡×§××•×ª ×§×™×™××•×ª ×¢×‘×•×¨ ×”××©×ª××©...');
          await Transaction.deleteMany({ user: user._id });
    
          console.log(`â• ××›× ×™×¡ ${transactionsToInsert.length} ×¢×¡×§××•×ª ×—×“×©×•×ª...`);
          await Transaction.insertMany(transactionsToInsert);
    
          console.log('ğŸ§® ××—×©×‘ ××—×“×© ×™×ª×¨×•×ª ×‘×—×©×‘×•× ×•×ª...');
          const aggregation = await Transaction.aggregate([
            { $match: { user: user._id } },
            { $group: {
                _id: '$account',
                total: { $sum: { $cond: [{ $eq: ['$type', '×”×›× ×¡×”'] }, '$amount', { $multiply: ['$amount', -1] }] } }
            }}
          ]);
    
          const newBalances = { checking: 0, cash: 0, deposits: 0, stocks: 0 };
          aggregation.forEach(item => {
            if (newBalances.hasOwnProperty(item._id)) newBalances[item._id] = item.total;
          });
    
          await FinanceProfile.updateOne({ user: user._id }, { $set: newBalances }, { upsert: true });
          console.log('ğŸ”„ ×”×™×ª×¨×•×ª ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”.');
    
          console.log('\nğŸ‰ğŸ‰ğŸ‰ ×”×™×™×‘×•× ×”×•×©×œ× ×‘×”×¦×œ×—×”! ğŸ‰ğŸ‰ğŸ‰');
    
        } catch (dbError) {
          console.error('âŒ ×©×’×™××” ×§×¨×™×˜×™×ª ×‘××”×œ×š ×”×›×ª×™×‘×” ×œ-MongoDB:', dbError);
        } finally {
          await mongoose.disconnect();
          console.log('ğŸ”š × ×•×ª×§×” ×”×ª×§×©×•×¨×ª ×¢× ××¡×“ ×”× ×ª×•× ×™×.');
        }
      });
    };
    
    runImport();
  ğŸ“ lib/
    ğŸ“„ priceCalc.js
      function calculateSinglePrice({ adults, teens, children, babies }, priceList) {
        const totalGuests = adults + teens + children + babies;
        if (totalGuests === 1) return priceList.single_room || 0;
      
        let total = priceList.couple || 0;
        const extraAdults = Math.max(0, adults - 2);
        total += extraAdults * (priceList.teen || 0);
        total += (teens || 0) * (priceList.teen || 0);
        total += (children || 0) * (priceList.child || 0);
        total += (babies || 0) * (priceList.baby || 0);
        return total;
      }
      
      function calculateMultiPrice(room, priceListsByName, selectedNames) {
        return selectedNames.reduce((sum, name) => {
          const pl = priceListsByName[name];
          return sum + (pl ? calculateSinglePrice(room, pl) : 0);
        }, 0);
      }
      
      module.exports = { calculateSinglePrice, calculateMultiPrice };
    ğŸ“„ priceCalculator.js
      // server/lib/priceCalculator.js (×•×’× ×‘-client/src/lib)
      
      // ×”×™×¨×¨×›×™×™×ª ××—×™×¨×™×: ××™ × ×—×©×‘ "×™×§×¨" ×™×•×ª×¨ ×‘×—×“×¨
      const guestHierarchy = {
        adult: { priceKey: 'teen', order: 1 },
        teen: { priceKey: 'teen', order: 2 },
        child: { priceKey: 'child', order: 3 },
      };
      
      /**
       * ××—×©×‘ ××—×™×¨ ×‘×¡×™×¡ *×œ×œ×™×œ×” ××—×“* ×¢×‘×•×¨ ×”×¨×›×‘ ××•×¨×—×™× ×•××—×™×¨×•×Ÿ ×¡×¤×¦×™×¤×™.
       * (×¤×•× ×§×¦×™×” ×¤× ×™××™×ª)
       */
      export function calculateSingleNightBasePrice(room, priceList) {
        const { adults = 0, teens = 0, children = 0, babies = 0 } = room;
      
        // 1. ×ª×™× ×•×§×•×ª: ×ª×•×¡×¤×ª ×§×‘×•×¢×” (×œ×œ×™×œ×”)
        const babyCost = babies * (priceList.baby || 0);
      
        // 2. ×§×‘×•×¦×” ×¢×™×§×¨×™×ª (×œ×œ× ×ª×™× ×•×§×•×ª)
        const mainGroupSize = adults + teens + children;
        let mainGroupPrice = 0;
      
        if (mainGroupSize === 0) {
          mainGroupPrice = 0;
        } else if (mainGroupSize === 1) {
          // ××—×™×¨ ×™×—×™×“ ×‘×—×“×¨
          mainGroupPrice = priceList.single_room || 0;
        } else {
          // ×–×•×’ ×•××¢×œ×”
          // ×××™×™× ×™× ×›×“×™ ×©×©× ×™ ×”"×™×§×¨×™×" ×‘×™×•×ª×¨ ×™×ª×¤×¡×• ××ª ××—×™×¨ ×”"×–×•×’"
          const guests = [
            ...Array(adults).fill('adult'),
            ...Array(teens).fill('teen'),
            ...Array(children).fill('child'),
          ];
      
          guests.sort((a, b) => guestHierarchy[a].order - guestHierarchy[b].order);
      
          // ××—×™×¨ ×”×‘×¡×™×¡ ×œ×–×•×’
          mainGroupPrice = priceList.couple || 0;
      
          // ×ª×•×¡×¤×•×ª ×¢×‘×•×¨ ×›×œ ××“× ××¢×‘×¨ ×œ×–×•×’ (×”×—×œ ××”××“× ×”×©×œ×™×©×™)
          for (let i = 2; i < guests.length; i++) {
            const guestType = guests[i];
            const priceKey = guestHierarchy[guestType].priceKey;
            mainGroupPrice += (priceList[priceKey] || 0);
          }
        }
      
        return mainGroupPrice + babyCost;
      }
      
      /**
       * ×”×¤×•× ×§×¦×™×” ×”×¨××©×™×ª ×œ×—×™×©×•×‘ ××—×™×¨ ×—×“×¨.
       * ××©×§×œ×œ×ª: ××—×™×¨×•× ×™× × ×‘×—×¨×™× + ×ª×•×¡×¤×ª ×¡×•×’ ×—×“×¨ + ××¡×¤×¨ ×œ×™×œ×•×ª.
       * * @param {Object} room - ××•×‘×™×™×§×˜ ×”×—×“×¨ (×›××•×™×•×ª ××•×¨×—×™×)
       * @param {Object} allPriceLists - ××¤×” ×©×œ ×›×œ ×”××—×™×¨×•× ×™× ×”×–××™× ×™×
       * @param {Array} selectedNames - ××¢×¨×š ×©××•×ª ×”××—×™×¨×•× ×™× ×©× ×‘×—×¨×• ×œ×—×“×¨ ×–×”
       * @param {Number} nights - ××¡×¤×¨ ×”×œ×™×œ×•×ª (×‘×¨×™×¨×ª ××—×“×œ 1)
       * @param {Number} roomSupplementPerNight - ×ª×•×¡×¤×ª ×©×§×œ×™×ª ×œ×œ×™×œ×” ×¢×‘×•×¨ ×¡×•×’ ×”×—×“×¨ (×‘×¨×™×¨×ª ××—×“×œ 0)
       */
      export function calculateRoomTotalPrice(room, allPriceLists, selectedNames, nights = 1, roomSupplementPerNight = 0) {
          if (!allPriceLists || !selectedNames || selectedNames.length === 0) {
              return 0;
          }
      
          let totalBasePricePerNight = 0;
      
          // ×¡×™×›×•× ×”××—×™×¨×™× ××›×œ ×”××—×™×¨×•× ×™× ×©× ×‘×—×¨×• (×œ×œ×™×œ×” ××—×“)
          for (const name of selectedNames) {
              const priceList = allPriceLists[name];
              if (priceList) {
                  totalBasePricePerNight += calculateSingleNightBasePrice(room, priceList);
              }
          }
      
          // ×”××—×™×¨ ×”×¡×•×¤×™ ×œ×œ×™×œ×” = (××—×™×¨ ××—×™×¨×•× ×™×) + (×ª×•×¡×¤×ª ×¡×•×’ ×—×“×¨)
          const finalPricePerNight = totalBasePricePerNight + roomSupplementPerNight;
      
          // ×”×›×¤×œ×” ×‘××¡×¤×¨ ×”×œ×™×œ×•×ª
          return finalPricePerNight * nights;
      }
  ğŸ“ middlewares/
    ğŸ“„ authMiddleware.js
      import jwt from 'jsonwebtoken';
      import User from '../models/userModel.js';
      
      /**
       * ××•×•×“× ×©×”××©×ª××© ××—×•×‘×¨ (×™×© ×˜×•×§×Ÿ ×ª×§×™×Ÿ).
       * ××•×¡×™×£ ××ª ××•×‘×™×™×§×˜ ×”××©×ª××© ×œ-req.user.
       */
      export const requireAuth = async (req, res, next) => {
        const token = req.cookies.jwt;
        if (!token) {
          return res.status(401).json({ message: '×œ× ××—×•×‘×¨' });
        }
      
        try {
          const decoded = jwt.verify(token, process.env.JWT_ACCESS_SECRET);
          // ×©×œ×™×¤×ª ×”××©×ª××© ××”-DB
          const user = await User.findById(decoded.id).select('-passwordHash');
          if (!user) {
            return res.status(401).json({ message: '××©×ª××© ×œ× × ××¦×' });
          }
      
          req.user = user;
          next();
        } catch (err) {
          return res.status(401).json({ message: '×˜×•×§×Ÿ ×œ× ×—×•×§×™ / ×¤×’ ×ª×•×§×£' });
        }
      };
      
      /**
       * ×”×¨×©××ª ×× ×”×œ ×‘×œ×‘×“.
       */
      export const requireAdmin = (req, res, next) => {
        if (req.user?.role !== 'admin') {
          return res.status(403).json({ message: '×’×™×©×” × ×“×—×ª×”: ×”×¨×©××ª ×× ×”×œ × ×“×¨×©×ª' });
        }
        next();
      };
      
      /**
       * âœ¨ ×—×“×©: ×”×¨×©××ª ××›×™×¨×•×ª (××• ×× ×”×œ).
       * ×××¤×©×¨ ×’×™×©×” ×œ: Admin, Sales.
       * ×—×•×¡× ×’×™×©×” ×œ: Maintenance.
       */
      export const requireSales = (req, res, next) => {
        const allowedRoles = ['admin', 'sales'];
        if (!allowedRoles.includes(req.user?.role)) {
          return res.status(403).json({ message: '×’×™×©×” × ×“×—×ª×”: ××–×•×¨ ×–×” ××™×•×¢×“ ×œ×× ×©×™ ××›×™×¨×•×ª ×‘×œ×‘×“' });
        }
        next();
      };
      
      /**
       * âœ¨ ×—×“×©: ×”×¨×©××ª ××—×–×§×”/× ×§×™×•×Ÿ (××• ×× ×”×œ).
       * ×××¤×©×¨ ×’×™×©×” ×œ: Admin, Maintenance.
       * ×—×•×¡× ×’×™×©×” ×œ: Sales.
       */
      export const requireMaintenance = (req, res, next) => {
        const allowedRoles = ['admin', 'maintenance'];
        if (!allowedRoles.includes(req.user?.role)) {
          return res.status(403).json({ message: '×’×™×©×” × ×“×—×ª×”: ××–×•×¨ ×–×” ××™×•×¢×“ ×œ×¦×•×•×ª ××—×–×§×” ×‘×œ×‘×“' });
        }
        next();
      };
    ğŸ“„ errorHandler.js
      // Global error handler
      export const errorHandler = (err, req, res, next) => {
        console.error("ğŸ’¥ ERROR:", err);
      
        if (err.code === 'EBADCSRFTOKEN') {
          return res.status(403).json({ message: 'Invalid or missing CSRF token.' });
        }
      
        err.statusCode = err.statusCode || 500;
        err.status = err.status || 'error';
        err.message = err.message || 'Something went very wrong!';
      
        res.status(err.statusCode).json({
          status: err.status,
          message: err.message,
          ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),
        });
      };
      
      // Wrapper for async route handlers to catch errors and pass them to the global handler
      export const catchAsync = fn => {
        return (req, res, next) => {
          fn(req, res, next).catch(next);
        };
      };
    ğŸ“„ rateLimiter.js
      import rateLimit from 'express-rate-limit';
      
      const isDev = process.env.NODE_ENV !== 'production';
      
      /* Limiter ×›×œ×œ×™ */
      export const publicLimiter = isDev
        ? (_req, _res, next) => next()
        : rateLimit({
            windowMs: 10 * 60 * 1000,
            max: 100,
            standardHeaders: true,
            legacyHeaders: false,
          });
      
      /* Limiter ×œ-/api/products */
      export const productsLimiter = isDev
        ? (_req, _res, next) => next()
        : rateLimit({
            windowMs: 10 * 60 * 1000,
            max: 300,
            standardHeaders: true,
            legacyHeaders: false,
          });
      
      /* ×‘×¨×™×¨×ª-××—×“×œ */
      export default publicLimiter;
    ğŸ“„ requireAdmin.js
      import jwt from 'jsonwebtoken';
      
      export default function requireAdmin(req, res, next) {
        const token = req.cookies.token;
        if (!token) return res.status(401).json({ message: '×œ× ××—×•×‘×¨' });
      
        try {
          const decoded = jwt.verify(token, process.env.JWT_SECRET);
          if (decoded.role !== 'admin')
            return res.status(403).json({ message: '×”×¨×©××ª ×× ×”×œ × ×“×¨×©×ª' });
      
          req.user = decoded;
          next();
        } catch {
          return res.status(401).json({ message: '×˜×•×§×Ÿ ×œ× ×ª×§×£/×¤×’' });
        }
      }
    ğŸ“„ requireAuth.js
      import jwt from 'jsonwebtoken';
      import User from '../models/userModel.js';
      
      export default async function requireAuth(req, res, next) {
        try {
          const token = req.cookies?.jwt;
          if (!token) {
            return res.status(401).json({ msg: 'Unauthorized: No token provided' });
          }
      
          const decoded = jwt.verify(token, process.env.JWT_ACCESS_SECRET);
      
          const user = await User.findById(decoded.id).select('-passwordHash');
          if (!user) {
            return res.status(401).json({ msg: 'Unauthorized: User not found' });
          }
      
          req.user = user;
          next();
        } catch (error) {
          // ×©×œ×— ×‘×—×–×¨×” ××ª ×”×•×“×¢×ª ×”×©×’×™××” ×”××“×•×™×§×ª ××”×¡×¤×¨×™×™×” ×œ×¦×•×¨×š ××‘×—×•×Ÿ
          return res.status(401).json({ msg: `Unauthorized: ${error.message}` });
        }
      }
    ğŸ“„ requireRefresh.js
      import jwt from "jsonwebtoken";
      import User from "../models/userModel.js";
      
      export default async function requireRefresh(req, res, next) {
        const token = req.cookies?.refreshToken;
        if (!token) return res.status(401).json({ message: "No refresh-token" });
      
        try {
          const { id } = jwt.verify(token, process.env.REFRESH_SECRET); // â† ××•×ª×• ×¡×•×“
          const user = await User.findById(id).select("-passwordHash");
          if (!user) return res.status(401).json({ message: "User not found" });
      
          req.user = user;
          next();
        } catch (err) {                                // â† ×—×™×™×‘ ×œ×§×‘×œ err
          console.log("âŒ verify refresh failed:", err.message);
          res.status(401).json({ message: "Invalid or expired refresh-token" });
        }
      }
  ğŸ“ models/
    ğŸ“„ Account.js
      // server/models/Account.js
      import mongoose from 'mongoose';
      
      const accountSchema = new mongoose.Schema(
        {
          userId:  { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
          name:    { type: String, required: true },
          balance: { type: Number, default: 0 },
        },
        { timestamps: true }
      );
      
      const Account = mongoose.model('Account', accountSchema);
      
      /* ×™×¦×•× ×›×¤×•×œ â€” ×œ×©× ×™ ×”×¢×•×œ××•×ª */
      export default Account;          // ES-Modules
      export { Account };              // ×™×™×‘×•× ×©××™ ×× ×ª×¨×¦×”
      // CommonJS fallback (×× ×§×•×“ ×™×©×Ÿ ×“×•×¨×©):
      // eslint-disable-next-line no-undef
      if (typeof module !== 'undefined') module.exports = Account;
    ğŸ“„ Announcement.js
      // server/models/Announcement.js
      import mongoose from 'mongoose';
      
      const announcementSchema = new mongoose.Schema({
        title: {
          type: String,
          required: true,
          trim: true
        },
        content: {
          type: String,
          required: true
        },
        // ×œ××™ ×”×”×•×“×¢×” ××™×•×¢×“×ª?
        target: {
          type: String,
          enum: ['all', 'user'],
          default: 'all'
        },
        // ×¨×œ×•×•× ×˜×™ ×¨×§ ×× target === 'user'
        targetUser: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'User',
          required: function() { return this.target === 'user'; }
        },
        // ×©× ×”×× ×”×œ ×©×™×¦×¨ ××ª ×”×”×•×“×¢×”
        authorName: {
          type: String,
          required: true
        },
        // ×ª××¨×™×š ×ª×¤×•×’×” (×× ×§×™×™×)
        expiresAt: {
          type: Date,
          default: null
        }
      }, {
        timestamps: true
      });
      
      // ××™× ×“×§×¡ TTL: ××•× ×’×• ×™××—×§ ××•×˜×•××˜×™×ª ××¡××›×™× ×‘×¨×’×¢ ×©×™×¢×‘×•×¨ ×”×–××Ÿ ×‘-expiresAt.
      // ×–×” ×¢×•×‘×“ ×¨×§ ×× expiresAt ×”×•× ×ª××¨×™×š (×œ× null).
      announcementSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 });
      
      export default mongoose.model('Announcement', announcementSchema);
    ğŸ“„ Category.js
      import mongoose from 'mongoose';
      
      const categorySchema = new mongoose.Schema({
        // ×”×¡×¨× ×• ××ª ×©×“×” ×”××©×ª××©
        name: {
          type: String,
          required: true,
          trim: true,
          unique: true, // ×©× ×”×§×˜×’×•×¨×™×” ×—×™×™×‘ ×œ×”×™×•×ª ×™×™×—×•×“×™ ×‘×›×œ ×”××¢×¨×›×ª
        },
        type: {
          type: String,
          enum: ['×”×•×¦××”', '×”×›× ×¡×”', '×›×œ×œ×™'],
          default: '×”×•×¦××”',
        },
      }, {
        timestamps: true,
      });
      
      export default mongoose.model('Category', categorySchema);
    ğŸ“„ CategoryRule.js
      import mongoose from 'mongoose';
      
      const categoryRuleSchema = new mongoose.Schema({
        // ××™×œ×ª ×”××¤×ª×— ×œ×—×™×¤×•×© ×‘×©× ×”×¡×¤×§, ×œ××©×œ "×¡×•×¤×¨", "×“×œ×§", "AMZN"
        keyword: {
          type: String,
          required: true,
          trim: true,
          unique: true, // ×›×œ ××™×œ×ª ××¤×ª×— ×”×™× ×™×™×—×•×“×™×ª
        },
        // ×”×§×™×©×•×¨ ×œ×§×˜×’×•×¨×™×” ×©××œ×™×” ×™×© ×œ×©×™×™×š ××ª ×”×¢×¡×§×” ×× × ××¦××” ××™×œ×ª ×”××¤×ª×—
        category: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'Category',
          required: true,
        },
        // × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×¢×“×™×¤×•×ª ×‘×¢×ª×™×“, ×›×“×™ ×œ×˜×¤×œ ×‘××§×¨×™× ×©××¡×¤×¨ ×—×•×§×™× ××ª××™××™×
        // priority: { type: Number, default: 0 }
      }, {
        timestamps: true,
      });
      
      export default mongoose.model('CategoryRule', categoryRuleSchema);
    ğŸ“„ Counter.js
      import mongoose from 'mongoose';
      
      const counterSchema = new mongoose.Schema({
        _id: { type: String, required: true },
        sequence_value: { type: Number, default: 0 }
      });
      
      const Counter = mongoose.model('Counter', counterSchema);
      
      // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×§×‘×œ×ª ×”××¡×¤×¨ ×”×‘× ×‘×¡×“×¨×”
      export async function getNextSequenceValue(sequenceName) {
        const sequenceDocument = await Counter.findByIdAndUpdate(
          sequenceName,
          { $inc: { sequence_value: 1 } },
          { new: true, upsert: true } // new:true ××—×–×™×¨ ××ª ×”××¡××š ×”××¢×•×“×›×Ÿ, upsert:true ×™×•×¦×¨ ××•×ª×• ×× ×œ× ×§×™×™×
        );
        return sequenceDocument.sequence_value;
      }
    ğŸ“„ DataRecordModel.js
      import mongoose from "mongoose";
      
      const dataRecordSchema = new mongoose.Schema(
        {
          // ×¢×¨×š ××¡×¤×¨×™ 3: ××–×”×” ×”××©×ª××© ×©×©×œ×— ××ª ×”× ×ª×•× ×™×
          user: {
            type: mongoose.Schema.Types.ObjectId,
            required: true,
            ref: "User", // ×§×™×©×•×¨ ×œ××•×“×œ ×”××©×ª××© ×©×œ×š
          },
          // ×¢×¨×š ××¡×¤×¨×™ 1: ××”×œ×§×•×—
          value1: {
            type: Number,
            required: true,
          },
          // ×¢×¨×š ××¡×¤×¨×™ 2: ××”×œ×§×•×—
          value2: {
            type: Number,
            required: true,
          },
        },
        {
          // ×¢×¨×š ××¡×¤×¨×™ 4: ×—×•×ª××ª ×–××Ÿ ××•×˜×•××˜×™×ª ×©×œ ××•× ×’×•
          timestamps: true, // ××•×¡×™×£ createdAt ×•-updatedAt
        }
      );
      
      export default mongoose.model("DataRecord", dataRecordSchema);
    ğŸ“„ Deposit.js
      // server/models/Deposit.js
      import mongoose from 'mongoose';
      
      const depositSchema = new mongoose.Schema({
        user: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true, index: true },
        name: { type: String, required: true, trim: true },
        principal: { type: Number, required: true, min: 0 },
        annualInterestRate: { type: Number, required: true, min: 0 },
        startDate: { type: Date, required: true },
        endDate: { type: Date, required: true },
        status: {
          type: String,
          enum: ['active', 'broken', 'matured'],
          default: 'active'
        },
        sourceAccount: { type: String, trim: true },
        // --- ×”×•×¡×¤×” ---
        exitPoints: {
          type: [Date], // ×”×’×“×¨×” ×›×©×“×” ××¡×•×’ ××¢×¨×š ×©×œ ×ª××¨×™×›×™×
          default: []   // ×¢×¨×š ×‘×¨×™×¨×ª ××—×“×œ ×”×•× ××¢×¨×š ×¨×™×§
        }
        // --- ×¡×•×£ ×”×•×¡×¤×” ---
      }, {
        timestamps: true,
        toJSON: { virtuals: true },
        toObject: { virtuals: true }
      });
      
      depositSchema.virtual('futureValue').get(function() {
        const years = (this.endDate.getTime() - this.startDate.getTime()) / (1000 * 60 * 60 * 24 * 365.25);
        return this.principal * (1 + (this.annualInterestRate / 100) * years);
      });
      
      export default mongoose.model('Deposit', depositSchema);
    ğŸ“„ ExtraType.js
      // server/models/ExtraType.js
      import mongoose from 'mongoose';
      
      const extraTypeSchema = new mongoose.Schema({
        name: {
          type: String,
          required: true,
          unique: true,
          trim: true
        },
        // ××¤×©×¨ ×œ×”×•×¡×™×£ ××—×™×¨ ×‘×¨×™×¨×ª ××—×“×œ ×× ×ª×¨×¦×” ×‘×¢×ª×™×“, ×›×¨×’×¢ ×‘×™×§×©×ª ×©×”××—×™×¨ ×™×”×™×” ×©×¨×™×¨×•×ª×™
      }, { timestamps: true });
      
      export default mongoose.model('ExtraType', extraTypeSchema);
    ğŸ“„ FinanceProfile.js
      import mongoose from 'mongoose';
      
      const financeProfileSchema = new mongoose.Schema({
        // ×§×™×©×•×¨ ×™×™×—×•×“×™ ×œ××©×ª××© (××—×“ ×¢×œ ××—×“)
        user: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'User', // ×•×“× ×©×–×” ×©× ××•×“×œ ×”××©×ª××© ×©×œ×š
          required: true,
          unique: true, // ××‘×˜×™×— ×©×œ×›×œ ××©×ª××© ×™×”×™×” ×¨×§ ×¤×¨×•×¤×™×œ ××—×“
        },
        checking: { // ×¢×•"×©
          type: Number,
          default: 0,
        },
        cash: { // ××–×•××Ÿ
          type: Number,
          default: 0,
        },
        deposits: { // ×¤×§×“×•× ×•×ª
          type: Number,
          default: 0,
        },
        stocks: { // ×× ×™×•×ª ×•×§×¨× ×•×ª
          type: Number,
          default: 0,
        },
      }, {
        timestamps: true, // ××•×¡×™×£ ××•×˜×•××˜×™×ª ×ª××¨×™×š ×™×¦×™×¨×” ×•×¢×“×›×•×Ÿ
      });
      
      export default mongoose.model('FinanceProfile', financeProfileSchema);
    ğŸ“„ Fund.js
      import mongoose from 'mongoose';
      
      const fundSchema = new mongoose.Schema(
        {
          user: {
            type: mongoose.Schema.Types.ObjectId,
            ref: 'User',
            required: true,
            index: true,
          },
          fund_number: {
            type: String,
            required: true,
            trim: true,
          },
          purchase_price: {
            type: Number,
            required: true,
          },
          invested_amount: {
            type: Number,
            required: true,
          },
          current_price: {
            type: Number,
            default: 0,
          },
          last_updated: {
            type: Date,
          },
        },
        {
          timestamps: true,
          toJSON: { virtuals: true },
          toObject: { virtuals: true },
        }
      );
      
      // Virtual properties ×œ×—×™×©×•×‘×™× ×“×™× ××™×™×, ×‘×“×•××” ×œ×§×•×“ ×”×¤×™×™×ª×•×Ÿ
      fundSchema.virtual('units').get(function () {
        if (this.purchase_price > 0) {
          return this.invested_amount / this.purchase_price;
        }
        return 0;
      });
      
      fundSchema.virtual('current_value').get(function () {
        return this.units * this.current_price;
      });
      
      fundSchema.virtual('profit').get(function () {
        return (this.current_price - this.purchase_price) * this.units;
      });
      
      export default mongoose.model('Fund', fundSchema);
    ğŸ“„ Hotel.js
      import mongoose from 'mongoose';
      
      const hotelSchema = new mongoose.Schema({
        name: {
          type: String,
          required: [true, '×©× ×”××œ×•×Ÿ ×”×•× ×©×“×” ×—×•×‘×”'],
          unique: true,
          trim: true,
        },
      
        // âœ¨ ×©×›×‘×” ×': ×”×ª×‘× ×™×ª ×”×¨××©×™×ª (×”×’×“×¨×•×ª ×”×× ×”×œ)
        masterChecklist: [{
          text: { type: String, required: true }, // ×ª×•×›×Ÿ ×”××©×™××” (×œ××©×œ: "×”×—×œ×¤×ª ××¦×¢×™×")
          order: { type: Number, default: 0 }     // ×¡×“×¨ ×ª×¦×•×’×”
        }],
      
        // ×©×“×” legacy (× ×©××¨ ×œ×ª××™×›×” ×œ××—×•×¨ ×‘××™×“×ª ×”×¦×•×¨×š)
        defaultTasks: [String]
      }, { timestamps: true });
      
      const Hotel = mongoose.models.Hotel || mongoose.model('Hotel', hotelSchema);
      
      export default Hotel;
    ğŸ“„ InboundEmail.js
      import mongoose from 'mongoose';
      
      const inboundEmailSchema = new mongoose.Schema(
        {
          from: { type: String, required: true, trim: true },
          type: { type: String, required: true, trim: true },
          body: { type: String, trim: true },
          receivedAt: { type: Date, default: Date.now, index: true },
      
          status: {
            type: String,
            enum: ['new', 'processed', 'closed', 'in_progress', 'not_relevant', 'converted'],
            default: 'new',
            index: true,
          },
          rejectionReason: { type: String, trim: true, default: null },
          parsedName: { type: String, trim: true },
          parsedPhone: { type: String, trim: true },
          parsedNote: { type: String, trim: true }, // ×”××•×›×¨ ×¨×•××” ×¨×§ ××ª ×–×”
          conversationLink: { type: String, trim: true },
      
          // ğŸ”¥ ×©×“×” × ×¡×ª×¨ (××™× ×“×§×¡ ×œ×‘×™×¦×•×¢×™× ××”×™×¨×™×)
          referrer: { type: String, trim: true, index: true, default: null },
      
          hotel: { type: String, trim: true, default: null },
          handledBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
          internalNotes: { type: String, trim: true }
        },
        { timestamps: true }
      );
      
      export default mongoose.models.InboundEmail || mongoose.model('InboundEmail', inboundEmailSchema);
    ğŸ“„ Loan.js
      import mongoose from 'mongoose';
      
      const loanSchema = new mongoose.Schema(
        {
          user: {
            type: mongoose.Schema.Types.ObjectId,
            ref: 'User',
            required: true,
            index: true,
          },
          name: {
            type: String,
            required: [true, '×©× ×”×”×œ×•×•××” ×”×•× ×©×“×” ×—×•×‘×”'],
            trim: true,
          },
          principal: {
            type: Number,
            required: [true, '×¡×›×•× ×”×§×¨×Ÿ ×”×•× ×©×“×” ×—×•×‘×”'],
          },
          // ×©×“×” ×”×¨×™×‘×™×ª ×©×•× ×” ×›×“×™ ×œ×©××•×¨ ×¨×§ ××ª ×”××¨×•×•×— ××¢×œ ×”×¤×¨×™×™×
          interestMargin: {
            type: Number,
            required: true,
            default: 0,
          },
          termInMonths: {
            type: Number,
            required: [true, '×ª×§×•×¤×ª ×”×”×œ×•×•××” ×‘×—×•×“×©×™× ×”×•× ×©×“×” ×—×•×‘×”'],
          },
          startDate: {
            type: Date,
            required: [true, '×ª××¨×™×š ×ª×—×™×œ×ª ×”×”×œ×•×•××” ×”×•× ×©×“×” ×—×•×‘×”'],
          },
          repaymentType: {
            type: String,
            enum: ['×©×¤×™×¦×¨', '×§×¨×Ÿ ×©×•×•×”'],
            required: true,
          },
          // ----- ×©×“×” ×–×” ××•×¡×¨ -----
          // amortizationSchedule: [paymentSchema],
        },
        {
          timestamps: true,
        }
      );
      
      export default mongoose.model('Loan', loanSchema);
    ğŸ“„ MerchantMap.js
      import mongoose from 'mongoose';
      
      const merchantMapSchema = new mongoose.Schema({
        // ×”×¡×¨× ×• ××ª ×©×“×” ×”××©×ª××©
        originalName: {
          type: String,
          required: true,
          trim: true,
          unique: true, // ×”×©× ×”××§×•×¨×™ ×—×™×™×‘ ×œ×”×™×•×ª ×™×™×—×•×“×™ ×‘×›×œ ×”××¢×¨×›×ª
        },
        newName: {
          type: String,
          required: true,
          trim: true,
        },
        category: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'Category',
          required: false,
        },
      }, {
        timestamps: true,
      });
      
      export default mongoose.model('MerchantMap', merchantMapSchema);
    ğŸ“„ Order.js
      import mongoose from 'mongoose';
      
      const roomSchema = new mongoose.Schema({
          adults: { type: Number, required: true, min: 0 },
          teens: { type: Number, required: true, min: 0 },
          children: { type: Number, required: true, min: 0 },
          babies: { type: Number, required: true, min: 0 },
          price_list_names: [String],
          price: { type: Number, required: true },
          roomType: { type: String, required: true, default: '×¨×’×™×œ' },
          roomSupplement: { type: Number, default: 0, min: 0 },
          notes: { type: String, trim: true }
      }, { _id: false });
      
      const extraSchema = new mongoose.Schema({
          extraType: { type: String, required: true },
          quantity: { type: Number, default: 1, min: 1 },
          price: { type: Number, required: true, min: 0 }
      }, { _id: false });
      
      const orderSchema = new mongoose.Schema(
        {
          orderNumber: { type: Number, unique: true, required: true },
          hotel: { type: mongoose.Schema.Types.ObjectId, ref: 'Hotel', required: true },
          user: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
          salespersonName: { type: String, required: true },
      
          customerName: { type: String, required: true, trim: true },
          customerPhone: { type: String, trim: true },
          customerEmail: { type: String, trim: true, lowercase: true },
          eventDate: { type: Date, default: Date.now },
      
          // âœ¨ ×¡×˜×˜×•×¡×™× ×•×¡×™×‘×ª ×“×—×™×™×”
          status: {
            type: String,
            enum: ['sent', 'placed', 'not_relevant', '×‘×”××ª× ×”', '×‘×•×¦×¢', '×œ× ×¨×œ×•×•× ×˜×™', 'cancelled'],
            default: '×‘×”××ª× ×”',
          },
          rejectionReason: { type: String, trim: true, default: null },
      
          numberOfNights: { type: Number, required: true, default: 1 },
          rooms: [roomSchema],
          extras: [extraSchema],
          discountPercent: { type: Number, default: 0 },
          total_price: { type: Number, required: true },
          notes: { type: String, trim: true },
        },
        { timestamps: true }
      );
      
      export default mongoose.models.Order || mongoose.model('Order', orderSchema);
    ğŸ“„ PriceList.js
      // server/models/PriceList.js
      import mongoose from 'mongoose';
      
      const priceListSchema = new mongoose.Schema({
        name: {
          type: String,
          required: true,
          unique: true,
          trim: true
        },
      
        // --- ×©×“×” ×—×“×© ---
        hotel: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'Hotel',
          required: [true, '×—×•×‘×” ×œ×©×™×™×š ××—×™×¨×•×Ÿ ×œ××œ×•×Ÿ'],
        },
        couple: {
          type: Number,
          default: 0,
          min: 0
        },
        teen: {
          type: Number,
          default: 0,
          min: 0
        },
        child: {
          type: Number,
          default: 0,
          min: 0
        },
        baby: {
          type: Number,
          default: 0,
          min: 0
        },
        single_room: {
          type: Number,
          default: 0,
          min: 0
        },
        // âœ¨ ×ª×•×¡×¤×ª ×§×™×™××ª: ×”×’×‘×œ×ª ××§×¡×™××•× ×œ×™×œ×•×ª âœ¨
        maxNights: {
          type: Number,
          default: 0,
          min: 0
        },
      
        // âœ¨âœ¨ ×ª×•×¡×¤×•×ª ×—×“×©×•×ª ×œ×©×œ×™×˜×” ×‘×ª×¦×•×’×” âœ¨âœ¨
      
        // ×”×× ×”××—×™×¨×•×Ÿ ××•×¦×’ ×œ××•×›×¨ ×‘×“×£ ×”×”×–×× ×”? (×‘×¨×™×¨×ª ××—×“×œ: ×›×Ÿ)
        isVisible: {
          type: Boolean,
          default: true
        },
      
        // ×¡×“×¨ ×ª×¦×•×’×” (× ××•×š = ×¨××©×•×Ÿ, ×’×‘×•×” = ××—×¨×•×Ÿ)
        displayOrder: {
          type: Number,
          default: 0
        },
      
        user: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'User',
          required: true
        }
      }, { timestamps: true });
      
      const PriceList = mongoose.models.PriceList || mongoose.model('PriceList', priceListSchema);
      
      export default PriceList;
    ğŸ“„ Product.js
      // server/models/Product.js
      
      import mongoose from 'mongoose';
      
      const productSchema = new mongoose.Schema(
        {
          name: {
            type: String,
            required: [true, '×©× ××•×¦×¨ ×”×•× ×©×“×” ×—×•×‘×”'],
            trim: true,
          },
          description: {
            type: String,
            trim: true,
          },
          price: {
            type: Number,
            required: [true, '××—×™×¨ ×”×•× ×©×“×” ×—×•×‘×”'],
            min: 0,
          },
          category: {
            type: String,
            enum: ['main_course', 'side_dish', 'salad', 'dessert', 'drink'],
            required: [true, '×§×˜×’×•×¨×™×” ×”×™× ×©×“×” ×—×•×‘×”'],
          },
          kashrut: {
            type: String,
            enum: ['parve', 'dairy', 'meat'],
            default: 'parve',
          },
          unit: {
            type: String,
            default: '×™×—×™×“×”',
            trim: true,
          },
          imageUrl: {
            type: String,
            trim: true,
          },
          isActive: {
            type: Boolean,
            default: true, // ××©××© ×œ××—×™×§×” "×¨×›×”"
          },
        },
        {
          timestamps: true,
          versionKey: false,
        }
      );
      
      // ××•× ×¢ ×©×’×™××•×ª ×§×•××¤×™×œ×¦×™×” ××—×“×© ×‘×¡×‘×™×‘×ª ×¤×™×ª×•×—
      export default mongoose.models.Product || mongoose.model('Product', productSchema);
    ğŸ“„ Project.js
      import mongoose from 'mongoose';
      
      /*
       * Sub-schemas for tasks and funds, embedded within a project.
       */
      const taskSchema = new mongoose.Schema({
        name: { type: String, required: true, trim: true },
        amount: { type: Number, required: true, min: 0 },
        done: { type: Boolean, default: false },
      });
      
      const fundSchema = new mongoose.Schema({
        amount: { type: Number, required: true, min: 0 },
        destination: { type: String, trim: true },
        date: { type: Date, default: Date.now },
      });
      
      /*
       * Main project schema.
       */
      const projectSchema = new mongoose.Schema({
        owner: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true, index: true },
        projectName: { type: String, required: true, trim: true },
        description: { type: String, trim: true },
        projectType: { type: String, required: true, enum: ['goal', 'task'] },
      
        // Fields for "goal" type projects
        targetAmount: {
          type: Number,
          min: 0,
          // Required only if the project type is 'goal'
          required() { return this.projectType === 'goal'; },
        },
        currentAmount: { type: Number, min: 0, default: 0 },
      
        // Embedded documents based on project type
        tasks: [taskSchema],
        funds: [fundSchema],
      
        dueDate: { type: Date },
      }, { timestamps: true });
      
      /**
       * Middleware (pre-save hook) to automatically calculate current and target amounts.
       * This logic runs before any `save()` operation on a project document.
       */
      projectSchema.pre('save', function (next) {
        if (this.projectType === 'goal') {
          // For goal projects, currentAmount is the sum of all funds.
          this.currentAmount = (this.funds || []).reduce((sum, f) => sum + f.amount, 0);
        } else if (this.projectType === 'task') {
          // For task projects, currentAmount is the sum of completed tasks,
          // and targetAmount is the sum of all tasks.
          const doneSum = (this.tasks || []).filter(t => t.done).reduce((sum, t) => sum + t.amount, 0);
          const totalSum = (this.tasks || []).reduce((sum, t) => sum + t.amount, 0);
          this.currentAmount = doneSum;
          this.targetAmount = totalSum;
        }
        next();
      });
      
      export default mongoose.model('Project', projectSchema);
    ğŸ“„ RateHistory.js
      import mongoose from 'mongoose';
      
      const rateHistorySchema = new mongoose.Schema(
        {
          // ×”×ª××¨×™×š ×©××× ×• ×”×¨×™×‘×™×ª ×‘×ª×•×§×£
          date: {
            type: Date,
            required: true,
            unique: true, // ×œ× × ××¤×©×¨ ×©× ×™ ×¢×“×›×•× ×™× ×‘××•×ª×• ×ª××¨×™×š
          },
          // ×©×™×¢×•×¨ ×”×¨×™×‘×™×ª ×‘××—×•×–×™× (×œ××©×œ, 6.25 ×¢×‘×•×¨ 6.25%)
          rate: {
            type: Number,
            required: true,
          },
          indexName: { // ×©× ×”××“×“, ×œ××§×¨×” ×©×ª×¨×¦×” ×œ×”×•×¡×™×£ ××“×“×™× ××—×¨×™× ×‘×¢×ª×™×“
            type: String,
            default: 'prime',
            required: true,
          }
        },
        {
          timestamps: true,
          versionKey: false,
        }
      );
      
      rateHistorySchema.index({ date: -1, indexName: 1 });
      
      export default mongoose.model('RateHistory', rateHistorySchema);
    ğŸ“„ ReferralAlias.js
      import mongoose from 'mongoose';
      
      const referralAliasSchema = new mongoose.Schema({
        originalName: { type: String, required: true, unique: true, trim: true }, // ×”×©× ×”×©×’×•×™/×”×™×©×Ÿ
        targetName: { type: String, required: true, trim: true } // ×”×©× ×”××ª×•×§×Ÿ
      }, { timestamps: true });
      
      export default mongoose.models.ReferralAlias || mongoose.model('ReferralAlias', referralAliasSchema);
    ğŸ“„ ReferrerAlias.js
      import mongoose from 'mongoose';
      
      const referrerAliasSchema = new mongoose.Schema({
        // ×”×©× ×›×¤×™ ×©×”×œ×§×•×— ×›×ª×‘ (×œ××©×œ: "××•×©×™×§×•")
        alias: {
          type: String,
          required: true,
          unique: true,
          trim: true
        },
        // ×”×©× ×”×¨×©××™ ×‘××¢×¨×›×ª (×œ××©×œ: "××©×” ×›×”×Ÿ")
        officialName: {
          type: String,
          required: true,
          trim: true
        }
      }, { timestamps: true });
      
      export default mongoose.model('ReferrerAlias', referrerAliasSchema);
    ğŸ“„ Room.js
      import mongoose from 'mongoose';
      
      const taskSchema = new mongoose.Schema({
        description: { type: String, required: true, trim: true },
        isCompleted: { type: Boolean, default: false },
      
        // âœ¨ ×”×¡×™×•×•×’ ×”×—×“×© ×©×œ 3 ×”×©×›×‘×•×ª
        type: {
          type: String,
          enum: ['standard', 'daily', 'maintenance'],
          default: 'standard'
        },
      
        // ×ª××¨×™×š (×¨×œ×•×•× ×˜×™ ×œ××©×™××•×ª ×™×•××™×•×ª ×›×“×™ ×œ×“×¢×ª ××ª×™ ×œ××—×•×§ ××•×ª×Ÿ)
        date: { type: Date, default: null },
      
        // ××™×“×¢ ×˜×›× ×™
        addedBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
        completedBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
        createdAt: { type: Date, default: Date.now },
      
        // ×©×“×” legacy - ×¢×“×™×™×Ÿ ×›××Ÿ ×›×“×™ ×œ× ×œ×©×‘×•×¨ ×›×œ×•× ××™×™×“×™×ª
        isSystemTask: { type: Boolean, default: false },
      });
      
      const roomSchema = new mongoose.Schema({
        hotel: { type: mongoose.Schema.Types.ObjectId, ref: 'Hotel', required: true, index: true },
        roomNumber: { type: String, required: true, trim: true },
        roomType: { type: mongoose.Schema.Types.ObjectId, ref: 'RoomType', required: true },
      
        status: {
          type: String,
          enum: ['clean', 'dirty', 'maintenance'],
          default: 'dirty',
          index: true
        },
      
        tasks: [taskSchema],
      
        lastCleanedAt: { type: Date },
        lastCleanedBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
        notes: { type: String, trim: true }
      }, { timestamps: true });
      
      // ××•× ×¢ ×™×¦×™×¨×ª ×©× ×™ ×—×“×¨×™× ×¢× ××•×ª×• ××¡×¤×¨ ×‘××•×ª×• ××œ×•×Ÿ
      roomSchema.index({ hotel: 1, roomNumber: 1 }, { unique: true });
      
      export default mongoose.models.Room || mongoose.model('Room', roomSchema);
    ğŸ“„ RoomType.js
      // server/models/RoomType.js
      import mongoose from 'mongoose';
      
      const roomTypeSchema = new mongoose.Schema({
        // ×©×™×•×š ×œ××œ×•×Ÿ ×¡×¤×¦×™×¤×™
        hotel: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'Hotel',
          required: true,
          index: true
        },
        // ×©× ×”×—×“×¨ (×œ××©×œ: "×¨×’×™×œ", "×¡×•×•×™×˜×”", "×—×“×¨ ×’×Ÿ")
        name: {
          type: String,
          required: true,
          trim: true
        },
        // ×ª×•×¡×¤×ª ×ª×©×œ×•× ×‘×©×§×œ×™× *×œ×œ×™×œ×”* (××¢×‘×¨ ×œ××—×™×¨ ×”×‘×¡×™×¡ ×‘××—×™×¨×•×Ÿ)
        supplementPerNight: {
          type: Number,
          default: 0,
          min: 0
        },
        // ×”×× ×–×” ×¡×•×’ ×”×—×“×¨ ×©×™×™×‘×—×¨ ××•×˜×•××˜×™×ª ×›×©×¤×•×ª×—×™× ×”×–×× ×”?
        isDefault: {
          type: Boolean,
          default: false
        }
      }, {
        timestamps: true
      });
      
      // ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª: ×œ× ×™×™×ª×›×Ÿ ××•×ª×• ×©× ×—×“×¨ ×¤×¢××™×™× ×‘××•×ª×• ××œ×•×Ÿ
      roomTypeSchema.index({ hotel: 1, name: 1 }, { unique: true });
      
      export default mongoose.model('RoomType', roomTypeSchema);
    ğŸ“„ Stock.js
      // server/models/Stock.js
      
      import mongoose from 'mongoose';
      
      const stockSchema = new mongoose.Schema(
        {
          user: {
            type: mongoose.Schema.Types.ObjectId,
            ref: 'User',
            required: true,
            index: true,
          },
          ticker: {
            type: String,
            required: true,
            uppercase: true,
            trim: true,
          },
          purchasePrice: {
            type: Number,
            required: true,
          },
          investedAmount: {
            type: Number,
            required: true,
          },
          currentPrice: {
            type: Number,
            default: 0,
          },
          lastUpdated: {
            type: Date,
          },
        },
        {
          timestamps: true,
          toJSON: { virtuals: true },
          toObject: { virtuals: true },
        }
      );
      
      // Virtual property to calculate shares on the fly
      stockSchema.virtual('shares').get(function () {
        if (this.purchasePrice > 0) {
          return this.investedAmount / this.purchasePrice;
        }
        return 0;
      });
      
      // Virtual property for current value in ILS
      stockSchema.virtual('currentValueILS').get(function () {
        const USD_TO_SHEKEL = 3.7; // It's better to manage this rate globally
        return this.shares * this.currentPrice * USD_TO_SHEKEL;
      });
      
      // Virtual property for profit/loss in USD
      stockSchema.virtual('profitUSD').get(function () {
        return (this.currentPrice - this.purchasePrice) * this.shares;
      });
      
      
      export default mongoose.model('Stock', stockSchema);
    ğŸ“„ Subscription.js
      import mongoose from 'mongoose';
      
      const subscriptionSchema = new mongoose.Schema({
        // ×§×™×©×•×¨ ×œ××©×ª××© (××•×¤×¦×™×•× ×œ×™, ×›×“×™ ×œ×“×¢×ª ××™ × ×¨×©×)
        user: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'User',
          default: null
        },
        // ××•×‘×™×™×§×˜ ×”-Push ×©×”×“×¤×“×¤×Ÿ ××™×™×¦×¨
        endpoint: { type: String, required: true, unique: true },
        keys: {
          p256dh: { type: String, required: true },
          auth: { type: String, required: true }
        },
        createdAt: { type: Date, default: Date.now }
      });
      
      export default mongoose.model('Subscription', subscriptionSchema);
    ğŸ“„ Transaction.js
      // server/models/Transaction.js
      import mongoose from 'mongoose';
      
      const transactionSchema = new mongoose.Schema({
        user: {
          type: mongoose.Schema.Types.ObjectId,
          ref: 'User',
          required: true,
        },
        date: {
          type: Date,
          required: true,
        },
        description: {
          type: String,
          default: '',
        },
        // â—€ï¸ --- ×©×“×” ×—×“×© ---
        // ×©×•××¨ ××ª ×”×©× ×”××§×•×¨×™ ×”×’×•×œ××™ ×›×¤×™ ×©×”×•×¤×™×¢ ×‘×§×•×‘×¥ ×”×™×™×‘×•×
        rawDescription: {
          type: String,
          default: '',
        },
        // --- ×¡×•×£ ---
        amount: {
          type: Number,
          required: true,
        },
        type: {
          type: String,
          enum: ['×”×•×¦××”', '×”×›× ×¡×”'],
          required: true,
        },
        category: {
          type: String,
          default: '×›×œ×œ×™',
        },
        account: {
          type: String,
          enum: ['checking', 'cash', 'deposits', 'stocks'],
          required: true,
        }
      }, {
        timestamps: true,
      });
      
      transactionSchema.index({ user: 1, date: 1, description: 1, amount: 1, type: 1 }, { unique: true });
      
      export default mongoose.model('Transaction', transactionSchema);
    ğŸ“„ TzitzitOrder.js
      import mongoose from 'mongoose';
      
      const TzitzitOrderSchema = new mongoose.Schema(
        {
          user:       { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
      
          supplier:   { type: String,  required: true, trim: true },
          date:       { type: Date,    required: true },
          type:       { type: String,  enum: ['×¦×™×¦×™×ª', '×˜×œ×™×ª'], required: true },
      
          quantity:   { type: Number,  required: true, min: 1 },
          unitPrice:  { type: Number,  required: true, min: 0 },
      
          /* â€¼ï¸  ×”×©×“×” ×©×”×™×” ×—×¡×¨  â€“ ×›××” ×›×‘×¨ ×©×•×œ× */
          paidMoney:  { type: Number,  default: 0,     min: 0 },
        },
        {
          timestamps: true,
          toJSON:  { virtuals: true },
          toObject:{ virtuals: true },
        }
      );
      
      /* virtual â€“ totalPrice ××—×•×©×‘ ××•×˜×•××˜×™×ª */
      TzitzitOrderSchema.virtual('totalPrice').get(function () {
        return (this.quantity ?? 0) * (this.unitPrice ?? 0);
      });
      
      export default mongoose.model('TzitzitOrder', TzitzitOrderSchema);
    ğŸ“„ centerModel.js
      import mongoose from 'mongoose';
      
      const centerSchema = new mongoose.Schema(
        {
          name: {
            type: String,
            required: [true, '×©× ××¨×›×– ×—×•×‘×”'],
            unique: true,
            trim: true,
          },
          address: {
            type: String,
            trim: true,
          },
          active: {
            type: Boolean,
            default: true,
          },
          capacity: {
            type: Number,
            default: 0, // 0 = ×œ×œ× ×”×’×‘×œ×”
            min: 0,
          },
        },
        {
          timestamps: true,
          versionKey: false,
        }
      );
      
      export default mongoose.model('Center', centerSchema);
    ğŸ“„ userModel.js
      import mongoose from 'mongoose';
      
      const MAX_FAILED = 5;
      const LOCK_MS = 10 * 60 * 1000;
      
      const cartItemSchema = new mongoose.Schema({
        product: { type: mongoose.Schema.Types.ObjectId, ref: 'Product', required: true },
        quantity: { type: Number, required: true, min: 1, default: 1 },
      }, { _id: false });
      
      const userSchema = new mongoose.Schema(
        {
          name: {
            type: String,
            required: [true, '×©× ×—×•×‘×”'],
            trim: true,
          },
          email: {
            type: String,
            required: [true, '××™××™×™×œ ×—×•×‘×”'],
            unique: true,
            lowercase: true,
            trim: true,
            match: [/^\S+@\S+\.\S+$/, '×¤×•×¨××˜ ××™××™×™×œ ×œ× ×ª×§×™×Ÿ'],
          },
          passwordHash: {
            type: String,
            required: [true, '×¡×™×¡××” ×—×•×‘×”'],
          },
          role: {
            type: String,
            enum: ['admin', 'sales', 'maintenance'],
            default: 'sales',
          },
          canManagePriceLists: {
            type: Boolean,
            default: false,
          },
          // âœ¨ ×©×“×” ×—×“×©: ×”×× ×”××©×ª××© ×¨×©××™ ×œ×¨××•×ª ×¢××œ×•×ª
          canViewCommissions: {
            type: Boolean,
            default: false,
          },
          cart: {
            type: [cartItemSchema],
            default: [],
          },
          twoFactorEnabled: { type: Boolean, default: false },
          totpSecret: { type: String, default: '' },
          failedLoginAttempts: { type: Number, default: 0 },
          lockUntil: { type: Date, default: null },
          tokenVersion: { type: Number, default: 0 },
        },
        {
          timestamps: true,
          versionKey: false,
        }
      );
      
      userSchema.virtual('isLocked').get(function () {
        return !!(this.lockUntil && this.lockUntil > Date.now());
      });
      
      userSchema.methods.incrementLoginAttempts = function () {
        if (this.isLocked) return;
        const updates = { $inc: { failedLoginAttempts: 1 } };
        if (this.failedLoginAttempts + 1 >= MAX_FAILED) {
          updates.$set = { lockUntil: Date.now() + LOCK_MS };
        }
        return this.updateOne(updates);
      };
      
      userSchema.methods.resetLoginAttempts = function () {
        if (this.failedLoginAttempts || this.lockUntil) {
          return this.updateOne({ failedLoginAttempts: 0, lockUntil: null });
        }
      };
      
      export default mongoose.models.User || mongoose.model('User', userSchema);
  ğŸš« node_modules/ (× ×¤×¡×œ ×œ×¡×¨×™×§×”)
  ğŸ“„ package-lock.json
  ğŸ“„ package.json
  ğŸ“ routes/
    ğŸ“„ adminCenters.js
      import express from 'express';
      import requireAdmin from '../middlewares/requireAdmin.js';
      import {
        getAllCenters,
        createCenter,
        deleteCenter,
      } from '../controllers/admin/centerAdminController.js';
      
      const router = express.Router();
      router.use(requireAdmin);
      
      router.get('/',    getAllCenters);
      router.post('/',   createCenter);
      router.delete('/:id', deleteCenter);
      
      export default router;
    ğŸ“„ adminDashboard.js
      // server/routes/adminDashboard.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import { getDashboardStats } from '../controllers/admin/dashboardController.js';
      
      const router = express.Router();
      
      // ×”×’×Ÿ ×¢×œ ×›×œ ×”× ×ª×™×‘×™× ×›××Ÿ
      router.use(requireAuth, requireAdmin);
      
      router.get('/stats', getDashboardStats);
      
      export default router;
    ğŸ“„ adminExtraTypes.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import { getExtraTypes, createExtraType, deleteExtraType } from '../controllers/admin/extraTypeController.js';
      
      const router = express.Router();
      
      // ×›×•×œ× ×™×›×•×œ×™× ×œ×§×¨×•× (×›×“×™ ×œ×”×¦×™×’ ×‘×˜×•×¤×¡ ×”×–×× ×”)
      router.get('/', requireAuth, getExtraTypes);
      
      // ×¨×§ ×× ×”×œ ×™×›×•×œ ×œ×™×¦×•×¨/×œ××—×•×§
      router.post('/', requireAuth, requireAdmin, createExtraType);
      router.delete('/:id', requireAuth, requireAdmin, deleteExtraType);
      
      export default router;
    ğŸ“„ adminHotels.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import { getAllHotels, createHotel, deleteHotel, updateMasterChecklist } from '../controllers/admin/hotelAdminController.js';
      
      const router = express.Router();
      
      router.use(requireAuth);
      
      router.get('/', getAllHotels);
      router.post('/', requireAdmin, createHotel);
      // âœ¨ ×”× ×ª×™×‘ ×”×—×“×© ×œ×¢×“×›×•×Ÿ ×”×¦'×§ ×œ×™×¡×˜ ×”×¨××©×™
      router.put('/:id/checklist', requireAdmin, updateMasterChecklist);
      router.delete('/:id', requireAdmin, deleteHotel);
      
      export default router;
    ğŸ“„ adminOrders.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import { getAllOrders, updateOrder, deleteOrder } from '../controllers/admin/orderAdminController.js';
      
      const router = express.Router();
      
      // ×›×œ ×”× ×ª×™×‘×™× ×›××Ÿ ×“×•×¨×©×™× ×”×¨×©××ª ×× ×”×œ
      router.use(requireAuth, requireAdmin);
      
      router.get('/', getAllOrders); // ××—×–×™×¨ ××ª ×›×œ ×”×”×–×× ×•×ª
      router.put('/:id', updateOrder);
      router.delete('/:id', deleteOrder);
      
      export default router;
    ğŸ“„ adminProducts.js
      // server/routes/adminProducts.js
      
      import express from 'express';
      import { requireAdmin } from '../middlewares/authMiddleware.js';
      import {
          getAllProducts,
          createProduct,
          updateProduct,
          deleteProduct,
      } from '../controllers/admin/productAdminController.js';
      
      const router = express.Router();
      
      // ×”×’× ×” ×¢×œ ×›×œ ×”×¨××•×˜×™× ×‘×§×•×‘×¥ - ×“×•×¨×© ×”×¨×©××ª ×× ×”×œ
      router.use(requireAdmin);
      
      router.route('/')
          .get(getAllProducts)
          .post(createProduct);
      
      router.route('/:id')
          .put(updateProduct)
          .delete(deleteProduct);
      
      export default router;
    ğŸ“„ adminReferrals.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import { getReferralStats, updateReferralName } from '../controllers/admin/referralController.js';
      
      const router = express.Router();
      
      router.use(requireAuth, requireAdmin); // ×”×’× ×”: ×× ×”×œ×™× ×‘×œ×‘×“
      
      router.get('/stats', getReferralStats);
      router.post('/rename', updateReferralName);
      
      export default router;
    ğŸ“„ adminRoomTypes.js
      // server/routes/adminRoomTypes.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import {
        getRoomTypesByHotel,
        createRoomType,
        updateRoomType,
        deleteRoomType
      } from '../controllers/admin/roomTypeController.js';
      
      const router = express.Router();
      
      // 1. ×›×œ ×”× ×ª×™×‘×™× ×“×•×¨×©×™× ×©×”××©×ª××© ×™×”×™×” ××—×•×‘×¨ ×œ××¢×¨×›×ª
      router.use(requireAuth);
      
      // 2. × ×ª×™×‘ ×§×¨×™××” (GET) - ×¤×ª×•×— ×œ×›×œ ××©×ª××© ××—×•×‘×¨ (×›×“×™ ×©×™×•×›×œ×• ×œ×™×¦×•×¨ ×”×–×× ×•×ª)
      router.get('/by-hotel/:hotelId', getRoomTypesByHotel);
      
      // 3. ××›××Ÿ ×•×”×œ××” - ×”× ×ª×™×‘×™× ×“×•×¨×©×™× ×”×¨×©××ª ×× ×”×œ ×‘×œ×‘×“ (×™×¦×™×¨×”, ×¢×¨×™×›×”, ××—×™×§×”)
      router.use(requireAdmin);
      
      router.post('/', createRoomType);
      router.put('/:id', updateRoomType);
      router.delete('/:id', deleteRoomType);
      
      export default router;
    ğŸ“„ adminUsers.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import {
          getAllUsers,
          updateUserPermissions,
          createUser,
          deleteUser
      } from '../controllers/admin/userAdminController.js';
      
      const router = express.Router();
      
      // ×›×œ ×”×¤×¢×•×œ×•×ª ×›××Ÿ ×“×•×¨×©×•×ª ×”×¨×©××ª ×× ×”×œ
      router.use(requireAuth, requireAdmin);
      
      router.route('/')
          .get(getAllUsers)
          .post(createUser);
      
      router.route('/:id')
          .put(updateUserPermissions)
          .delete(deleteUser);
      
      export default router;
    ğŸ“„ announcementRoutes.js
      // server/routes/announcementRoutes.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import {
        getAllAnnouncements,
        getPublicAnnouncements,
        createAnnouncement,
        updateAnnouncement, // âœ¨ ×™×™×‘×•× ×”×¤×•× ×§×¦×™×” ×”×—×“×©×”
        deleteAnnouncement
      } from '../controllers/announcementController.js';
      
      const router = express.Router();
      
      // × ×ª×™×‘ ×¤×ª×•×— ×œ×›×œ ××©×ª××© ××—×•×‘×¨ (×œ×§×¨×™××ª ×”×•×“×¢×•×ª)
      router.get('/', requireAuth, getPublicAnnouncements);
      
      // --- ××–×•×¨ ××•×’×Ÿ ×œ×× ×”×œ×™× ×‘×œ×‘×“ ---
      router.use(requireAuth, requireAdmin);
      
      router.get('/all', getAllAnnouncements); // ×›×œ ×”×”×™×¡×˜×•×¨×™×”
      router.post('/', createAnnouncement);    // ×™×¦×™×¨×”
      router.put('/:id', updateAnnouncement);  // âœ¨ ×¢×¨×™×›×”
      router.delete('/:id', deleteAnnouncement); // ××—×™×§×”
      
      export default router;
    ğŸ“„ auth.js
      // server/routes/auth.js
      
      import express from 'express';
      
      // âœ¨ 1. ×™×™×‘×•× ×©×œ ×¤×•× ×§×¦×™×•×ª ×”×•×•×œ×™×“×¦×™×” ×©×™×¦×¨×ª
      import { loginValidator, registerValidator } from '../utils/validators.js';
      
      // âœ¨ 2. ×™×™×‘×•× ×›×œ ×”×¤×•× ×§×¦×™×•×ª ×”× ×“×¨×©×•×ª ××”×§×•× ×˜×¨×•×œ×¨
      import {
        loginUser,
        logout,
        refresh,
        registerUser, // âœ¨ ×”×•×¡×¤×ª ×™×™×‘×•× ×¤×•× ×§×¦×™×™×ª ×”×”×¨×©××”
      } from '../controllers/authController.js';
      
      const router = express.Router();
      
      // --- × ×ª×™×‘×™× ×¦×™×‘×•×¨×™×™× ---
      
      // âœ¨ 3. ×”×•×¡×¤×ª ××™×“×œ×•×•×¨ ×”×•×•×œ×™×“×¦×™×” ×œ× ×ª×™×‘ ×”×”×¨×©××”
      router.post('/register', registerValidator, registerUser);
      
      // âœ¨ 4. ×”×•×¡×¤×ª ××™×“×œ×•×•×¨ ×”×•×•×œ×™×“×¦×™×” ×œ× ×ª×™×‘ ×”×”×ª×—×‘×¨×•×ª
      router.post('/login', loginValidator, loginUser);
      
      router.post('/logout', logout);
      router.post('/refresh', refresh);
      
      export default router;
    ğŸ“„ dataRoutes.js
      import express from "express";
      import { saveDataRecord } from "../controllers/dataController.js";
      // ×©×•×¨×” ×–×• ××©×ª× ×”
      import requireAuth from "../middlewares/requireAuth.js"; // <-- ×”×ª×™×§×•×Ÿ ×›××Ÿ
      
      const router = express.Router();
      
      router.post("/save", requireAuth, saveDataRecord);
      
      export default router;
    ğŸ“„ fundRoutes.js
      import express from 'express';
      import { getFunds, addFund, refreshAllPrices, sellFund, deleteFund } from '../controllers/fundController.js';
      
      const router = express.Router();
      
      router.route('/')
        .get(getFunds)
        .post(addFund);
      
      router.post('/refresh', refreshAllPrices);
      router.post('/:id/sell', sellFund);
      router.delete('/:id', deleteFund);
      
      export default router;
    ğŸ“„ leadRoutes.js
      import express from 'express';
      import {
          getAllLeads,
          processLead,
          updateLeadStatus,
          deleteLead // âœ¨ ×™×™×‘×•× ×”×¤×•× ×§×¦×™×” ×”×—×“×©×”
      } from '../controllers/leadController.js';
      import {
          requireAuth,
          requireAdmin // âœ¨ ×™×™×‘×•× Middleware ×œ×‘×“×™×§×ª ×× ×”×œ
      } from '../middlewares/authMiddleware.js';
      
      const router = express.Router();
      
      // ×××‘×˜×—×™× ××ª ×›×œ ×”× ×ª×™×‘×™× ×‘×§×•×‘×¥ ×–×”
      router.use(requireAuth);
      
      router.get('/', getAllLeads);
      router.post('/:id/process', processLead);
      router.patch('/:id/status', updateLeadStatus);
      
      // âœ¨ × ×ª×™×‘ ×—×“×© ×œ××—×™×§×” - ××•×’×Ÿ ×‘×”×¨×©××ª ×× ×”×œ ×‘×œ×‘×“
      router.delete('/:id', requireAdmin, deleteLead);
      
      export default router;
    ğŸ“„ orderRoutes.js
      // server/routes/orderRoutes.js
      
      import express from 'express';
      import multer from 'multer'; // ×•×“× ×©×”×ª×§× ×ª: npm install multer
      import {
          createOrder,
          getMyOrders,
          getAllOrders,
          getOrderById,
          updateOrder,
          deleteOrder,
          getPublicQuoteById,
          sendOrderEmail // âœ¨ ×”×¤×•× ×§×¦×™×” ×”×—×“×©×”
      } from '../controllers/orderController.js';
      import { requireAuth } from '../middlewares/authMiddleware.js';
      
      // ×”×’×“×¨×ª ××—×¡×•×Ÿ ×–×× ×™ ×‘×–×™×›×¨×•×Ÿ
      const upload = multer({ storage: multer.memoryStorage() });
      
      const router = express.Router();
      
      // â¬‡ï¸ --- × ×ª×™×‘×™× ×¦×™×‘×•×¨×™×™× --- â¬‡ï¸
      router.get('/public/:id', getPublicQuoteById);
      
      // â¬‡ï¸ --- × ×ª×™×‘×™× ××•×’× ×™× --- â¬‡ï¸
      router.use(requireAuth);
      
      router.route('/')
          .post(createOrder);
      
      router.route('/my-orders')
          .get(getMyOrders);
      
      router.get('/all', getAllOrders);
      
      // âœ¨ × ×ª×™×‘ ×©×œ×™×—×ª ××™×™×œ (×—×©×•×‘ ×©×™×”×™×” ×œ×¤× ×™ ×”× ×ª×™×‘ ×¢× :id ×”×›×œ×œ×™)
      router.post('/:id/email', upload.single('pdf'), sendOrderEmail);
      
      router.route('/:id')
          .get(getOrderById)
          .put(updateOrder)
          .delete(deleteOrder);
      
      export default router;
    ğŸ“„ priceListRoutes.js
      import express from 'express';
      import {
        getAllPriceLists,
        createPriceList,
        updatePriceList,
        deletePriceList,
      } from '../controllers/priceListController.js';
      import { requireAuth } from '../middlewares/authMiddleware.js';
      
      const router = express.Router();
      
      router.use(requireAuth);
      
      // ××™×“×œ×•×•×¨ ×¤× ×™××™ ×œ×‘×“×™×§×ª ×”×¨×©××•×ª × ×™×”×•×œ ××—×™×¨×•× ×™×
      const canManage = (req, res, next) => {
        if (req.user.role === 'admin' || req.user.canManagePriceLists === true) {
          return next();
        }
        return res.status(403).json({ message: '××™×Ÿ ×œ×š ×”×¨×©××” ×œ× ×”×œ ××—×™×¨×•× ×™×.' });
      };
      
      // × ×ª×™×‘ ×œ×§×‘×œ×ª ×›×œ ×”××—×™×¨×•× ×™× - ×¤×ª×•×— ×œ×›×œ ××©×ª××© ××—×•×‘×¨
      router.get('/', getAllPriceLists);
      
      // × ×ª×™×‘×™× ×œ×™×¦×™×¨×”, ×¢×“×›×•×Ÿ ×•××—×™×§×” - ××•×’× ×™×
      router.post('/', canManage, createPriceList);
      router.put('/:id', canManage, updatePriceList);
      router.delete('/:id', canManage, deletePriceList);
      
      export default router;
    ğŸ“„ pushRoutes.js
      import express from 'express';
      import Subscription from '../models/Subscription.js';
      import { getPublicKey } from '../utils/pushHandler.js';
      import { requireAuth } from '../middlewares/authMiddleware.js';
      
      const router = express.Router();
      
      // ×§×‘×œ×ª ×”××¤×ª×— ×”×¦×™×‘×•×¨×™ (×›×“×™ ×©×”×§×œ×™×™× ×˜ ×™×•×›×œ ×œ×”×™×¨×©×)
      router.get('/key', (req, res) => {
        res.json({ publicKey: getPublicKey() });
      });
      
      // ×©××™×¨×ª ×× ×•×™ ×—×“×© (Subscribe)
      router.post('/subscribe', requireAuth, async (req, res) => {
        try {
          const subscription = req.body;
      
          // ×‘×“×™×§×” ×× ×§×™×™× ×›×‘×¨
          const exists = await Subscription.findOne({ endpoint: subscription.endpoint });
          if (!exists) {
            await Subscription.create({
              user: req.user._id,
              endpoint: subscription.endpoint,
              keys: subscription.keys
            });
          }
      
          res.status(201).json({ message: 'Subscribed successfully' });
        } catch (error) {
          console.error(error);
          res.status(500).json({ message: 'Error subscribing' });
        }
      });
      
      export default router;
    ğŸ“„ rateRoutes.js
      // server/routes/rateRoutes.js
      
      import express from 'express';
      import { updatePrimeRate } from '../controllers/rateController.js';
      
      // --- ×”×ª×™×§×•×Ÿ ×›××Ÿ: ××™×™×‘××™× ×’× ××ª requireAuth ---
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      
      const router = express.Router();
      
      // --- ×•×”×ª×™×§×•×Ÿ ×›××Ÿ: ××•×¡×™×¤×™× ××ª requireAuth ×œ×¤× ×™ requireAdmin ---
      router.post('/prime', requireAuth, requireAdmin, updatePrimeRate);
      
      export default router;
    ğŸ“„ referrerRoutes.js
      import express from 'express';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      import { getReferrerStats, upsertAlias, scanHistory } from '../controllers/referrerController.js';
      
      const router = express.Router();
      
      router.use(requireAuth, requireAdmin);
      
      router.get('/stats', getReferrerStats);
      router.post('/', upsertAlias);
      router.post('/scan', scanHistory); // ×”× ×ª×™×‘ ×”×—×“×© ×œ×›×¤×ª×•×¨ ×”×ª×™×§×•×Ÿ
      
      export default router;
    ğŸ“„ roomRoutes.js
      import express from 'express';
      import { requireAuth, requireAdmin, requireMaintenance } from '../middlewares/authMiddleware.js';
      import {
        getRoomsByHotel,
        getAllRooms,
        createBulkRooms,
        updateRoomStatus,
        addTask,
        toggleTask,
        deleteRoom,
        applyDailyPlan // âœ¨ ×”×¤×•× ×§×¦×™×” ×”×—×“×©×” ×œ×¡×™×“×•×¨ ×¢×‘×•×“×”
      } from '../controllers/roomController.js';
      
      const router = express.Router();
      
      router.use(requireAuth);
      
      // 1. × ×ª×™×‘×™× ×¡×˜×˜×™×™× (×—×™×™×‘×™× ×œ×”×™×•×ª ×¨××©×•× ×™×!)
      // -------------------------------------------
      router.get('/all', requireAdmin, getAllRooms);
      router.post('/bulk', requireAdmin, createBulkRooms);
      router.post('/daily-plan', requireAdmin, applyDailyPlan); // âœ¨ ×”× ×ª×™×‘ ×”×—×“×©
      
      // 2. × ×ª×™×‘×™× ×“×™× ××™×™× ×œ×¤×™ ID ×©×œ ×—×“×¨
      // -------------------------------------------
      // requireMaintenance = ×××¤×©×¨ ×’×™×©×” ×’× ×œ×× ×”×œ ×•×’× ×œ×¢×•×‘×“ ×ª×—×–×•×§×”
      router.patch('/:id/status', requireMaintenance, updateRoomStatus);
      router.post('/:id/tasks', requireMaintenance, addTask);
      router.patch('/:id/tasks/:taskId', requireMaintenance, toggleTask);
      router.delete('/:id', requireAdmin, deleteRoom); // ×¨×§ ×× ×”×œ ×™×›×•×œ ×œ××—×•×§ ×—×“×¨
      
      
      // 3. × ×ª×™×‘ ×¤×¨××˜×¨×™ ×›×œ×œ×™ (×—×™×™×‘ ×œ×”×™×•×ª ××—×¨×•×Ÿ ×—×‘×™×‘!)
      // -------------------------------------------
      router.get('/:hotelId', getRoomsByHotel); // ×©×•×œ×£ ××ª ×¨×©×™××ª ×”×—×“×¨×™× ×œ××œ×•×Ÿ ×¡×¤×¦×™×¤×™
      
      export default router;
    ğŸ“„ uploadRoutes.js
      // server/routes/uploadRoutes.js
      import express from 'express';
      import multer from 'multer';
      import path from 'path';
      import { requireAuth, requireAdmin } from '../middlewares/authMiddleware.js';
      
      const router = express.Router();
      
      // ×”×’×“×¨×ª ××—×¡×•×Ÿ: ×©×•××¨×™× ×‘×ª×™×§×™×™×ª uploads ×‘×©× ×§×‘×•×¢
      const storage = multer.diskStorage({
        destination(req, file, cb) {
          cb(null, 'uploads/');
        },
        filename(req, file, cb) {
          // ×ª××™×“ × ×©××•×¨ ×‘×©× ×§×‘×•×¢ ×›×“×™ ×©×™×”×™×” ×§×œ ×œ××¦×•× ××•×ª×•
          cb(null, 'company-logo.png');
        },
      });
      
      const upload = multer({ storage });
      
      // × ×ª×™×‘ ×”×¢×œ××” (×¨×§ ×œ×× ×”×œ×™×)
      router.post('/logo', requireAuth, requireAdmin, upload.single('logo'), (req, res) => {
        if (!req.file) {
          return res.status(400).json({ message: '×œ× × ×‘×—×¨ ×§×•×‘×¥' });
        }
        res.json({
          message: '×”×œ×•×’×• ×¢×œ×” ×‘×”×¦×œ×—×”',
          path: `/uploads/company-logo.png?t=${Date.now()}` // ×”×•×¡×¤× ×• ×–××Ÿ ×›×“×™ ×œ×× ×•×¢ Cache ×‘×“×¤×“×¤×Ÿ
        });
      });
      
      export default router;
    ğŸ“„ webhookRoutes.js
      import express from 'express';
      import InboundEmail from '../models/InboundEmail.js';
      import ReferrerAlias from '../models/ReferrerAlias.js';
      // âœ¨ 1. ×™×™×‘×•× ×¤×•× ×§×¦×™×™×ª ×”×©×œ×™×—×”
      import { sendPushToAll } from '../utils/pushHandler.js';
      
      const router = express.Router();
      
      // ×¤×•× ×§×¦×™×™×ª ×—×™×œ×•×¥ × ×§×™×™×”
      async function extractReferrerName(text) {
          if (!text) return null;
          const regex = /(?:×”×’×¢×ª×™|×¤× ×™×ª×™|×‘××ª×™)\s*(?:×“×¨×š|×|××”|×‘×”××œ×¦×ª|×¢"×™)\s+(.+)/i;
          const match = text.match(regex);
      
          if (match && match[1]) {
      
             let rawName = match[1].trim().split(/\s+/).slice(0, 2).join(' ');
              rawName = rawName.replace(/[.,;!?-]$/, '');
      
              // ×‘×“×™×§×ª × ×¨××•×œ ××•×œ ×”××™×œ×•×Ÿ
              const alias = await ReferrerAlias.findOne({ alias: rawName });
              return alias ? alias.officialName : rawName;
          }
          return null;
      }
      
      const verifySecret = (req, res, next) => {
        const providedSecret = req.query.secret || req.headers['x-webhook-secret'];
        const expectedSecret = process.env.WEBHOOK_SECRET_KEY;
        if (!expectedSecret || providedSecret !== expectedSecret) {
          return res.status(403).json({ message: 'Forbidden' });
        }
        next();
      };
      
      router.post('/email-inbound', verifySecret, async (req, res) => {
        try {
          const { from, type, body, parsedName, parsedPhone, parsedNote, conversationLink } = req.body;
      
          // 1. ×¡×¨×™×§×” ×©×§×˜×”
          const textToScan = (parsedNote || '') + ' ' + (body || '');
          const detectedReferrer = await extractReferrerName(textToScan);
      
          // 2. ×©××™×¨×” (×”×œ×™×“ × ×©××¨ × ×§×™ ×œ××•×›×¨, ×”××¤× ×” × ×©××¨ ×‘× ×¡×ª×¨)
          const newEmail = new InboundEmail({
            from: from || 'Connectop Bot',
            type: type || '×¤× ×™×™×” ×—×“×©×”',
            body: body || '',
            status: 'new', // ××©××™×¨×™× ×›-new ×›×“×™ ×©×”××•×›×¨ ×™×¨××”
      
            parsedName: parsedName,
            parsedPhone: parsedPhone,
            parsedNote: parsedNote, // × ×©××¨ ××§×•×¨×™!
            conversationLink: conversationLink,
      
            referrer: detectedReferrer, // × ×©××¨ ×‘×¦×“ ×œ×“×•×—×•×ª
      
            hotel: type ? type.trim() : null,
            handledBy: null
          });
      
          await newEmail.save();
      
          // âœ¨ 3. ×©×œ×™×—×ª ×”×ª×¨××” ×œ×›×•×œ× (Push Notification)
          try {
              const leadTitle = parsedName || '×œ×§×•×— ×—×“×©';
              const leadMsg = parsedNote || '×”×ª×§×‘×œ×” ×¤× ×™×™×” ×—×“×©×” ×œ××¢×¨×›×ª';
      
              // ×©×•×œ×— ×”×ª×¨××” ×‘×¨×§×¢ ×œ×›×œ ×”×× ×•×™×™×
              sendPushToAll({
                  title: ` ×œ×™×“ ×—×“×© ×××ª: ${leadTitle}`,
                  body: leadMsg,
                  url: '/leads' // ×œ×—×™×¦×” ×ª×•×‘×™×œ ×œ×“×£ ×”×œ×™×“×™×
              });
          } catch (pushErr) {
              console.error("Push notification failed:", pushErr);
              // ×œ× ×¢×•×¦×¨×™× ××ª ×”-Response ×‘×’×œ×œ ×›×™×©×œ×•×Ÿ ×”×ª×¨××”
          }
      
          res.status(201).json({ message: 'Saved', referrer: detectedReferrer });
      
        } catch (error) {
          console.error('Webhook Error:', error);
          res.status(400).json({ error: error.message });
        }
      });
      
      export default router;
  ğŸ“ scripts/
    ğŸ“„ checkUsers.js
      import mongoose from 'mongoose';
      import dotenv from 'dotenv';
      import path from 'path';
      import { fileURLToPath } from 'url';
      import User from '../models/userModel.js';
      
      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      dotenv.config({ path: path.resolve(__dirname, '../.env') });
      
      const check = async () => {
        await mongoose.connect(process.env.MONGO_URI);
        const users = await User.find({}, 'name email role');
        console.table(users.map(u => ({ Name: u.name, Email: u.email, Role: u.role })));
        process.exit(0);
      };
      check();
    ğŸ“„ makeAdmin.js
      import mongoose from 'mongoose';
      import dotenv from 'dotenv';
      import User from '../models/userModel.js';
      
      // ×˜×¢×Ÿ ××ª .env ××”×©×•×¨×© ×©×œ server
      dotenv.config({ path: './.env', override: true });
      
      console.log('ğŸ” Connecting to:', process.env.MONGO_URI);
      
      const promoteToAdmin = async () => {
        await mongoose.connect(process.env.MONGO_URI);
      
        const email = 'yosefdaean@gmail.com'; // â† ×”××™××™×™×œ ×©×‘×¨×¦×•× ×š ×œ×§×“×
      
        const user = await User.findOne({ email });
        if (!user) {
          console.log('âŒ ×”××©×ª××© ×œ× × ××¦×');
          process.exit(1);
        }
      
        user.role = 'admin';
        await user.save();
      
        console.log(`âœ… ×”××©×ª××© ${email} ×§×•×“× ×œ×ª×¤×§×™×“ ×× ×”×œ`);
        process.exit(0);
      };
      
      promoteToAdmin();
    ğŸ“„ migrateRoles.js
      import mongoose from 'mongoose';
      import dotenv from 'dotenv';
      import path from 'path';
      import { fileURLToPath } from 'url';
      import User from '../models/userModel.js';
      
      // --- ×”×’×“×¨×ª × ×ª×™×‘×™× ×œ×˜×¢×™× ×ª ××©×ª× ×™ ×”×¡×‘×™×‘×” ---
      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      
      // ×˜×•×¢×Ÿ ××ª ×§×•×‘×¥ ×”-.env ××”×ª×™×§×™×™×” ×”×¨××©×™×ª ×©×œ ×”×©×¨×ª
      dotenv.config({ path: path.resolve(__dirname, '../.env') });
      
      const migrateRoles = async () => {
        console.log('ğŸ”„ ××ª×—×™×œ ×ª×”×œ×™×š ××™×’×¨×¦×™×™×ª ×ª×¤×§×™×“×™×...');
      
        // 1. ×”×ª×—×‘×¨×•×ª ×œ×“××˜×”-×‘×™×™×¡
        try {
          if (!process.env.MONGO_URI) {
            throw new Error('âŒ ××©×ª× ×” ×¡×‘×™×‘×” MONGO_URI ×—×¡×¨.');
          }
      
          await mongoose.connect(process.env.MONGO_URI);
          console.log('âœ… ××—×•×‘×¨ ×œ-MongoDB ×‘×”×¦×œ×—×”.');
      
        } catch (error) {
          console.error('âŒ ×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª:', error.message);
          process.exit(1);
        }
      
        try {
          // 2. ×‘×“×™×§×ª ××¦×‘ ×§×™×™×
          const countOldUsers = await User.countDocuments({ role: 'user' });
          console.log(`ğŸ“Š × ××¦××• ${countOldUsers} ××©×ª××©×™× ×¢× ×”×ª×¤×§×™×“ ×”×™×©×Ÿ ("user").`);
      
          if (countOldUsers === 0) {
            console.log('âœ¨ ××™×Ÿ ×¦×•×¨×š ×‘×©×™× ×•×™×™×. ×›×œ ×”××©×ª××©×™× ××¢×•×“×›× ×™×.');
            await mongoose.disconnect();
            process.exit(0);
          }
      
          // 3. ×‘×™×¦×•×¢ ×”×¢×“×›×•×Ÿ
          // updateMany ×¢×•×§×£ ×•×œ×™×“×¦×™×•×ª ××¡×•×™××•×ª, ××” ×©×˜×•×‘ ×œ× ×• ×›×™ "user" ×›×‘×¨ ×œ× ×§×™×™× ×‘-Enum ×”×—×“×©
          const result = await User.updateMany(
            { role: 'user' },
            { $set: { role: 'sales' } }
          );
      
          console.log(`âœ… ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”: ${result.modifiedCount} ××©×ª××©×™×.`);
          console.log('ğŸ‰ ×›×¢×ª ×›×•×œ× ××•×’×“×¨×™× ×›-"sales" (××œ×‘×“ ×”×× ×”×œ×™×).');
      
        } catch (error) {
          console.error('âŒ ×©×’×™××” ×‘××”×œ×š ×”×¢×“×›×•×Ÿ:', error);
        } finally {
          // 4. × ×™×ª×•×§ ××¡×•×“×¨
          await mongoose.disconnect();
          console.log('ğŸ‘‹ ×”×—×™×‘×•×¨ × ×¡×’×¨.');
          process.exit(0);
        }
      };
      
      migrateRoles();
  ğŸ“„ setLoading(false))
  ğŸ“„ setSaving(false))
  ğŸ“ stores/
    ğŸ“„ authStore.js
      // src/stores/authStore.js
      
      import { create } from 'zustand';
      
      // ×¤×•× ×§×¦×™×” ×©×§×•×¨××ª ××ª ×¤×¨×˜×™ ×”××©×ª××© ××”××—×¡×•×Ÿ ×”××§×•××™ ×©×œ ×”×“×¤×“×¤×Ÿ
      const getInitialState = () => {
        try {
          const user = JSON.parse(localStorage.getItem('user'));
          return {
            user: user,
            isAuthenticated: !!user, // ×”×•×¤×š ××ª ×”×ª×•×¦××” ×œ-true ×× ×™×© ××©×ª××©, ×•-false ×× ××™×Ÿ
          };
        } catch (error) {
          return { user: null, isAuthenticated: false };
        }
      };
      
      export const useAuthStore = create((set) => ({
        ...getInitialState(), // ×§×•×‘×¢ ××ª ×”××¦×‘ ×”×”×ª×—×œ×ª×™ ×›×©×”××¤×œ×™×§×¦×™×” × ×˜×¢× ×ª
      
        // ×¤×¢×•×œ×” ×©×§×•×¨××™× ×œ×” ××—×¨×™ ×”×ª×—×‘×¨×•×ª ××•×¦×œ×—×ª
        login: (userData) => {
          localStorage.setItem('user', JSON.stringify(userData));
          set({ user: userData, isAuthenticated: true });
        },
      
        // ×¤×¢×•×œ×” ×©×§×•×¨××™× ×œ×” ×‘×¢×ª ×”×ª× ×ª×§×•×ª
        logout: () => {
          localStorage.removeItem('user');
          set({ user: null, isAuthenticated: false });
        },
      }));
    ğŸ“„ projectsStore.js
      // client/src/stores/projectsStore.js
      
      import { create } from 'zustand';
      import {
        getProjects,
        getProject,
        createProject,
        updateProject,
        deleteProject,
        addFund,
        addTask,
        toggleTask,
        deleteTask,
      } from '../utils/projects';
      
      /**
       * Zustand store ×œ× ×™×”×•×œ ××¦×‘ "Projects" (×™×¢×“×™× / ××©×™××•×ª) ×‘×¦×“â€‘×œ×§×•×—.
       *
       * â”€ ×”× ×ª×•× ×™× × ×©××¨×™× ×‘×–×™×›×¨×•×Ÿ ×”×’×œ×•×‘×œ×™ ×©×œ ×”××¤×œ×™×§×¦×™×”.
       * â”€ ×›×œ ×¤×¢×•×œ×” ××¢×“×›× ×ª ××ª ×”â€‘state ×‘××•×¤×Ÿ ××™×¡×˜× ×˜×™×‘×™ (optimistic) ×•××– ××××ª×ª ××•×œ ×”×©×¨×ª.
       */
      const useProjectsStore = create((set, get) => ({
        /* -------------------------------------------------------
         * State
         * ----------------------------------------------------- */
        projects: [],      // ×›×œ ×”×¤×¨×•×™×§×˜×™× ×©×œ ×”××©×ª××©
        active: null,      // ×¤×¨×•×™×§×˜ ×¤×ª×•×— ×›×¨×’×¢ (object) ××• null
        loading: false,    // true ×‘×–××Ÿ ×¤×¢×•×œ×” ×â€‘×¡×™× ×›×¨×•× ×™×ª
        error: null,       // ××•×‘×™×™×§×˜ ×©×’×™××” ××—×¨×•×Ÿ ××• null
      
        /* -------------------------------------------------------
         * Internal helpers
         * ----------------------------------------------------- */
        _start: () => set({ loading: true, error: null }),
        _success: (overrides = {}) => set({ loading: false, ...overrides }),
        _fail: (error) => set({ loading: false, error }),
      
        /* -------------------------------------------------------
         * Actions â€“ CRUD ×‘×¡×™×¡×™
         * ----------------------------------------------------- */
        fetchProjects: async () => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const projects = await getProjects();
            _success({ projects });
          } catch (err) {
            _fail(err);
          }
        },
      
        fetchProject: async (id) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const project = await getProject(id);
            // ×¢×“×›×Ÿ ××• ×”×•×¡×£ ×œâ€‘projects
            const projects = [...get().projects];
            const idx = projects.findIndex((p) => p._id === id);
            if (idx > -1) projects[idx] = project; else projects.unshift(project);
            _success({ projects, active: project });
          } catch (err) {
            _fail(err);
          }
        },
      
        createProject: async (payload) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const project = await createProject(payload);
            _success({ projects: [project, ...get().projects] });
          } catch (err) {
            _fail(err);
          }
        },
      
        updateProject: async (id, payload) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const updated = await updateProject(id, payload);
            const projects = get().projects.map((p) => (p._id === id ? updated : p));
            const active   = get().active && get().active._id === id ? updated : get().active;
            _success({ projects, active });
          } catch (err) {
            _fail(err);
          }
        },
      
        deleteProject: async (id) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            await deleteProject(id);
            const projects = get().projects.filter((p) => p._id !== id);
            const active   = get().active && get().active._id === id ? null : get().active;
            _success({ projects, active });
          } catch (err) {
            _fail(err);
          }
        },
      
        /* -------------------------------------------------------
         * Goalâ€‘type helpers (Funds)
         * ----------------------------------------------------- */
        addFund: async (projectId, fund) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const updated = await addFund(projectId, fund);
            const projects = get().projects.map((p) => (p._id === projectId ? updated : p));
            const active   = get().active && get().active._id === projectId ? updated : get().active;
            _success({ projects, active });
          } catch (err) {
            _fail(err);
          }
        },
      
        /* -------------------------------------------------------
         * Taskâ€‘type helpers (Tasks)
         * ----------------------------------------------------- */
        addTask: async (projectId, task) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const updated = await addTask(projectId, task);
            const projects = get().projects.map((p) => (p._id === projectId ? updated : p));
            const active   = get().active && get().active._id === projectId ? updated : get().active;
            _success({ projects, active });
          } catch (err) {
            _fail(err);
          }
        },
      
        toggleTask: async (projectId, taskId) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const updated = await toggleTask(projectId, taskId);
            const projects = get().projects.map((p) => (p._id === projectId ? updated : p));
            const active   = get().active && get().active._id === projectId ? updated : get().active;
            _success({ projects, active });
          } catch (err) {
            _fail(err);
          }
        },
      
        deleteTask: async (projectId, taskId) => {
          const { _start, _success, _fail } = get();
          try {
            _start();
            const updated = await deleteTask(projectId, taskId);
            const projects = get().projects.map((p) => (p._id === projectId ? updated : p));
            const active   = get().active && get().active._id === projectId ? updated : get().active;
            _success({ projects, active });
          } catch (err) {
            _fail(err);
          }
        },
      }));
      
      export default useProjectsStore;
  ğŸ“ uploads/
    ğŸ“„ company-logo.png
  ğŸ“ utils/
    ğŸ“„ AppError.js
      class AppError extends Error {
        constructor(message, statusCode) {
          super(message);
          this.statusCode = statusCode;
          this.status = `${statusCode}`.startsWith('4') ? 'fail' : 'error';
          this.isOperational = true; // To distinguish from programming errors
          Error.captureStackTrace(this, this.constructor);
        }
      }
      
      export default AppError;
    ğŸ“„ dateHelpers.js
      // server/utils/dateHelpers.js
      
      /**
       * ××•×¡×™×£ ××¡×¤×¨ ×—×•×“×©×™× ×œ×ª××¨×™×š × ×ª×•×Ÿ.
       * ××˜×¤×œ ×‘××§×¨×™ ×§×¦×” ×›××• ×”×•×¡×¤×ª ×—×•×“×© ×œ-31 ×‘×™× ×•××¨.
       * @param {Date} baseDate - ×ª××¨×™×š ×”×”×ª×—×œ×”
       * @param {number} months - ××¡×¤×¨ ×”×—×•×“×©×™× ×œ×”×•×¡×¤×”
       * @returns {Date} - ×”×ª××¨×™×š ×”×—×“×©
       */
      export function add_months(baseDate, months) {
        const d = new Date(baseDate);
        const originalDay = d.getDate();
      
        // setMonth ××˜×¤×œ ××•×˜×•××˜×™×ª ×‘××¢×‘×¨ ×œ×©× ×” ×”×‘××”
        d.setMonth(d.getMonth() + months);
      
        // ×× ×”×™×•× ×‘×—×•×“×© ×”×©×ª× ×” (×œ××©×œ, ×”×•×¡×¤×ª ×—×•×“×© ×œ-31.1 ×”×¤×›×” ×œ-2.3 ×‘××§×•× ×¡×•×£ ×¤×‘×¨×•××¨),
        // ×× ×—× ×• ××ª×§× ×™× ××ª ×–×” ×œ×™×•× ×”××—×¨×•×Ÿ ×©×œ ×”×—×•×“×© ×”×§×•×“×.
        if (d.getDate() !== originalDay) {
          d.setDate(0);
        }
        return d;
      }
    ğŸ“„ excelCleaners.js
      // server/utils/excelCleaners.js
      
      /**
       * ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×’× ×¨×™×ª ×œ××™×ª×•×¨ ×˜×‘×œ×ª ×”× ×ª×•× ×™× ×‘×ª×•×š ×§×•×‘×¥ ××§×¡×œ.
       * @param {Array<Array<string>>} data ×”× ×ª×•× ×™× ×”×’×•×œ××™×™× ××”×’×™×œ×™×•×Ÿ.
       * @param {string[]} keyHeaders ×¨×©×™××ª ×›×•×ª×¨×•×ª ×—×•×‘×” ×©×—×™×™×‘×•×ª ×œ×”×•×¤×™×¢ ×‘×©×•×¨×ª ×”×›×•×ª×¨×•×ª.
       * @returns {{headers: string[], dataRows: Array<Array<string>>}}
       */
      function findTableData(data, keyHeaders) {
        const headerRowIndex = data.findIndex(row =>
          Array.isArray(row) && keyHeaders.every(header =>
            row.some(cell => typeof cell === 'string' && cell.trim().includes(header))
          )
        );
      
        if (headerRowIndex === -1) {
          throw new Error(`×œ× ×”×¦×œ×—× ×• ×œ×–×”×•×ª ××ª ×©×•×¨×ª ×”×›×•×ª×¨×•×ª. ×•×“× ×©×”×§×•×‘×¥ ××›×™×œ ×¢××•×“×•×ª: ${keyHeaders.join(', ')}.`);
        }
      
        const headers = data[headerRowIndex].map(h => String(h || '').trim().replace(/\s+/g, ' '));
        const rowsAfterHeaders = data.slice(headerRowIndex + 1);
      
        const dataRows = rowsAfterHeaders.filter(row =>
          Array.isArray(row) && row.filter(cell => cell != null && String(cell).trim() !== '').length >= 2
        );
      
        return { headers, dataRows };
      }
      
      /**
       * ×× ×§×” ×•××¢×‘×“ ×§×•×‘×¥ ×¢×¡×§××•×ª ×©×œ ×—×‘×¨×ª "××§×¡".
       */
      export function cleanMaxFile(data) {
        const { headers, dataRows } = findTableData(data, ['×ª××¨×™×š ×¢×¡×§×”', '×©× ×‘×™×ª ×”×¢×¡×§', '×¡×›×•× ×—×™×•×‘']);
      
        if (dataRows.length < 1) {
          throw new Error("×œ× × ××¦××• × ×ª×•× ×™× ×‘×§×•×‘×¥ '××§×¡' ×œ××—×¨ ×”× ×™×§×•×™.");
        }
      
        return dataRows.map(rowArray => {
          let rowObject = {};
          headers.forEach((header, index) => {
            if (header) {
              rowObject[header] = rowArray[index];
            }
          });
          return rowObject;
        });
      }
      
      /**
       * ×× ×§×” ×•××¢×‘×“ ×§×•×‘×¥ ×¢×¡×§××•×ª ×©×œ ×—×‘×¨×ª "×›××œ".
       * ×”×œ×•×’×™×§×” ××–×”×” ××ª ×ª×—×™×œ×ª ×”× ×ª×•× ×™× ×•×××¤×” ××•×ª× ×œ×¤×™ ××™×§×•× ×§×‘×•×¢ ×©×œ ×¢××•×“×•×ª.
       */
      export function cleanCalFile(data) {
          // ×©×œ×‘ 1: ××¦× ××ª ×”××™× ×“×§×¡ ×©×œ ×©×•×¨×ª ×”×›×•×ª×¨×•×ª ×›×“×™ ×œ×“×¢×ª ×××™×¤×” ×œ×”×ª×—×™×œ
          const headerRowIndex = data.findIndex(row =>
              Array.isArray(row) &&
              row.some(cell => typeof cell === 'string' && cell.includes('×ª××¨×™×š')) &&
              row.some(cell => typeof cell === 'string' && cell.includes('×©× ×‘×™×ª ×¢×¡×§'))
          );
      
          if (headerRowIndex === -1) {
              throw new Error("×§×•×‘×¥ '×›××œ' ×œ× ×ª×§×™×Ÿ: ×œ× ×”×¦×œ×—× ×• ×œ×–×”×•×ª ××ª ×©×•×¨×ª ×”×›×•×ª×¨×•×ª. ×•×“× ×©×”×§×•×‘×¥ ××›×™×œ ××ª ×”×¢××•×“×•×ª ×”× ×“×¨×©×•×ª.");
          }
      
          // ×©×œ×‘ 2: ×—×œ×¥ ××ª ×©×•×¨×•×ª ×”× ×ª×•× ×™× ×©××ª×—×™×œ×•×ª ××™×“ ××—×¨×™ ×”×›×•×ª×¨×•×ª
          const dataRows = data.slice(headerRowIndex + 1);
      
          // ×©×œ×‘ 3: ×¡× ×Ÿ ×©×•×¨×•×ª ×œ× ×¨×œ×•×•× ×˜×™×•×ª (×¨×™×§×•×ª ××• ×©×•×¨×•×ª ×¡×™×›×•×)
          const finalRows = dataRows.filter(row =>
              Array.isArray(row) &&
              row[0] && // ×—×™×™×‘ ×œ×”×™×•×ª ×¢×¨×š ×‘×¢××•×“×ª ×”×ª××¨×™×š (××™× ×“×§×¡ 0)
              row[1]    // ×—×™×™×‘ ×œ×”×™×•×ª ×¢×¨×š ×‘×¢××•×“×ª ×©× ×‘×™×ª ×”×¢×¡×§ (××™× ×“×§×¡ 1)
          );
      
          if (finalRows.length < 1) {
              throw new Error("×œ× × ××¦××• ×©×•×¨×•×ª × ×ª×•× ×™× ×ª×§×™× ×•×ª ×‘×§×•×‘×¥ '×›××œ' ×œ××—×¨ ×”× ×™×§×•×™.");
          }
      
          // --- ğŸ‘‡ ×”×ª×™×§×•×Ÿ ×›××Ÿ: ××™×¤×•×™ ×œ×¤×™ ××™×§×•× ×§×‘×•×¢ ×©×œ ×©×œ×•×© ×”×¢××•×“×•×ª ×”×¨××©×•× ×•×ª ---
          return finalRows.map(rowArray => {
              return {
                  "×ª××¨×™×š ×¢×¡×§×”": rowArray[0],
                  "×©× ×‘×™×ª ×”×¢×¡×§": rowArray[1],
                  // ×¢××•×“×” 3 ×”×™× ×”×¡×›×•×, ×•× ×™×ª×Ÿ ×œ×” ×©× ×§×‘×•×¢ ×©×”×§×•×“ ××¦×¤×” ×œ×•
                  "×¡×›×•× ×—×™×•×‘": rowArray[2]
              };
          });
      }
    ğŸ“„ excelParser.js
      // server/utils/excelParser.js
      import MerchantMap from '../models/MerchantMap.js';
      import CategoryRule from '../models/CategoryRule.js';
      
      /**
       * ××¤×¢× ×— ×ª××¨×™×š ×××’×•×•×Ÿ ×¤×•×¨××˜×™× ××¤×©×¨×™×™× (DD/MM/YYYY, ISO, ×•×›×•') ×œ×ª××¨×™×š UTC ×ª×§× ×™.
       * ×”×¤×•× ×§×¦×™×” ×¢××™×“×” ×œ×§×œ×˜ ×—×œ×§×™ ××• ×œ× ×ª×§×™×Ÿ.
       * @param {Date|string|number} dateInput - ×”×§×œ×˜ ×©×™×© ×œ×¤×¢× ×—.
       * @returns {Date|null} ××•×‘×™×™×§×˜ Date ××• null ×× ×”×¤×¢× ×•×— × ×›×©×œ.
       */
      function parseDate(dateInput) {
        // ×× ×”×§×œ×˜ ×”×•× ×›×‘×¨ ××•×‘×™×™×§×˜ ×ª××¨×™×š ×ª×§×™×Ÿ, × ×—×–×™×¨ ××•×ª×• ××™×“.
        if (dateInput instanceof Date && !isNaN(dateInput.getTime())) {
          return dateInput;
        }
        if (!dateInput) return null;
      
        const dateStr = String(dateInput).trim();
      
        // × ×¡×™×•×Ÿ ×¤×¢× ×•×— ×©×œ ×¤×•×¨××˜ DD/MM/YYYY ××• DD-MM-YYYY
        const parts = dateStr.match(/^(\d{1,2})[-/](\d{1,2})[-/](\d{4})$/);
        if (parts) {
          const day = parseInt(parts[1], 10);
          const month = parseInt(parts[2], 10);
          const year = parseInt(parts[3], 10);
          if (year > 1900 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
            // ×©×™××•×© ×‘-Date.UTC ×›×“×™ ×œ×× ×•×¢ ×‘×¢×™×•×ª ××–×•×¨ ×–××Ÿ.
            const date = new Date(Date.UTC(year, month - 1, day));
            if (!isNaN(date.getTime())) return date;
          }
        }
      
        // × ×¡×™×•×Ÿ ×¤×¢× ×•×— ×›-ISO ××• ×¤×•×¨××˜ × ×ª××š ××—×¨ ×©×œ JavaScript.
        const isoDate = new Date(dateStr);
        if (!isNaN(isoDate.getTime())) return isoDate;
      
        return null;
      }
      
      /**
       * ×™×•×¦×¨ ××•×‘×™×™×§×˜ ×¢×¡×§×” ×’×•×œ××™ ××©×•×¨×ª × ×ª×•× ×™× ××”×§×•×‘×¥.
       * ××˜×¤×œ ×‘×”×‘×“×œ×™× ×‘×™×Ÿ ×§×‘×¦×™ '××§×¡' ×•'×›××œ'.
       * @param {object} row - ×©×•×¨×ª × ×ª×•× ×™× ××”×§×•×‘×¥ ×”×× ×•×§×”.
       * @param {string} userId - ××–×”×” ×”××©×ª××©.
       * @param {string} type - ×¡×•×’ ×”×§×•×‘×¥ ('max' ××• 'cal').
       * @returns {object|null} ××•×‘×™×™×§×˜ ×¢×¡×§×” ××• null ×× ×”×©×•×¨×” ×œ× ×ª×§×™× ×”.
       */
      const createTransactionObject = (row, userId, type) => {
          const date = parseDate(row["×ª××¨×™×š ×¢×¡×§×”"]);
          if (!date || !row["×©× ×‘×™×ª ×”×¢×¡×§"]) return null;
      
          let amount, transactionType;
      
          if (type === 'max') {
              // ×§×•×‘×¥ '××§×¡' ××›×™×œ ×¢××•×“×•×ª × ×¤×¨×“×•×ª ×œ×—×™×•×‘ ×•×–×™×›×•×™
              const chargeAmount = parseFloat(String(row["×¡×›×•× ×—×™×•×‘"] || '0').replace(/,/g, ''));
              const creditAmount = parseFloat(String(row["×¡×›×•× ×–×™×›×•×™"] || '0').replace(/,/g, ''));
      
              if (!isNaN(chargeAmount) && chargeAmount !== 0) {
                  amount = Math.abs(chargeAmount);
                  transactionType = chargeAmount > 0 ? '×”×•×¦××”' : '×”×›× ×¡×”';
              } else if (!isNaN(creditAmount) && creditAmount !== 0) {
                  amount = Math.abs(creditAmount);
                  transactionType = '×”×›× ×¡×”';
              } else {
                  return null; // ×©×•×¨×” ×œ×œ× ×¡×›×•×
              }
          } else { // 'cal'
              // ×§×•×‘×¥ '×›××œ' ××©×ª××© ×‘×¢××•×“×” ××—×ª ×¢× ××¡×¤×¨ ×—×™×•×‘×™ ××• ×©×œ×™×œ×™
              const amountValue = row["×¡×›×•× ×‘×©\"×—"] || row["×¡×›×•× ×¢×¡×§×”"] || row["×¡×›×•× ×—×™×•×‘"];
              if (amountValue == null) return null;
      
              amount = parseFloat(String(amountValue).replace(/,/g, ''));
              if (isNaN(amount)) return null;
      
              transactionType = amount < 0 ? '×”×›× ×¡×”' : '×”×•×¦××”';
              amount = Math.abs(amount);
          }
      
          return {
              user: userId,
              date,
              description: String(row["×©× ×‘×™×ª ×”×¢×¡×§"]).trim(),
              rawDescription: String(row["×©× ×‘×™×ª ×”×¢×¡×§"]).trim(), // ×©××™×¨×ª ×”×©× ×”××§×•×¨×™
              amount,
              type: transactionType,
              account: 'checking', // ×‘×¨×™×¨×ª ××—×“×œ
              category: row['×§×˜×’×•×¨×™×”']?.trim() || '×›×œ×œ×™',
          };
      };
      
      /**
       * ×¤×•× ×§×¦×™×” ×¨××©×™×ª: ×× ×ª×—×ª × ×ª×•× ×™× ××§×•×‘×¥ ××§×¡×œ, ××¢×©×™×¨×” ××•×ª× ×¢× ×—×•×§×™× ×•××™×¤×•×™×™×,
       * ×•××—×–×™×¨×” ×¨×©×™××ª ×¢×¡×§××•×ª ××•×›× ×•×ª ×œ×”×›× ×¡×” ×•×¨×©×™××ª ×¡×•×—×¨×™× ×”×“×•×¨×©×™× ××™×¤×•×™ ×™×“× ×™.
       * @param {Array<object>} cleanedData - ××¢×¨×š ××•×‘×™×™×§×˜×™× ×©×œ ×¢×¡×§××•×ª ×œ××—×¨ × ×™×§×•×™ ×‘×¡×™×¡×™.
       * @param {string} fileType - ×¡×•×’ ×”×§×•×‘×¥ ('max' ××• 'cal').
       * @param {string} userId - ××–×”×” ×”××©×ª××©.
       * @returns {Promise<{transactions: Array<object>, unseenMerchants: Array<string>}>}
       */
      export async function parseTransactions(cleanedData, fileType, userId) {
          // ×©×œ×‘ 1: ×™×¦×™×¨×ª ××•×‘×™×™×§×˜×™× ×‘×¡×™×¡×™×™× ××”× ×ª×•× ×™× ×”×’×•×œ××™×™×
          const mapper = (row) => createTransactionObject(row, userId, fileType);
          const initialTransactions = cleanedData.map(mapper).filter(Boolean);
      
          // ×©×œ×‘ 2: ×˜×¢×™× ×ª ×›×œ ×”××™×¤×•×™×™× ×•×”×—×•×§×™× ××”-DB ×¤×¢× ××—×ª ×œ×˜×•×‘×ª ×™×¢×™×œ×•×ª
          const [merchantMaps, categoryRules] = await Promise.all([
              MerchantMap.find({}).populate('category', 'name').lean(),
              CategoryRule.find({}).populate('category', 'name').lean(),
          ]);
      
          // ×™×¦×™×¨×ª ××™×œ×•×Ÿ ××”×™×¨ ×œ×’×™×©×” ×œ××™×¤×•×™×™×
          const merchantMapCache = new Map(merchantMaps.map(m => [m.originalName, m]));
      
          // ×§×‘×•×¦×” ×©×ª×›×™×œ ××ª ×›×œ ×©××•×ª ×”×¡×•×—×¨×™× ×©×”××¢×¨×›×ª ×œ× ×”×¦×œ×™×—×” ×œ×©×™×™×š ×œ×”× ×§×˜×’×•×¨×™×”
          const merchantsThatNeedMapping = new Set();
      
          // ×©×œ×‘ 3: ×œ×•×œ××” ×¨××©×™×ª ×¢×œ ×›×œ ×¢×¡×§×” ×›×“×™ ×œ×”×¢×©×™×¨ ××•×ª×”
          const transactions = initialTransactions.map(trx => {
              const originalDescription = trx.rawDescription;
              let finalDescription = trx.description;
              let finalCategoryName = '×›×œ×œ×™'; // ×‘×¨×™×¨×ª ××—×“×œ
              let categoryApplied = false;
      
              // ×©×œ×‘ 3.1: ×‘×“×™×§×ª ××™×¤×•×™ ×¡×•×—×¨×™× (MerchantMap)
              // ×–×” ×”×©×œ×‘ ×”×›×™ ×—×–×§. ×× ×™×© ××™×¤×•×™, ×”×•× ×§×•×‘×¢ ×’× ××ª ×”×©× ×•×’× ××ª ×”×§×˜×’×•×¨×™×”.
              const mapping = merchantMapCache.get(originalDescription);
              if (mapping) {
                  finalDescription = mapping.newName;
                  if (mapping.category) {
                      finalCategoryName = mapping.category.name;
                      categoryApplied = true;
                  }
              }
      
              // ×©×œ×‘ 3.2: ×× ×œ× × ××¦××” ×§×˜×’×•×¨×™×” ×“×¨×š ××™×¤×•×™ ×™×©×™×¨, × ×‘×“×•×§ ×—×•×§×™ ×§×˜×’×•×¨×™×•×ª
              if (!categoryApplied) {
                  for (const rule of categoryRules) {
                      // ×”×—×•×§×™× ×¨×’×™×©×™× ×œ×’×•×“×œ ××•×ª, ×œ×›×Ÿ × ×©×•×•×” ×”×›×œ ×‘××•×ª×™×•×ª ×§×˜× ×•×ª
                      if (finalDescription.toLowerCase().includes(rule.keyword.toLowerCase())) {
                          if (rule.category) {
                              finalCategoryName = rule.category.name;
                              categoryApplied = true;
                              break; // ××¦×× ×• ×—×•×§ ××ª××™×, ××™×Ÿ ×¦×•×¨×š ×œ×”××©×™×š
                          }
                      }
                  }
              }
      
              // ×©×œ×‘ 3.3: ×”×—×œ×˜×” ×¡×•×¤×™×ª - ×”×× ×œ×”×¦×™×’ ×œ××©×ª××© ×‘×“×™××œ×•×’?
              // ×× ××—×¨×™ ×›×œ ×”×‘×“×™×§×•×ª ×”××•×˜×•××˜×™×•×ª ×¢×“×™×™×Ÿ ×œ× ×©×•×™×›×” ×§×˜×’×•×¨×™×”,
              // × ×•×¡×™×£ ××ª ×©× ×”×¡×•×—×¨ ×”××§×•×¨×™ ×œ×¨×©×™××” ×©×ª×—×–×•×¨ ×œ××©×ª××©.
              // ×–×” ××›×¡×” ×’× ×¡×•×—×¨×™× ×—×“×©×™× ×œ×’××¨×™ ×•×’× ×¡×•×—×¨×™× ×©××•×¤×• (×”×©× ×©×œ×”× ×©×•× ×”) ××‘×œ ×¢×“×™×™×Ÿ ××™×Ÿ ×œ×”× ×§×˜×’×•×¨×™×”.
              if (!categoryApplied) {
                  merchantsThatNeedMapping.add(originalDescription);
              }
      
              return { ...trx, description: finalDescription, category: finalCategoryName };
          });
      
          // ×©×œ×‘ 4: ×”×—×–×¨×ª ×”×ª×•×¦××” ×”×¡×•×¤×™×ª
          return {
              transactions,
              unseenMerchants: Array.from(merchantsThatNeedMapping)
          };
      }
    ğŸ“„ fundScraper.js
      import axios from 'axios';
      import * as cheerio from 'cheerio';
      
      export const getFundPriceBizportal = async (fundNumber) => {
        const url = `https://www.bizportal.co.il/mutualfunds/quote/generalview/${fundNumber}`;
        try {
          const { data } = await axios.get(url, { timeout: 8000 });
          const $ = cheerio.load(data);
          const priceText = $("div.num").first().text().trim().replace(/,/g, '');
      
          if (priceText) {
            const priceAgorot = parseFloat(priceText);
            return priceAgorot / 100.0; // ×”××¨×” ×××’×•×¨×•×ª ×œ×©×§×œ×™×
          }
          return 0.0;
        } catch (error) {
          console.error(`Failed to fetch price for fund ${fundNumber}:`, error.message);
          return 0.0;
        }
      };
    ğŸ“„ googleSheetService.js
      import { google } from 'googleapis';
      import path from 'path';
      import { fileURLToPath } from 'url';
      
      const { GOOGLE_SERVICE_ACCOUNT, GOOGLE_SHEET_ID_ORDERS, GOOGLE_SHEET_ID_PRODUCTS } = process.env;
      if (!GOOGLE_SERVICE_ACCOUNT || !GOOGLE_SHEET_ID_ORDERS || !GOOGLE_SHEET_ID_PRODUCTS) {
        throw new Error('Missing Google Sheets environment variables');
      }
      
      const ORDERS_SHEET_NAME = 'Orders';
      const PRODUCTS_SHEET_NAME = 'Products';
      const PRICE_LISTS_SHEET_NAME = 'PriceLists';
      const __dirname = path.dirname(fileURLToPath(import.meta.url));
      const KEY_FILE_PATH = path.resolve(__dirname, '..', GOOGLE_SERVICE_ACCOUNT);
      
      let sheets;
      try {
        const auth = new google.auth.GoogleAuth({
          keyFile: KEY_FILE_PATH,
          scopes: ['https://www.googleapis.com/auth/spreadsheets'],
        });
        sheets = google.sheets({ version: 'v4', auth });
      } catch (authError) {
          console.error(`[G-Sheets] FATAL: Could not authenticate. Path: ${KEY_FILE_PATH}`, authError);
          throw authError;
      }
      
      async function ensureSheetAndHeaders(spreadsheetId, sheetName, headers) {
        try {
          const spreadsheet = await sheets.spreadsheets.get({ spreadsheetId, fields: 'sheets.properties.title' });
          const sheetExists = spreadsheet.data.sheets.some(s => s.properties.title === sheetName);
          if (!sheetExists) {
            await sheets.spreadsheets.batchUpdate({
              spreadsheetId,
              requestBody: { requests: [{ addSheet: { properties: { title: sheetName } } }] },
            });
            await sheets.spreadsheets.values.update({
              spreadsheetId,
              range: `${sheetName}!A1`,
              valueInputOption: 'USER_ENTERED',
              requestBody: { values: [headers] },
            });
          }
        } catch (err) {
          console.error(`[G-Sheets] Error in ensureSheetAndHeaders for "${sheetName}":`, err.message);
          throw err;
        }
      }
      
      const rowsToObjects = (rows) => {
         if (!rows || rows.length < 2) return [];
          const headers = rows[0];
          return rows.slice(1).map(row => {
              const obj = {};
              headers.forEach((header, index) => {
                  obj[header] = row[index];
              });
              return obj;
          });
      };
      
      const getSheetData = async (spreadsheetId, sheetName) => {
          const response = await sheets.spreadsheets.values.get({ spreadsheetId, range: sheetName });
          return response.data.values;
      };
      
      const findRowIndex = (rows, columnHeader, value) => {
          if (!rows || rows.length < 1) return -1;
          const headerIndex = rows[0].indexOf(columnHeader);
          if (headerIndex === -1) return -1;
          for (let i = 1; i < rows.length; i++) {
              if (rows[i][headerIndex] === value) return i + 1;
          }
          return -1;
      };
      
      const findSheetIdByName = async (spreadsheetId, sheetName) => {
          const res = await sheets.spreadsheets.get({ spreadsheetId, fields: 'sheets(properties(sheetId,title))' });
          const sheet = res.data.sheets.find(s => s.properties.title === sheetName);
          if (!sheet) throw new Error(`Sheet with name "${sheetName}" not found.`);
          return sheet.properties.sheetId;
      };
      
      const serializeRoomsToJSON = (rooms) => {
        if (!rooms || !Array.isArray(rooms)) return '[]';
        try {
          const simplifiedRooms = rooms.map(r => ({
            adults: r.adults, teens: r.teens, children: r.children, babies: r.babies,
            price_list_names: r.price_list_names, price: r.price,
          }));
          return JSON.stringify(simplifiedRooms);
        } catch (e) {
          return '[]';
        }
      };
      
      const ORDERS_HEADERS = ['orderId', 'orderNumber', 'userEmail', 'userName', 'customerName', 'customerPhone', 'status', 'totalPrice', 'createdAt', 'notes', 'roomsJSON'];
      
      export const ordersService = {
        async ensureSheet() {
          await ensureSheetAndHeaders(GOOGLE_SHEET_ID_ORDERS, ORDERS_SHEET_NAME, ORDERS_HEADERS);
        },
      
        async getAll() {
          await this.ensureSheet();
          try {
              const rows = await getSheetData(GOOGLE_SHEET_ID_ORDERS, ORDERS_SHEET_NAME);
              return rowsToObjects(rows).map(o => {
                  let roomsData = [];
                  try {
                      if (o.roomsJSON) roomsData = JSON.parse(o.roomsJSON);
                  } catch (e) {
                      console.error(`Failed to parse roomsJSON for orderId ${o.orderId}`, e);
                  }
                  return {
                      ...o,
                      _id: o.orderId,
                      total_price: parseFloat(o.totalPrice) || 0,
                      createdAt: o.createdAt,
                      rooms: roomsData,
                  };
              });
          } catch (err) {
              console.error('âŒ [G-Sheets] Failed to getAll orders:', err);
              throw err;
          }
        },
      
        async add(orderData) {
          await this.ensureSheet();
          try {
              const newRow = [
                  orderData._id.toString(),
                  orderData.orderNumber,
                  orderData.user?.email || 'N/A',
                  orderData.salespersonName || orderData.user?.name || 'N/A',
                  orderData.customerName,
                  orderData.customerPhone || '',
                  orderData.status || '×‘×”××ª× ×”',
                  orderData.total_price,
                  orderData.createdAt.toISOString(),
                  orderData.notes || '',
                  serializeRoomsToJSON(orderData.rooms),
              ];
              await sheets.spreadsheets.values.append({
                  spreadsheetId: GOOGLE_SHEET_ID_ORDERS, range: `${ORDERS_SHEET_NAME}!A1`,
                  valueInputOption: 'USER_ENTERED', requestBody: { values: [newRow] },
              });
              return orderData;
          } catch(err) {
              console.error(`âŒ [G-Sheets] Failed to add order ID ${orderData._id}:`, err);
              throw err;
          }
        },
      
        async update(orderId, orderData) {
          await this.ensureSheet();
          try {
            const rows = await getSheetData(GOOGLE_SHEET_ID_ORDERS, ORDERS_SHEET_NAME);
            const rowIndex = findRowIndex(rows, 'orderId', orderId.toString());
            if (rowIndex === -1) {
                return this.add({ ...orderData, _id: orderId });
            }
            const updatedRow = [
              orderId.toString(), orderData.orderNumber,
              orderData.user?.email || rows[rowIndex-1][2],
              orderData.salespersonName || orderData.user?.name || rows[rowIndex-1][3],
              orderData.customerName,
              orderData.customerPhone || (rows[rowIndex-1] ? rows[rowIndex-1][5] : ''),
              orderData.status, orderData.total_price,
              new Date(orderData.createdAt).toISOString(),
              orderData.notes || '',
              serializeRoomsToJSON(orderData.rooms),
            ];
            await sheets.spreadsheets.values.update({
              spreadsheetId: GOOGLE_SHEET_ID_ORDERS,
              range: `${ORDERS_SHEET_NAME}!A${rowIndex}:${String.fromCharCode(65 + updatedRow.length - 1)}${rowIndex}`,
              valueInputOption: 'USER_ENTERED',
              requestBody: { values: [updatedRow] },
            });
          } catch(err) {
            console.error(`âŒ [G-Sheets] Failed to update order ID ${orderId}:`, err);
            throw err;
          }
        },
      
        async delete(orderId) {
          await this.ensureSheet();
          try {
            const rows = await getSheetData(GOOGLE_SHEET_ID_ORDERS, ORDERS_SHEET_NAME);
            const rowIndex = findRowIndex(rows, 'orderId', orderId.toString());
            if (rowIndex === -1) return;
            const sheetId = await findSheetIdByName(GOOGLE_SHEET_ID_ORDERS, ORDERS_SHEET_NAME);
            await sheets.spreadsheets.batchUpdate({
              spreadsheetId: GOOGLE_SHEET_ID_ORDERS,
              requestBody: { requests: [{ deleteDimension: { range: { sheetId, dimension: 'ROWS', startIndex: rowIndex - 1, endIndex: rowIndex } } }] }
            });
          } catch (err) {
            console.error(`âŒ [G-Sheets] Failed to delete order ID ${orderId}:`, err);
            throw err;
          }
        }
      };
      
      // --- ×©×™×¨×•×ª ××•×¦×¨×™× (Products Service) ---
      export const productsService = {
        async getAll() {
          console.log('[G-Sheets] Getting all products.');
          try {
            await ensureSheetAndHeaders(GOOGLE_SHEET_ID_PRODUCTS, PRODUCTS_SHEET_NAME, ['productId', 'name', 'description', 'price', 'category', 'kashrut', 'unit', 'imageUrl', 'isActive']);
            const rows = await getSheetData(GOOGLE_SHEET_ID_PRODUCTS, PRODUCTS_SHEET_NAME);
            const products = rowsToObjects(rows);
            return products.filter(p => p.isActive === 'TRUE');
          } catch (err) {
            console.error('âŒ [G-Sheets] Failed to getAll products:', err);
            throw err;
          }
        },
        async add(productData) {
          console.log(`[G-Sheets] Adding product: ${productData.name}`);
          try {
              const newRow = [
                  productData._id.toString(), productData.name, productData.description || '', productData.price,
                  productData.category, productData.kashrut, productData.unit, productData.imageUrl || '', 'TRUE'
              ];
              await sheets.spreadsheets.values.append({
                 spreadsheetId: GOOGLE_SHEET_ID_PRODUCTS, range: `${PRODUCTS_SHEET_NAME}!A1`,
                 valueInputOption: 'USER_ENTERED', requestBody: { values: [newRow] }
              });
              console.log(`âœ… [G-Sheets] Successfully added product: ${productData.name}`);
              return productData;
          } catch(err) {
              console.error(`âŒ [G-Sheets] Failed to add product "${productData.name}":`, err);
              throw err;
          }
        },
        async update(productId, productData) {
          console.log(`[G-Sheets] Updating product ID: ${productId}`);
           try {
               const rows = await getSheetData(GOOGLE_SHEET_ID_PRODUCTS, PRODUCTS_SHEET_NAME);
              const rowIndex = findRowIndex(rows, 'productId', productId);
              if (rowIndex === -1) throw new Error('Product not found in Sheet');
              const updatedRow = [
                 productId, productData.name, productData.description || '', productData.price,
                 productData.category, productData.kashrut, productData.unit, productData.imageUrl || '',
                  productData.isActive !== false ? 'TRUE' : 'FALSE'
              ];
              await sheets.spreadsheets.values.update({
                 spreadsheetId: GOOGLE_SHEET_ID_PRODUCTS,
                 range: `${PRODUCTS_SHEET_NAME}!A${rowIndex}:${String.fromCharCode(65 + updatedRow.length - 1)}${rowIndex}`,
                  valueInputOption: 'USER_ENTERED', requestBody: { values: [updatedRow] }
              });
              console.log(`âœ… [G-Sheets] Successfully updated product ID: ${productId}`);
              return { _id: productId, ...productData };
          } catch(err) {
              console.error(`âŒ [G-Sheets] Failed to update product ID ${productId}:`, err);
              throw err;
          }
        },
        async delete(productId) {
          console.log(`[G-Sheets] Deleting (disabling) product ID: ${productId}`);
          try {
              const rows = await getSheetData(GOOGLE_SHEET_ID_PRODUCTS, PRODUCTS_SHEET_NAME);
              const rowIndex = findRowIndex(rows, 'productId', productId);
              if (rowIndex === -1) throw new Error('Product not found in Sheet');
              const activeColIndex = rows[0].indexOf('isActive');
              const activeColLetter = String.fromCharCode(65 + activeColIndex);
              await sheets.spreadsheets.values.update({
                  spreadsheetId: GOOGLE_SHEET_ID_PRODUCTS,
                  range: `${PRODUCTS_SHEET_NAME}!${activeColLetter}${rowIndex}`,
                  valueInputOption: 'USER_ENTERED', requestBody: { values: [['FALSE']] }
              });
              console.log(`âœ… [G-Sheets] Successfully disabled product ID: ${productId}`);
              return { productId };
          } catch(err) {
              console.error(`âŒ [G-Sheets] Failed to delete product ID ${productId}:`, err);
              throw err;
          }
        }
      };
      
      // --- ×©×™×¨×•×ª ××—×™×¨×•× ×™× (Price Lists Service) ---
      const PRICE_LISTS_HEADERS = ['priceListId', 'name', 'couple', 'teen', 'child', 'baby', 'single_room', 'userEmail'];
      
      export const priceListsService = {
        async ensureSheet() {
          await ensureSheetAndHeaders(GOOGLE_SHEET_ID_PRODUCTS, PRICE_LISTS_SHEET_NAME, PRICE_LISTS_HEADERS);
        },
      
        async getAll() {
          console.log('[G-Sheets] Getting all price lists.');
          await this.ensureSheet();
          try {
            const rows = await getSheetData(GOOGLE_SHEET_ID_PRODUCTS, PRICE_LISTS_SHEET_NAME);
      
            const priceLists = (rowsToObjects(rows) || []).map(pl => ({
              ...pl,
              _id: pl.priceListId,
              couple: parseFloat(pl.couple) || 0,
              teen: parseFloat(pl.teen) || 0,
              child: parseFloat(pl.child) || 0,
              baby: parseFloat(pl.baby) || 0,
              single_room: parseFloat(pl.single_room) || 0,
            }));
      
            console.log(`âœ… [G-Sheets] Successfully fetched ${priceLists.length} price lists.`);
            return priceLists;
          } catch (err) {
            console.error('âŒ [G-Sheets] Failed to getAll price lists:', err);
            throw err;
          }
        },
      
        async add(priceListData) {
          console.log(`[G-Sheets] Adding price list: ${priceListData.name}`);
          await this.ensureSheet();
          try {
              const newRow = [
                  priceListData._id.toString(),
                  priceListData.name,
                  priceListData.couple,
                  priceListData.teen,
                  priceListData.child,
                  priceListData.baby,
                  priceListData.single_room,
                  priceListData.user?.email || 'N/A'
              ];
              await sheets.spreadsheets.values.append({
                  spreadsheetId: GOOGLE_SHEET_ID_PRODUCTS,
                  range: `${PRICE_LISTS_SHEET_NAME}!A1`,
                  valueInputOption: 'USER_ENTERED',
                  requestBody: { values: [newRow] },
              });
              console.log(`âœ… [G-Sheets] Successfully added price list: ${priceListData.name}`);
              return priceListData;
          } catch(err) {
              console.error(`âŒ [G-Sheets] Failed to add price list "${priceListData.name}":`, err);
              throw err;
          }
        },
      
        async update(priceListId, priceListData) {
            console.log(`[G-Sheets] Updating price list ID: ${priceListId}`);
            await this.ensureSheet();
            try {
                const rows = await getSheetData(GOOGLE_SHEET_ID_PRODUCTS, PRICE_LISTS_SHEET_NAME);
                const rowIndex = findRowIndex(rows, 'priceListId', priceListId);
                if (rowIndex === -1) throw new Error('Price list not found in Sheet');
      
                const updatedRow = [
                    priceListId,
                    priceListData.name,
                    priceListData.couple,
                    priceListData.teen,
                    priceListData.child,
                    priceListData.baby,
                    priceListData.single_room,
                    priceListData.user?.email || (rows[rowIndex-1] ? rows[rowIndex-1][7] : 'N/A')
                ];
      
                await sheets.spreadsheets.values.update({
                    spreadsheetId: GOOGLE_SHEET_ID_PRODUCTS,
                    range: `${PRICE_LISTS_SHEET_NAME}!A${rowIndex}:${String.fromCharCode(65 + updatedRow.length - 1)}${rowIndex}`,
                    valueInputOption: 'USER_ENTERED',
                    requestBody: { values: [updatedRow] },
                });
                console.log(`âœ… [G-Sheets] Successfully updated price list ID: ${priceListId}`);
                return { _id: priceListId, ...priceListData };
            } catch(err) {
                console.error(`âŒ [G-Sheets] Failed to update price list ID ${priceListId}:`, err);
                throw err;
            }
        },
      
        async delete(priceListId) {
            console.log(`[G-Sheets] Deleting price list ID: ${priceListId}`);
            await this.ensureSheet();
            try {
                const rows = await getSheetData(GOOGLE_SHEET_ID_PRODUCTS, PRICE_LISTS_SHEET_NAME);
                const rowIndex = findRowIndex(rows, 'priceListId', priceListId);
                if (rowIndex === -1) {
                    console.warn(`[G-Sheets] Price list ${priceListId} not found for deletion.`);
                    return;
                }
      
                const sheetId = await findSheetIdByName(GOOGLE_SHEET_ID_PRODUCTS, PRICE_LISTS_SHEET_NAME);
      
                await sheets.spreadsheets.batchUpdate({
                    spreadsheetId: GOOGLE_SHEET_ID_PRODUCTS,
                    requestBody: {
                        requests: [{
                            deleteDimension: {
                                range: { sheetId, dimension: 'ROWS', startIndex: rowIndex - 1, endIndex: rowIndex }
                            }
                        }]
                    }
                });
                console.log(`âœ… [G-Sheets] Successfully deleted price list ID: ${priceListId}`);
            } catch(err) {
                console.error(`âŒ [G-Sheets] Failed to delete price list ID ${priceListId}:`, err);
                throw err;
            }
        }
      };
    ğŸ“„ googleSheets.js
      import { google } from 'googleapis';
      import path from 'path';
      
      const { GOOGLE_SERVICE_ACCOUNT, GOOGLE_SHEET_ID } = process.env;
      if (!GOOGLE_SERVICE_ACCOUNT) throw new Error('GOOGLE_SERVICE_ACCOUNT missing');
      if (!GOOGLE_SHEET_ID)       throw new Error('GOOGLE_SHEET_ID missing');
      
      const auth = new google.auth.GoogleAuth({
        keyFile: path.resolve(GOOGLE_SERVICE_ACCOUNT),
        scopes: ['https://www.googleapis.com/auth/spreadsheets'],
      });
      const sheets = google.sheets({ version: 'v4', auth });
      
      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ public helper â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      export async function appendOrder(row, tab) {
        await ensureSheet(tab);
      
        /* ×”-range ×—×™×™×‘ ×œ×”×™×•×ª ×¢× ×’×¨×©×™×™× ×× ×”×©× ×›×•×œ×œ ×ª×•×•×™× ×œ×-×œ×˜×™× ×™×™× / ×¨×•×•×—×™× */
        const range = `'${tab}'!A1`;
      
        await sheets.spreadsheets.values.append({
          spreadsheetId: GOOGLE_SHEET_ID,
          range,
          valueInputOption: 'USER_ENTERED',
          requestBody: { values: [row] },
        });
      }
      
      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ create sheet if missing â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      async function ensureSheet(title) {
        const meta = await sheets.spreadsheets.get({
          spreadsheetId: GOOGLE_SHEET_ID,
          fields: 'sheets.properties.title',
        });
      
        const exists = meta.data.sheets.some(
          (s) => s.properties.title === title
        );
        if (exists) return;
      
        await sheets.spreadsheets.batchUpdate({
          spreadsheetId: GOOGLE_SHEET_ID,
          requestBody: {
            requests: [{ addSheet: { properties: { title } } }],
          },
        });
      }
    ğŸ“„ loanCalculator.js
      // server/utils/loanCalculator.js
      
      /**
       * ××—×–×™×¨ ××ª ×”×¨×™×‘×™×ª ×©×”×™×™×ª×” ×‘×ª×•×§×£ ×œ×ª××¨×™×š ××¡×•×™×.
       */
      function getRateForDate(date, rateHistory) {
        const applicableRate = rateHistory
          .filter(r => r.date <= date)
          .pop();
        return applicableRate ? applicableRate.rate : (rateHistory[0]?.rate || 0);
      }
      
      /**
       * ××—×©×‘ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ ×“×™× ××™ ×”××‘×•×¡×¡ ×¢×œ ×”×™×¡×˜×•×¨×™×™×ª ×¨×™×‘×™×•×ª ××©×ª× ×”.
       */
      export function calculateDynamicSchedule({ loan, rateHistory }) {
        const { principal, termInMonths, startDate, repaymentType, interestMargin } = loan;
        const schedule = [];
        let remainingBalance = principal;
        const principalPerMonth = repaymentType === '×§×¨×Ÿ ×©×•×•×”' ? principal / termInMonths : 0;
      
        for (let i = 1; i <= termInMonths; i++) {
          const paymentDate = new Date(startDate);
          paymentDate.setMonth(paymentDate.getMonth() + i);
      
          const primeRate = getRateForDate(paymentDate, rateHistory);
          const annualRate = primeRate + interestMargin;
          const monthlyInterestRate = annualRate / 100 / 12;
      
          // ×”×¨×™×‘×™×ª ×¢×œ ×”×ª×©×œ×•× ×”× ×•×›×—×™ ×ª××™×“ ××—×•×©×‘×ª ×¢×œ ×”×™×ª×¨×” ×”×§×™×™××ª
          const interestPayment = remainingBalance * monthlyInterestRate;
          let principalPayment, totalPayment;
      
          if (repaymentType === '×©×¤×™×¦×¨') {
            // =======================   ×”×ª×™×§×•×Ÿ ×›××Ÿ   =======================
            // ×”×•×¡×¤× ×• ×‘×“×™×§×” ×¤×©×•×˜×”: ×× ×”×¨×™×‘×™×ª ×”×™× 0, ×”×—×™×©×•×‘ ×¤×©×•×˜ ×•××•× ×¢ ×—×œ×•×§×” ×‘××¤×¡.
            if (monthlyInterestRate === 0) {
              totalPayment = principal / termInMonths;
              principalPayment = totalPayment; // ×‘×¨×™×‘×™×ª 0, ×›×œ ×”×ª×©×œ×•× ×”×•× ×¢×œ ×—×©×‘×•×Ÿ ×”×§×¨×Ÿ
            } else {
              // ×× ×”×¨×™×‘×™×ª ××™× ×” 0, × ×©×ª××© ×‘× ×•×¡×—×” ×”××•×¨×›×‘×ª ×”××§×•×¨×™×ª
              const remainingTerm = termInMonths - i + 1;
              const monthlyPayment = remainingBalance * (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, remainingTerm)) / (Math.pow(1 + monthlyInterestRate, remainingTerm) - 1);
              totalPayment = monthlyPayment;
              principalPayment = monthlyPayment - interestPayment;
            }
            // =====================   ×¡×•×£ ×”×ª×™×§×•×Ÿ   =====================
      
          } else { // ×§×¨×Ÿ ×©×•×•×”
            principalPayment = principalPerMonth;
            totalPayment = principalPerMonth + interestPayment;
          }
      
          remainingBalance -= principalPayment;
      
          schedule.push({
            paymentNumber: i,
            date: paymentDate,
            principal: parseFloat(principalPayment.toFixed(2)),
            interest: parseFloat(interestPayment.toFixed(2)),
            totalPayment: parseFloat(totalPayment.toFixed(2)),
            remainingBalance: parseFloat(Math.max(0, remainingBalance).toFixed(2)),
            rate: annualRate,
          });
        }
        return schedule;
      }
    ğŸ“„ pushHandler.js
      import webpush from 'web-push';
      import Subscription from '../models/Subscription.js';
      
      // =================================================================
      // ğŸ”‘ ×”×’×“×¨×•×ª VAPID Keys - ×”××¤×ª×—×•×ª ×©×œ×š
      // =================================================================
      const publicVapidKey = 'BK2xkowsIPCT8VCKEuioVCHmXa3kS10k3yoWh-uCoxKMwGyW4jRh5HdYjkg0RiS4ZOjylCIMSMSgvm23Cai7pFA';
      const privateVapidKey = 'PkRNszG1kHw2RvhvuZwDd6YcZVrceyJgc_a18bk43Z0';
      const adminEmail = 'mailto:admin@zipori.com'; // ×›×ª×•×‘×ª ×”××™×™×œ ×©×œ×š ×œ××§×¨×” ×©×œ ×‘×¢×™×•×ª ×‘×©×œ×™×—×”
      
      // ×”×’×“×¨×ª ×”×¡×¤×¨×™×™×” ×¢× ×”××¤×ª×—×•×ª
      try {
          webpush.setVapidDetails(
              adminEmail,
              publicVapidKey,
              privateVapidKey
          );
          console.log('âœ… VAPID Keys configured successfully.');
      } catch (error) {
          console.warn("âŒ Warning: VAPID keys configuration failed:", error.message);
      }
      
      // ×™×™×¦×•× ×”××¤×ª×— ×”×¦×™×‘×•×¨×™ ×›×“×™ ×©×”×¦×“-×œ×§×•×— ×™×•×›×œ ×œ×”×™×¨×©× ××œ×™×•
      export const getPublicKey = () => publicVapidKey;
      
      /**
       * ×©×•×œ×— ×”×•×“×¢×ª Push ×œ×›×œ ×”×× ×•×™×™× ×”×¨×©×•××™× ×‘××¢×¨×›×ª
       * @param {Object} payload - { title, body, url, icon }
       */
      export const sendPushToAll = async (payload) => {
        // ×©×œ×™×¤×ª ×›×œ ×”×× ×•×™×™× ××”×“××˜×”-×‘×™×™×¡
        const subscriptions = await Subscription.find({});
      
        if (subscriptions.length === 0) return;
      
        const notificationPayload = JSON.stringify({
          title: payload.title || '×”×•×“×¢×” ×—×“×©×”',
          body: payload.body || '×™×© ×œ×š ×¢×“×›×•×Ÿ ×‘××¢×¨×›×ª',
          url: payload.url || '/',
          icon: '/favicon.svg'
        });
      
        console.log(`ğŸ“¤ Sending push notification to ${subscriptions.length} subscribers...`);
      
        const promises = subscriptions.map(sub => {
          const pushConfig = {
            endpoint: sub.endpoint,
            keys: {
              auth: sub.keys.auth,
              p256dh: sub.keys.p256dh
            }
          };
      
          return webpush.sendNotification(pushConfig, notificationPayload)
            .catch(err => {
              // ×§×•×“ 410 ××• 404 ××•××¨ ×©×”×× ×•×™ ×›×‘×¨ ×œ× ×§×™×™× (×”××©×ª××© ×”×¡×™×¨ ×”×¨×©××”)
              if (err.statusCode === 410 || err.statusCode === 404) {
                console.log(`ğŸ—‘ï¸ Subscription expired, deleting: ${sub._id}`);
                return Subscription.findByIdAndDelete(sub._id);
              }
              console.error('âŒ Error sending push:', err.statusCode);
            });
        });
      
        await Promise.all(promises);
      };
    ğŸ“„ tokenHandler.js
      import jwt from 'jsonwebtoken';
      
      const signAccessToken = (payload) =>
        jwt.sign(payload, process.env.JWT_ACCESS_SECRET, { expiresIn: '15m' });
      
      const signRefreshToken = (payload) =>
        jwt.sign(payload, process.env.JWT_REFRESH_SECRET, { expiresIn: '7d' });
      
      export const createAndSendTokens = (user, res) => {
        const accessToken = signAccessToken({ id: user._id, role: user.role });
        const refreshToken = signRefreshToken({ id: user._id, v: user.tokenVersion });
      
        // â¬‡ï¸ === ×ª×™×§×•×Ÿ: ×”×’×“×¨×” ×–×• ×—×™×™×‘×ª ×œ×”×™×•×ª true ×¢×‘×•×¨ SameSite=None === â¬‡ï¸
        const secure = true;
      
        res
          .cookie('jwt', accessToken, {
            httpOnly: true,
            // â¬‡ï¸ === ×ª×™×§×•×Ÿ: SameSite=None × ×“×¨×© ×œ×‘×§×©×•×ª cross-domain === â¬‡ï¸
            sameSite: 'None',
            secure, // ×™×§×‘×œ 'true'
            maxAge: 15 * 60 * 1000,
          })
          .cookie('refreshToken', refreshToken, {
            httpOnly: true,
            // â¬‡ï¸ === ×ª×™×§×•×Ÿ: SameSite=None × ×“×¨×© ×œ×‘×§×©×•×ª cross-domain === â¬‡ï¸
            sameSite: 'None',
            secure, // ×™×§×‘×œ 'true'
            maxAge: 7 * 24 * 60 * 60 * 1000,
          });
      };
    ğŸ“„ validators.js
      import { body, validationResult } from 'express-validator';
      import AppError from './AppError.js';
      
      const handleValidationErrors = (req, res, next) => {
        const errors = validationResult(req);
        if (!errors.isEmpty()) {
          const message = errors.array().map(err => err.msg).join('. ');
          return next(new AppError(message, 400));
        }
        next();
      };
      
      export const registerValidator = [
        body('email').isEmail().withMessage('Please provide a valid email address.'),
        body('password').isLength({ min: 6 }).withMessage('Password must be at least 6 characters long.'),
        handleValidationErrors,
      ];
      
      export const loginValidator = [
        body('email').isEmail().withMessage('Please provide a valid email.'),
        body('password').notEmpty().withMessage('Password is required.'),
        handleValidationErrors,
      ];
      
      export const productValidator = [
        body('name').notEmpty().withMessage('Product name is required.'),
        body('price').isFloat({ gt: 0 }).withMessage('Price must be a positive number.'),
        body('description').notEmpty().withMessage('Description is required.'),
        body('category').isIn(['main', 'side', 'dessert', 'drink']).withMessage('Invalid category.'),
        handleValidationErrors,
      ];
      
      export { handleValidationErrors };
ğŸ“„ start-all.bat
ğŸ“„ vc.html
  <!DOCTYPE html>
  <html lang="he" dir="rtl">
  <head>
      <meta charset="UTF-8">
      <title>×‘×“×™×§×ª ×ª××•× ×”</title>
      <style>
          body { font-family: sans-serif; text-align: center; padding-top: 50px; }
          img { border: 2px solid #ccc; margin-top: 20px; }
      </style>
  </head>
  <body>
      <h1>×‘×“×™×§×” ×¤×©×•×˜×”</h1>
      <p>×× ×”×ª××•× ×” ××•×¤×™×¢×” ××ª×—×ª, ×”×©×¨×ª ×©×œ×š ××’×™×© ×ª××•× ×•×ª ×›××• ×©×¦×¨×™×š.</p>
      <img
          src="http://localhost:4000/uploads/test.jpg"
          alt="×ª××•× ×ª ×‘×“×™×§×”"
          width="500"
      />
  </body>
  </html>